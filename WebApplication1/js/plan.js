/* 
 *  Copyright (c) 2012-2014, Inspirock Corporation.
 *  All rights reserved.
 */

/* 
 *  Copyright (c) 2012-2017, Inspirock Corporation.
 *  All rights reserved.
 */

/*
 *  Copyright (c) 2012-2014, Inspirock Corporation.
 *  All rights reserved.
 */

/*
 *  Copyright (c) 2012-2016, Inspirock Corporation.
 *  All rights reserved.
 */

/*! fancyBox v2.1.5 fancyapps.com | fancyapps.com/fancybox/#license */

/* 
 *  Copyright (c) 2012-2016, Inspirock Corporation.
 *  All rights reserved.
 */

/* 
 *  Copyright (c) 2012-2018, Inspirock Corporation.
 *  All rights reserved.
 */

/* 
 *  Copyright (c) 2012-2013, Inspirock Corporation.
 *  All rights reserved.
 */

/* 
 *  Copyright (c) 2012-2015, Inspirock Corporation.
 *  All rights reserved.
 */

// Initialize copyright if photo is loaded in qtip

/*
 *  Copyright (c) 2012-2015, Inspirock Corporation.
 *  All rights reserved.
 */

/*
 *  Copyright (c) 2012-2014, Inspirock Corporation.
 *  All rights reserved.pla
 */

/*!
 * FullCalendar v3.4.0
 * Docs & License: https://fullcalendar.io/
 * (c) 2017 Adam Shaw
 */

//initialize copyright

/*
 *  Copyright (c) 2012-2013, Inspirock Corporation.
 *  All rights reserved.
 */

define("plan/loading",["jquery"],function(){return{showLoading:function(a,g,d){var p=$("#planContent");g.css({opacity:0,"pointer-events":"none"});a.find(".progress-txt").text(d);a.removeClass("hidden");g=$(".modal-box").length?$(".modal-box .ui-dialog-content").scrollTop()+100:Math.min($("#planContent").height()-138,$(window).scrollTop()+200-(p.length?p.offset().top:0));g=Math.max(140,g);a.css("top",g+"px");$("body").addClass("loading")},hideLoading:function(a,g){g.css({opacity:1,"pointer-events":""});
a.addClass("hidden");$("body").removeClass("loading")}}});
define("modules/view",["modules/events","modules/utils","jquery"],function(a,g){var d={},p;d.scrollCalendarElementIntoViewInModal=function(d,a,i){d=d instanceof jQuery?d:$(document.getElementById(d));d.length&&(a=i?i.parents(".dlg-show-overflow-calendar"):void 0,a=parseInt(a.css("padding-top"),10)+parseInt(a.css("top"),10),a=i.offset().top+a+i.find("#calendarBox .fc-head .fc-row thead").height()+i.find("#calendarStayBox").height(),d=d.offset().top-a,i.scrollTop(d))};d.scrollCalendarElementIntoView=
function(d){d=d instanceof jQuery?d:$(document.getElementById(d));if(d.length){var a=$("#itinerarySubnavPane").height()+$("#planHeader").height()+$("#calendarBox .fc-head .fc-row thead").height()+$("#calendarStayBox").height(),d=d.offset().top-a,a=$("footer").offset().top-$(window).height(),d=Math.min(a,d);localStorage&&!localStorage.getItem("firstTimeLoadOfCalendarPage")?($("html").animate({scrollTop:d},"slow"),localStorage.setItem("firstTimeLoadOfCalendarPage",!0)):window.scrollTo(0,d)}};d.scrollDayByDayElementIntoView=
function(d,a){var i=d instanceof jQuery?d:$(document.getElementById(d));i.length&&(i=i.offset().top-$("#planHeader").height()-parseInt($("#itineraryMainPane").css("margin-top"))-parseInt($("#daybyday").css("margin-top"))+10,p=!0,$("html, body").animate({scrollTop:i},a?500:0,function(){p=!1}))};d.scrollElementIntoView=function(d,a,i,c){d=d instanceof jQuery?d:$(document.getElementById(d));if(d.length){void 0===a&&(a=0);var b=d.offset().left,f=d.offset().top,g=d.offset().left+d.outerWidth(),n=d.offset().top+
d.outerHeight(),k=window.pageXOffset,h=window.pageYOffset,e=window.pageXOffset+$(window).width(),l=window.pageYOffset+$(window).height();if(b>=k&&g<=e&&f>=h&&n<=l)c&&c();else if(b=0<$(".modal-box").length,d=d.offset().top,b&&(d+=$(".modal-box .ui-dialog-content").scrollTop()),a=d-10+a,p=!0,i)window.scrollTo(0,a),p=!1,c&&c();else{var t=!1;(b?$(".modal-box .ui-dialog-content"):$("html, body")).animate({scrollTop:a},500,function(){p=!1;!t&&c&&(c(),t=!0)})}}};d.scrollAndUpdate=function(){a.triggerEvent("view",
"scroll",{manualScrollEvent:p})};d.initialize=function(){var m;if(m=window.addEventListener){var j=!1;try{var i=Object.defineProperty({},"passive",{get:function(){j=!0}});window.addEventListener("test",null,i)}catch(c){}m=j}m?window.addEventListener("scroll",function(){d.scrollAndUpdate()},{passive:!0}):$(window).scroll(function(){d.scrollAndUpdate()});g.enableMouseWheel();a.addObserver("scroll-first-visit","view",function(c,f){f.$dialog?d.scrollCalendarElementIntoViewInModal(f.element,f.additionalYOffset,
f.$dialog):d.scrollCalendarElementIntoView(f.element,f.additionalYOffset)})};return d});define("modules/log",[],function(){return{debug:function(){window.debugLogsEnabled&&console.log.apply(this,arguments)},info:function(){console.log.apply(this,arguments)}}});
define("modules/history","plan/loading modules/events modules/view modules/utils modules/log jquery".split(" "),function(a,g,d,p,m){var j={},i=0;j.getState=function(){return window.history.state};j.push=function(c,b,d,a,n){if(window.history.pushState&&d){var j=window.history.state;if(j){j.pageYOffset=window.pageYOffset;!n&&(0!==n&&a&&a.historyData)&&(n=a.historyData.pageYOffset,delete a.historyData.pageYOffset);if(n||0===n)j.pageYOffset=n;window.history.replaceState(j,"")}c={id:c,tabId:b,url:d,data:a,
pageYOffset:window.pageYOffset,stateCount:++i};m.debug("push",c);window.history.pushState(c,"",d)}};j.replace=function(c,b,d,a,j){if(window.history.replaceState&&d){var k=window.history.state;i=k&&k.stateCount?k.stateCount:i;c={id:c,tabId:b,url:d,data:a,pageYOffset:void 0!==j?j:window.pageYOffset,stateCount:i};m.debug("replace",c);window.history.replaceState(c,"",d)}};j.pop=function(){window.history&&window.history.back()};j.initialize=function(){j.disable=!1;window.onpopstate=function(c){m.debug("pop",
c.state);var b=c.state;p.hideAllOpenQtips();(!b||b.stateCount<i)&&g.triggerEvent("history","back-btn",{});if(window.history&&null!==b){i=b.stateCount;(!b.data||!b.data.modal)&&g.triggerEvent("history","close-modal",{});if("explore"===b.tabId||b.data&&"explore"===b.data.modal)(!b.data||"explore"!==b.data.modal&&!b.data.isModal)&&g.triggerEvent("history","show-tab-explore",{addToHistory:!1}),"exploreAttractionDetails"===b.id?(!p.isMobile()&&(!b.data||"explore"!==b.data.modal)&&a.showLoading($("#exploreLoadingPane"),
$("#exploreMainPane"),"Loading..."),g.triggerEvent("history","explore-attraction-details",{url:b.data.detailsUrl,analyticsEventCategory:b.data.eventSource,shouldScroll:!1,backText:b.data.backText,tabId:b.data.tabId})):"exploreDestinationDetails"===b.id?(!p.isMobile()&&(!b.data||"explore"!==b.data.modal)&&a.showLoading($("#exploreLoadingPane"),$("#exploreMainPane"),"Loading..."),g.triggerEvent("history","explore-destination-details",{url:b.data.detailsUrl,analyticsEventCategory:b.data.eventSource,
shouldScroll:!1,backText:b.data.backText})):"browseattractions"===b.id.toLowerCase()?(b.data.subnav="attractions",!b.data||!b.data.isModal?g.triggerEvent("history","explore-browse",b.data||{}):(b.data.addlData={requestData:b.data.requestData},g.triggerEvent("history","load-explore-in-modal",b.data))):"browsedestinations"===b.id.toLowerCase()?(b.data.subnav="destinations",!b.data||!b.data.isModal?g.triggerEvent("history","explore-browse",b.data||{}):(b.data.addlData={requestData:b.data.requestData},
g.triggerEvent("history","load-explore-in-modal",b.data))):"browseabout"===b.id.toLowerCase()?(b.data.subnav="about",!b.data||!b.data.isModal?g.triggerEvent("history","explore-browse",b.data||{}):(b.data.addlData={requestData:b.data.requestData},g.triggerEvent("history","load-explore-in-modal",b.data))):(b.data={},b.data.subnav="attractions",g.triggerEvent("history","explore-browse",b.data||{}));if("itinerary"===b.tabId){var c={},f={};c.addToHistory=!1;c.tabData=f;f.subnav=b.data&&b.data.targetId?
b.data.targetId:"daybyday";f.subnavLinkId=b.data&&b.data.subnavLinkId?b.data.subnavLinkId:"daybydaylink";f.historyData=b.data&&b.data.historyData?b.data.historyData:{};f.historyData.noPush=!0;g.triggerEvent("history","show-tab-itinerary",c)}else"overview"===b.tabId||b.data&&"overview"===b.data.modal?"addDestination"===b.id?g.triggerEvent("history","show-add-destination-dialog",{addToHistory:!1}):"editRoute"===b.id?g.triggerEvent("history","show-edit-route",{addToHistory:!1}):g.triggerEvent("history",
"show-tab-overview",{addToHistory:!1}):"notifications"===b.tabId||b.data&&"notifications"===b.data.modal?g.triggerEvent("history","show-tab-notifications",{addToHistory:!1}):"alerts"===b.tabId?g.triggerEvent("history","show-tab-alerts",{addToHistory:!1}):"collaborate"===b.tabId?g.triggerEvent("history","show-tab-collaborator",{addToHistory:!1}):"transportation"===b.tabId?"addReservation"===b.id?g.triggerEvent("history","show-add-reservation",{addToHistory:!1}):g.triggerEvent("history","show-tab-transportation",
{addToHistory:!1}):$(".tab-"+b.tabId).trigger("click");$(".ui-dialog:not(.modal-box) .ui-dialog-content").dialog("close");$.fancybox.close();if(-1!==location.pathname.indexOf("https://www.inspirock.com/modal/"))$(".modal-box").off("idle.modal").on("idle.modal",function(){var c=$(this).find(".ui-dialog-content");window.setTimeout(function(){c.scrollTop(b.pageYOffset)},0);$(this).off("idle.modal")});else window.setTimeout(function(){window.scrollTo(0,b.pageYOffset)},0);d.scrollAndUpdate()}}};return j});
define("modules/modal","modules/utils modules/events modules/ajax modules/history jquery jqueryui jqueryuioverrides".split(" "),function(a,g,d,p){function m(h,e){if("open-modal"===e.action){var a=b.isOpen()?b.scrollTop():window.pageYOffset,t=e.param;b.isOpen()&&(k.parents(".modal-box").toggleClass("full",t.dialogClass&&-1!==t.dialogClass.indexOf("full")),k.parents(".modal-box").toggleClass("dock-close",t.dialogClass&&-1!==t.dialogClass.indexOf("dock-close")),b.param&&b.param.dialogClass&&k.parents(".modal-box").removeClass(b.param.dialogClass),
k.parents(".modal-box").addClass(t.dialogClass));b.param=t;if(!b.isOpen())if(window.history.state)b.staticData=window.history.state.data&&window.history.state.data.parentId?{history:{id:window.history.state.data.parentId,tabId:window.history.state.data.parentTabId,data:window.history.state.data},path:window.history.state.data.pathname}:{history:{id:window.history.state.id,tabId:window.history.state.tabId,data:window.history.state.data},path:location.pathname};else{var r=location.pathname.split("https://www.inspirock.com/modal/"),
q=r[0].split("https://www.inspirock.com/")[3];b.staticData=q?{history:{id:q,tabId:q},path:r[0]}:{}}r=b.isOpen();r||(b.nestingLevel=0,q=t.dialogClass?t.dialogClass:"",b.scrollTopPx=$(window).scrollTop(),$("#pageWrapper").css("top",-b.scrollTopPx),k.dialog({resizable:!1,modal:!1,draggable:!1,width:"970px",show:{effect:"fade",duration:200},position:{my:"center top",at:"center top+75",of:$("body"),collision:"none"},dialogClass:"modal-box "+q,beforeClose:function(){b.pageYOffset=b.scrollTop()},close:function(c,d){var r=$("#pageWrapper"),
e=k.data("closeOnBack");j(!0);r.removeClass("modal-open").css("top","");$("body").removeClass("modal-open");k.dialog("destroy").remove();r.css({"max-height":"",overflow:""});$(window).scrollTop(b.scrollTopPx);!e&&b.staticData.history&&!b.simulateClose?p.push(b.staticData.history.id,b.staticData.history.tabId,b.staticData.path,b.staticData.history.data):c.currentTarget&&(c.currentTarget.hasClass("ui-dialog-titlebar-close")&&window.history.state)&&p.replace(window.history.state.id,window.history.state.tabId,
window.history.state.url,window.history.state.data,b.pageYOffset);if(t.onClose)t.onClose(c,d);g.triggerEvent(n,"on-modal-close",{simulateClose:b.simulateClose,historyData:b.staticData.history&&b.staticData.history.data?b.staticData.history.data.historyData:null})},open:function(){b.simulateClose=!1;$(".modal-box .ui-dialog-titlebar .ui-dialog-titlebar-back").off("click.modalBox_back").on("click.modalBox_back",function(){p.pop();b.loading()});$(".modal-box .ui-dialog-titlebar").off("mousedown");$(".modal-box .ui-dialog-content").css("min-height",
"450px")},create:function(){$(".modal-box .ui-dialog-titlebar").append('<a href="javascript:void(0);" class="ui-dialog-titlebar-back hidden" role="button">&laquo; Back</a>');$(".modal-box .ui-dialog-titlebar").wrapInner('<div class = "titlebar-inner-wrap"></div>');$(".modal-box .ui-button-icon-space").remove();$(".modal-box .ui-dialog-titlebar-close").removeClass("ui-button-icon-only").contents().filter(function(){return 3===this.nodeType}).remove();k.html("");k.append('<div class="modal-content"></div>');
k.append('<div id="modalLoadingPane" class="modal-loading-pane progress-indicator hidden"><img class="progress-img" src="https://s.inspirock.com/images/misc/bulb.gif" alt="Loading..."><div class="progress-txt">Loading...</div></div>')}}),k.close=function(){k.dialog("close")});window.history.state&&(window.history.state.data&&window.history.state.data.historyNestingLevel)&&(b.nestingLevel=window.history.state.data.historyNestingLevel+1);t.data&&void 0!==t.data.historyNestingLevel&&(b.nestingLevel=
t.data.historyNestingLevel+1);var q=t.data&&t.data.history?t.data.history:null,f=t.data&&t.data.replaceHistory&&window.history.state?t.data.replaceHistory:!1;q&&!$.isEmptyObject(q)&&b.pushHistory(q.id,q.tabId,q.url,q.data,f,a);r||($("body").addClass("modal-open"),$("#pageWrapper").addClass("modal-open"));i();var u=function(d){c(d);if(t.onLoad)t.onLoad(k.find(".modal-content"));b.scrollTop(0);$(".modal-box").trigger("idle")};j();b.loading();t.ajaxParams?(t.ajaxParams.success=function(c){t.ajaxParams.func&&
t.ajaxParams.func.success&&(c=t.ajaxParams.func.success(c));u(c)},t.ajaxParams.complete=function(){t.ajaxParams.func&&t.ajaxParams.func.complete&&t.ajaxParams.func.complete()},t.ajaxParams.error=function(){t.ajaxParams.func&&t.ajaxParams.func.error&&(t.ajaxParams.func.error(k.find(".modal-content")),b.loadingComplete())},d.makeAJAXcall(t.ajaxParams)):u(t.message);b.currentParam=t}}function j(d){if(b.isOpen()||d){a.removeAllErrorToolTips();if(b.currentParam&&b.currentParam.onUnload)b.currentParam.onUnload(k.find(".modal-content"));
c("");b.currentParam=void 0}}function i(){b.param.showBack||1<b.nestingLevel&&(!b.param.dialogClass||-1===b.param.dialogClass.indexOf("full"))?k.parent(".modal-box").find(".ui-dialog-titlebar-back").removeClass("hidden"):k.parent(".modal-box").find(".ui-dialog-titlebar-back").addClass("hidden")}function c(c){void 0!==c&&(k.find(".modal-content").html(c),b.loadingComplete())}var b={},f,u,n="modal",k;b.open=function(c){g.hasObserver("page-change")?g.triggerEvent("alerts","page-change",{action:"open-modal",
param:c}):m("",{action:"open-modal",param:c});return k};b.close=function(){b.isOpen()&&(b.simulateClose=!0,k.dialog("close"));$(".dlg-large-map .ui-dialog-content").dialog("close")};b.openModal=function(c){m("page-change",{action:"open-modal",param:c});return k};b.isOpen=function(){return $(".modal-box").length};b.loading=function(){k.addClass("noscrollbar").find(".modal-content").addClass("hidden");k.find("#modalLoadingPane").removeClass("hidden");k.parents(".modal-box").find(".ui-dialog-titlebar").addClass("hidden");
k.scrollTop(0)};b.loadingComplete=function(){k.removeClass("noscrollbar").find(".modal-content").removeClass("hidden");k.find("#modalLoadingPane").addClass("hidden");k.parents(".modal-box").find(".ui-dialog-titlebar").removeClass("hidden")};b.pushHistory=function(c,d,a,t,r,q){if(!b.nestingLevel||0>b.nestingLevel)b.nestingLevel=0;t.parentId=b.staticData.history.id;t.parentTabId=b.staticData.history.tabId;t.targetId=b.staticData.history.data?b.staticData.history.data.targetId:void 0;t.subnavLinkId=
b.staticData.history.data?b.staticData.history.data.subnavLinkId:void 0;t.pathname=b.staticData.path;r?p.replace(c,d,a,t,q):(t.historyNestingLevel=b.nestingLevel,p.push(c,d,a,t,q),b.nestingLevel+=1,i())};b.getTab=function(){var c=location.pathname.split("https://www.inspirock.com/modal/");if(1!==c.length)return c[0].split("https://www.inspirock.com/")[3]};b.snapshot=function(){f=k.find(".modal-content").clone(!0);u=$(".modal-box").attr("class")};b.restore=function(){k.find(".modal-content").remove();k.append(f);b.param.dialogClass&&k.parents(".modal-box").removeClass(b.param.dialogClass);
k.parents(".modal-box").addClass(u);u=f=void 0};b.updateDialogClass=function(c,d){k.parents(".modal-box").removeClass(c);k.parents(".modal-box").addClass(d);b.param.dialogClass=b.param.dialogClass?b.param.dialogClass.replace(c,d):d};b.scrollTop=function(c){if(void 0===c)return $(".modal-box .ui-dialog-content").scrollTop();$(".modal-box .ui-dialog-content").scrollTop(c)};b.initialize=function(){k=$(document.createElement("div"));g.addObserver("close-modal",n,function(){b.isOpen()&&(b.simulateClose=
!0,k.dialog("close"))});g.addObserver("back-btn",n,function(){b.isOpen()&&(b.nestingLevel-=1,i(),0>=b.nestingLevel?(k.data("closeOnBack",!0),k.dialog("close"),b.nestingLevel=0):b.loading())});g.addObserver("post-route-change","modal",m)};b.initialize();return b});
(function(a,g,d,p){var m=d("html"),j=d(a),i=d(g),c=d.fancybox=function(){c.open.apply(this,arguments)},b=navigator.userAgent.match(/msie/i),f=null,u=g.createTouch!==p,n=function(c){return c&&c.hasOwnProperty&&c instanceof d},k=function(c){return c&&"string"===d.type(c)},h=function(c){return k(c)&&0<c.indexOf("%")},e=function(b,d){var e=parseInt(b,10)||0;d&&h(b)&&(e*=c.getViewport()[d]/100);return Math.ceil(e)},l=function(c,b){return e(c,b)+"px"};d.extend(c,{version:"2.1.5",defaults:{padding:15,margin:20,
width:800,height:600,minWidth:100,minHeight:100,maxWidth:9999,maxHeight:9999,pixelRatio:1,autoSize:!0,autoHeight:!1,autoWidth:!1,autoResize:!0,autoCenter:!u,fitToView:!0,aspectRatio:!1,topRatio:0.5,leftRatio:0.5,scrolling:"auto",wrapCSS:"",arrows:!0,closeBtn:!0,closeClick:!1,nextClick:!1,mouseWheel:!0,autoPlay:!1,playSpeed:3E3,preload:3,modal:!1,loop:!0,ajax:{dataType:"html",headers:{"X-fancyBox":!0}},iframe:{scrolling:"auto",preload:!0},swf:{wmode:"transparent",allowfullscreen:"true",allowscriptaccess:"always"},
keys:{next:{13:"left",34:"up",39:"left",40:"up"},prev:{8:"right",33:"down",37:"right",38:"down"},close:[27],play:[32],toggle:[70]},direction:{next:"left",prev:"right"},scrollOutside:!0,index:0,type:null,href:null,content:null,title:null,tpl:{wrap:'<div class="fancybox-wrap" tabIndex="-1"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div></div>',image:'<img class="fancybox-image" src="{href}" alt="" />',iframe:'<iframe id="fancybox-frame{rnd}" name="fancybox-frame{rnd}" class="fancybox-iframe" frameborder="0" vspace="0" hspace="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen'+
(b?' allowtransparency="true"':"")+"></iframe>",error:'<p class="fancybox-error">The requested content cannot be loaded.<br/>Please try again later.</p>',closeBtn:'<a title="Close" class="fancybox-item fancybox-close" href="javascript:;"></a>',next:'<a title="Next" class="fancybox-nav fancybox-next" href="javascript:;"><span></span></a>',prev:'<a title="Previous" class="fancybox-nav fancybox-prev" href="javascript:;"><span></span></a>'},openEffect:"fade",openSpeed:250,openEasing:"swing",openOpacity:!0,
openMethod:"zoomIn",closeEffect:"fade",closeSpeed:250,closeEasing:"swing",closeOpacity:!0,closeMethod:"zoomOut",nextEffect:"elastic",nextSpeed:250,nextEasing:"swing",nextMethod:"changeIn",prevEffect:"elastic",prevSpeed:250,prevEasing:"swing",prevMethod:"changeOut",helpers:{overlay:!0,title:!0},onCancel:d.noop,beforeLoad:d.noop,afterLoad:d.noop,beforeShow:d.noop,afterShow:d.noop,beforeChange:d.noop,beforeClose:d.noop,afterClose:d.noop},group:{},opts:{},previous:null,coming:null,current:null,isActive:!1,
isOpen:!1,isOpened:!1,wrap:null,skin:null,outer:null,inner:null,player:{timer:null,isActive:!1},ajaxLoad:null,imgPreload:null,transitions:{},helpers:{},open:function(b,r){if(b&&(d.isPlainObject(r)||(r={}),!1!==c.close(!0)))return d.isArray(b)||(b=n(b)?d(b).get():[b]),d.each(b,function(e,a){var f={},h,i,l,j,g;"object"===d.type(a)&&(a.nodeType&&(a=d(a)),n(a)?(f={href:a.data("fancybox-href")||a.attr("href"),title:a.data("fancybox-title")||a.attr("title"),isDom:!0,element:a},d.metadata&&d.extend(!0,f,
a.metadata())):f=a);h=r.href||f.href||(k(a)?a:null);i=r.title!==p?r.title:f.title||"";j=(l=r.content||f.content)?"html":r.type||f.type;!j&&f.isDom&&(j=a.data("fancybox-type"),j||(j=(j=a.prop("class").match(/fancybox\.(\w+)/))?j[1]:null));k(h)&&(j||(c.isImage(h)?j="image":c.isSWF(h)?j="swf":"#"===h.charAt(0)?j="inline":k(a)&&(j="html",l=a)),"ajax"===j&&(g=h.split(/\s+/,2),h=g.shift(),g=g.shift()));l||("inline"===j?h?l=d(k(h)?h.replace(/.*(?=#[^\s]+$)/,""):h):f.isDom&&(l=a):"html"===j?l=h:!j&&!h&&f.isDom&&
(j="inline",l=a));d.extend(f,{href:h,type:j,content:l,title:i,selector:g});b[e]=f}),c.opts=d.extend(!0,{},c.defaults,r),r.keys!==p&&(c.opts.keys=r.keys?d.extend({},c.defaults.keys,r.keys):!1),c.group=b,c._start(c.opts.index)},cancel:function(){var b=c.coming;b&&!1!==c.trigger("onCancel")&&(c.hideLoading(),c.ajaxLoad&&c.ajaxLoad.abort(),c.ajaxLoad=null,c.imgPreload&&(c.imgPreload.onload=c.imgPreload.onerror=null),b.wrap&&b.wrap.stop(!0,!0).trigger("onReset").remove(),c.coming=null,c.current||c._afterZoomOut(b))},
close:function(b){c.cancel();!1!==c.trigger("beforeClose")&&(c.unbindEvents(),c.isActive&&(!c.isOpen||!0===b?(d(".fancybox-wrap").stop(!0).trigger("onReset").remove(),c._afterZoomOut()):(c.isOpen=c.isOpened=!1,c.isClosing=!0,d(".fancybox-item, .fancybox-nav").remove(),c.wrap.stop(!0,!0).removeClass("fancybox-opened"),c.transitions[c.current.closeMethod]())))},play:function(b){var d=function(){clearTimeout(c.player.timer)},e=function(){d();c.current&&c.player.isActive&&(c.player.timer=setTimeout(c.next,
c.current.playSpeed))},a=function(){d();i.unbind(".player");c.player.isActive=!1;c.trigger("onPlayEnd")};if(!0===b||!c.player.isActive&&!1!==b){if(c.current&&(c.current.loop||c.current.index<c.group.length-1))c.player.isActive=!0,i.bind({"onCancel.player beforeClose.player":a,"onUpdate.player":e,"beforeLoad.player":d}),e(),c.trigger("onPlayStart")}else a()},next:function(b){var d=c.current;d&&(k(b)||(b=d.direction.next),c.jumpto(d.index+1,b,"next"))},prev:function(b){var d=c.current;d&&(k(b)||(b=
d.direction.prev),c.jumpto(d.index-1,b,"prev"))},jumpto:function(b,d,a){var f=c.current;f&&(b=e(b),c.direction=d||f.direction[b>=f.index?"next":"prev"],c.router=a||"jumpto",f.loop&&(0>b&&(b=f.group.length+b%f.group.length),b%=f.group.length),f.group[b]!==p&&(c.cancel(),c._start(b)))},reposition:function(b,a){var e=c.current,f=e?e.wrap:null,h;f&&(h=c._getPosition(a),b&&"scroll"===b.type?(delete h.position,f.stop(!0,!0).animate(h,200)):(f.css(h),e.pos=d.extend({},e.dim,h)))},update:function(b){var d=
b&&b.type,e=!d||"orientationchange"===d;e&&(clearTimeout(f),f=null);c.isOpen&&!f&&(f=setTimeout(function(){var a=c.current;a&&!c.isClosing&&(c.wrap.removeClass("fancybox-tmp"),(e||"load"===d||"resize"===d&&a.autoResize)&&c._setDimension(),"scroll"===d&&a.canShrink||c.reposition(b),c.trigger("onUpdate"),f=null)},e&&!u?0:300))},toggle:function(b){c.isOpen&&(c.current.fitToView="boolean"===d.type(b)?b:!c.current.fitToView,u&&(c.wrap.removeAttr("style").addClass("fancybox-tmp"),c.trigger("onUpdate")),
c.update())},hideLoading:function(){i.unbind(".loading");d("#fancybox-loading").remove()},showLoading:function(){var b,e;c.hideLoading();b=d('<div id="fancybox-loading"><div></div></div>').click(c.cancel).appendTo("body");i.bind("keydown.loading",function(b){if(27===(b.which||b.keyCode))b.preventDefault(),c.cancel()});c.defaults.fixed||(e=c.getViewport(),b.css({position:"absolute",top:0.5*e.h+e.y,left:0.5*e.w+e.x}))},getViewport:function(){var b=c.current&&c.current.locked||!1,d={x:j.scrollLeft(),
y:j.scrollTop()};b?(d.w=b[0].clientWidth,d.h=b[0].clientHeight):(d.w=u&&a.innerWidth?a.innerWidth:j.width(),d.h=u&&a.innerHeight?a.innerHeight:j.height());return d},unbindEvents:function(){c.wrap&&n(c.wrap)&&c.wrap.unbind(".fb");i.unbind(".fb");j.unbind(".fb")},bindEvents:function(){var b=c.current,e;b&&(j.bind("orientationchange.fb"+(u?"":" resize.fb")+(b.autoCenter&&!b.locked?" scroll.fb":""),c.update),(e=b.keys)&&i.bind("keydown.fb",function(a){var f=a.which||a.keyCode,h=a.target||a.srcElement;
if(27===f&&c.coming)return!1;!a.ctrlKey&&!a.altKey&&(!a.shiftKey&&!a.metaKey&&(!h||!h.type&&!d(h).is("[contenteditable]")))&&d.each(e,function(e,h){if(1<b.group.length&&h[f]!==p)return c[e](h[f]),a.preventDefault(),!1;if(-1<d.inArray(f,h))return c[e](),a.preventDefault(),!1})}),d.fn.mousewheel&&b.mouseWheel&&c.wrap.bind("mousewheel.fb",function(e,a,f,h){for(var r=d(e.target||null),i=!1;r.length&&!i&&!r.is(".fancybox-skin")&&!r.is(".fancybox-wrap");)i=r[0]&&!(r[0].style.overflow&&"hidden"===r[0].style.overflow)&&
(r[0].clientWidth&&r[0].scrollWidth>r[0].clientWidth||r[0].clientHeight&&r[0].scrollHeight>r[0].clientHeight),r=d(r).parent();if(0!==a&&!i&&1<c.group.length&&!b.canShrink){if(0<h||0<f)c.prev(0<h?"down":"left");else if(0>h||0>f)c.next(0>h?"up":"right");e.preventDefault()}}))},trigger:function(b,e){var a,f=e||c.coming||c.current;if(f){d.isFunction(f[b])&&(a=f[b].apply(f,Array.prototype.slice.call(arguments,1)));if(!1===a)return!1;f.helpers&&d.each(f.helpers,function(e,a){if(a&&c.helpers[e]&&d.isFunction(c.helpers[e][b]))c.helpers[e][b](d.extend(!0,
{},c.helpers[e].defaults,a),f)});i.trigger(b)}},isImage:function(c){return k(c)&&c.match(/(^data:image\/.*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp|svg)((\?|#).*)?$)/i)},isSWF:function(c){return k(c)&&c.match(/\.(swf)((\?|#).*)?$/i)},_start:function(b){var a={},f,h,b=e(b);f=c.group[b]||null;if(!f)return!1;a=d.extend(!0,{},c.opts,f);f=a.margin;h=a.padding;"number"===d.type(f)&&(a.margin=[f,f,f,f]);"number"===d.type(h)&&(a.padding=[h,h,h,h]);a.modal&&d.extend(!0,a,{closeBtn:!1,closeClick:!1,nextClick:!1,arrows:!1,
mouseWheel:!1,keys:null,helpers:{overlay:{closeClick:!1}}});a.autoSize&&(a.autoWidth=a.autoHeight=!0);"auto"===a.width&&(a.autoWidth=!0);"auto"===a.height&&(a.autoHeight=!0);a.group=c.group;a.index=b;c.coming=a;if(!1===c.trigger("beforeLoad"))c.coming=null;else{h=a.type;f=a.href;if(!h)return c.coming=null,c.current&&c.router&&"jumpto"!==c.router?(c.current.index=b,c[c.router](c.direction)):!1;c.isActive=!0;if("image"===h||"swf"===h)a.autoHeight=a.autoWidth=!1,a.scrolling="visible";"image"===h&&(a.aspectRatio=
!0);"iframe"===h&&u&&(a.scrolling="scroll");a.wrap=d(a.tpl.wrap).addClass("fancybox-"+(u?"mobile":"desktop")+" fancybox-type-"+h+" fancybox-tmp "+a.wrapCSS).appendTo(a.parent||"body");d.extend(a,{skin:d(".fancybox-skin",a.wrap),outer:d(".fancybox-outer",a.wrap),inner:d(".fancybox-inner",a.wrap)});d.each(["Top","Right","Bottom","Left"],function(c,b){a.skin.css("padding"+b,l(a.padding[c]))});c.trigger("onReady");if("inline"===h||"html"===h){if(!a.content||!a.content.length)return c._error("content")}else if(!f)return c._error("href");
"image"===h?c._loadImage():"ajax"===h?c._loadAjax():"iframe"===h?c._loadIframe():c._afterLoad()}},_error:function(b){d.extend(c.coming,{type:"html",autoWidth:!0,autoHeight:!0,minWidth:0,minHeight:0,scrolling:"no",hasError:b,content:c.coming.tpl.error});c._afterLoad()},_loadImage:function(){var b=c.imgPreload=new Image;b.onload=function(){this.onload=this.onerror=null;c.coming.width=this.width/c.opts.pixelRatio;c.coming.height=this.height/c.opts.pixelRatio;c._afterLoad()};b.onerror=function(){this.onload=
this.onerror=null;c._error("image")};b.src=c.coming.href;!0!==b.complete&&c.showLoading()},_loadAjax:function(){var b=c.coming;c.showLoading();c.ajaxLoad=d.ajax(d.extend({},b.ajax,{url:b.href,error:function(b,d){c.coming&&"abort"!==d?c._error("ajax",b):c.hideLoading()},success:function(d,a){"success"===a&&(b.content=d,c._afterLoad())}}))},_loadIframe:function(){var b=c.coming,a=d(b.tpl.iframe.replace(/\{rnd\}/g,(new Date).getTime())).attr("scrolling",u?"auto":b.iframe.scrolling).attr("src",b.href);
d(b.wrap).bind("onReset",function(){try{d(this).find("iframe").hide().attr("src","//about:blank").end().empty()}catch(b){}});b.iframe.preload&&(c.showLoading(),a.one("load",function(){d(this).data("ready",1);u||d(this).bind("load.fb",c.update);d(this).parents(".fancybox-wrap").width("100%").removeClass("fancybox-tmp").show();c._afterLoad()}));b.content=a.appendTo(b.inner);b.iframe.preload||c._afterLoad()},_preloadImages:function(){var b=c.group,d=c.current,a=b.length,e=d.preload?Math.min(d.preload,
a-1):0,f,h;for(h=1;h<=e;h+=1)f=b[(d.index+h)%a],"image"===f.type&&f.href&&((new Image).src=f.href)},_afterLoad:function(){var b=c.coming,a=c.current,e,f,h,i,j;c.hideLoading();if(b&&!1!==c.isActive)if(!1===c.trigger("afterLoad",b,a))b.wrap.stop(!0).trigger("onReset").remove(),c.coming=null;else{a&&(c.trigger("beforeChange",a),a.wrap.stop(!0).removeClass("fancybox-opened").find(".fancybox-item, .fancybox-nav").remove());c.unbindEvents();e=b.content;f=b.type;h=b.scrolling;d.extend(c,{wrap:b.wrap,skin:b.skin,
outer:b.outer,inner:b.inner,current:b,previous:a});i=b.href;switch(f){case "inline":case "ajax":case "html":b.selector?e=d("<div>").html(e).find(b.selector):n(e)&&(e.data("fancybox-placeholder")||e.data("fancybox-placeholder",d('<div class="fancybox-placeholder"></div>').insertAfter(e).hide()),e=e.show().detach(),b.wrap.bind("onReset",function(){d(this).find(e).length&&e.hide().replaceAll(e.data("fancybox-placeholder")).data("fancybox-placeholder",!1)}));break;case "image":e=b.tpl.image.replace("{href}",
i);break;case "swf":e='<object id="fancybox-swf" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="movie" value="'+i+'"></param>',j="",d.each(b.swf,function(b,c){e+='<param name="'+b+'" value="'+c+'"></param>';j+=" "+b+'="'+c+'"'}),e+='<embed src="'+i+'" type="application/x-shockwave-flash" width="100%" height="100%"'+j+"></embed></object>"}(!n(e)||!e.parent().is(b.inner))&&b.inner.append(e);c.trigger("beforeShow");b.inner.css("overflow","yes"===h?"scroll":
"no"===h?"hidden":h);c._setDimension();c.reposition();c.isOpen=!1;c.coming=null;c.bindEvents();if(c.isOpened){if(a.prevMethod)c.transitions[a.prevMethod]()}else d(".fancybox-wrap").not(b.wrap).stop(!0).trigger("onReset").remove();c.transitions[c.isOpened?b.nextMethod:b.openMethod]();c._preloadImages()}},_setDimension:function(){var b=c.getViewport(),a=0,f=!1,i=!1,f=c.wrap,j=c.skin,n=c.inner,k=c.current,i=k.width,g=k.height,u=k.minWidth,m=k.minHeight,w=k.maxWidth,p=k.maxHeight,F=k.scrolling,y=k.scrollOutside?
k.scrollbarWidth:0,s=k.margin,H=e(s[1]+s[3]),x=e(s[0]+s[2]),A,E,K,L,Q,N,O,I,T;f.add(j).add(n).width("auto").height("auto").removeClass("fancybox-tmp");s=e(j.outerWidth(!0)-j.width());A=e(j.outerHeight(!0)-j.height());E=H+s;K=x+A;L=h(i)?(b.w-E)*e(i)/100:i;Q=h(g)?(b.h-K)*e(g)/100:g;if("iframe"===k.type){if(T=k.content,k.autoHeight&&1===T.data("ready"))try{T[0].contentWindow.document.location&&(n.width(L).height(9999),N=T.contents().find("body"),y&&N.css("overflow-x","hidden"),Q=N.outerHeight(!0))}catch(S){}}else if(k.autoWidth||
k.autoHeight)n.addClass("fancybox-tmp"),k.autoWidth||n.width(L),k.autoHeight||n.height(Q),k.autoWidth&&(L=n.width()),k.autoHeight&&(Q=n.height()),n.removeClass("fancybox-tmp");i=e(L);g=e(Q);I=L/Q;u=e(h(u)?e(u,"w")-E:u);w=e(h(w)?e(w,"w")-E:w);m=e(h(m)?e(m,"h")-K:m);p=e(h(p)?e(p,"h")-K:p);N=w;O=p;k.fitToView&&(w=Math.min(b.w-E,w),p=Math.min(b.h-K,p));E=b.w-H;x=b.h-x;k.aspectRatio?(i>w&&(i=w,g=e(i/I)),g>p&&(g=p,i=e(g*I)),i<u&&(i=u,g=e(i/I)),g<m&&(g=m,i=e(g*I))):(i=Math.max(u,Math.min(i,w)),k.autoHeight&&
"iframe"!==k.type&&(n.width(i),g=n.height()),g=Math.max(m,Math.min(g,p)));if(k.fitToView)if(n.width(i).height(g),f.width(i+s),b=f.width(),H=f.height(),k.aspectRatio)for(;(b>E||H>x)&&i>u&&g>m&&!(19<a++);)g=Math.max(m,Math.min(p,g-10)),i=e(g*I),i<u&&(i=u,g=e(i/I)),i>w&&(i=w,g=e(i/I)),n.width(i).height(g),f.width(i+s),b=f.width(),H=f.height();else i=Math.max(u,Math.min(i,i-(b-E))),g=Math.max(m,Math.min(g,g-(H-x)));y&&"auto"===F&&(g<Q&&i+s+y<E)&&(i+=y);n.width(i).height(g);f.width(i+s);b=f.width();H=
f.height();f=(b>E||H>x)&&i>u&&g>m;i=k.aspectRatio?i<N&&g<O&&i<L&&g<Q:(i<N||g<O)&&(i<L||g<Q);d.extend(k,{dim:{width:l(b),height:l(H)},origWidth:L,origHeight:Q,canShrink:f,canExpand:i,wPadding:s,hPadding:A,wrapSpace:H-j.outerHeight(!0),skinSpace:j.height()-g});!T&&k.autoHeight&&(g>m&&g<p&&!i)&&n.height("auto")},_getPosition:function(b){var d=c.current,a=c.getViewport(),e=d.margin,f=c.wrap.width()+e[1]+e[3],h=c.wrap.height()+e[0]+e[2],e={position:"absolute",top:e[0],left:e[3]};d.autoCenter&&d.fixed&&
!b&&h<=a.h&&f<=a.w?e.position="fixed":d.locked||(e.top+=a.y,e.left+=a.x);e.top=l(Math.max(e.top,e.top+(a.h-h)*d.topRatio));e.left=l(Math.max(e.left,e.left+(a.w-f)*d.leftRatio));return e},_afterZoomIn:function(){var b=c.current;b&&(c.isOpen=c.isOpened=!0,c.wrap.css("overflow","visible").addClass("fancybox-opened"),c.update(),(b.closeClick||b.nextClick&&1<c.group.length)&&c.inner.css("cursor","pointer").bind("click.fb",function(a){!d(a.target).is("a")&&!d(a.target).parent().is("a")&&(a.preventDefault(),
c[b.closeClick?"close":"next"]())}),b.closeBtn&&d(b.tpl.closeBtn).appendTo(c.skin).bind("click.fb",function(b){b.preventDefault();c.close()}),b.arrows&&1<c.group.length&&((b.loop||0<b.index)&&d(b.tpl.prev).appendTo(c.outer).bind("click.fb",c.prev),(b.loop||b.index<c.group.length-1)&&d(b.tpl.next).appendTo(c.outer).bind("click.fb",c.next)),c.trigger("afterShow"),!b.loop&&b.index===b.group.length-1?c.play(!1):c.opts.autoPlay&&!c.player.isActive&&(c.opts.autoPlay=!1,c.play()))},_afterZoomOut:function(b){b=
b||c.current;d(".fancybox-wrap").trigger("onReset").remove();d.extend(c,{group:{},opts:{},router:!1,current:null,isActive:!1,isOpened:!1,isOpen:!1,isClosing:!1,wrap:null,skin:null,outer:null,inner:null});c.trigger("afterClose",b)}});c.transitions={getOrigPosition:function(){var b=c.current,d=b.element,a=b.orig,e={},f=50,h=50,i=b.hPadding,j=b.wPadding,k=c.getViewport();!a&&b.isDom&&d.is(":visible")&&(a=d.find("img:first"),a.length||(a=d));n(a)?(e=a.offset(),a.is("img")&&(f=a.outerWidth(),h=a.outerHeight())):
(e.top=k.y+(k.h-h)*b.topRatio,e.left=k.x+(k.w-f)*b.leftRatio);if("fixed"===c.wrap.css("position")||b.locked)e.top-=k.y,e.left-=k.x;return{top:l(e.top-i*b.topRatio),left:l(e.left-j*b.leftRatio),width:l(f+j),height:l(h+i)}},step:function(b,d){var a,f,h=d.prop;f=c.current;var i=f.wrapSpace,j=f.skinSpace;if("width"===h||"height"===h)a=d.end===d.start?1:(b-d.start)/(d.end-d.start),c.isClosing&&(a=1-a),f="width"===h?f.wPadding:f.hPadding,f=b-f,c.skin[h](e("width"===h?f:f-i*a)),c.inner[h](e("width"===h?
f:f-i*a-j*a))},zoomIn:function(){var b=c.current,a=b.pos,e=b.openEffect,f="elastic"===e,h=d.extend({opacity:1},a);delete h.position;f?(a=this.getOrigPosition(),b.openOpacity&&(a.opacity=0.1)):"fade"===e&&(a.opacity=0.1);c.wrap.css(a).animate(h,{duration:"none"===e?0:b.openSpeed,easing:b.openEasing,step:f?this.step:null,complete:c._afterZoomIn})},zoomOut:function(){var b=c.current,d=b.closeEffect,a="elastic"===d,e={opacity:0.1};a&&(e=this.getOrigPosition(),b.closeOpacity&&(e.opacity=0.1));c.wrap.animate(e,
{duration:"none"===d?0:b.closeSpeed,easing:b.closeEasing,step:a?this.step:null,complete:c._afterZoomOut})},changeIn:function(){var b=c.current,d=b.nextEffect,a=b.pos,f={opacity:1},h=c.direction,i;a.opacity=0.1;"elastic"===d&&(i="down"===h||"up"===h?"top":"left","down"===h||"right"===h?(a[i]=l(e(a[i])-200),f[i]="+=200px"):(a[i]=l(e(a[i])+200),f[i]="-=200px"));"none"===d?c._afterZoomIn():c.wrap.css(a).animate(f,{duration:b.nextSpeed,easing:b.nextEasing,complete:c._afterZoomIn})},changeOut:function(){var b=
c.previous,a=b.prevEffect,e={opacity:0.1},f=c.direction;"elastic"===a&&(e["down"===f||"up"===f?"top":"left"]=("up"===f||"left"===f?"-":"+")+"=200px");b.wrap.animate(e,{duration:"none"===a?0:b.prevSpeed,easing:b.prevEasing,complete:function(){d(this).trigger("onReset").remove()}})}};c.helpers.overlay={defaults:{closeClick:!0,speedOut:200,showEarly:!0,css:{},locked:!u,fixed:!0},overlay:null,fixed:!1,el:d("html"),create:function(b){b=d.extend({},this.defaults,b);this.overlay&&this.close();this.overlay=
d('<div class="fancybox-overlay"></div>').appendTo(c.coming?c.coming.parent:b.parent);this.fixed=!1;b.fixed&&c.defaults.fixed&&(this.overlay.addClass("fancybox-overlay-fixed"),this.fixed=!0)},open:function(b){var a=this,b=d.extend({},this.defaults,b);this.overlay?this.overlay.unbind(".overlay").width("auto").height("auto"):this.create(b);this.fixed||(j.bind("resize.overlay",d.proxy(this.update,this)),this.update());b.closeClick&&this.overlay.bind("click.overlay",function(b){if(d(b.target).hasClass("fancybox-overlay"))return c.isActive?
c.close():a.close(),!1});this.overlay.css(b.css).show()},close:function(){var b,c;j.unbind("resize.overlay");this.el.hasClass("fancybox-lock")&&(d(".fancybox-margin").removeClass("fancybox-margin"),b=j.scrollTop(),c=j.scrollLeft(),this.el.removeClass("fancybox-lock"),j.scrollTop(b).scrollLeft(c));d(".fancybox-overlay").remove().hide();d.extend(this,{overlay:null,fixed:!1})},update:function(){var c="100%",a;this.overlay.width(c).height("100%");b?(a=Math.max(g.documentElement.offsetWidth,g.body.offsetWidth),
i.width()>a&&(c=i.width())):i.width()>j.width()&&(c=i.width());this.overlay.width(c).height(i.height())},onReady:function(b,c){var a=this.overlay;d(".fancybox-overlay").stop(!0,!0);a||this.create(b);b.locked&&this.fixed&&c.fixed&&(a||(this.margin=i.height()>j.height()?d("html").css("margin-right").replace("px",""):!1),c.locked=this.overlay.append(c.wrap),c.fixed=!1);!0===b.showEarly&&this.beforeShow.apply(this,arguments)},beforeShow:function(b,c){var a,e;c.locked&&(!1!==this.margin&&(d("*").filter(function(){return"fixed"===
d(this).css("position")&&!d(this).hasClass("fancybox-overlay")&&!d(this).hasClass("fancybox-wrap")}).addClass("fancybox-margin"),this.el.addClass("fancybox-margin")),a=j.scrollTop(),e=j.scrollLeft(),this.el.addClass("fancybox-lock"),j.scrollTop(a).scrollLeft(e));this.open(b)},onUpdate:function(){this.fixed||this.update()},afterClose:function(b){this.overlay&&!c.coming&&this.overlay.fadeOut(b.speedOut,d.proxy(this.close,this))}};c.helpers.title={defaults:{type:"float",position:"bottom"},beforeShow:function(a){var f=
c.current,h=f.title,i=a.type;d.isFunction(h)&&(h=h.call(f.element,f));if(k(h)&&""!==d.trim(h)){f=d('<div class="fancybox-title fancybox-title-'+i+'-wrap">'+h+"</div>");switch(i){case "inside":i=c.skin;break;case "outside":i=c.wrap;break;case "over":i=c.inner;break;default:i=c.skin,f.appendTo("body"),b&&f.width(f.width()),f.wrapInner('<span class="child"></span>'),c.current.margin[2]+=Math.abs(e(f.css("margin-bottom")))}f["top"===a.position?"prependTo":"appendTo"](i)}}};d.fn.fancybox=function(b){var a,
e=d(this),f=this.selector||"",h=function(h){var i=d(this).blur(),j=a,l,n;!h.ctrlKey&&!h.altKey&&!h.shiftKey&&!h.metaKey&&!i.is(".fancybox-wrap")&&(l=b.groupAttr||"data-fancybox-group",n=i.attr(l),n||(l="rel",n=i.get(0)[l]),n&&""!==n&&"nofollow"!==n&&(i=f.length?d(f):e,i=i.filter("["+l+'="'+n+'"]'),j=i.index(this)),b.index=j,!1!==c.open(i,b)&&h.preventDefault())},b=b||{};a=b.index||0;!f||!1===b.live?e.unbind("click.fb-start").bind("click.fb-start",h):i.undelegate(f,"click.fb-start").delegate(f+":not('.fancybox-item, .fancybox-nav')",
"click.fb-start",h);this.filter("[data-fancybox-start=1]").trigger("click");return this};i.ready(function(){var b,e;d.scrollbarWidth===p&&(d.scrollbarWidth=function(){var b=d('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body"),c=b.children(),c=c.innerWidth()-c.height(99).innerWidth();b.remove();return c});if(d.support.fixedPosition===p){b=d.support;e=d('<div style="position:fixed;top:20px;"></div>').appendTo("body");var f=20===e[0].offsetTop||15===e[0].offsetTop;e.remove();
b.fixedPosition=f}d.extend(c.defaults,{scrollbarWidth:d.scrollbarWidth(),fixed:d.support.fixedPosition,parent:d("body")});b=d(a).width();m.addClass("fancybox-lock-test");e=d(a).width();m.removeClass("fancybox-lock-test");d("<style type='text/css'>.fancybox-margin{margin-right:"+(e-b)+"px;}</style>").appendTo("head")})})(window,document,jQuery);define("fancybox",["jquery"],function(){});
define("modules/copyright",["modules/ajax","jquery","fancybox"],function(a){function g(a,g){var m=$(window).scrollTop();$.fancybox.open($(this),{title:g.name,href:g.largeUrl,padding:0,margin:0,helpers:{overlay:{locked:!1,css:{background:"rgba(51, 51, 51, 0.95)"}}},tpl:{wrap:'<div class="fancybox-wrap" tabIndex="-1"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div><div class="credits hidden"></div></div></div>'},beforeLoad:function(){$(this.wrap).length&&
$(this.wrap).find(".credits").addClass("hidden")},afterLoad:function(){if(a.length&&a.attr("src")&&0<=a.attr("src").indexOf("../../../no-image-graphic.html"))$(this.wrap).find(".credits").addClass("hidden");else if(a.length&&$(this.wrap).length&&g.artist){var j=g.artist,i=g.sourceUrl;$(this.wrap).find(".credits").html('Photo by <a href="'+i+'" class="artist" rel="nofollow noopener" target="_blank">'+j+"</a>");$(this.wrap).find(".credits .artist").click(function(c){c.stopPropagation()});$("#pageWrapper").css("top",
-m).addClass("fancybox-open")}else $(this.wrap).length&&$(this.wrap).find(".credits").addClass("hidden")},onUpdate:function(){$(this.wrap).find(".credits").removeClass("hidden").appendTo($(this.wrap).find(".fancybox-title"));$(this.wrap).find(".fancybox-title").length||$(this.wrap).find(".credits").addClass("no-title-credits");this.close=this.close||$('<div id="fancy-close"></div>').appendTo("body");this.close.off("click").on("click",function(){$.fancybox.close()})},afterClose:function(){$("#pageWrapper").css("top",
"").removeClass("fancybox-open");$(window).scrollTop(m);this.close&&(this.close.remove(),this.close=null)}})}return{initialize:function(){$(".copyright-fancy-box-img,.copyright-fancy-box-div").unbind("click").click(function(d){var p=$(this),m=p.parent().find("div,img").eq(0),j=p.data("type"),i=p.data("id"),c=p.data("imgPath");if(m.hasClass("ignore-click"))return d.stopPropagation(),d.preventDefault(),!1;a.makeAJAXcall({type:"GET",data:{type:j,id:i,path:c},url:window.contextPath+"/photoInfo",success:function(b){g.call(p,
m,b)}});d.stopPropagation();d.preventDefault();return!1})}}});
define("plan/planUtils","modules/analytics modules/analyticsEventParams modules/ajax modules/events modules/utils plan/loading moment jquery jqueryui jQueryExtensions/inspirockDatepicker".split(" "),function(a,g,d,p,m,j,i){var c={adjustRouteClick:function(b,c,i){var n=$("#resultpageContent"),k=$("#planRecalculating");d.makeAJAXcall({type:"GET",url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/adjustRoute",success:function(h){var e=$(h),l=function(){var b=$(this).parents(".stay-row"),c=b.index();
0<c&&b.insertBefore(e.find(".stay-row").eq(c-1));e.find(".destination-index").each(function(b){$(this).text(b+1)})},t=function(){var b=$(this).parents(".stay-row"),c=e.find(".stay-row"),a=b.index();a<c.length-1&&b.insertAfter(c.eq(a+1));e.find(".destination-index").each(function(b){$(this).text(b+1)})};e.dialog({resizable:!1,modal:!0,draggable:!1,width:"560px",dialogClass:"dlg-route mediumx",buttons:[{html:"Save Route",click:function(){function h(e,m){j.showLoading(k,n,"Updating Your Plan...");var t=
$.extend({stayOrder:l,forceMerge:e,userDIY:m},c);d.makeAJAXcall({type:"POST",url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/adjustRoute",data:t,synchronize:!0,success:function(c,d,e){e.getResponseHeader("Modified-Visits")?($("#pageWrapper").append($(c)),p.triggerEvent("plan","show-removed-visits-dlg",{cb:h})):(j.hideLoading(k,n),i&&i(c,d,e),a.trackEvent(b,g.ACT_ADJUST_ROUTE),p.triggerEvent("plan","mmt_track_link",{linkName:"Edit Route"}),m&&p.triggerEvent("explore","show-tab-itinerary",
{addToHistory:!1,tabData:{subnav:"calendar"}}))}})}var l="";e.find(".stay-row").map(function(){0!==$(this).index()&&(l+=",");l+=$(this).data("stayId")});e.dialog("close");h(!1,!1)}}],open:function(){e.on("click.moveup",".move-up",l);e.on("click.movedown",".move-down",t);m.setupDialogOverlay(e,!1)},close:function(){$(this).dialog("destroy").remove()}})}})},showEditDatesDialog:function(b,c,a){var n=$("#resultpageContent"),k=$("#planRecalculating");d.makeAJAXcall({type:"GET",data:c,url:window.contextPath+
"/trip/"+$("#plan").data("planId")+"/dates",success:function(c){function e(b){var c=r.datepicker("getDate"),a=q.val();if(null!==c){q.datepicker("option","minDate",c);var d=new Date(c.valueOf());d.setDate(c.getDate()+60-1);q.datepicker("option","maxDate",d)}else q.datepicker("option","minDate","+0d"),q.datepicker("option","maxDate","+60d");b&&q.val(a)}function f(){var b=i.utc(i(r.datepicker("getDate")).format(m.ISO_DATE_FORMAT),m.ISO_DATE_FORMAT),c=i.utc(i(q.datepicker("getDate")).format(m.ISO_DATE_FORMAT),
m.ISO_DATE_FORMAT),a=i.duration(c-b).asDays()+1;g.find(".num-days").text(a);var d=1===v?" day":" days",e=1===Math.abs(a-v)?" day":" days";a===v?D.text(""):a>v?D.text("Your plan has "+v+d+", which leaves "+(a-v)+e+" open."):D.text("Your plan has "+v+d+", which is "+(v-a)+e+" past your end date.");b.isSame(B)&&c.isSame(z)?g.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button").prop("disabled",!0):g.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button").prop("disabled",!1)}var g=
$(c),r=g.find("#startDate"),q=g.find("#endDate"),D=g.find(".message"),v=g.data("planDays"),B,z;g.dialog({resizable:!1,modal:!0,draggable:!1,width:"560px",dialogClass:"dlg-dates mediumx",buttons:[{html:"Save",click:function(){function c(a,e){j.showLoading(k,n,"Updating your plan...");l.forceMerge=a;l.userDIY=e;d.makeAJAXcall({type:"POST",url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/dates",data:l,synchronize:!0,success:function(a,d,f){f.getResponseHeader("Modified-Visits")?($("#pageWrapper").append($(a)),
p.triggerEvent("planUtils","show-removed-visits-dlg",{cb:c}),j.hideLoading(k,n)):(p.triggerEvent("plan","mmt_track_link",{linkName:"Edit Dates"}),j.hideLoading(k,n),p.triggerEvent("plan","plan-update",{uiSource:b}),"overview"===h&&p.triggerEvent("plan","refresh-overview"),e&&p.triggerEvent("explore","show-tab-itinerary",{addToHistory:!1,tabData:{subnav:"calendar"}}))}})}if(a)a(g),g.dialog("close");else{g.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button").prop("disabled",!0);var e=i(r.datepicker("getDate")),
f=i(q.datepicker("getDate")),h=n.find(".tab-content").filter(":visible").attr("id"),l={startDate:e.format("MMM DD, YYYY"),endDate:f.format("MMM DD, YYYY")};g.dialog("close");c(!1,!1)}}}],open:function(){r.inspirockDatepicker({minDate:"+0d",maxDate:"+3y",dateFormat:"M dd, yy",onSelect:function(){e(!1);f()}}).click(function(){r.datepicker("show")});q.inspirockDatepicker({maxDate:null,dateFormat:"M dd, yy",onSelect:function(){f()}}).click(function(){q.datepicker("show")});e(!0);B=i(r.datepicker("getDate"));
z=i(q.datepicker("getDate"));m.setupDialogOverlay(g,!1);f()},close:function(){$(this).dialog("destroy").remove()}})}})},recalcStay:function(b,a,i,n,g,h){function e(c,h){h||(j.showLoading(m,l,"Updating your plan..."),d.makeAJAXcall({type:"POST",url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/optimizeStay",synchronize:!0,data:{view:"empty",stayId:b,forceMerge:c,userDIY:h},error:function(){i&&i()},success:function(b,c,d){d.getResponseHeader("Modified-Visits")?($("#pageWrapper").append($(b)),
p.triggerEvent("planUtils","show-removed-visits-dlg",{cb:e})):a&&a()},complete:function(){j.hideLoading(m,l);n&&n();h&&p.triggerEvent("explore","show-tab-itinerary",{addToHistory:!1,tabData:{subnav:"calendar"}})}}))}var l=$("#resultpageContent"),m=$("#planRecalculating");if(g){var r=$("<div></div>");r.dialog({resizable:!1,modal:!0,title:h+" has conflicts. Do you want to proceed?",draggable:!1,width:"490px",dialogClass:"dlg-recalc mediumx",buttons:{No:function(){r.dialog("close")},Yes:function(){c.recalcStay(b,
a,i,n,!1);r.dialog("close")}},close:function(){r.dialog("destroy").remove()}})}else e(!1,!1)},getFormattedAttachmentLink:function(b){return'<div class="attachment '+(b.id?"":"placeholder")+'" ><div class="attachment-file-wrapper attachment-link text-link" data-attachment-name="'+b.name+'" data-attachment-id="'+(b.id?b.id:"")+'"><svg class="attachment-file"><use xlink:href="#icon-attachment-file"/></svg></div><span class="attachment-link text-link file-name" data-attachment-name="'+b.name+'" data-attachment-id="'+
(b.id?b.id:"")+'">'+b.name+'</span><div class="attachment-cross-wrapper"><svg class="attachment-cross"><use xlink:href="#icon-cross"/></div><div class="progress"></div></div>'},getAttachmentIds:function(b){var c=[];b.find(".attachment-list .attachment").each(function(b,a){c.push($(a).find(".attachment-link").data("attachmentId"))});return c},getAttachments:function(b){var c=[];b.find(".attachment-list .attachment").each(function(b,a){c.push({id:$(a).find(".attachment-link").data("attachmentId"),name:$(a).find(".attachment-link").data("attachmentName")})});
return c},adjustNotesTextAreaHeight:function(b){var c=b.height(),a=b.parents(".notes-attachment-wrapper"),d=a.scrollTop();b.height(1);var i=b[0].scrollHeight;b.height(i);a.scrollTop(d+(i-c))}};return c});define("text%21templates/deleteNotesQtip.html",[],function(){return'<div class="message">Deleting &ldquo;<span class="title"></span>&rdquo; will remove all notes &amp; attachments.</div>\n<div class="buttons">\n    <button class="cta-button large cancel">Cancel</button>\n    <button class="cta-button large delete">Delete</button>\n</div>'});
define("plan/planHelper",["text!templates/deleteNotesQtip.html","jquery","jqueryui","qtip"],function(a){return{deleteNotesQtip:function(g,d,p){var m=$("<div />").append(a);m.find(".title").html(d);g.qtip({overwrite:!0,content:{text:m.html(),button:!0},position:{at:"top center",my:"bottom center",container:$(".dlg-show-overflow-calendar").length?$(".calendar-container"):$("body"),viewport:$(".dlg-show-overflow-calendar").length?$(".calendar-container"):$(window),adjust:{x:-5,y:-5,method:"flip"}},show:{event:"click",
ready:!0},hide:{event:"unfocus",fixed:!0},events:{show:function(a,d){d.elements.content.find(".delete").off("click.delete").on("click.delete",function(){p&&p();d.hide()});d.elements.content.find(".cancel").off("click.cancel").on("click.cancel",function(){d.hide()})},hide:function(a,d){d.destroy()}},style:{classes:"qtip-light qtip-shadow delete-notes-tip",width:"320",tip:{corner:!0,width:20,height:10}}})}}});
define("modules/flightquotes",["modules/ajax"],function(a){var g={},d={},p={};g.getQuote=function(a,j){if(window.flightsEnabled){var i;i=a.startDestinationId+"|"+a.endDestinationId+"|"+a.outboundDateStr;a.inboundDateStr&&(i+="|"+a.inboundDateStr);var c=!1;if(d.hasOwnProperty(i)){var b=d[i];0<b.amount&&(j(b),c=!0)}c||(p[i]={input:a,successCB:j},g.timeout||(g.timeout=setTimeout(function(){g.processQueue();delete g.timeout},50)))}};g.processQueue=function(){if(!$.isEmptyObject(p)){var g=p,j=[],i;for(i in g){var c=
g[i].input;j.push({cacheCode:i,origin:c.startDestinationId,destination:c.endDestinationId,outboundDateStr:c.outboundDateStr,inboundDateStr:c.inboundDateStr})}a.makeAJAXcall({type:"GET",url:"/transportation/flights/get-a-quote",data:{data:JSON.stringify(j)},success:function(b){if(b)for(var c in b){var a=b[c];d[a.cacheCode]=a;0<a.amount&&g[a.cacheCode].successCB(a)}}});p=[]}};return g});define("text%21templates/reservations/container.html",[],function(){return'<div class="reservation-container"></div>'});
define("text%21templates/reservations/addOptions.html",[],function(){return'<div class="add-header">Add reservation</div>\n<div class="email-text add-type">\n    <svg>\n        <use xlink:href="#icon-grey-envelope"></use>\n    </svg>\n    <span class="message">\n        <span class="forward">Forward booking confirmation email to</span>\n        <a href="mailto:plans@inspirock.com" target="_top" class="reservation-email text-link">plans@inspirock.com</a>\n        <span class="recommend">&nbsp;(recommended)</span>\n    </span>\n</div>\n<div class="line">\n    <span>Or</span>\n</div>\n<div class="manual-text add-type">\n    <svg>\n        <use xlink:href="#icon-add-circle"></use>\n    </svg>\n    <span class="message">Enter reservation details</span>\n</div>\n<div class="line">\n    <span>Or</span>\n</div>\n<div class="add-existing add-type">\n    <svg>\n        <use xlink:href="#icon-attach"></use>\n    </svg>\n    <span class="message">Select existing reservation</span>\n</div>'});
define("text%21templates/reservations/options.html",[],function(){return'<div class="options-container">\n    <div class="options-header">Select Reservation type</div>\n    <div class="option-container" data-type="HotelReservation" data-name="hotel">\n        <svg class="bed">\n            <use xlink:href="#icon-bed"></use>\n        </svg>\n        <span class="type-name">Hotel</span>\n    </div>\n    <div class="option-container" data-type="CarReservation" data-name="car-rental">\n        <svg class="car">\n            <use xlink:href="#icon-travel-car"></use>\n        </svg>\n       <span class="type-name">Car Rental</span>\n    </div>\n    <div class="option-container" data-type="travel" data-name="travel">\n        <svg class="flight">\n            <use xlink:href="#icon-travel-flight"></use>\n        </svg>\n        <span class="type-name">Travel</span>\n    </div>\n    <div class="option-container" data-type="AttractionReservation" data-name="attraction">\n        <svg class="binocs">\n            <use xlink:href="#icon-binocs"></use>\n        </svg>\n        <span class="type-name">Attraction</span>\n    </div>\n    <div class="option-container" data-type="CustomReservation" data-name="custom">\n        <svg class="other">\n            <use xlink:href="#icon-flag"></use>\n        </svg>\n        <span class="type-name">Other</span>\n    </div>\n</div>'});
define("text%21templates/reservations/travel/options.html",[],function(){return'<div class="sel-type hidden">\n    Select Travel type\n</div>\n<div class="option-container travel-option indent1 hidden" data-type="FlightReservation">\n    <svg class="flight">\n        <use xlink:href="#icon-travel-flight"></use>\n    </svg>\n    <span class="type-name">Flight</span>\n</div>\n<div class="option-container travel-option indent1 hidden car" data-type="CarReservation">\n    <svg class="car">\n        <use xlink:href="#icon-travel-car"></use>\n    </svg>\n    <span class="type-name">Car</span>\n</div>\n<div class="option-container travel-option indent1 hidden" data-type="TrainReservation">\n    <svg class="train">\n        <use xlink:href="#icon-travel-train"></use>\n    </svg>\n    <span class="type-name">Train</span>\n</div>\n<div class="option-container travel-option indent1 hidden" data-type="BusReservation">\n    <svg class="bus">\n        <use xlink:href="#icon-travel-bus"></use>\n    </svg>\n    <span class="type-name">Bus</span>\n</div>\n<div class="option-container travel-option indent1 hidden" data-type="BoatReservation">\n    <svg class="ferry">\n        <use xlink:href="#icon-travel-ferry"></use>\n    </svg>\n    <span class="type-name">Ferry</span>\n</div>\n<div class="option-container travel-option indent1 hidden" data-type="ShuttleReservation">\n    <svg class="shuttle">\n        <use xlink:href="#icon-travel-shuttle"></use>\n    </svg>\n    <span class="type-name">Shuttle</span>\n</div>\n<div class="option-container travel-option indent1 hidden" data-type="OtherTravelReservation">\n    <svg class="custom">\n        <use xlink:href="#icon-travel-custom"></use>\n    </svg>\n    <span class="type-name">Other</span>\n</div>'});
define("text%21templates/reservations/travelNoMatch.html",[],function(){return'<div class="travel-no-match">\n    <h2>Are you Sure?</h2>\n    <div class="content">\n        This travel is from <b><span class="item-from-destination"></span> to <span class="item-to-destination"></span></b> but \n        you are adding it to <b><span class="reservation-from-destination"></span> to <span class="reservation-to-destination"></span></b>\n    </div>\n    <div class="buttons">\n        <div class="yes">Yes, add to plan</div>\n        <div class="no">No, don\'t add</div>\n    </div>\n</div>'});
define("text%21templates/reservations/travelDestinationNotAvbl.html",[],function(){return'<div class="travel-no-match">\n    <h2>Are you Sure?</h2>\n    <div class="content">\n        Please confirm, this reservation is for <b><span class="item-from-destination"></span> to <span class="item-to-destination"></span></b>\n    </div>\n    <div class="buttons">\n        <div class="yes">Yes, add to plan</div>\n        <div class="no">No, don\'t add</div>\n    </div>\n</div>'});
define("text%21templates/reservations/stayNoMatch.html",[],function(){return'<div class="stay-no-match">\n    <h2>Are you Sure?</h2>\n    <div class="content">\n        This hotel reservation is for <b><span class="reservation-destination"></span>, <span class="reservation-date"></span></b> but\n        you are adding it to <b><span class="item-destination"></span>, <span class="item-date"></span></b>\n    </div>\n    <div class="buttons">\n        <div class="yes">Yes, add to plan</div>\n        <div class="no">No, don\'t add</div>\n    </div>\n</div>'});
define("text%21templates/reservations/stayDestinationNotAvbl.html",[],function(){return'<div class="stay-no-match">\n    <h2>Are you Sure?</h2>\n    <div class="content">\n        Please confirm, this hotel reservation is for <b><span class="item-destination"></span>, <span class="item-date"></span></b>\n    </div>\n    <div class="buttons">\n        <div class="yes">Yes, add to plan</div>\n        <div class="no">No, don\'t add</div>\n    </div>\n</div>'});
define("text%21templates/reservations/stayPresent.html",[],function(){return'<div class="stay-present">\n    <h2>\n        <svg class="error-circle">\n            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-error-circle"></use>\n        </svg>\n    </h2>\n    <div class="content">\n        You already have a hotel reservation associated with your stay in <b><span class="item-destination"></span>, <span class="item-date"></span></b>.\n        Currently we support only one hotel reservation per destination.\n    </div>\n    <div class="buttons">\n        <div class="got-it">Got it!</div>\n    </div>\n</div>'});
define("text%21templates/reservations/carRentalNoMatch.html",[],function(){return'<div class="car-rental-no-match">\n    <h2>Are you Sure?</h2>\n    <div class="content">\n        You are traveling from <span class="reservation-from-destination"></span> to <span class="reservation-to-destination"></span>\n        on <b><span class="item-date-range"></span></b>. But your reservation is on <b><span class="reservation-date-range"></span></b>.\n    </div>\n    <div class="buttons">\n        <div class="yes">Yes, add to plan</div>\n        <div class="no">No, don\'t add</div>\n    </div>\n</div>'});
define("text%21templates/reservations/carRentalDestinationNotAvbl.html",[],function(){return'<div class="car-rental-destination-not-avbl">\n    <h2>Are you Sure?</h2>\n    <div class="content">\n        We are unable match the pickup and dropoff location to your plan.\n    </div>\n    <div class="buttons">\n        <div class="yes">Yes, add to plan</div>\n        <div class="no">No, don\'t add</div>\n    </div>\n</div>'});define("text%21templates/reservations/activityNoMatch.html",[],function(){return'<div class="activity-no-match">\n    <h2>Are you Sure?</h2>\n    <div class="content">\n        This activity reservation is for <b><span class="reservation-attraction"></span></b> but\n        you are adding it to <b><span class="item-attraction"></span></b>\n    </div>\n    <div class="buttons">\n        <div class="yes">Yes, add to plan</div>\n        <div class="no">No, don\'t add</div>\n    </div>\n</div>'});
define("text%21templates/reservations/errorCompatability.html",[],function(){return'<div class="error-compatability">\n    <h2>\n        <svg class="error-circle">\n            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-error-circle"></use>\n        </svg>\n    </h2>\n    <div class="content">\n    </div>\n    <div class="buttons">\n        <div class="got-it">Got it!</div>\n    </div>\n</div>'});define("text%21templates/reservations/reservationItemContainer.html",[],function(){return'<div class="reservation-item-container">\n    <div class="reservation-type">Reservation type: <span class="type"></span></div>\n    <div class="items"></div>\n</div>'});
define("constants",["jquery","jqueryui"],function(){var a={};a.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP={position:{my:"top left",at:"bottom left",container:$("body"),viewport:$(window),effect:!1}};return a});
define("plan/reservation/utils/reservationUtils",["modules/utils","modules/ajax","constants","moment","jquery"],function(a,g,d,p){var m={getDateDifference:function(){},addAdditionalData:function(a,d){a&&(a.id&&(d.id=a.id),void 0!==a.itemId&&(d.itemId=a.itemId.toString()),a.isNightLife&&(d.isNightLife=""+a.isNightLife));return d},unescapeHtml:function(a){if(a&&a.trim().length)return $("<textarea/>").html(a).text()},createDatePickers:function(a,d,c,b,f,g,n,k){m.createDatePicker(a,c.toDate(),b.toDate(),
a.siblings(".custom-event-date-box"),f,k,g);d&&d.length&&m.createDatePicker(d,c.clone().add(30,"m").toDate(),b.toDate(),d.siblings(".custom-event-date-box"),f,k,n)},createInspirockSelectMenu:function(d,i,c,b,f){a.createOptionForTime(d,null,c,void 0,void 0,!0);a.createOptionForTime(i,null,b,void 0,void 0,!0);d.inspirockSelectmenu({appendTo:d.parents(".dlg-add-reservation-option"),change:f});i.inspirockSelectmenu({appendTo:i.parents(".dlg-add-reservation-option"),change:f})},addGoogleAutocomplete:function(a,
d,c){a.googleAutocomplete({element:a[0],onSelect:d,isAddressRequired:c});a[1]&&a.googleAutocomplete({element:a[1],onSelect:d,isAddressRequired:c})},checkValues:function(a){var d=m.getAddress(a.find(".depart-station"),"pickup_"),c=m.getAddress(a.find(".arrival-station"),"dropoff_"),b=a.find(".line-name").val(),f=m.getDateTime(a.find(".start-container")),g=m.getDateTime(a.find(".end-container")),n=a.find(".depart-station").val(),k=a.find(".arrival-station").val();!b||!d||!c||d.pickup_address&&c.dropoff_address&&
d.pickup_address===c.dropoff_address||!n||!k||!f||!g||f.isSameOrAfter(g)&&1<f.clone().startOf("day").diff(g.clone().startOf("day"),"days")?a.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button").addClass("incomplete"):a.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button").removeClass("incomplete")},checkOnSubmit:function(g,i,c,b,f,m,n,k,h){var e=!f||!c||!c.id&&!c.value,l=!m||!b||!b.id&&!b.value,f=c.id&&c.id===b.id||f===m;h&&(e=!c||!c.id&&!c.value,l=!b||!b.id&&!b.value,f=c.id&&
c.id===b.id);if(i)if(e)a.showErrorTooltip(g.find(".depart-station"),"Enter a valid depart "+(h?"airport":"station"),void 0,d.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP);else if(l)a.showErrorTooltip(g.find(".arrival-station"),"Enter a valid arrival "+(h?"airport":"station"),void 0,d.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP);else if(f)a.showErrorTooltip(g.find(".to"),"Departure and arrival stations must be different.",void 0,d.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP);else if(n)if(k)if(n.isSameOrAfter(k))a.showErrorTooltip(g.find(".end-container").find(".custom-event-date-box"),
"Depart time should be before arrival time",void 0,d.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP);else return!0;else a.showErrorTooltip(g.find(".end-container").find(".custom-event-date-box"),"Choose a valid dropoff date",void 0,d.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP);else a.showErrorTooltip(g.find(".start-container").find(".custom-event-date-box"),"Choose a valid pickup date",void 0,d.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP);else a.showErrorTooltip(g.find(".line-name"),"Enter line Name",void 0,d.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)},
getMinMaxDays:function(){var a=$("#plan"),d=p(a.data("planStartDate")).subtract(1,"days"),a=p(a.data("planEndDate")).add(1,"days");return{minDate:d,maxDate:a}},customCb:function(d){return{id:void 0,label:a.escape(d),nightstay:!1,value:void 0,selectable:!0,className:"custom-data"}},getDateTime:function(a,d){var c=a.find(".custom-event-date-copy").datepicker("getDate");if(c){var c=p(c),b=d?a.find(".end-time").val():a.find(".time-in-minutes").val();c.add(parseInt(b,10),"m");return c}},createDatePicker:function(a,
d,c,b,f,g,n){var k=new Date(d);k.setDate(k.getDate()+1);a.inspirockDatepicker({minDate:d,maxDate:c,dateFormat:"yyyy-mm-dd",altFormat:"mm/dd/yy",altField:b,showAnim:"",defaultDate:k,onSelect:function(){g&&g()},beforeShow:function(){f.find("#start-time").selectmenu("close");f.find("#end-time").selectmenu("close");a.parents(".date-time").find(".custom-event-date").append($("#ui-datepicker-div").addClass("calendar-datepicker"))},onClose:function(){$("body").append($("#ui-datepicker-div").removeClass("calendar-datepicker"))}});
b.off("click").on("click",function(){a.datepicker("show")}).off("mousedown").on("mousedown",function(b){b.stopPropagation()});n&&a.datepicker("setDate",n.toDate())},saveReservation:function(d,i,c){g.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/reservation",data:{data:JSON.stringify(c),view:i.view,type:i.type,itemType:i.itemType,id:i.id,stayId:i.stayId},type:"POST",success:function(b,c,g){g.getResponseHeader("Error-List")?(d.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button").removeClass("disabled"),
i.errorCB(d,b)):(d.dialog("close"),i.successCB&&i.successCB(b),a.removeAllErrorToolTips())},error:function(){}})},getDisplayName:function(a,d){return a.name&&a.address?d?m.unescapeHtml(a.name+", "+a.address):m.unescapeHtml(a.name):m.unescapeHtml(a.address)},getAddress:function(a,d){if(a.val().trim().length){var c=a.data("googlePlace"),d=d||"";if(!c){if((c=a.data("savedLocation"))&&(a.val()===c.address||a.val()===c.name+", "+c.address||a.val()===c.name)){var b={};b[d+"name"]=c.name;b[d+"address"]=
c.address;c.lat&&c.lng&&(b[d+"lat"]=c.lat.toString(),b[d+"lng"]=c.lng.toString());b[d+"city"]=c.cityName;b[d+"destinationId"]=c.destination;return b}c={formatted_address:a.val(),address_components:[]}}var b=$(c.address_components).filter(function(){return-1!==this.types.indexOf("postal_code")})[0],f=$(c.address_components).filter(function(){return-1!==this.types.indexOf("locality")})[0],g=$(c.address_components).filter(function(){return-1!==this.types.indexOf("country")})[0],n={};n[d+"name"]=c.name;
n[d+"address"]=c.formatted_address?c.formatted_address:c.address;n[d+"lat"]=c.geometry?c.geometry.location.lat().toString():void 0;n[d+"lng"]=c.geometry?c.geometry.location.lng().toString():void 0;n[d+"postalCode"]=b?b.short_name:"";n[d+"city"]=f?f.short_name:"";n[d+"country"]=g?g.short_name:"";n[d+"destinationId"]=c.destinationId;return n}},createCalendarItemDialogContainer:function(a,d){var c=$(".dlg-show-overflow-calendar"),b=c.length?parseInt(c.css("z-index"),10)+2:100;$(".resultspage").addClass("scroll-hide-calendar-dlg");
a.css({position:"fixed",left:0,top:0,right:0,bottom:0,overflow:"auto","z-index":b}).attr("id","calendarItemContainer");a.appendTo($("body"));var f=d.parents(".ui-dialog");f.appendTo(a);d.dialog("open");f.next().hasClass("ui-widget-overlay")&&f.next().remove();c.length&&a.next().css({"z-index":b-1});a.off("click").on("click",function(b){"calendarItemContainer"===$(b.target).attr("id")&&d.dialog("close")})},getReservationRowDataForCalendarDialogs:function(a){var d,c,b,f,g;a.parents(".dlg-calendar-edit-item").hasClass("dlg-travel-item")?
(d="planItem",c="travel",b=a.data("id"),g=a.data("reservationType")):(g=a.data("reservationType"),d="ActivityReservation"===g?"visit":"reserved",c="ActivityReservation"===g?"visit":"reserved",b=a.data("id"),f=a.data("stayId"));var n={};d&&(n.type=d);c&&(n.itemType=c);null!==b&&void 0!==b&&(n.id=b);null!==f&&void 0!==f&&(n.stayId=f);n.reservationType=g;var k=[];a.find(".reservation-wrapper").find(".reservation").each(function(){k.push($(this).data("reservationId"))});k.length&&(n.eventReservations=
k);return n}};return m});define("text%21templates/reservations/hotel.html",[],function(){return'<div class="reservation-form-container hotel">\n    <div class="res-header">\n        <svg>\n            <use xlink:href="#icon-bed"></use>\n        </svg>\n        <span>Enter hotel / apartment reservation</span>\n    </div>\n    <div class="header">Booking confirmation #</div>\n    <input type="text" name="confirm" class="confirm flat" placeholder="Optional"/>\n    \n    <div class="hotel-phone-container container">\n        <div class="linename-bus-container sub-container">\n            <div class="hotel-header header">Hotel name</div>\n            <input type="text" name="hotel-name" class="hotel-name flat"/>\n        </div>\n        <div class="phone-container sub-container">\n            <div class="phone-header header">Hotel phone</div>\n            <input type="text" name="phone-no" class="phone-no flat" placeholder="Optional"/>\n        </div>\n    </div>\n    \n    <div class="container single">\n        <div class="header">Location</div>\n        <input type="text" name="location" class="location flat" placeholder="Entering location will help optimize your plan"/>\n    </div>\n\n    <div class="depart-date-header header">Check in date</div>\n    <div class="arrival-date-header header">Check out date</div>\n    \n    <div class="date-time start-container">\n        <div class="custom-event-date calendar-input">\n            <input type="text" name="custom-event-date-copy" class="custom-event-date-copy container-datepicker" readonly="readonly"/>\n            <input type="text" name="custom-event-date-box" class="custom-event-date-box flat" placeholder="Select" readonly="readonly"/>\n            <svg class="calendar-icon">\n                <use xlink:href="#icon-calendar" />\n            </svg>\n        </div>\n        <div class="time-holder">\n            <select id="start-time" class="time-in-minutes notranslate" name="day"></select>\n        </div>\n    </div>\n\n    <div class="date-time end-container">\n        <div class="custom-event-date calendar-input">\n            <input type="text" name="custom-event-date-copy" class="custom-event-date-copy container-datepicker flat" readonly="readonly"/>\n            <input type="text" name="custom-event-date-box" class="custom-event-date-box flat" placeholder="Select" readonly="readonly"/>\n            <svg class="calendar-icon">\n                <use xlink:href="#icon-calendar" />\n            </svg>\n        </div>\n        <div class="time-holder">\n            <select id="end-time" class="time-in-minutes notranslate" name="day"></select>\n        </div>\n    </div>\n    <div class="error hidden"></div>\n</div>'});
define("jQueryExtensions/googleAutocomplete",["jquery","jqueryui"],function(){$.fn.googleAutocomplete=function(a){var g=new window.google.maps.places.Autocomplete(a.element,a.options);g.addListener("place_changed",function(){var d=g.getPlace(),p=Object.keys(d);p&&1===p.length&&"name"===p[0]?($(a.element).val(d.name),a.addressElement&&(d.address=d.name,$(a.addressElement).data("googlePlace",d))):(a.phoneElement&&$(a.phoneElement).val(d.international_phone_number),a.addressElement&&$(a.addressElement).val(d.formatted_address).data("googlePlace",
d),a.nameElement&&$(a.nameElement).val(d.name));!a.nameElement&&!a.addressElement&&(p=a.isAddressRequired?d.name+", "+d.formatted_address:d.name,$(a.element).val(p).data("googlePlace",d));if(a.onSelect)a.onSelect()})}});
define("plan/reservation/hotel","modules/utils constants plan/reservation/utils/reservationUtils text!templates/reservations/hotel.html moment jquery jQueryExtensions/googleAutocomplete".split(" "),function(a,g,d,p,m){return{save:function(j,i){var c=[],b=i.find(".reservation-form-container"),f=b.find(".hotel-name").val();if(f){var m=d.getAddress(b.find(".location"));if(m){var n=d.getDateTime(b.find(".start-container"));if(n){var k=d.getDateTime(b.find(".end-container"));if(k)if(n.isSameOrAfter(k))a.showErrorTooltip(b.find(".end-container").find(".ui-selectmenu-button"),
"Arrival should be after departure",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP);else{var h=b.find(".confirm").val(),b=b.find(".phone-no").val(),f={hotelName:f,mode:"hotel",startTime:n.format(a.ISO_DATE_TIME_FORMAT),endTime:k.format(a.ISO_DATE_TIME_FORMAT),confirmation:h,phoneNo:b,sameTimeZone:!0},f=$.extend({},f,m),f=d.addAdditionalData(j,f);c.push(f);return c}else a.showErrorTooltip(b.find(".end-container").find(".custom-event-date-box"),"Choose a valid check out date",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(b.find(".start-container").find(".custom-event-date-box"),
"Choose a valid check in date",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(b.find(".location"),"Enter a valid location",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(b.find(".hotel-name"),"Enter hotel name",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)},open:function(a,i){var c=$(p),b=$("<div />").append(c),f=d.getMinMaxDays(),g=f.minDate,f=f.maxDate;i.html(b);var b=c.find(".end-container").find(".custom-event-date-copy"),n=c.find(".start-container").find(".custom-event-date-copy"),
k,h,e=840,l=600,t=c.find(".start-container").find(".time-in-minutes"),r=c.find(".end-container").find(".time-in-minutes"),q=c.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button"),D=c.find(".hotel-name"),v=c.find(".phone-no"),B=c.find(".location"),z=function(){var b=D.val(),a=B.val(),e=d.getDateTime(c.find(".start-container")),f=d.getDateTime(c.find(".end-container"));!b||!a||!e||!f||e.isSameOrAfter(f)?q.addClass("incomplete"):q.removeClass("incomplete")};c.off("keyup.hotel-name").on("keyup.hotel-name",
".hotel-name, .location",z);q.addClass("incomplete");D.googleAutocomplete({element:D[0],nameElement:D[0],addressElement:B[0],phoneElement:v[0],options:{types:["establishment"]},onSelect:z});B.googleAutocomplete({element:B[0],nameElement:D[0],addressElement:B[0],phoneElement:v[0],onSelect:z});a&&(c.find(".confirm").val(d.unescapeHtml(a.confirmationNumber)),D.val(d.unescapeHtml(a.name)),v.val(d.unescapeHtml(a.phone)),k=m(a.startDateTime).startOf("day"),h=m(a.endDateTime).startOf("day"),e=m(a.startDateTime).diff(k,
"minutes"),l=m(a.endDateTime).diff(h,"minutes"),a.fromLocation&&B.val(d.unescapeHtml(a.fromLocation.address)).data("savedLocation",a.fromLocation),a.id&&c.data("reservationId",a.id),a.isPartial||q.removeClass("incomplete"));d.createDatePickers(n,b,g,f,c,k,h,z);d.createInspirockSelectMenu(t,r,e,l,z)}}});define("text%21templates/reservations/attraction.html",[],function(){return'<div class="reservation-form-container attraction">\n    <div class="res-header">\n        <svg>\n            <use xlink:href="#icon-binocs"></use>\n        </svg>\n        <span>Enter attraction reservation</span>\n    </div>\n    <div class="header">Booking confirmation #</div>\n    <input type="text" name="confirm" class="confirm flat" placeholder="Optional"/>\n    \n    \n    <div class="container single">\n        <div class="attraction-header header">Attraction name</div>\n        <input type="text" name="attraction-name" class="attraction-name flat"/>\n    </div>\n    \n    <div class="container single">\n        <div class="location-header header">Location</div>\n        <input type="text" name="location" class="location flat" placeholder="Entering location will help optimize your plan"/>\n    </div>\n\n    <div class="depart-date-header header">Date</div>\n    <div class="time-header header">Start time</div>\n    <div class="time-header header">End time</div>\n    \n    <div class="date-time start-container single clearfix">\n        <div class="custom-event-date calendar-input">\n            <input type="text" name="custom-event-date-copy" class="custom-event-date-copy container-datepicker" readonly="readonly"/>\n            <input type="text" name="custom-event-date-box" class="custom-event-date-box flat" placeholder="Select" readonly="readonly"/>\n            <svg class="calendar-icon">\n                <use xlink:href="#icon-calendar" />\n            </svg>\n        </div>\n        <div class="time-holder">\n            <select id="start-time" class="time-in-minutes notranslate" name="day"></select>\n        </div>\n        <div class="time-holder">\n            <select id="end-time" class=" end-time time-in-minutes notranslate" name="day"></select>\n        </div>\n    </div>\n\n    <div class="error hidden"></div>\n</div>'});
define("plan/reservation/attraction","modules/utils plan/reservation/utils/reservationUtils text!templates/reservations/attraction.html moment jquery jQueryExtensions/googleAutocomplete".split(" "),function(a,g,d,p){return{save:function(d,j){var i=[],c=j.find(".reservation-form-container"),b=c.find(".attraction-name").data("inspirockAutocomplete").getSelectedItem(),f=c.find(".confirm").val(),u=g.getDateTime(c.find(".start-container")),n=g.getDateTime(c.find(".start-container"),!0);if(!b||!b.id&&!b.value)a.showErrorTooltip(c.find(".attraction-name"),
"Enter attraction Name");else if(!u||!n)a.showErrorTooltip(c.find(".start-container").find(".custom-event-date-box"),"Choose a valid date");else if(u.isSameOrAfter(n))a.showErrorTooltip(c.find(".start-container").find(".time-holder").last().find(".ui-selectmenu-button"),"Arrival should be after departure");else{var k=g.getAddress(c.find(".location"));if(!k||!k.address)a.showErrorTooltip(c.find(".location"),"Enter a valid location");else return c=c.find(".location").data("attractionId"),b={attractionName:b.value,
mode:"attraction",startTime:u.format(a.ISO_DATE_TIME_FORMAT),endTime:n.format(a.ISO_DATE_TIME_FORMAT),confirmation:f,attractionId:b.id,sameTimeZone:!0},c&&(b.isAttrAddress="true"),b=$.extend({},b,k),b=g.addAdditionalData(d,b),i.push(b),i}},open:function(a,j){var i=$(d),c=$("<div />").append(i),b=g.getMinMaxDays(),f=b.minDate,b=b.maxDate;j.html(c);var c=i.find(".start-container").find(".custom-event-date-copy"),u,n,k=600,h=630,e=i.find(".start-container").find(".time-in-minutes"),l=i.find(".start-container").find(".end-time"),
t=i.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button"),r=i.find(".attraction-name"),q=i.find(".location"),D=function(){var b=r.val(),a=q.val(),c=g.getDateTime(i.find(".start-container")),d=g.getDateTime(i.find(".start-container"),!0);!b||!a||!c||!d||c.isSameOrAfter(d)?t.addClass("incomplete"):t.removeClass("incomplete")};i.off("keyup.attraction-name").on("keyup.attraction-name",".attraction-name, .location",D);i.off("keyup.location").on("keyup.location",".location",function(){$(this).data("attractionId",
"")});t.addClass("incomplete");r.inspirockAutocomplete({url:window.contextPath+"/attractionAutocomplete",appendTo:r.parents(".ui-dialog"),data:{hideCity:!0},onSelect:function(b,a){a&&a.address&&(q.data("place",{formatted_address:a.address,destinationId:a.destinationId}).val(a.address),q.data("attractionId",a.id));D()}});q.googleAutocomplete({element:q[0],addressElement:q[0],onSelect:D});if(a){i.find(".confirm").val(g.unescapeHtml(a.confirmationNumber));u=p(a.startDateTime).startOf("day");n=p(a.endDateTime).startOf("day");
k=p(a.startDateTime).diff(u,"minutes");h=p(a.endDateTime).diff(n,"minutes");if(a.attractionData){var v=i.find(".attraction-name"),B=a.attractionData,B={id:B.id,value:$("<i>"+B.value+"</i>").text(),label:B.label,destinationId:B.destinationId,isScheduleable:B.isSchedulable};v.data("inspirockAutocomplete").setItem(B)}a.fromLocation&&i.find(".location").val(g.unescapeHtml(a.fromLocation.address)).data("savedLocation",a.fromLocation);a.isPartial||t.removeClass("incomplete")}g.createDatePickers(c,void 0,
f,b,i,u,n,D);g.createInspirockSelectMenu(e,l,k,h,D)}}});define("text%21templates/reservations/custom.html",[],function(){return'<div class="reservation-form-container custom">\n    <div class="res-header">\n        <svg>\n            <use xlink:href="#icon-flag"></use>\n        </svg>\n        <span>Enter custom activity reservation</span>\n    </div>\n    <div class="header">Booking confirmation #</div>\n    <input type="text" name="confirm" class="confirm flat" placeholder="Optional"/>\n    \n    \n    <div class="container single">\n        <div class="custom-header header">Activity title</div>\n        <input type="text" name="activity-title" class="activity-title flat"/>\n    </div>\n    \n    <div class="container single">\n        <div class="location-header header">Location</div>\n        <input type="text" name="location" class="location flat" id="custom-location" placeholder="Entering location will help optimize your plan"/>\n    </div>\n\n    <div class="depart-date-header header">Date</div>\n    <div class="time-header header">Start time</div>\n    <div class="time-header header">End time</div>\n    \n    <div class="date-time start-container single clearfix">\n        <div class="custom-event-date calendar-input">\n            <input type="text" name="custom-event-date-copy" class="custom-event-date-copy container-datepicker" readonly="readonly"/>\n            <input type="text" name="custom-event-date-box" class="custom-event-date-box flat" placeholder="Select" readonly="readonly"/>\n            <svg class="calendar-icon">\n                <use xlink:href="#icon-calendar" />\n            </svg>\n        </div>\n        <div class="time-holder">\n            <select id="start-time" class="time-in-minutes notranslate" name="day"></select>\n        </div>\n        <div class="time-holder">\n            <select id="end-time" class=" end-time time-in-minutes notranslate" name="day"></select>\n        </div>\n    </div>\n\n    <div class="error hidden"></div>\n</div>'});
define("plan/reservation/custom","modules/utils constants plan/reservation/utils/reservationUtils text!templates/reservations/custom.html moment jquery jQueryExtensions/googleAutocomplete".split(" "),function(a,g,d,p,m){return{save:function(j,i){var c=[],b=i.find(".reservation-form-container"),f=b.find(".activity-title").val(),m=b.find(".confirm").val(),n=d.getDateTime(b.find(".start-container")),k=d.getDateTime(b.find(".start-container"),!0);if(f)if(n)if(k)if(n.isSameOrAfter(k))a.showErrorTooltip(b.find(".start-container").find(".time-holder").last().find(".ui-selectmenu-button"),
"Arrival should be after departure",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP);else{var h=d.getAddress(b.find(".location"));if(h)return b={activityTitle:f,mode:"custom",startTime:n.format(a.ISO_DATE_TIME_FORMAT),endTime:k.format(a.ISO_DATE_TIME_FORMAT),confirmation:m,sameTimeZone:!0},b=$.extend({},b,h),b=d.addAdditionalData(j,b),c.push(b),c;a.showErrorTooltip(b.find(".location"),"Enter a valid location",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(b.find(".start-container").find("#end-time"),
"Choose an end time",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP);else a.showErrorTooltip(b.find(".start-container").find("#start-time"),"Choose a start time",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP);else a.showErrorTooltip(b.find(".activity-title"),"Enter a title",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)},open:function(a,i){var c=$(p),b=$("<div />").append(c),f=d.getMinMaxDays(),g=f.minDate,f=f.maxDate;i.html(b);var b=c.find(".start-container").find(".custom-event-date-copy"),n,k,h=600,e=630,l=c.find(".start-container").find(".time-in-minutes"),
t=c.find(".start-container").find(".end-time"),r=c.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button"),q=c.find(".activity-title"),D=c.find(".location"),v=function(){var b=q.val(),a=D.val(),e=d.getDateTime(c.find(".start-container")),f=d.getDateTime(c.find(".start-container"),!0);!b||!a||!e||!f||e.isSameOrAfter(f)?r.addClass("incomplete"):r.removeClass("incomplete")};c.off("keyup.location").on("keyup.location",".location",v);c.off("keyup.confirm").on("keyup.confirm",".confirm",v);c.off("keyup.activity-title").on("keyup.activity-title",
".activity-title",v);r.addClass("incomplete");D.googleAutocomplete({element:D[0],addressElement:D[0],onSelect:v});a&&(c.find(".confirm").val(d.unescapeHtml(a.confirmationNumber)),q.val(d.unescapeHtml(a.name)),n=m(a.startDateTime).startOf("day"),k=m(a.endDateTime).startOf("day"),h=m(a.startDateTime).diff(n,"minutes"),e=m(a.endDateTime).diff(k,"minutes"),a.minDate&&(g=m(a.minDate)),a.maxDate&&(f=m(a.maxDate)),a.fromLocation&&D.val(d.unescapeHtml(a.fromLocation.address)).data("savedLocation",a.fromLocation),
a.isPartial||r.removeClass("incomplete"));d.createDatePickers(b,void 0,g,f,c,n,k,v);d.createInspirockSelectMenu(l,t,h,e,v)}}});define("text%21templates/reservations/travel/flight.html",[],function(){return'<div class="reservation-form-container">\n    <div class="res-header">\n        <svg class="flight">\n            <use xlink:href="#icon-travel-flight"></use>\n        </svg>\n        <span>Enter flight reservation</span>\n    </div>\n    <div class="airline-conf header">Airline confirmation #</div>\n    <input type="text" name="airline-confirmation" class="airline-confirmation flat" placeholder="Optional"/>\n    <div class="airline-flight-container container">\n        <div class="airline-name-container sub-container">\n            <div class="airline-header header">Airline</div>\n            <input type="text" name="line-name" class="line-name flat"/>\n        </div>\n        <div class="flight-number-container sub-container">\n            <div class="flight-number-header header">Flight #</div>\n            <input type="text" name="flight-number" class="flight-number flat" placeholder="Optional"/>\n        </div>\n    </div>\n    <div class="depart-arrival-container container">\n        <div class="depart-container sub-container">\n            <div class="depart-header header">Depart airport</div>\n            <input type="text" name="depart-airport" class="depart-station flat" placeholder="Entering airport will help optimize your plan"/>\n        </div>\n        <div class="arrival-container sub-container">\n            <div class="arrival-header header">Arrival airport</div>\n            <input type="text" name="arrival-airport" class="arrival-station flat" placeholder="Entering airport will help optimize your plan"/>\n        </div>\n    </div>\n\n    <div class="depart-date-header header">Depart date</div>\n    <div class="arrival-date-header header">Arrival date</div>\n    <div class="date-time start-container flight">\n        <div class="custom-event-date calendar-input">\n            <input type="text" name="custom-event-date-copy" class="custom-event-date-copy container-datepicker" readonly="readonly"/>\n            <input type="text" name="custom-event-date-box" class="custom-event-date-box flat" placeholder="Start date" readonly="readonly"/>\n            <svg class="calendar-icon">\n                <use xlink:href="#icon-calendar" />\n            </svg>\n        </div>\n        <div class="time-holder">\n            <select id="start-time" class="time-in-minutes notranslate" name="day"></select>\n        </div>\n    </div>\n\n    <div class="date-time end-container flight">\n        <div class="custom-event-date calendar-input">\n            <input type="text" name="custom-event-date-copy" class="custom-event-date-copy container-datepicker flat" readonly="readonly"/>\n            <input type="text" name="custom-event-date-box" class="custom-event-date-box flat" placeholder="End date" readonly="readonly"/>\n            <svg class="calendar-icon">\n                <use xlink:href="#icon-calendar" />\n            </svg>\n        </div>\n        <div class="time-holder">\n            <select id="end-time" class="time-in-minutes notranslate" name="day"></select>\n        </div>\n    </div>\n    <div class="error hidden"></div>\n</div>\n<div class="text-link add-flight">+ Add another flight</div>'});
define("plan/reservation/travel/flight","modules/utils constants plan/reservation/utils/reservationUtils text!templates/reservations/travel/flight.html moment jquery".split(" "),function(a,g,d,p,m){function j(a,b){var d={id:b.id,value:$("<i>"+b.value+"</i>").text(),schema:b.schema,iata:b.iata};a.data("inspirockAutocomplete").setItem(d)}var i={displayError:function(c,b){c.forEach(function(c){switch(c){case "ARRIVAL_BEFORE_DEPARTURE":a.showErrorTooltip(b.find(".end-container").find(".ui-selectmenu-button"),
"Arrival should be after departure",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}})},save:function(c,b){for(var f=[],j=b.find(".reservation-form-container"),n=0;n<j.length;n++){var k=$(j[n]),h=k.find(".depart-station").data("inspirockAutocomplete").getSelectedItem(),e=k.find(".arrival-station").data("inspirockAutocomplete").getSelectedItem(),l=k.find(".line-name").val().trim(),m=k.find(".airline-confirmation").val(),r=k.find(".flight-number").val(),q=d.getDateTime(k.find(".start-container")),p=d.getDateTime(k.find(".end-container"));
if(1<j.length&&!h&&!e&&!l&&!m&&!r&&!q&&!p)f.push({});else{if(!l){a.showErrorTooltip(k.find(".line-name"),"Enter line Name",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP);return}if(!h||!h.id&&!h.value){a.showErrorTooltip(k.find(".depart-station"),"Enter a valid airport",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP);return}if(!e||!e.id&&!e.value){a.showErrorTooltip(k.find(".arrival-station"),"Enter a valid airport",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP);return}if(h.id&&h.id===e.id){a.showErrorTooltip(k.find(".to"),
"Departure and airports must be different.",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP);return}if(!q){a.showErrorTooltip(k.find(".start-container").find(".custom-event-date-box"),"Choose a valid departure date",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP);return}if(!p){a.showErrorTooltip(k.find(".end-container").find(".custom-event-date-box"),"Choose a valid arrival date",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP);return}if(q.isSameOrAfter(p)&&1<q.clone().startOf("day").diff(p.clone().startOf("day"),"days")){i.displayError(["ARRIVAL_BEFORE_DEPARTURE"],
k);return}k={airlineName:l,mode:"flight",startTime:q.format(a.ISO_DATE_TIME_FORMAT),endTime:p.format(a.ISO_DATE_TIME_FORMAT),fromCode:h.id,fromSchema:h.schema,toCode:e.id,toSchema:e.schema,confirmation:m,flightNumber:r};k=d.addAdditionalData(c,k);f.push(k)}}return f},open:function(a,b){function f(b,f,i){var l=b.find(".start-container").find(".custom-event-date-copy"),k=b.find(".end-container").find(".custom-event-date-copy"),u,p,C=b.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button"),
G=600,M=630,w=b.find(".start-container").find(".time-in-minutes"),J=b.find(".end-container").find(".time-in-minutes"),F=b.find(".depart-station, .arrival-station"),y=function(){a:{for(var b=g.find(".reservation-form-container"),a=0;a<b.length;a++){var c=$(b[a]),e=c.find(".depart-station").data("inspirockAutocomplete").getSelectedItem(),f=c.find(".arrival-station").data("inspirockAutocomplete").getSelectedItem(),h=c.find(".line-name").val(),i=c.find(".airline-confirmation").val(),l=c.find(".flight-number").val(),
k=d.getDateTime(c.find(".start-container")),r=d.getDateTime(c.find(".end-container"));if(!(1<b.length&&!e&&!f&&!h&&!i&&!l&&!k&&!r)&&(!h||!e||!e.id&&!e.value||!f||!f.id&&!f.value||e.id&&e.id===f.id||!k||!r||k.isSameOrAfter(r)&&1<k.clone().startOf("day").diff(r.clone().startOf("day"),"days"))){c.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button").addClass("incomplete");break a}}c.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button").removeClass("incomplete")}};b.off("keyup.line-name").on("keyup.line-name",
".line-name, .depart-station, .arrival-station",y);f&&C.addClass("incomplete");F.inspirockAutocomplete({url:window.contextPath+"/airportAutocomplete",appendTo:F.parents(".ui-dialog"),data:{hideCity:!0,hideAllAirports:!0},onSelect:y});a&&1===i&&(b.find(".line-name").val(d.unescapeHtml(a.airlineName)),b.find(".airline-confirmation").val(d.unescapeHtml(a.confirmationNumber)),b.find(".flight-number").val(d.unescapeHtml(a.flightNumber)),u=m(a.startDateTime).startOf("day"),p=m(a.endDateTime).startOf("day"),
a.departureAirportName&&j(b.find(".depart-station"),a.departureAirportName),a.arrivalAirportName&&j(b.find(".arrival-station"),a.arrivalAirportName),G=m(a.startDateTime).diff(u,"minutes"),M=m(a.endDateTime).diff(p,"minutes"),a.isPartial||C.removeClass("incomplete"));d.createDatePickers(l,k,h,e,b,u,p,y);d.createInspirockSelectMenu(w,J,G,M,y)}var i=$(p).clone(),g=$("<div />").append(i),k=d.getMinMaxDays(),h=k.minDate,e=k.maxDate,l=1;b.html(g);f(i,!0,l);g.off("click.add-flight").on("click.add-flight",
".add-flight",function(){l++;$(".reservation-form-container").first().find(".flight1").length||$("<div class='res-header small-header flight1'>FLIGHT 1</div>").insertAfter($(".reservation-form-container").first().find(".airline-confirmation"));var b=$(p).clone().filter(".reservation-form-container");b.find(".airline-confirmation").remove();b.find(".airline-conf").remove();b.find(".res-header").empty().addClass("small-header").text("Flight "+l);b.find(".time-holder").find("select").each(function(){var b=
$(this);b.attr("id",b.attr("id")+"-"+l)});$(this).before(b);f(b,!1,l)})}};return i});define("text%21templates/reservations/travel/car.html",[],function(){return'<div class="reservation-form-container car">\n    <div class="res-header">\n        <svg class="car">\n            <use xlink:href="#icon-travel-car"></use>\n        </svg>\n        <span>Enter car reservation</span>\n    </div>\n    <div class="car-conf header">Booking confirmation #</div>\n    <input type="text" name="confirm" class="confirm flat" placeholder="Optional"/>\n    <div class="agency-cartype-container container">\n        <div class="airline-name-container sub-container">\n            <div class="agency-header header">Agency name</div>\n            <input type="text" name="line-name" class="line-name flat"/>\n        </div>\n        <div class="cartype-container sub-container">\n            <div class="cartype-header header">Car type</div>\n            <input type="text" name="car-type" class="car-type flat" placeholder="Optional"/>\n        </div>\n    </div>\n    <div class="pickup-container container">\n        <div class="pickup-header header">Pick-up location</div>\n        <input type="text" name="pickup" class="pickup depart-station flat" placeholder="Entering location will help optimize your plan"/>\n    </div>\n    \n    <div class="same-dropoff-container">\n        <input type="checkbox" id="same-dropoff" class="tripType flat dark"/>\n        <label for="same-dropoff" class="same-dropoff">\n            <span class="checkbox-text">Return car at the same location</span>\n        </label>\n    </div>\n    \n    \n    <div class="dropoff-container container">\n        <div class="dropoff-header header">Drop-off location</div>\n        <input type="text" name="dropoff" class="dropoff arrival-station flat" placeholder="Entering location will help optimize your plan"/>\n    </div>\n\n    <div class="depart-date-header header">Pick-up time</div>\n    <div class="arrival-date-header header">Drop-off time</div>\n    <div class="date-time start-container">\n        <div class="custom-event-date calendar-input">\n            <input type="text" name="custom-event-date-copy" class="custom-event-date-copy container-datepicker" readonly="readonly"/>\n            <input type="text" name="custom-event-date-box" class="custom-event-date-box flat" placeholder="Start date" readonly="readonly"/>\n            <svg class="calendar-icon">\n                <use xlink:href="#icon-calendar" />\n            </svg>\n        </div>\n        <div class="time-holder">\n            <select id="start-time" class="time-in-minutes notranslate" name="day"></select>\n        </div>\n    </div>\n\n    <div class="date-time end-container">\n        <div class="custom-event-date calendar-input">\n            <input type="text" name="custom-event-date-copy" class="custom-event-date-copy container-datepicker flat" readonly="readonly"/>\n            <input type="text" name="custom-event-date-box" class="custom-event-date-box flat" placeholder="End date" readonly="readonly"/>\n            <svg class="calendar-icon">\n                <use xlink:href="#icon-calendar" />\n            </svg>\n        </div>\n        <div class="time-holder">\n            <select id="end-time" class="time-in-minutes notranslate" name="day"></select>\n        </div>\n    </div>\n    <div class="error hidden"></div>\n</div>'});
define("plan/reservation/travel/car","modules/utils constants plan/reservation/utils/reservationUtils text!templates/reservations/travel/car.html moment jquery jQueryExtensions/googleAutocomplete".split(" "),function(a,g,d,p,m){var j={displayError:function(d,c){d.forEach(function(b){switch(b){case "ARRIVAL_BEFORE_DEPARTURE":a.showErrorTooltip(c.find(".end-container").find(".ui-selectmenu-button"),"Drop-off date should be after pick-up date",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}})},save:function(i,
c){var b=[],f=c.find(".reservation-form-container"),m=f.find(".dropoff").parent(".dropoff-container").hasClass("hidden"),n=f.find(".line-name").val().trim();if(n){var k=d.getAddress(f.find(".pickup"),"pickup_");if(k){var h=d.getAddress(f.find(m?".pickup":".dropoff"),"dropoff_");if(h){var e=d.getDateTime(f.find(".start-container"));if(e){var l=d.getDateTime(f.find(".end-container"));if(l)if(e.isSameOrAfter(l)&&1<e.clone().startOf("day").diff(l.clone().startOf("day"),"days"))j.displayError(["ARRIVAL_BEFORE_DEPARTURE"],
f);else{var t=f.find(".confirm").val(),f=f.find(".car-type").val(),m={agencyName:n,mode:"car",startTime:e.format(a.ISO_DATE_TIME_FORMAT),endTime:l.format(a.ISO_DATE_TIME_FORMAT),confirmation:t,carType:f,sameDropOff:m?"true":"false"},m=$.extend({},m,k,h),m=d.addAdditionalData(i,m);b.push(m);return b}else a.showErrorTooltip(f.find(".start-container").find(".custom-event-date-box"),"Choose a valid drop-off date",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".start-container").find(".custom-event-date-box"),
"Choose a valid pick-up date",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".dropoff"),"Enter a valid dropoff location",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".pickup"),"Enter a valid pickup location",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".line-name"),"Enter Agency Name",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)},open:function(a,c){var b=$(p),f=$("<div />").append(b),g=d.getMinMaxDays(),n=g.minDate,
g=g.maxDate;c.html(f);var f=b.find(".start-container").find(".custom-event-date-copy"),k=b.find(".end-container").find(".custom-event-date-copy"),h,e,l=600,j=630,r=b.find(".start-container").find(".time-in-minutes"),q=b.find(".end-container").find(".time-in-minutes"),D=b.find(".depart-station, .arrival-station"),v=function(){var a=$("#same-dropoff").prop("checked"),c=d.getAddress(b.find(".pickup"),"pickup_"),e=d.getAddress(b.find(a?".pickup":".dropoff"),"dropoff_"),f=b.find(".line-name").val(),h=
d.getDateTime(b.find(".start-container")),i=d.getDateTime(b.find(".end-container")),g=b.find(".pickup").val(),l=b.find(a?".pickup":".dropoff").val();!f||!c||!e||!a&&c.pickup_address&&e.dropoff_address&&c.pickup_address===e.dropoff_address||!g||!l||!h||!i||h.isSameOrAfter(i)&&1<h.clone().startOf("day").diff(i.clone().startOf("day"),"days")?b.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button").addClass("incomplete"):b.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button").removeClass("incomplete")},
B=b.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button");b.off("keyup.line-name").on("keyup.line-name",".line-name, .depart-station, .arrival-station",v);B.addClass("incomplete");d.addGoogleAutocomplete(D,v,!0);a&&(b.find(".line-name").val(d.unescapeHtml(a.agencyName)),b.find(".confirm").val(d.unescapeHtml(a.confirmationNumber)),b.find(".car-type").val(d.unescapeHtml(a.carType)),h=m(a.startDateTime).startOf("day"),e=m(a.endDateTime).startOf("day"),l=m(a.startDateTime).diff(h,"minutes"),
j=m(a.endDateTime).diff(e,"minutes"),a.fromLocation&&b.find(".depart-station").val(d.getDisplayName(a.fromLocation,!0)).data("savedLocation",a.fromLocation),a.sameDropOff?(b.find(".dropoff-container").addClass("hidden"),b.find("#same-dropoff").prop("checked",!0)):a.toLocation&&b.find(".arrival-station").val(d.getDisplayName(a.toLocation,!0)).data("savedLocation",a.toLocation),a.isPartial||B.removeClass("incomplete"));d.createDatePickers(f,a&&a.isSameDropOff?void 0:k,n,g,b,h,e,v);d.createInspirockSelectMenu(r,
q,l,j,v);b.off("click.tripType").on("click.tripType",".tripType",function(){b.find(".dropoff-container").toggleClass("hidden",!0===$(this).prop("checked"))})}};return j});define("text%21templates/reservations/travel/train.html",[],function(){return'<div class="reservation-form-container train">\n    <div class="res-header">\n        <svg class="train">\n            <use xlink:href="#icon-travel-train"></use>\n        </svg>\n        <span>Enter train reservation</span>\n    </div>\n    <div class="train-conf header">Booking confirmation #</div>\n    <input type="text" name="confirm" class="confirm flat" placeholder="Optional"/>\n    \n    <div class="line-trainno-container container">\n        <div class="linename-train-container sub-container">\n            <div class="linename-header header">Train line</div>\n            <input type="text" name="line-name" class="line-name flat"/>\n        </div>\n        <div class="train-container sub-container">\n            <div class="train-header header">Train #</div>\n            <input type="text" name="res-num" class="res-num flat" placeholder="Optional"/>\n        </div>\n    </div>\n    \n    <div class="depart-arrival-container container">\n        <div class="depart-container sub-container">\n            <div class="depart-header header">Departing station</div>\n            <input type="text" name="depart-station" class="depart-station flat" placeholder="Entering station will help optimize your plan"/>\n        </div>\n\n        <div class="arrival-container sub-container">\n            <div class="arrival-header header">Arrival station</div>\n            <input type="text" name="arrival-station" class="arrival-station flat" placeholder="Entering station will help optimize your plan"/>\n        </div>\n    </div>\n\n    <div class="depart-date-header header">Depart date</div>\n    <div class="arrival-date-header header">Arrival date</div>\n    \n    <div class="date-time start-container">\n        <div class="custom-event-date calendar-input">\n            <input type="text" name="custom-event-date-copy" class="custom-event-date-copy container-datepicker" readonly="readonly"/>\n            <input type="text" name="custom-event-date-box" class="custom-event-date-box flat" placeholder="Start date" readonly="readonly"/>\n            <svg class="calendar-icon">\n                <use xlink:href="#icon-calendar" />\n            </svg>\n        </div>\n        <div class="time-holder">\n            <select id="start-time" class="time-in-minutes notranslate" name="day"></select>\n        </div>\n    </div>\n\n    <div class="date-time end-container">\n        <div class="custom-event-date calendar-input">\n            <input type="text" name="custom-event-date-copy" class="custom-event-date-copy container-datepicker flat" readonly="readonly"/>\n            <input type="text" name="custom-event-date-box" class="custom-event-date-box flat" placeholder="End date" readonly="readonly"/>\n            <svg class="calendar-icon">\n                <use xlink:href="#icon-calendar" />\n            </svg>\n        </div>\n        <div class="time-holder">\n            <select id="end-time" class="time-in-minutes notranslate" name="day"></select>\n        </div>\n    </div>\n    \n    <div class="error hidden"></div>\n</div>'});
define("plan/reservation/travel/train","modules/utils constants plan/reservation/utils/reservationUtils text!templates/reservations/travel/train.html moment jquery".split(" "),function(a,g,d,p,m){var j={displayError:function(d,c){d.forEach(function(b){switch(b){case "ARRIVAL_BEFORE_DEPARTURE":a.showErrorTooltip(c.find(".end-container").find(".ui-selectmenu-button"),"Arrival time should be after Departure time",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}})},save:function(i,c){var b=[],f=c.find(".reservation-form-container"),
m=f.find(".line-name").val().trim();if(m){var n=d.getAddress(f.find(".depart-station"),"pickup_");if(n){var k=d.getAddress(f.find(".arrival-station"),"dropoff_");if(k)if(n.pickup_address&&k.dropoff_address&&n.pickup_address===k.dropoff_address)a.showErrorTooltip(f.find(".arrival-station"),"Departure and arrival stations must be different.",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP);else{var h=d.getDateTime(f.find(".start-container"));if(h){var e=d.getDateTime(f.find(".end-container"));if(e)if(h.isSameOrAfter(e)&&
1<h.clone().startOf("day").diff(e.clone().startOf("day"),"days"))j.displayError(["ARRIVAL_BEFORE_DEPARTURE"],f);else{var l=f.find(".confirm").val(),f=f.find(".res-num").val(),m={lineName:m,mode:"train",startTime:h.format(a.ISO_DATE_TIME_FORMAT),endTime:e.format(a.ISO_DATE_TIME_FORMAT),confirmation:l,trainNo:f},m=$.extend({},m,n,k),m=d.addAdditionalData(i,m);b.push(m);return b}else a.showErrorTooltip(f.find(".end-container").find(".custom-event-date-box"),"Choose a valid arrival date",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".start-container").find(".custom-event-date-box"),
"Choose a valid departure date",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".arrival-station"),"Enter a valid arrival station",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".depart-station"),"Enter a valid depart station",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".line-name"),"Enter line Name",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)},open:function(a,c){var b=$(p),f=$("<div />").append(b),g=d.getMinMaxDays(),
n=g.minDate,g=g.maxDate;c.html(f);var f=b.find(".start-container").find(".custom-event-date-copy"),k=b.find(".end-container").find(".custom-event-date-copy"),h,e,l=600,j=630,r=b.find(".start-container").find(".time-in-minutes"),q=b.find(".end-container").find(".time-in-minutes"),D=b.find(".depart-station, .arrival-station"),v=function(){d.checkValues(b)},B=b.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button");b.off("keyup.line-name").on("keyup.line-name",".line-name, .depart-station, .arrival-station",
v);B.addClass("incomplete");d.addGoogleAutocomplete(D,v,!1);a&&(b.find(".res-num").val(d.unescapeHtml(a.trainNo)),b.find(".confirm").val(d.unescapeHtml(a.confirmationNumber)),b.find(".line-name").val(d.unescapeHtml(a.lineName)),h=m(a.startDateTime).startOf("day"),e=m(a.endDateTime).startOf("day"),l=m(a.startDateTime).diff(h,"minutes"),j=m(a.endDateTime).diff(e,"minutes"),a.fromLocation&&b.find(".depart-station").val(d.getDisplayName(a.fromLocation,!1)).data("savedLocation",a.fromLocation),a.toLocation&&
b.find(".arrival-station").val(d.getDisplayName(a.toLocation,!1)).data("savedLocation",a.toLocation),a.isPartial||B.removeClass("incomplete"));d.createDatePickers(f,k,n,g,b,h,e,v);d.createInspirockSelectMenu(r,q,l,j,v)}};return j});define("text%21templates/reservations/travel/bus.html",[],function(){return'<div class="reservation-form-container bus">\n    <div class="res-header">\n        <svg>\n            <use xlink:href="#icon-travel-bus"></use>\n        </svg>\n        <span>Enter bus reservation</span>\n    </div>\n    <div class="header">Booking confirmation #</div>\n    <input type="text" name="confirm" class="confirm flat" placeholder="Optional"/>\n    \n    <div class="line-busno-container container">\n        <div class="linename-bus-container sub-container">\n            <div class="linename-header header">Bus line</div>\n            <input type="text" name="line-name" class="line-name flat"/>\n        </div>\n        <div class="bus-container sub-container">\n            <div class="bus-header header">Bus #</div>\n            <input type="text" name="res-num" class="res-num flat" placeholder="Optional"/>\n        </div>\n    </div>\n    \n    <div class="depart-arrival-container container">\n        <div class="depart-container sub-container">\n            <div class="depart-header header">Departing station</div>\n            <input type="text" name="depart-station" class="depart-station flat" placeholder="Entering station will help optimize your plan"/>\n        </div>\n\n        <div class="arrival-container sub-container">\n            <div class="arrival-header header">Arrival station</div>\n            <input type="text" name="arrival-station" class="arrival-station flat" placeholder="Entering station will help optimize your plan"/>\n        </div>\n    </div>\n\n    <div class="depart-date-header header">Depart date</div>\n    <div class="arrival-date-header header">Arrival date</div>\n    \n    <div class="date-time start-container">\n        <div class="custom-event-date calendar-input">\n            <input type="text" name="custom-event-date-copy" class="custom-event-date-copy container-datepicker" readonly="readonly"/>\n            <input type="text" name="custom-event-date-box" class="custom-event-date-box flat" placeholder="Start date" readonly="readonly"/>\n            <svg class="calendar-icon">\n                <use xlink:href="#icon-calendar" />\n            </svg>\n        </div>\n        <div class="time-holder">\n            <select id="start-time" class="time-in-minutes notranslate" name="day"></select>\n        </div>\n    </div>\n\n    <div class="date-time end-container">\n        <div class="custom-event-date calendar-input">\n            <input type="text" name="custom-event-date-copy" class="custom-event-date-copy container-datepicker flat" readonly="readonly"/>\n            <input type="text" name="custom-event-date-box" class="custom-event-date-box flat" placeholder="End date" readonly="readonly"/>\n            <svg class="calendar-icon">\n                <use xlink:href="#icon-calendar" />\n            </svg>\n        </div>\n        <div class="time-holder">\n            <select id="end-time" class="time-in-minutes notranslate" name="day"></select>\n        </div>\n    </div>\n    \n    <div class="error hidden"></div>\n</div>'});
define("plan/reservation/travel/bus","modules/utils constants plan/reservation/utils/reservationUtils text!templates/reservations/travel/bus.html moment jquery".split(" "),function(a,g,d,p,m){var j={displayError:function(d,c){d.forEach(function(b){switch(b){case "ARRIVAL_BEFORE_DEPARTURE":a.showErrorTooltip(c.find(".end-container").find(".ui-selectmenu-button"),"Arrival time should be after Departure time",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}})},save:function(i,c){var b=[],f=c.find(".reservation-form-container"),
m=f.find(".line-name").val().trim();if(m){var n=d.getAddress(f.find(".depart-station"),"pickup_");if(n){var k=d.getAddress(f.find(".arrival-station"),"dropoff_");if(k)if(n.pickup_address&&k.dropoff_address&&n.pickup_address===k.dropoff_address)a.showErrorTooltip(f.find(".arrival-station"),"Departure and arrival stations must be different.",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP);else{var h=d.getDateTime(f.find(".start-container"));if(h){var e=d.getDateTime(f.find(".end-container"));if(e)if(h.isSameOrAfter(e)&&
1<h.clone().startOf("day").diff(e.clone().startOf("day"),"days"))j.displayError(["ARRIVAL_BEFORE_DEPARTURE"],f);else{var l=f.find(".confirm").val(),f=f.find(".res-num").val(),m={lineName:m,mode:"bus",startTime:h.format(a.ISO_DATE_TIME_FORMAT),endTime:e.format(a.ISO_DATE_TIME_FORMAT),confirmation:l,busNo:f},m=$.extend({},m,n,k),m=d.addAdditionalData(i,m);b.push(m);return b}else a.showErrorTooltip(f.find(".end-container").find(".custom-event-date-box"),"Choose a valid arrival date",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".start-container").find(".custom-event-date-box"),
"Choose a valid departure date",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".arrival-station"),"Enter a valid arrival station",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".depart-station"),"Enter a valid depart station",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".line-name"),"Enter line Name",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)},open:function(a,c){var b=$(p),f=$("<div />").append(b),g=d.getMinMaxDays(),
n=g.minDate,g=g.maxDate;c.html(f);var f=b.find(".start-container").find(".custom-event-date-copy"),k=b.find(".end-container").find(".custom-event-date-copy"),h,e,l=600,j=630,r=b.find(".start-container").find(".time-in-minutes"),q=b.find(".end-container").find(".time-in-minutes"),D=b.find(".depart-station, .arrival-station"),v=function(){d.checkValues(b)},B=b.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button");b.off("keyup.line-name").on("keyup.line-name",".line-name, .depart-station, .arrival-station",
v);B.addClass("incomplete");d.addGoogleAutocomplete(D,v,!0);a&&(b.find(".line-name").val(d.unescapeHtml(a.lineName)),b.find(".confirm").val(d.unescapeHtml(a.confirmationNumber)),b.find(".res-num").val(d.unescapeHtml(a.busNo)),h=m(a.startDateTime).startOf("day"),e=m(a.endDateTime).startOf("day"),l=m(a.startDateTime).diff(h,"minutes"),j=m(a.endDateTime).diff(e,"minutes"),a.fromLocation&&b.find(".depart-station").val(d.getDisplayName(a.fromLocation,!0)).data("savedLocation",a.fromLocation),a.toLocation&&
b.find(".arrival-station").val(d.getDisplayName(a.toLocation,!0)).data("savedLocation",a.toLocation),a.isPartial||B.removeClass("incomplete"));d.createDatePickers(f,k,n,g,b,h,e,v);d.createInspirockSelectMenu(r,q,l,j,v)}};return j});define("text%21templates/reservations/travel/ferry.html",[],function(){return'<div class="reservation-form-container ferry">\n    <div class="res-header">\n        <svg>\n            <use xlink:href="#icon-travel-ferry"></use>\n        </svg>\n        <span>Enter ferry reservation</span>\n    </div>\n    <div class="header">Booking confirmation #</div>\n    <input type="text" name="confirm" class="confirm flat" placeholder="Optional"/>\n    \n    <div class="line-ferryno-container container">\n        <div class="linename-ferry-container sub-container">\n            <div class="linename-header header">Ferry line</div>\n            <input type="text" name="line-name" class="line-name flat"/>\n        </div>\n        <div class="ferry-container sub-container">\n            <div class="ferry-header header">Ferry #</div>\n            <input type="text" name="res-num" class="res-num flat" placeholder="Optional"/>\n        </div>\n    </div>\n    \n    <div class="depart-arrival-container container">\n        <div class="depart-container sub-container">\n            <div class="depart-header header">Departing location</div>\n            <input type="text" name="depart-station" class="depart-station flat" placeholder="Entering station will help optimize your plan"/>\n        </div>\n\n        <div class="arrival-container sub-container">\n            <div class="arrival-header header">Arrival location</div>\n            <input type="text" name="arrival-station" class="arrival-station flat" placeholder="Entering station will help optimize your plan"/>\n        </div>\n    </div>\n\n    <div class="depart-date-header header">Depart date</div>\n    <div class="arrival-date-header header">Arrival date</div>\n    \n    <div class="date-time start-container">\n        <div class="custom-event-date calendar-input">\n            <input type="text" name="custom-event-date-copy" class="custom-event-date-copy container-datepicker" readonly="readonly"/>\n            <input type="text" name="custom-event-date-box" class="custom-event-date-box flat" placeholder="Start date" readonly="readonly"/>\n            <svg class="calendar-icon">\n                <use xlink:href="#icon-calendar" />\n            </svg>\n        </div>\n        <div class="time-holder">\n            <select id="start-time" class="time-in-minutes notranslate" name="day"></select>\n        </div>\n    </div>\n\n    <div class="date-time end-container">\n        <div class="custom-event-date calendar-input">\n            <input type="text" name="custom-event-date-copy" class="custom-event-date-copy container-datepicker flat" readonly="readonly"/>\n            <input type="text" name="custom-event-date-box" class="custom-event-date-box flat" placeholder="End date" readonly="readonly"/>\n            <svg class="calendar-icon">\n                <use xlink:href="#icon-calendar" />\n            </svg>\n        </div>\n        <div class="time-holder">\n            <select id="end-time" class="time-in-minutes notranslate" name="day"></select>\n        </div>\n    </div>\n    \n    <div class="error hidden"></div>\n</div>'});
define("plan/reservation/travel/ferry","modules/utils constants plan/reservation/utils/reservationUtils text!templates/reservations/travel/ferry.html moment jquery".split(" "),function(a,g,d,p,m){var j={displayError:function(d,c){d.forEach(function(b){switch(b){case "ARRIVAL_BEFORE_DEPARTURE":a.showErrorTooltip(c.find(".end-container").find(".ui-selectmenu-button"),"Arrival time should be after Departure time",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}})},save:function(i,c){var b=[],f=c.find(".reservation-form-container"),
m=f.find(".line-name").val().trim();if(m){var n=d.getAddress(f.find(".depart-station"),"pickup_");if(n){var k=d.getAddress(f.find(".arrival-station"),"dropoff_");if(k)if(n.pickup_address&&k.dropoff_address&&n.pickup_address===k.dropoff_address)a.showErrorTooltip(f.find(".arrival-station"),"Departure and arrival location must be different.",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP);else{var h=d.getDateTime(f.find(".start-container"));if(h){var e=d.getDateTime(f.find(".end-container"));if(e)if(h.isSameOrAfter(e)&&
1<h.clone().startOf("day").diff(e.clone().startOf("day"),"days"))j.displayError(["ARRIVAL_BEFORE_DEPARTURE"],f);else{var l=f.find(".confirm").val(),t=f.find(".res-num").val(),m={lineName:m,mode:"boat",startTime:h.format(a.ISO_DATE_TIME_FORMAT),endTime:e.format(a.ISO_DATE_TIME_FORMAT),confirmation:l,ferryNo:t};f.data("reservationId")&&(m.id=f.data("reservationId"));m=$.extend({},m,n,k);m=d.addAdditionalData(i,m);b.push(m);return b}else a.showErrorTooltip(f.find(".end-container").find(".custom-event-date-box"),
"Choose a valid arrival date",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".start-container").find(".custom-event-date-box"),"Choose a valid departure date",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".arrival-station"),"Enter a valid arrival location",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".depart-station"),"Enter a valid depart location",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".line-name"),
"Enter line Name",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)},open:function(a,c){var b=$(p),f=$("<div />").append(b),g=d.getMinMaxDays(),n=g.minDate,g=g.maxDate;c.html(f);var f=b.find(".start-container").find(".custom-event-date-copy"),k=b.find(".end-container").find(".custom-event-date-copy"),h,e,l=600,j=630,r=b.find(".start-container").find(".time-in-minutes"),q=b.find(".end-container").find(".time-in-minutes"),D=b.find(".depart-station, .arrival-station"),v=function(){d.checkValues(b)},B=b.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button");
b.off("keyup.line-name").on("keyup.line-name",".line-name, .depart-station, .arrival-station",v);B.addClass("incomplete");d.addGoogleAutocomplete(D,v,!0);a&&(b.find(".res-num").val(d.unescapeHtml(a.boatNo)),b.find(".line-name").val(d.unescapeHtml(a.lineName)),b.find(".confirm").val(d.unescapeHtml(a.confirmationNumber)),h=m(a.startDateTime).startOf("day"),e=m(a.endDateTime).startOf("day"),l=m(a.startDateTime).diff(h,"minutes"),j=m(a.endDateTime).diff(e,"minutes"),a.fromLocation&&b.find(".depart-station").val(d.getDisplayName(a.fromLocation,
!0)).data("savedLocation",a.fromLocation),a.toLocation&&b.find(".arrival-station").val(d.getDisplayName(a.toLocation,!0)).data("savedLocation",a.toLocation),a.isPartial||B.removeClass("incomplete"));d.createDatePickers(f,k,n,g,b,h,e,v);d.createInspirockSelectMenu(r,q,l,j,v)}};return j});define("text%21templates/reservations/travel/shuttle.html",[],function(){return'<div class="reservation-form-container shuttle">\n    <div class="res-header">\n        <svg>\n            <use xlink:href="#icon-travel-shuttle"></use>\n        </svg>\n        <span>Enter shuttle reservation</span>\n    </div>\n    <div class="header">Booking confirmation #</div>\n    <input type="text" name="confirm" class="confirm flat" placeholder="Optional"/>\n    \n    <div class="line-shuttleno-container container">\n        <div class="linename-shuttle-container sub-container">\n            <div class="linename-header header">Shuttle name</div>\n            <input type="text" name="line-name" class="line-name flat"/>\n        </div>\n        <div class="shuttle-container sub-container">\n            <div class="shuttle-header header">Shuttle #</div>\n            <input type="text" name="res-num" class="res-num flat" placeholder="Optional"/>\n        </div>\n    </div>\n    \n    <div class="depart-arrival-container container">\n        <div class="depart-container sub-container">\n            <div class="depart-header header">Pick-up location</div>\n            <input type="text" name="depart-station" class="depart-station flat" placeholder="Entering location will help optimize your plan"/>\n        </div>\n\n        <div class="arrival-container sub-container">\n            <div class="arrival-header header">Drop-off location</div>\n            <input type="text" name="arrival-station" class="arrival-station flat" placeholder="Entering location will help optimize your plan"/>\n        </div>\n    </div>\n\n    <div class="depart-date-header header">Pick-up date</div>\n    <div class="arrival-date-header header">Drop-off date</div>\n    \n    <div class="date-time start-container">\n        <div class="custom-event-date calendar-input">\n            <input type="text" name="custom-event-date-copy" class="custom-event-date-copy container-datepicker" readonly="readonly"/>\n            <input type="text" name="custom-event-date-box" class="custom-event-date-box flat" placeholder="Start date" readonly="readonly"/>\n            <svg class="calendar-icon">\n                <use xlink:href="#icon-calendar" />\n            </svg>\n        </div>\n        <div class="time-holder">\n            <select id="start-time" class="time-in-minutes notranslate" name="day"></select>\n        </div>\n    </div>\n\n    <div class="date-time end-container">\n        <div class="custom-event-date calendar-input">\n            <input type="text" name="custom-event-date-copy" class="custom-event-date-copy container-datepicker flat" readonly="readonly"/>\n            <input type="text" name="custom-event-date-box" class="custom-event-date-box flat" placeholder="End date" readonly="readonly"/>\n            <svg class="calendar-icon">\n                <use xlink:href="#icon-calendar" />\n            </svg>\n        </div>\n        <div class="time-holder">\n            <select id="end-time" class="time-in-minutes notranslate" name="day"></select>\n        </div>\n    </div>\n    \n    <div class="error hidden"></div>\n</div>'});
define("plan/reservation/travel/shuttle","modules/utils constants plan/reservation/utils/reservationUtils text!templates/reservations/travel/shuttle.html moment jquery".split(" "),function(a,g,d,p,m){var j={displayError:function(d,c){d.forEach(function(b){switch(b){case "ARRIVAL_BEFORE_DEPARTURE":a.showErrorTooltip(c.find(".end-container").find(".ui-selectmenu-button"),"Arrival time should be after Departure time",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}})},save:function(i,c){var b=[],f=c.find(".reservation-form-container"),
m=f.find(".line-name").val().trim();if(m){var n=d.getAddress(f.find(".depart-station"),"pickup_");if(n){var k=d.getAddress(f.find(".arrival-station"),"dropoff_");if(k)if(n.pickup_address&&k.dropoff_address&&n.pickup_address===k.dropoff_address)a.showErrorTooltip(f.find(".arrival-station"),"Pick-up and drop-off location must be different.",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP);else{var h=d.getDateTime(f.find(".start-container"));if(h){var e=d.getDateTime(f.find(".end-container"));if(e)if(h.isSameOrAfter(e)&&
1<h.clone().startOf("day").diff(e.clone().startOf("day"),"days"))j.displayError(["ARRIVAL_BEFORE_DEPARTURE"],f);else{var l=f.find(".confirm").val(),f=f.find(".res-num").val(),m={shuttleName:m,mode:"shuttle",startTime:h.format(a.ISO_DATE_TIME_FORMAT),endTime:e.format(a.ISO_DATE_TIME_FORMAT),confirmation:l,shuttleNo:f},m=$.extend({},m,n,k),m=d.addAdditionalData(i,m);b.push(m);return b}else a.showErrorTooltip(f.find(".end-container").find(".custom-event-date-box"),"Choose a valid drop-off date",void 0,
g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".start-container").find(".custom-event-date-box"),"Choose a valid pick-up date",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".arrival-station"),"Enter a valid drop-off location",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".depart-station"),"Enter a valid pick-up location",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".line-name"),"Enter shuttle Name",
void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)},open:function(a,c){var b=$(p),f=$("<div />").append(b),g=d.getMinMaxDays(),n=g.minDate,g=g.maxDate;c.html(f);var f=b.find(".start-container").find(".custom-event-date-copy"),k=b.find(".end-container").find(".custom-event-date-copy"),h,e,l=600,j=630,r=b.find(".start-container").find(".time-in-minutes"),q=b.find(".end-container").find(".time-in-minutes"),D=b.find(".depart-station, .arrival-station"),v=function(){d.checkValues(b)},B=b.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button");
b.off("keyup.line-name").on("keyup.line-name",".line-name, .depart-station, .arrival-station",v);B.addClass("incomplete");d.addGoogleAutocomplete(D,v,!0);a&&(b.find(".res-num").val(d.unescapeHtml(a.shuttleNo)),b.find(".confirm").val(d.unescapeHtml(a.confirmationNumber)),b.find(".line-name").val(d.unescapeHtml(a.shuttleName)),h=m(a.startDateTime).startOf("day"),e=m(a.endDateTime).startOf("day"),l=m(a.startDateTime).diff(h,"minutes"),j=m(a.endDateTime).diff(e,"minutes"),a.fromLocation&&b.find(".depart-station").val(d.getDisplayName(a.fromLocation,
!0)).data("savedLocation",a.fromLocation),a.toLocation&&b.find(".arrival-station").val(d.getDisplayName(a.toLocation,!0)).data("savedLocation",a.toLocation),a.isPartial||B.removeClass("incomplete"));d.createDatePickers(f,k,n,g,b,h,e,v);d.createInspirockSelectMenu(r,q,l,j,v)}};return j});define("text%21templates/reservations/travel/other.html",[],function(){return'<div class="reservation-form-container other">\n    <div class="res-header">\n        <svg>\n            <use xlink:href="#icon-travel-custom"></use>\n        </svg>\n        <span>Enter custom travel reservation</span>\n    </div>\n    <div class="header">Booking confirmation #</div>\n    <input type="text" name="confirm" class="confirm flat" placeholder="Optional"/>\n    \n    <div class="line-otherno-container container">\n        <div class="linename-shuttle-container sub-container">\n            <div class="linename-header header">Travel name / type</div>\n            <input type="text" name="line-name" class="line-name flat"/>\n        </div>\n        <div class="other-container sub-container">\n            <div class="other-header header">Service #</div>\n            <input type="text" name="res-num" class="res-num flat" placeholder="Optional"/>\n        </div>\n    </div>\n    \n    <div class="depart-arrival-container container">\n        <div class="depart-container sub-container">\n            <div class="depart-header header">Departing location</div>\n            <input type="text" name="depart-station" class="depart-station flat" placeholder="Entering station will help optimize your plan"/>\n        </div>\n\n        <div class="arrival-container sub-container">\n            <div class="arrival-header header">Arrival location</div>\n            <input type="text" name="arrival-station" class="arrival-station flat" placeholder="Entering station will help optimize your plan"/>\n        </div>\n    </div>\n\n    <div class="depart-date-header header">Depart date</div>\n    <div class="arrival-date-header header">Arrival date</div>\n    \n    <div class="date-time start-container">\n        <div class="custom-event-date calendar-input">\n            <input type="text" name="custom-event-date-copy" class="custom-event-date-copy container-datepicker" readonly="readonly"/>\n            <input type="text" name="custom-event-date-box" class="custom-event-date-box flat" placeholder="Start date" readonly="readonly"/>\n            <svg class="calendar-icon">\n                <use xlink:href="#icon-calendar" />\n            </svg>\n        </div>\n        <div class="time-holder">\n            <select id="start-time" class="time-in-minutes notranslate" name="day"></select>\n        </div>\n    </div>\n\n    <div class="date-time end-container">\n        <div class="custom-event-date calendar-input">\n            <input type="text" name="custom-event-date-copy" class="custom-event-date-copy container-datepicker flat" readonly="readonly"/>\n            <input type="text" name="custom-event-date-box" class="custom-event-date-box flat" placeholder="End date" readonly="readonly"/>\n            <svg class="calendar-icon">\n                <use xlink:href="#icon-calendar" />\n            </svg>\n        </div>\n        <div class="time-holder">\n            <select id="end-time" class="time-in-minutes notranslate" name="day"></select>\n        </div>\n    </div>\n    \n    <div class="error hidden"></div>\n</div>'});
define("plan/reservation/travel/other","modules/utils constants plan/reservation/utils/reservationUtils text!templates/reservations/travel/other.html moment jquery".split(" "),function(a,g,d,p,m){var j={displayError:function(d,c){d.forEach(function(b){switch(b){case "ARRIVAL_BEFORE_DEPARTURE":a.showErrorTooltip(c.find(".end-container").find(".ui-selectmenu-button"),"Arrival time should be after Departure time",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}})},save:function(i,c){var b=[],f=c.find(".reservation-form-container"),
m=f.find(".line-name").val().trim();if(m){var n=d.getAddress(f.find(".depart-station"),"pickup_");if(n){var k=d.getAddress(f.find(".arrival-station"),"dropoff_");if(k)if(n.pickup_address&&k.dropoff_address&&n.pickup_address===k.dropoff_address)a.showErrorTooltip(f.find(".arrival-station"),"Depart and arrival location must be different.",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP);else{var h=d.getDateTime(f.find(".start-container"));if(h){var e=d.getDateTime(f.find(".end-container"));if(e)if(h.isSameOrAfter(e)&&
1<h.clone().startOf("day").diff(e.clone().startOf("day"),"days"))j.displayError(["ARRIVAL_BEFORE_DEPARTURE"],f);else{var l=f.find(".confirm").val(),f=f.find(".res-num").val(),m={modeName:m,mode:"other",startTime:h.format(a.ISO_DATE_TIME_FORMAT),endTime:e.format(a.ISO_DATE_TIME_FORMAT),confirmation:l,otherNo:f},m=$.extend({},m,n,k),m=d.addAdditionalData(i,m);b.push(m);return b}else a.showErrorTooltip(f.find(".end-container").find(".custom-event-date-box"),"Choose a valid arrival date",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".start-container").find(".custom-event-date-box"),
"Choose a valid departure date",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".arrival-station"),"Enter a valid arrival location",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".depart-station"),"Enter a valid depart location",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)}else a.showErrorTooltip(f.find(".line-name"),"Enter the mode of travel",void 0,g.ERROR_TOOL_TIP_BOTTOM_LEFT_QTIP)},open:function(a,c){var b=$(p),f=$("<div />").append(b),g=d.getMinMaxDays(),
n=g.minDate,g=g.maxDate;c.html(f);var f=b.find(".start-container").find(".custom-event-date-copy"),k=b.find(".end-container").find(".custom-event-date-copy"),h,e,l=600,j=630,r=b.find(".start-container").find(".time-in-minutes"),q=b.find(".end-container").find(".time-in-minutes"),D=b.find(".depart-station, .arrival-station"),v=function(){d.checkValues(b)},B=b.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button");b.off("keyup.line-name").on("keyup.line-name",".line-name, .depart-station, .arrival-station",
v);B.addClass("incomplete");d.addGoogleAutocomplete(D,v,!0);a&&(b.find(".res-num").val(d.unescapeHtml(a.otherNo)),b.find(".confirm").val(d.unescapeHtml(a.confirmationNumber)),b.find(".line-name").val(d.unescapeHtml(a.modeName)),h=m(a.startDateTime).startOf("day"),e=m(a.endDateTime).startOf("day"),l=m(a.startDateTime).diff(h,"minutes"),j=m(a.endDateTime).diff(e,"minutes"),a.fromLocation&&b.find(".depart-station").val(d.getDisplayName(a.fromLocation,!0)).data("savedLocation",a.fromLocation),a.toLocation&&
b.find(".arrival-station").val(d.getDisplayName(a.toLocation,!0)).data("savedLocation",a.toLocation),a.isPartial||B.removeClass("incomplete"));d.createDatePickers(f,k,n,g,b,h,e,v);d.createInspirockSelectMenu(r,q,l,j,v)}};return j});
define("plan/reservation/reservationFactory","modules/events modules/ajax modules/utils moment plan/reservation/utils/reservationUtils plan/reservation/hotel plan/reservation/attraction plan/reservation/custom plan/reservation/travel/flight plan/reservation/travel/car plan/reservation/travel/train plan/reservation/travel/bus plan/reservation/travel/ferry plan/reservation/travel/shuttle plan/reservation/travel/other jquery".split(" "),function(a,g,d,p,m,j,i,c,b,f,u,n,k,h,e){function l(a){return p(a.format(d.ISO_DATE_TIME_FORMAT),
d.ISO_DATE_TIME_FORMAT)}var t={showReservation:function(l,q,D,v,B,z,C){function G(g,l,s){J.remove();F.inspirockDialog({resizable:!1,modal:!0,draggable:!1,autoOpen:!1,width:"830px",animated:!0,dialogClass:"dlg-add-reservation-option mediumx animated",buttons:{Save:function(){s&&(g.isNightLife=s);var a=M.save(g,F);if(a&&a.length){w.id=a[0].itemId;z&&"route"===B&&$(".dlg-calendar-edit-item").find(".travel-edit-container").data("travelEmpty")&&(w.id=C.id);if($(".dlg-calendar-edit-item").length){var b=
$(".dlg-calendar-edit-item").find(".item-block-wrapper");$(".dlg-calendar-edit-item").hasClass("dlg-travel-item")?(w.type="planItem",w.itemType="travel"):b.hasClass("nightlife-row")||b.hasClass("hotels-row")?(w.type="planItem",w.itemType="stay"):(w.type=$(".dlg-calendar-edit-item").hasClass("dlg-visit-item")?"visit":"reserved",w.itemType=$(".dlg-calendar-edit-item").hasClass("dlg-visit-item")?"visit":"reserved",w.stayId=b.data("stayId")||$(".dlg-calendar-edit-item .reservation").data("stayId"));w.view=
"calendarItemDialog";w.id||b.each(function(){$(this).data("reservationId")===q&&("travel"===w.itemType?w.id=$(this).data("travelId"):"stay"===w.itemType?w.id=$(this).data("stayId"):"visit"===w.itemType?w.id=$(this).data("visitId"):"reserved"===w.itemType&&(w.id=$(this).data("reservedId")))})}if("calendarItemDialog"===w.view&&"reserved"===w.itemType&&!w.id&&!a[0].id){v.dateString=a[0].startTime;v.date=p(a[0].startTime).format("YYYY-MM-DD");var b=p(a[0].startTime).startOf("day"),c=p(a[0].endTime).startOf("day");
v.fromTime=p(a[0].startTime).diff(b,"minutes");v.toTime=p(a[0].endTime).diff(c,"minutes");v.activityTitle=a[0].activityTitle;v.startTime=a[0].startTime;v.endTime=a[0].endTime;v.saveReservation=function(b){w.id=b.reservedId;w.stayId=b.stayId;a[0].itemId=b.reservedId.toString();a={reservations:a};F.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button").addClass("disabled");m.saveReservation(F,w,a)};v.createReservedItem(v)}else a={reservations:a},F.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button").addClass("disabled"),
m.saveReservation(F,w,a)}}},open:function(){a.triggerEvent("reservation","hide-calendar-dialog",{})},beforeClose:function(){$(".resultspage").removeClass("scroll-hide");d.removeAllErrorToolTips()},close:function(){$(".pac-container").remove();d.closeDialog(F,t);a.triggerEvent("reservation-dialog","show-calendar-dialog",{})}});var r;switch(l){case "HotelReservation":r=j;break;case "AttractionReservation":r=i;break;case "CustomReservation":r=c;break;case "FlightReservation":r=b;break;case "CarReservation":r=
f;break;case "TrainReservation":r=u;break;case "BusReservation":r=n;break;case "BoatReservation":r=k;break;case "ShuttleReservation":r=h;break;case "OtherTravelReservation":r=e}M=r;M.open(g,F);var t=$("<div>");d.createDialogContainer(t,F)}var M,w={view:$("#itineraryMainPane").children().filter(":not(.hidden)").attr("id"),successCB:function(b){if("daybyday"===w.view||"maps"===w.view)$("#itinerary").html(b),a.triggerEvent("daybyday","initialize-itinerary",{}),$("#daybyday").trigger("refreshed");else if("calendarItemDialog"===
w.view){var c=$("<div />").append(b),d=function(){c.find(".update-time-dlg").remove();$("#itineraryMainPane").data("hasReservation",c.filter(".reservations-title").data("hasReservation"));a.triggerEvent("reservation-dialog","show-calendar-dialog",c.html());if($(".dlg-calendar-edit-item").hasClass("dlg-travel-item")){if(z&&"route"===B&&$(".dlg-calendar-edit-item").find(".travel-edit-container").data("travelEmpty")&&c.find(".reservations-title").data("hasReservation")){var b=[],d=$(C.travelRow);c.find(".item-block-wrapper.travel-row").each(function(){b.push({id:$(this).data("reservationId")})});
d.data("reservations",b)}a.triggerEvent("itinerary","open-travel-dialog",{})}B&&"route"===B?a.triggerEvent("overview","plan-update",{}):a.triggerEvent("itinerary","plan-update",{})};c.find(".update-time-dlg").length?t.updateTime(c.find(".update-time-dlg"),function(){d()}):d()}},errorCB:function(a,b){for(var c=Object.keys(b),d=0;d<c.length;d++){var e=a.find(".reservation-form-container").eq(c[d]);M.displayError(b[c[d]].errorCodes,e)}}},J=$('<div class="ui-widget-overlay"><img class="progress-indicator" src="'+
window.ajaxLoaderPath+'" alt="loading"></div>'),F=$("<div />"),y;J.appendTo("body");if(q)g.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/reservation/"+q,type:"GET",success:function(a){y=a;G(a,a.type)}});else if(D&&D.length){var s=D.data("type"),H=D.data("eventId"),x=D.data("isNightLife"),l=D.data("date");null===H||void 0===H?(l={startTime:v.startTime,endTime:v.endTime},G(l,s,x)):z&&"route"===B&&$(".dlg-calendar-edit-item").find(".travel-edit-container").data("travelEmpty")?
(l={startTime:C.localStartDateTime,endTime:C.localEndDateTime},G(l,s,x)):(l=window.contextPath+"/trip/"+$("#plan").data("planId")+"/reservation/dataForReservation/"+H+(l?"/"+l:""),g.makeAJAXcall({url:l,type:"GET",success:function(a){y=a;y.itemId=H;G(y,s,x)}}))}else G(null,l)},updateTime:function(b,c){b.inspirockDialog({resizable:!1,modal:!0,draggable:!1,width:"830px",autoOpen:!1,animated:!0,dialogClass:"dlg-update-time mediumx animated",buttons:{"Update Plan":function(){var e=b.find(".update-time-row"),
e=$(e[0]),f=e.find(".event-date-copy"),h=e.find("#start-time"),l=e.find("#end-time"),f={date:p(f.datepicker("getDate")).format(d.ISO_DATE_FORMAT),fromTime:h.val(),duration:parseInt(l.val())-parseInt(h.val()),view:"CalendarData",isOverflow:!1,isMove:!0};g.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/reserved/"+e.data("slotItemId"),type:"POST",data:f,synchronize:!0,success:function(){c=void 0;b.dialog("close");a.triggerEvent("reservation-dialog","close-calendar-dialog");
a.triggerEvent("reserved","plan-update",{})}})}},open:function(){b.find(".update-time-row").each(function(c,e){var f=$(e),h=f.find(".data-holder"),g=f.find(".event-date-copy"),n=f.find("#start-time"),k=f.find("#end-time"),i=p(h.data("start-time")),f=30*d.toSlot(i),m=p(h.data("end-time")),m=30*d.toSlot(m),j=p(h.data("plan-start-date")),h=p(h.data("plan-end-date")),s=[{start:j.clone(),end:h.clone().subtract(1,"seconds")}],q=0>f,h=h.toDate(),j=j.toDate();for(c in s)s[c].start.isBefore(j)&&(j=s[c].start.clone().startOf("day").toDate()),
s[c].end.isAfter(h)&&(h=s[c].end.clone().startOf("day").toDate());g.inspirockDatepicker({minDate:j,maxDate:h,dateFormat:"yyyy-mm-dd",altFormat:window.dateFormatDisplayPattern,altField:g.siblings(".event-date-box"),showAnim:"",onSelect:function(){var c=g.datepicker("getDate"),d=parseInt(n.val()),e=parseInt(k.val());a.triggerEvent("reservationFactory","setup-time-selects",{date:c,starttime:n,endtime:k,startTimeInMinutes:d,endTimeInMinutes:e,timeRanges:s,showTimeSelectTitles:q,container:b})},beforeShowDay:function(a){var b=
!1,c;for(c in s){var d=l(s[c].start.clone().startOf("day")),e=l(s[c].end.clone().startOf("day"));if((d.isSame(a)||d.isBefore(a))&&(e.isSame(a)||e.isAfter(a))){b=!0;break}}return[b,"",null]},beforeShow:function(){n.selectmenu("close");k.selectmenu("close");b.find(".calendar-input").append($("#ui-datepicker-div").addClass("calendar-datepicker"))},onClose:function(){$("body").append($("#ui-datepicker-div").removeClass("calendar-datepicker"))}});i=i.toDate();g.datepicker("setDate",i);a.triggerEvent("reservationFactory",
"setup-time-selects",{date:i,starttime:n,endtime:k,startTimeInMinutes:f,endTimeInMinutes:m,timeRanges:s,showTimeSelectTitles:q,container:b});b.find(".event-date-box").off("click").on("click",function(){g.datepicker("show")}).off("mousedown").on("mousedown",function(a){a.stopPropagation()})})},beforeClose:function(){$(".resultspage").removeClass("scroll-hide")},close:function(){e.remove();$(".resultspage").removeClass("scroll-hide-calendar-dlg");c&&c()}});var e=$("<div>");d.createDialogContainer(e,
b)},selectExisting:function(b,c,e,f){var h=$('<div class="ui-widget-overlay"><img class="progress-indicator" src="'+window.ajaxLoaderPath+'" alt="loading"></div>');h.appendTo("body");g.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/reservations/",type:"GET",success:function(l){h.remove();var n=$(l);n.inspirockDialog({resizable:!1,modal:!0,draggable:!1,autoOpen:!1,width:"830px",animated:!0,dialogClass:"dlg-select-reservation mediumx animated",buttons:{Cancel:{"class":"cta-cancel",
text:"Cancel",click:function(){n.dialog("close")}},Select:{"class":"disabled cta-select",text:"Select",click:function(b){function d(){g.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/reservation/add",type:"POST",data:j,success:function(b){n.dialog("close");"daybyday"===r||"maps"===r?($("#itinerary").html(b),a.triggerEvent("daybyday","initialize-itinerary",{}),$("#daybyday").trigger("refreshed")):"calendarItemDialog"===r&&($("#itineraryMainPane").data("hasReservation",$(b).filter(".reservations-title").data("hasReservation")),
a.triggerEvent("reservation-dialog","show-calendar-dialog",b),f&&"route"===f?a.triggerEvent("overview","plan-update",{}):a.triggerEvent("itinerary","plan-update",{}),$(".dlg-calendar-edit-item").hasClass("dlg-travel-item")&&a.triggerEvent("itinerary","open-travel-dialog",{}))},error:function(){h.removeClass("disabled")}})}var h=$(b.target);if(!h.hasClass("disabled")){h.addClass("disabled");var l=[],k,i,m;n.find(".selected").each(function(){l.push($(this).data("reservationId"));k||(k=$(this).data("startTime"),
i=$(this).data("endTime"),m=$(this).data("name"))});var r=$("#itineraryMainPane").children().filter(":not(.hidden)").attr("id");$(".dlg-calendar-edit-item").length&&(r="calendarItemDialog");var j={data:JSON.stringify(l),view:r},j=$.extend({},j,c);if("calendarItemDialog"===r&&"reserved"===j.itemType&&!j.id){e.dateString=k;e.date=p(k).format("YYYY-MM-DD");var b=p(k).startOf("day"),t=p(i).startOf("day");e.fromTime=p(k).diff(b,"minutes");e.toTime=p(i).diff(t,"minutes");e.activityTitle=m;e.startTime=k;
e.endTime=i;e.saveReservation=function(a){j.id=a.reservedId;j.stayId=a.stayId;d()};e.createReservedItem(e)}else d()}}}},open:function(){a.triggerEvent("reservation","hide-calendar-dialog",{});n.find(".reservation-row").each(function(){var a=c.eventReservations,a=a&&a.length&&-1<a.indexOf($(this).data("reservationId")),b=$(this).data("isActivity")&&("AttractionReservation"===c.reservationType||"CustomReservation"===c.reservationType);if((c.reservationType!==$(this).data("reservationType")||a)&&(!b||
a))$(this).addClass("disabled"),a&&$(this).addClass("existing")});n.off("mouseover.reservation-row").on("mouseover.reservation-row",".reservation-row, .reservation-col",function(){var a=$(this).hasClass("reservation-row")?$(this):$(this).parents(".reservation-row");if(a.hasClass("disabled")){var b=a.find(".res-type").html()+" reservation",d=c.itemType,b=b+" cannot be added to "+d;a.hasClass("existing")&&(b="The "+d+" already has this reservation");d=$("<div><div class='err-msg'>"+b+"</div></div>");
a.qtip({content:{text:d},overwrite:!1,show:{ready:!0},hide:{event:"mouseout",fixed:!0},position:{my:"bottom center",at:"top center",viewport:$(window),adjust:{method:"shift"}},events:{show:function(){},hide:function(a,b){b.destroy(!0)}},style:{classes:"qtip-light qtip-shadow reservation-error-tip",tip:{width:20,height:10}}})}});n.off("click.reservation-row").on("click.reservation-row",".reservation-row",function(){var a=$(this);a.hasClass("disabled")||(a.toggleClass("selected"),b&&n.find(".reservation-row").not(this).removeClass("selected"));
var c=!1;n.find(".reservation-row").each(function(){if(c=$(this).hasClass("selected"))return n.parents(".ui-dialog").find(".cta-select").removeClass("disabled"),!1});c||n.parents(".ui-dialog").find(".cta-select").addClass("disabled")})},beforeClose:function(){$(".resultspage").removeClass("scroll-hide")},close:function(){d.closeDialog(n,k);a.triggerEvent("reservation-dialog","show-calendar-dialog",{})}});var k=$("<div>");d.createDialogContainer(k,n)}})}};return t});
define("text%21templates/calendarEventsOptions.html",[],function(){return'<!DOCTYPE html>\n<\!--\n Copyright (c) 2012-2017, Inspirock Corporation.\n All rights reserved.\n--\>\n<div>\n    <div class="options-container reserve">\n        <div class="edit-reservation">Edit reservation</div>\n        <div class="delete-reservation">Delete reservation</div>\n    </div>\n</div>'});
define("plan/reservation/reservation","modules/ajax modules/utils modules/events text!templates/reservations/container.html text!templates/reservations/addOptions.html text!templates/reservations/options.html text!templates/reservations/travel/options.html text!templates/reservations/travelNoMatch.html text!templates/reservations/travelDestinationNotAvbl.html text!templates/reservations/stayNoMatch.html text!templates/reservations/stayDestinationNotAvbl.html text!templates/reservations/stayPresent.html text!templates/reservations/carRentalNoMatch.html text!templates/reservations/carRentalDestinationNotAvbl.html text!templates/reservations/activityNoMatch.html text!templates/reservations/errorCompatability.html text!templates/reservations/reservationItemContainer.html plan/reservation/reservationFactory text!templates/calendarEventsOptions.html jquery".split(" "),function(a,
g,d,p,m,j,i,c,b,f,u,n,k,h,e,l,t,r,q){function D(a,b,c,d,e,f,h){a.qtip({overwrite:!0,content:{text:b},position:c.position,show:{event:"click",ready:!0},hide:{event:"unfocus",fixed:!0},events:{show:function(a,g){c.showCB&&c.showCB(g);b.off("click.add-existing").on("click.add-existing",".add-existing",function(){g.hide();r.selectExisting(e,d,f,h)})},hide:function(a,b){c.hideCB&&c.hideCB(b)}},style:{classes:"qtip-light qtip-shadow reservation-tip "+(c["class"]?c["class"]:""),width:360,tip:c.tip}})}function v(d,
g,i,m,j,q,p){var t=m.parents(".ui-dialog-content");j.hasClass("disabled")||(j.addClass("disabled"),a.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/reservation/"+m.data("reservationId")+"/associate/",type:"POST",data:{id:d,type:g,ignoreError:i},success:function(i){if("true"===i.success){var D=m.siblings(".associated-item");D.length||(D=m.parents(".associated-item"));i.travelStartDestination?(D.find(".item-from-destination").html(i.travelStartDestination),D.find(".item-to-destination").html(i.travelEndDestination),
D.find(".item-start-date").html(i.travelStartDate),D.removeClass("hidden").data("travelId",i.travelId).data("reservationId",i.reservationId)):i.stayDestination?(D.find(".item-destination").html(i.stayDestination),D.find(".item-date-range").html(i.stayDateRange),D.removeClass("hidden").data("id",i.stayId).data("reservationId",i.reservationId)):i.carRental?(D.find(".item-date-range").html(i.itemDateRange),D.removeClass("hidden").data("id",i.stayId).data("reservationId",i.reservationId)):i.attraction?
(D.find(".item-attraction").html(i.visitName),D.find(".item-date-range").html(i.visitDateTime),D.removeClass("hidden").data("reservationId",i.reservationId)):i.other&&(D.find(".item-attraction").html(i.reservedName),D.find(".item-date-range").html(i.reservedDateTime),D.removeClass("hidden").data("reservationId",i.reservationId));m.hasClass("add-reservation-to-plan")&&m.addClass("hidden");t.find(".change").off("click").on("click",function(){B.addReservationToPlan($(this),p)});t.find(".done-btn button").removeAttr("disabled").off("click").on("click",
function(){$(this).attr("disabled",!0);a.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/reservation/"+m.data("reservationId")+"/associate/",type:"POST",data:{id:d,type:g,save:!0},success:function(a,b,c){m.parents(".ui-dialog-content").dialog("close");c.getResponseHeader("SHOW_UPDATE_TIME_DLG")?(a=$(a),r.updateTime(a.filter(".update-time-dlg"),function(){p&&p()})):p&&p()},error:function(){$(this).removeAttr("disabled")}})});q.hide()}else"TRAVEL_RESERVATION_DESTINATION_NO_MATCH"===
i.errorCode?(j.html(c),j.find(".item-from-destination").html(i.travelStartDestination),j.find(".item-to-destination").html(i.travelEndDestination),j.find(".reservation-from-destination").html(i.reservationStartDestination),j.find(".reservation-to-destination").html(i.reservationEndDestination)):"TRAVEL_RESERVATION_DESTINATION_NOT_AVBL"===i.errorCode?(j.html(b),j.find(".item-from-destination").html(i.travelStartDestination),j.find(".item-to-destination").html(i.travelEndDestination)):"STAY_RESERVATION_DESTINATION_NO_MATCH"===
i.errorCode?(j.html(f),j.find(".item-destination").html(i.stayDestination),j.find(".item-date").html(i.stayDateRange),j.find(".reservation-destination").html($("<textarea/>").html(i.reservationDestination).text()),j.find(".reservation-date").html(i.reservationDateRange)):"STAY_RESERVATION_DESTINATION_NOT_AVBL"===i.errorCode?(j.html(u),j.find(".item-destination").html(i.stayDestination),j.find(".item-date").html(i.stayDateRange)):"STAY_RESERVATION_PRESENT"===i.errorCode?(j.html(n),j.find(".item-destination").html(i.stayDestination),
j.find(".item-date").html(i.stayDateRange)):"CAR_RENTAL_RESERVATION_DESTINATION_NOT_AVBL"===i.errorCode?j.html(h):"CAR_RENTAL_RESERVATION_DESTINATION_NO_MATCH"===i.errorCode?(j.html(l),j.find(".content").html(i.errorDescription)):"CAR_RENTAL_RESERVATION_DATE_NO_MATCH"===i.errorCode?(j.html(k),j.find(".item-from-destination").html(i.planStartDestination),j.find(".item-to-destination").html(i.planEndDestination),j.find(".item-date-range").html(i.itemDateRange),j.find(".reservation-from-destination").html(i.reservationStartDestination),
j.find(".reservation-to-destination").html(i.reservationEndDestination),j.find(".reservation-date-range").html(i.reservationDateRange)):"VISIT_RESERVATION_ATTRACTION_NO_MATCH"===i.errorCode?(j.html(e),j.find(".item-attraction").html(i.visitName),j.find(".reservation-attraction").html(i.reservationName)):"OTHER_RESERVATION_ATTRACTION_NO_MATCH"===i.errorCode?(j.html(e),j.find(".item-attraction").html(i.reservedName),j.find(".reservation-attraction").html(i.reservationName)):"RESERVATION_NOT_COMPATBILE"===
i.errorCode&&(j.html(l),j.find(".content").html(i.errorDescription)),q.elements.content.parents(".qtip").removeClass("hidden"),q.reposition(null,!1),q.elements.content.find(".yes").off("click").on("click",function(){v(d,g,!0,m,j,q,p);q.hide()})},error:function(){q.hide()},complete:function(){j.removeClass("disabled")}}))}var B={},m=g.removeTagsFromString(m,".add-reservation",$("#plan").data("reservationsEnabled"));B.addReservation=function(a,b,c,d,e,f,h,g){var l=$(p),n=$("#plan").data("reservationEmail"),
k=c.reservationType;l.attr("data-event-id",c.id);c.isNightLife&&l.attr("data-is-night-life",c.isNightLife);c.date&&l.attr("data-date",c.date);b.showCB=function(b){function c(){b.hide();r.showReservation(null,null,l,f,h,a,g)}l.off("click.travel-option").on("click.travel-option",".travel-option",function(){l.attr("data-type",$(this).data("type"));c.bind($(this))(!0)});l.off("click.manual-text").on("click.manual-text",".manual-text",function(){l.empty();e.hasClass("travel-row")?l.append($(i).removeClass("hidden indent1")):
(l.attr("data-type",k),c());b.reposition(null,!1)})};b.hideCB=function(a){a.destroy(!0)};l.html(m);$("#itineraryMainPane").data("hasReservation")||(l.find(".add-existing").remove(),l.find(".line").last().remove(),l.find(".manual-text").addClass("last"));b["class"]="add-tip";l.find(".reservation-email").text(n).attr("href","mailto:"+n);D(a,l,b,c,d,f,h)};B.registerEventsForReservation=function(a){var b=$(p);a.off("click.add-reservation").on("click.add-reservation",".add-reservation",function(){var c=
a.data("qtip").target,d=$("#plan").data("reservationEmail"),e=$("#itinerarySubnavPane").find(".add-item"),f={showCB:function(a){b.off("click.travel-option").on("click.travel-option",".travel-option",function(){a.hide();var b=$(this);r.showReservation(b.data("type"))});b.off("click.option-container").on("click.option-container",".option-container:not(.travel-option)",function(){var b=$(this);"travel"===b.data("type")?(b.hasClass("active")?b.siblings(".travel-option").remove():$(i).not(".car").not(".sel-type").removeClass("hidden").insertAfter(b),
b.toggleClass("active")):(a.hide(),r.showReservation(b.data("type")))});b.off("click.manual-text").on("click.manual-text",".manual-text",function(){b.empty();b.append($(j))})},hideCB:function(b){b.destroy(!0)},tip:!1};f.position={my:"top right",at:"bottom right",target:e,effect:!1,viewport:$(window),adjust:{method:"shift none",y:10}};a.qtip("api").hide();b.html(m);b.find(".add-existing").remove();b.find(".line").last().remove();b.find(".manual-text").addClass("last");b.find(".reservation-email").text(d).attr("href",
"mailto:"+d);D(c,b,f)})};B.editReservation=function(b){var a=$(".dlg-calendar-edit-item .reservation-wrapper .reservation").data("isManual");b.preventDefault();a?(b=$(this).data("reservationId"),r.showReservation(null,b)):(b=$(".dlg-calendar-edit-item .reservation-wrapper .reservation").attr("href"),window.open(b,"_blank"))};B.viewDetails=function(){var b=$(this),b=b.hasClass("reservation-row")?b:b.parents(".reservation"),a=b.data("reservationId");b.data("isManual")?r.showReservation(null,a):window.open(window.contextPath+
"/trip/"+$("#plan").data("planId")+"/reservation/"+a+"/details","_blank")};B.addReservationToPlan=function(b,a){b.qtip({overwrite:!0,content:$(p).append(j),position:{at:"right center",my:"left bottom",viewport:$(window),container:$("body"),adjust:{y:15}},show:{event:"click",ready:!0},hide:{event:"unfocus",fixed:!0},events:{show:function(c,d){function e(c){if(c)if("car-rental"===c)d.elements.content.parents(".qtip").addClass("hidden"),v(null,"car-rental",!1,b,f,d,a);else{f.html(t);var h=f.find(".items"),
g=b.parents(".ui-dialog-content").find(".reservation-item"),i="attraction"===c||"other"===c||"custom"===c?"stay":"stay"===c||"hotel"===c?"stay":"travel";h.append(g.clone().addClass("hidden"));h.find(".reservation-item."+i).removeClass("hidden");f.find(".reservation-type .type").text(c);h.find(".reservation-item."+i).data("subType","attraction"===c||"other"===c||"custom"===c?c:"");h.find(".reservation-item:not(.hidden)").length||(f.html(l),"travel"===c?f.find(".content").html("Sorry you have no scheduled travel in the plan."):
f.find(".content").html("Oh uh! No items available."));d.reposition(null,!1)}else f.html(j),d.reposition(null,!1)}var f=d.elements.content.find(".reservation-container");d.elements.content.off("click.option-container").on("click.option-container",".option-container",function(){e($(this).data("name"))});d.elements.content.off("click.reservation-type").on("click.reservation-type",".reservation-type .type",function(){var b=$(this).data("type");e(b)});d.elements.content.off("click.close-qtip").on("click.close-qtip",
".no, .got-it",function(){d.hide()});d.elements.content.off("click.reservation-item").on("click.reservation-item",".reservation-item",function(){var c=$(this).data("id"),e=$(this).data("type"),h=$(this).data("subType");"travel"===e&&b.data("travelMode")&&(e=b.data("travelMode"));h?($(this).addClass("hidden").siblings(".reservation-item").addClass("hidden"),$(this).siblings(".slot-item."+h+"[data-stay-id="+c+"]").removeClass("hidden"),f.find(".reservation-type .type").data("type",h),f.find(".items").find(".reservation-item:not(.hidden)").length||
(f.html(l),f.find(".content").html("Oh uh! No items available. Please select another type.")),d.reposition(null,!1)):v(c,e,!1,b,f,d,a)});b.data("mode")&&d.elements.content.find('.option-container[data-type="'+b.data("mode")+'"]').click()},hide:function(b,a){a.destroy(!0)}},style:{classes:"qtip-light qtip-shadow reservation-tip reservation-item-tip",tip:{corner:!0,width:20,height:10,mimic:"left center",offset:35}}})};B.removeAllFromTravel=function(b){var c={view:b.view};a.makeAJAXcall({url:window.contextPath+
"/trip/"+$("#plan").data("planId")+"/travel/"+b.travelId+"/deleteAllReservations",type:"POST",data:c,synchronize:!0,success:function(a){b.successCB&&b.successCB(a)},complete:function(){b.completeCB&&b.completeCB()}})};B.removeFromPlan=function(b){var c=b.reservationId,d={view:b.view,isOverflow:b.isOverflow};b.hasOwnProperty("type")&&(d.type=b.type);b.hasOwnProperty("itemType")&&(d.itemType=b.itemType);b.hasOwnProperty("id")&&(d.id=b.id);b.hasOwnProperty("stayId")&&(d.stayId=b.stayId);a.makeAJAXcall({url:window.contextPath+
"/trip/"+$("#plan").data("planId")+"/reservation/"+c+"/delete",type:"POST",data:d,synchronize:!0,success:function(a){b.successCB&&b.successCB(a)},complete:function(){b.completeCB&&b.completeCB()}})};B.activityOptionsClick=function(){function b(){a.qtip("api").destroy()}var a=$(this),c=$(".dlg-calendar-edit-item").find(".item-block-wrapper"),d=$(q);a.qtip({overwrite:!0,content:d,position:{my:"top right",at:"bottom right",container:c.parents(".item-block-wrapper"),adjust:{x:-6,y:-4}},show:{delay:0,
ready:!0},hide:{event:"mouseout",fixed:!0},events:{show:function(e,f){var h=c.data("visitId");void 0===h&&(h=c.data("reservedId"));void 0===h&&c.data("travelId");d.click(b);d.find(".edit-reservation").attr("href",$(".dlg-calendar-edit-item .reservation-wrapper .reservation").data("href"));d.find(".edit-reservation").attr("target",$(".dlg-calendar-edit-item .reservation-wrapper .reservation").data("target"));d.find(".edit-reservation").attr("data-reservation-id",a.parents(".item-block-wrapper").data("reservationId"));
d.find(".delete-reservation").attr("data-reservation-id",a.parents(".item-block-wrapper").data("reservationId"));d.find(".delete-reservation").off("click.delete-reservation").on("click.delete-reservation",B.deleteReservation);d.find(".edit-reservation").off("click.edit-reservation").on("click.edit-reservation",B.editReservation);0===f.elements.content.siblings(".qtip-fillerDiv").length&&$('<div class="qtip-fillerDiv"></div>').insertBefore(f.elements.content)},hide:function(b,a){a.destroy()}},style:{classes:"noShadow noBorder activity-options-tip",
tip:{corner:!1}}})};B.deleteReservation=function(b){var a=$(this),c=$(".dlg-calendar-edit-item").find(".item-block-wrapper"),e=a.data("reservationId"),f,h,i,l,n,k;if(c.hasClass("reservation-row")||a.hasClass("delete-reservation"))n="reservation",k=!0;c.hasClass("travel-row")?(f="planItem",h="travel",i=c.data("travelId")):c.hasClass("nightlife-row")||c.hasClass("hotels-row")?(f="planItem",h="stay",i=c.data("stayId")):(f=c.data("visitId")?"visit":"reserved",h=c.data("visitId")?"visit":"reserved",i=
c.data("visitId")?c.data("visitId"):c.data("reservedId"),l=c.data("stayId"));var j=$("<div class='delete-container'><div class='head'>Delete "+n+"?</div><div class='message'>Deleting this "+n+" will delete all its instances from your timeline"+(k?"":" as well as any notes and attachments")+"</div></div>");j.dialog({resizable:!1,modal:!0,draggable:!1,width:"480px",autoOpen:!1,dialogClass:"dlg-delete-event",buttons:[{text:"Cancel",click:function(){j.dialog("close")}},{text:"Delete "+n,click:function(){var g=
{title:c.data("name"),reservationId:e,view:"calendarItemDialog",hasNotes:c.data("hasNotes"),$target:a,type:f,itemType:h,id:i,stayId:l,successCB:function(a){$("#itineraryMainPane").attr("hasReservation",$(a).filter(".reservations-title").data("hasReservation"));$(".dlg-calendar-edit-item").find(".reservation").html(a);b&&"route"===b?d.triggerEvent("overview","plan-update",{}):d.triggerEvent("itinerary","plan-update",{});$(".dlg-calendar-edit-item").hasClass("dlg-travel-item")&&d.triggerEvent("itinerary",
"open-travel-dialog",{})}};B.removeFromPlan(g);j.dialog("close")}}],close:function(){j.dialog("destroy").remove();$(".resultspage").removeClass("scroll-hide");m.remove();g.removeAllErrorToolTips()}});var m=$("<div>");$(".resultspage").addClass("scroll-hide");m.css({position:"fixed",left:0,top:0,right:0,bottom:0,overflow:"auto","z-index":100}).attr("id","reservationContainer");m.appendTo($("body"));j.parents(".ui-dialog").appendTo(m);j.dialog("open");m.off("click").on("click",function(b){"reservationContainer"===
$(b.target).attr("id")&&j.dialog("close")})};return B});
define("jQueryExtensions/inspirockSelectmenu",["modules/ajax","modules/utils","jquery","jqueryui"],function(){$.fn.inspirockSelectmenu=function(a){var g=$(this),d=$.extend(!0,{},a);d.classes=d.classes||{};d.classes["ui-selectmenu-button-closed"]="notranslate";d.classes["ui-selectmenu-button-open"]="notranslate";d.focus=function(d,g){a.focus&&a.focus(d,g)};d.open=function(p,m){a.open&&a.open(p,m);var j=d.appendTo?$(d.appendTo).find("#"+$(p.currentTarget).attr("aria-owns")):$("#"+$(p.currentTarget).attr("aria-owns"));
j.scrollTop(0);j.find("li div.ui-selectmenu-item-selected").removeClass("ui-state-active");if(g.val()){var i=j.find('[data-value="'+g.val()+'"]').offset().top,c=j.offset().top;j.scrollTop(i-c)}};d.change=function(d,g){$(g.item.element).attr("selected",!0).siblings("option").removeAttr("selected");$(g.item.element).parents("select").selectmenu("refresh");a.change&&a.change(d,g)};$(this).each(function(){var a=$(this);a.selectmenu(d);a.data("ui-selectmenu")._renderItem=function(a,g){var i=$('<li data-value="'+
g.value+'" class="notranslate">'),c=$("<div>",{html:d.format?d.format(g.label):g.label});g.element.attr("selected")&&c.addClass("ui-selectmenu-item-selected").removeClass(".ui-state-active");g.disabled&&i.addClass("ui-state-disabled");$("<span>",{style:g.element.attr("data-style")}).appendTo(c);return i.append(c).appendTo(a)}})}});
define("plan/travelEdit","modules/analytics modules/events modules/utils modules/ajax modules/flightquotes plan/planUtils plan/reservation/reservation moment plan/reservation/utils/reservationUtils plan/reservation/reservationFactory jquery jqueryui qtip jQueryExtensions/inspirockSelectmenu jQueryExtensions/inspirockDatepicker".split(" "),function(a,g,d,p,m,j,i,c,b){function f(b){var a=b.find(".start-container").find(".custom-event-date-box").siblings(".container-datepicker").datepicker("getDate"),
e=b.find("#start-time"),f=b.find("#end-time"),e=parseInt(e.val()),h=b.find(".end-container").find(".custom-event-date-box").siblings(".container-datepicker").datepicker("getDate"),g=parseInt(f.val()),i={position:{my:"left center",at:"right center",viewport:$(window),effect:!1,adjust:{x:-15}}};if(!a)return d.showErrorTooltip(b.find(".custom-event-date-box"),"Enter departure date",void 0,i),null;if(!h)return d.showErrorTooltip(b.find(".custom-event-date-box"),"Enter arrival date",void 0,i),null;var b=
e%60,l=g%60,g=(g-l)/60;a.setHours((e-b)/60);a.setMinutes(b);h.setHours(g);h.setMinutes(l);if(-26>c(h).diff(c(a),"hours"))return d.showErrorTooltip(f.parents(".date-time"),"Arrival time cannot be before departure time",void 0,i),null;d.removeAllErrorToolTips();return{departure:u(a),arrival:u(h)}}function u(b){return b.getFullYear()+"-"+n(b.getMonth()+1)+"-"+n(b.getDate())+"T"+n(b.getHours())+":"+n(b.getMinutes())+":"+n(b.getSeconds())}function n(b){return 10>b?"0"+b:b}function k(b,a,c,d,e,f){g.triggerEvent("route",
"prompt-flight-search",{startIataCode:b,startSchema:a,endIataCode:c,endSchema:d,outbounddate:e,inbounddate:f,event:"route.travel.prompt-airport"})}function h(b){null!==f(b)&&!b.find(".save-custom-event").hasClass("uploading")?b.find(".save-custom-event").removeAttr("disabled"):b.find(".save-custom-event").attr("disabled","disabled")}function e(b,c){var d=b.localStartDateTime.format(t);b.localStartDateTime.isSame(b.localEndDateTime,"day")||b.localEndDateTime.format(t);var e=b.isBoundary,f=-1===b.stayId;
c.find(".search-link").each(function(){var c=$("#route").find(".route-main-pane"),h=$(this).parents(".segment-link"),i=d,l=h.data("startId"),n=h.data("endId"),j=h.data("startStopDestinationId"),q=h.data("endStopDestinationId"),t=h.data("startStopDisambiguatedName"),s=h.data("endStopDisambiguatedName"),p=h.data("startStopCountryName"),u=h.data("endStopCountryName"),c=c.find('.travel-row[data-travel-id="'+h.data("transposeTravelId")+'"]'),A=h.data("isReturn"),E=h.data("roundtrip")&&c.length?c.data("startDate"):
null,K=h.data("mode");E&&A&&(c=i,i=E,E=c,c=l,l=n,n=c,c=j,j=q,q=c);if($(this).parents(".segment-link").hasClass("plane")){var L=$(this);1===$(this).parents(".route-links").find(".segment-link.plane").length&&m.getQuote({startDestinationId:j,endDestinationId:q,outboundDateStr:i,inboundDateStr:E},function(b){L.html("Search flights from "+b.formattedAmount)})}$(this).off("click.search-link").on("click.search-link",function(){var c={startDestinationId:j,endDestinationId:q,outbounddate:i,inbounddate:E,
tripType:h.data("roundtrip")?"roundtrip":"oneway",mode:h.data("mode"),startId:l,endId:n};window.flightsEnabled&&"plane"===K?e&&f&&!l&&n?(a.trackEvent("route.travel.options","prompt-start-dest-airport"),k(l,"",n,"cityIata",d)):e&&!f&&l&&!n?(a.trackEvent("route.travel.options","prompt-end-dest-airport"),k(l,"cityIata",n,"",d)):l&&n&&l===n?window.open("https://www.skyscanner.com/","_blank"):!l||!n?window.open("https://www.skyscanner.com/","_blank"):g.triggerEvent("calendar","show-transport-modal",{searchData:c}):
window.trainsEnabled&&"train"===K&&b.isTrainBookable?g.triggerEvent("calendar","show-transport-modal",{searchData:c}):window.carsEnabled&&"car"===K&&l&&n?(c={travelId:$(this).data("travelId"),segmentIndex:$(this).data("segmentItemIndex"),mode:K},g.triggerEvent("calendar","show-transport-modal",{searchData:c})):window.carsEnabled&&"car"===K?window.open("https://www.google.com/maps/dir/"+t+","+p+"/"+s+","+u,"_blank"):window.r2rLinksEnabled&&window.open("https://www.rome2rio.com/s/"+b.startDestination.destinationName+
"/"+b.endDestination.destinationName,"_blank")})})}var l={},t=d.ISO_DATE_FORMAT;l.formatTimeUtil=function(b,a){var c,d;d=window.dateFormatMomentDisplayPattern;c=0<b.minutes()?d+", h:mma":d+", ha";d=b.isSame(a,"day")?0<a.minutes()?" - h:mma":" - ha":0<a.minutes()?" - "+d+", h:mma":" - "+d+", ha";c=b.clone().format(c);d=a.clone().format(d);return c+d};l.travelClick=function(a,c,n,k,m,t,u){if(!c||!$(c.target).hasClass("overflow-icon-container")){if(u&&"route"===u){var G=$(a.travelRow);if(G.data("reservations")){var G=
G.data("reservations").length?G.data("reservations"):[],M=[],w;for(w in G)M.push(G[w].id)}}var J=$('<div class="ui-widget-overlay"><img class="progress-indicator" src="'+window.ajaxLoaderPath+'" alt="loading"></div>');J.appendTo("body");p.makeAJAXcall({type:"GET",url:"/trip/"+$("#plan").data("planId")+"/travelItemDialog",data:{travelId:a.id,reservationIds:d.stringify(M)},success:function(w){J.remove();var y=$("<div/>").html(w);y.find(".reservation").attr("data-id",a.id).attr("data-reservation-type",
"TravelReservation");var s=$("<div/>"),H=function(){var b=x.find(".edit-mode-content .custom-travel-mode"),a=$("#plan").data("travelModes").toLowerCase().split(",");b.autocomplete({source:function(b,c){if("<inspirock-focus>"===b.term)c(a);else{var d=RegExp($.ui.autocomplete.escapeRegex(b.term),"i"),e=$.grep(a,function(b){b=b.label||b.value||b;return d.test(b)});-1===e.indexOf(b.term.toLowerCase())&&e.unshift(b.term);c(e)}},select:function(){h.bind($(this))(x)},minLength:0,classes:{"ui-autocomplete":"custom-travel-mode-autocomplete"},
appendTo:b.parents(".qtip").length?b.parents(".qtip"):b.parents(".travel-edit-container")}).off("focus.inspirockAutoComplete").on("focus.inspirockAutoComplete",function(){b.autocomplete("search","<inspirock-focus>")}).off("input.inspirockAutoComplete").on("input.inspirockAutoComplete",function(){})},x=$(y),A=!1;if(u&&"route"===u){var E="";$(a.travelRow).find(".overview-travel-options li").each(function(b){var a=$(this);if(!a.hasClass("add-travel-option")){var c="",d="";a.find(".segment-option").each(function(){var b=
$(this).data("mode");c=c+(""===c?"":" + ")+$(this).find(".type").data("modeText");var a=$(this).find(".icons").data("modeIcon");d=d+(""===d?"":" + ")+('<svg class="icons '+b+'" data-mode-icon="'+a+'"><use xlink:href="#'+a+'" /></svg>')});var e="";a.hasClass("selected")&&(e="selected");E+="<option class='travel-option' value='"+b+"' data-svg-value='"+d+"' "+e+">"+c+"</option>";a.hasClass("custom-travel")&&(x.find(".edit-mode-content input").val(c),a.hasClass("selected")&&(A=!0))}});x.find(".mode-options-dropdown").toggleClass("hidden",
A);x.find(".edit-mode-content").toggleClass("hidden",!A);E+="<option class='add-custom-travel' value='add-custom-travel'><a>Add custom travel</a></option>";x.find(".mode-options").html(E)}else x.find(".edit-mode-content.hidden").length||(A=!0);var K=x.find(".reservation-container").data("numReservations");x.find(".mode-options-dropdown").find(".mode-options").inspirockSelectmenu({appendTo:x,create:function(){x.find(".ui-selectmenu-text").val()},select:function(b,c){if(!x.hasClass("dropdownInactive"))if("add-custom-travel"===
c.item.value){if(!$(this).hasClass("disabled")){var d=x.find(".edit-mode-content .custom-travel-mode");x.find(".edit-mode-content").removeClass("hidden").siblings(".mode-options-dropdown").addClass("hidden");H();d.blur();j.adjustNotesTextAreaHeight(x.find(".add-note-text"));N.find(".save-custom-event").attr("disabled","disabled")}}else{x.find(".mode-options-dropdown .ui-selectmenu-text").addClass("hidden");var d=x.find(".mode-options-dropdown option:selected"),f;f='<div class="modes-text">'+d.text();
f+="</div>";x.find(".mode-options-dropdown .selected-mode").removeClass("hidden").appendTo(x.find(".mode-options-dropdown .ui-selectmenu-button")).html(d.data("svgValue")+" "+f);if(!t&&(!K||0===K)){var h=x.find(".mode-options-dropdown option:selected").val();x.find(".route-links").each(function(){$(this).data("index").toString()===h&&($(this).removeClass("hidden").siblings().addClass("hidden"),e(a,x))})}}},classes:{"ui-selectmenu-menu":"travel-dropdown"}});x.find(".mode-options-dropdown .ui-selectmenu-text").addClass("hidden");
var w=x.find(".mode-options-dropdown option:selected"),L;L='<div class="modes-text">'+w.text();L+="</div>";x.find(".mode-options-dropdown .selected-mode").removeClass("hidden").appendTo(x.find(".mode-options-dropdown .ui-selectmenu-button")).html(w.data("svgValue")+" "+L);if(!K||0===K){var Q=x.find(".mode-options-dropdown option:selected").val();x.find(".route-links").each(function(){$(this).data("index").toString()===Q&&$(this).removeClass("hidden").siblings().addClass("hidden")})}l.modesText=A?
"":$.trim(x.find(".view-mode-content .modes-text").text());w="Travel to "+a.endDestination.destinationName;x.find(".travel-to").html(w);w=a.distance?a.distance+"&nbsp; / &nbsp;":"";w+=a.durationInHoursAndMinutes;x.find(".distance-time").html(w);w=l.formatTimeUtil(a.localStartDateTime,a.localEndDateTime);x.find(".travel-time").html(w);K&&0<K?x.addClass("dropdownInactive"):(!K||0===K)&&x.removeClass("dropdownInactive");e(a,x);var N=x;t&&(N.find(".edit-container").addClass("hidden"),N.find(".travelsummary-container").addClass("disabled"));
w=60*a.localStartDateTime.hour()+a.localStartDateTime.minute();L=60*a.localEndDateTime.hour()+a.localEndDateTime.minute();var O=0>w,I=O?"Start":null,O=O?"End":null,T=x.find("#start-time"),S=x.find("#end-time");d.createOptionForTime(T,I,w);d.createOptionForTime(S,O,L);T.inspirockSelectmenu({appendTo:N});S.inspirockSelectmenu({appendTo:N});N.off("input.add-note-text").on("input.add-note-text",".add-note-text",function(){j.adjustNotesTextAreaHeight(N.find(".add-note-text"))});var U=N.find(".start-container").find(".custom-event-date-copy"),
G=N.find(".end-container").find(".custom-event-date-copy");U.inspirockDatepicker({minDate:n[0].toDate(),maxDate:n[1].toDate(),dateFormat:"yyyy-mm-dd",altFormat:window.dateFormatDisplayPattern,altField:U.siblings(".custom-event-date-box"),showAnim:"",onSelect:function(){h.bind($(this))(x)},beforeShow:function(){N.parents(".dlg-calendar-edit-item").append($("#ui-datepicker-div").addClass("calendar-datepicker-depart"))},onClose:function(){$("body").append($("#ui-datepicker-div").removeClass("calendar-datepicker-depart"))}});
G.inspirockDatepicker({minDate:k[0].toDate(),maxDate:k[1].toDate(),dateFormat:"yyyy-mm-dd",altFormat:window.dateFormatDisplayPattern,altField:G.siblings(".custom-event-date-box"),showAnim:"",onSelect:function(){h.bind($(this))(x)},beforeShow:function(){N.parents(".dlg-calendar-edit-item").append($("#ui-datepicker-div").addClass("calendar-datepicker-arrive"))},onClose:function(){$("body").append($("#ui-datepicker-div").removeClass("calendar-datepicker-arrive"))}});w=a.localStartDateTime.toDate();U.datepicker("setDate",
w);w=a.localEndDateTime.toDate();G.datepicker("setDate",w);N.find(".start-container").find(".custom-event-date-box").off("click").on("click",function(){U.datepicker("show")}).off("mousedown").on("mousedown",function(b){b.stopPropagation()});N.find(".end-container").find(".custom-event-date-box").off("click").on("click",function(){G.datepicker("show")}).off("mousedown").on("mousedown",function(b){b.stopPropagation()});x.find("#start-time, #end-time").on("selectmenuchange",function(){h.bind($(this))(x)});
x.find("#travel-mode-dlg-field").on("keyup change",function(){$(this).val()?x.find(".save-custom-event").removeAttr("disabled"):x.find(".save-custom-event").attr("disabled",!0)});x.find(".mode-options").on("selectmenuchange",function(){!$(this).parents(".ui-dialog-content").hasClass("dropdownInactive")&&x.find(".edit-mode-content").hasClass("hidden")&&x.find(".save-custom-event").removeAttr("disabled")});x.find(".custom-travel-mode").on("selectmenuchange",function(){x.find(".save-custom-event").removeAttr("disabled")});
x.off("click.save-custom-event").on("click.save-custom-event",".save-custom-event",function(){var b=f(x),c=x.find(".edit-mode-content.hidden").length?x.find(".mode-options option:selected").data("customName"):x.find("#travel-mode-dlg-field").val(),e=parseInt(x.find(".mode-options").val());isNaN(e)&&(e=x.find(".mode-options option").length-1);c===l.modesText&&(c=void 0);var h=j.getAttachmentIds(x.find(".notes-attachment-wrapper"));if(null!==b||c)if("route"===u)g.triggerEvent("calendar","save-route-travel",
{travelDOM:x,travelRow:a.travelRow,self:a.self,addOrEdit:a.addOrEdit,selectedRouteIndex:e});else{var i=a.id,n=x.find(".add-note-text").val(),k=x,q=$(s),b={name:c,startDateTime:b.departure,endDateTime:b.arrival,notes:n,view:"CalendarData",attachments:h,selectedRouteIndex:e};p.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/travel/"+i,type:"POST",data:b,synchronize:!0,success:function(b){m.successCB(b)},error:function(){window.console.log("error on server")},complete:function(){d.closeDialog(k,
q)}})}});x.off("click.travel-options").on("click.travel-options",".travel-options",function(){g.triggerEvent("calendar","overview-post-refresh-actions",{action:"openTravelOptions",travelId:a.id});g.triggerEvent("calendar","show-tab-overview",{addToHistory:!0})});a.notes&&x.find(".notes-attachment-wrapper").removeClass("hidden");if(a.attachments&&a.attachments.length){x.find(".notes-attachment-wrapper").removeClass("hidden");var w=x.find(".attachment-list"),W;for(W in a.attachments)w.append(j.getFormattedAttachmentLink(a.attachments[W]))}x.find(".add-note-text").val(a.notes);
N.off("input.add-note-text").on("input.add-note-text",".add-note-text",function(){h.bind($(this))(N);j.adjustNotesTextAreaHeight($(this))});N.off("click.delete-attachment").on("click.delete-attachment",".notes-attachment-wrapper .attachment-cross-wrapper",function(){h.bind($(this))(N);j.adjustNotesTextAreaHeight($(this))});A&&H();y.inspirockDialog({resizable:!1,modal:!0,animated:!0,autoOpen:!1,draggable:!1,width:"830",dialogClass:"dlg-calendar-edit-item dlg-travel-item row animated mediumx",open:function(){m.successDialogOpen(!0);
y.parents(".ui-dialog").css("position","relative");d.setupDialogOverlay(y,!1);y.off("click.reservation-container").on("click.reservation-container",".reservation-container .add-reservation",function(){$(this).addClass("travel-row");var c={};c.position={my:"left center",at:"right center",target:$(this),container:s,adjust:{x:10}};c.tip={corner:!0,width:20,height:10,mimic:"left center",offset:80};$(this).parents(".reservation-container").data("numReservations")&&(c.position={my:"top right",at:"bottom right",
viewport:$(window),container:s},c.tip=!1);i.addReservation($(this),c,b.getReservationRowDataForCalendarDialogs($(this).parents(".reservation")),!1,$(this),null,u,a)});y.off("mouseenter.activity-options-container").on("mouseenter.activity-options-container",".activity-options-container",i.activityOptionsClick);y.off("click.delete-reservation").on("click.delete-reservation",".delete-reservation",function(){$(this).attr("data-reservation-id",$(this).parents(".item-block-wrapper").data("reservationId"));
i.deleteReservation.bind($(this))(u)});y.off("click.view-details").on("click.view-details",".view-details",i.viewDetails);j.adjustNotesTextAreaHeight(y.find(".add-note-text"));y.find(".edit-mode-content .custom-travel-mode").blur()},beforeClose:function(){d.removeAllErrorToolTips()},close:function(){d.closeDialog(y,s)}});W=void 0;t&&(W=$(".dlg-show-overflow-calendar").css("z-index"));b.createCalendarItemDialogContainer(s,y,W);g.addObserver("open-travel-dialog","calendar",function(){d.closeDialog(y,
s);l.travelClick(a,c,n,k,m,t,u)})}})}};return l});
define("plan/visits","modules/analytics modules/analyticsEventParams modules/utils modules/ajax modules/events plan/planUtils plan/planHelper plan/travelEdit moment modules/copyright plan/reservation/reservation plan/reservation/utils/reservationUtils plan/reservation/reservationFactory jquery".split(" "),function(a,g,d,p,m,j,i,c,b,f,u,n){function k(b){var a=b.visitId;p.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/visit/"+a+"/delete",type:"POST",data:{view:b.view,isOverflow:b.isOverflow},
synchronize:!0,success:function(a){void 0!==b.successCB&&b.successCB(a)},complete:function(){void 0!==b.completeCB&&b.completeCB()}})}function h(b,a){var c=b.split("+"),e=c[0],f=parseInt(c[1]),h=$("<div></div>").html('<div class="tagline calendartext">We\'ve added '+a.attractionName+' to your plan but were not able to schedule it properly.</div><div class="add-destination-button"><button class="cta-button small show-event-calendar">See on calendar</button></div>');h.dialog({resizable:!1,modal:!0,
draggable:!1,width:"660px",dialogClass:"dlg-add-activity mediumx",open:function(){d.setupDialogOverlay(h,!1);h.off("click.show-event-calendar").on("click.show-event-calendar",".show-event-calendar",function(){h.dialog("close");a.modal&&a.modal.close();m.triggerEvent("explore","show-tab-itinerary",{addToHistory:!1,tabData:{subnav:"calendar",date:e,visitId:f}})})},close:function(){h.dialog("destroy").remove();a.completeCB&&a.completeCB()}})}function e(a,c,e){if(!$(this).hasClass("disabled")){var f;
a.find(".event-date").hasClass("not-in-range")?(f=a.find(".event-date-box").val(),f=null!==f?b(f,"ddd M/D").format("YYYY-MM-DD"):null):(f=a.find(".event-date-copy").datepicker("getDate"),f=null!==f?b(f).format("YYYY-MM-DD"):null);var h=parseInt(a.find(".time-holder #start-time").val()),g=parseInt(a.find(".time-holder #end-time").val()),l=a.find(".add-note-text").val().trim(),i=j.getAttachmentIds(a.find(".notes-attachment-wrapper"));-1===h||-1===g||g<=h?d.showErrorTooltip(a.find(".time-holder #end-time-button"),
"Please select valid start & end times.",null,{}):p.makeAJAXcall({type:"POST",data:{date:f,startTime:h,endTime:g,view:c.view,notes:l,isOverflow:c.isOverflow,isOverflowMode:c.stayOverflowMode,attachments:i},url:c.url,synchronize:!0,complete:function(){d.closeDialog(a,e)},success:function(b){c.successCB(b)}})}}function l(b){""!==b.find(".event-date-box").val()&&!b.find(".save-event").hasClass("uploading")?b.find(".save-event").removeAttr("disabled"):b.find(".save-event").attr("disabled","disabled")}
function t(){var b=$(this).parents(".desc");b.parents(".photo-name-container").removeClass("unabridged");$(this).parents(".event-data").find(".full-details-link").addClass("hidden");q(b);D(b);$(this).remove()}function r(){var b=$(this).parents(".desc");b.parents(".photo-name-container").addClass("unabridged");$(this).parents(".event-data").find(".full-details-link").removeClass("hidden");b.append($('<span class="less-link secondary-text-link">See less</span>'));q(b)}function q(b){var a=b.find(".trim-desc"),
c=b.find(".alt-desc"),d=a.html(),b=b.find(".alt-desc").html();a.html(b);c.html(d)}function D(b){b.find(".trim-desc").each(function(){var b=$(this).text(),a=$(this).data("moreLink");""!==b.trim()&&($(this).append("<span data-link='"+a+"' class='more-link secondary-text-link' title='Read More'>See more</span>"),b=$(this)[0].offsetHeight,a=parseFloat($(this).css("lineHeight")),Math.round(b/a))})}function v(a){return b(a.format(z),z)}var B={},z=d.ISO_DATE_TIME_FORMAT;B.getUrlParamsForExplore=function(){var b=
{};location.search.slice(1).split("&").forEach(function(a){var a=a.split("="),c=decodeURIComponent(a[0].replace(/\+/g," ")).replace(/\[/g,"").replace(/\]/g,"");if(b.hasOwnProperty(c)){var d=b[c];$.isArray(d)||(d=[],d.push(b[c]));d.push(decodeURIComponent(a[1]?a[1].replace(/\+/g," "):""));b[c]=d}else b[c]=decodeURIComponent(a[1]?a[1].replace(/\+/g," "):"")});if(!$.isArray(b.categoryGroupFilters)){var a=[];b.hasOwnProperty("categoryGroupFilters")&&a.push(b.categoryGroupFilters);b.categoryGroupFilters=
a}$.isArray(b.categoryFilters)||(a=[],b.hasOwnProperty("categoryFilters")&&a.push(b.categoryFilters),b.categoryFilters=a);$.isArray(b.otherFilters)||(a=[],b.hasOwnProperty("otherFilters")&&a.push(b.otherFilters),b.otherFilters=a);$.isArray(b.planDestinationFilters)||(a=[],b.hasOwnProperty("planDestinationFilters")&&a.push(b.planDestinationFilters),b.planDestinationFilters=a);return b};B.removeFromPlan=function(b){b.hasNotes?i.deleteNotesQtip(b.$target,b.title,function(){k(b)}):k(b)};B.addAttraction=
function(b){function c(e,f,l,i,n){b.requestData.forceMerge=e;b.requestData.userDIY=f;i&&(b.requestData.replanStayIds=i);n&&(b.requestData.adjustStayIds=n);b.requestData.showCalendar=!0;p.makeAJAXcall({type:"POST",data:b.requestData,url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/visit",synchronize:!0,success:function(e,f,i){b.removeCalendarDateAndStay&&b.removeCalendarDateAndStay();if(l)l(e);else if(i.getResponseHeader("Modified-Visits"))$("#pageWrapper").append($(e)),m.triggerEvent(b.eventSource,
"show-removed-visits-dlg",{cb:function(a,d,e,f){var h;d&&(h=function(a){m.triggerEvent(b.eventSource,"visit-add",{uiSource:b.uiSource,onlyInvalidate:!0});m.triggerEvent("explore","show-tab-itinerary",{addToHistory:!1,tabData:{subnav:"calendar",date:a.date,visitId:a.visitId}})});c(a,d,h,e,f)}});else{i.getResponseHeader("Forced-Visit")&&(f=i.getResponseHeader("Forced-Visit"),h(f,b));var n=$(e),k=n.find("#needsNewDestination");k.length?n.dialog({resizable:!1,modal:!0,draggable:!1,width:"660px",dialogClass:"dlg-add-activity mediumx",
open:function(){d.setupDialogOverlay(n,!1);n.off("click.add-destination").on("click.add-destination",".add-destination",function(){function c(f,i,l,n,k){e.forceMerge=f;e.userDIY=i;e.forceAddStay=!0;n&&(e.replanStayIds=n);k&&(e.adjustStayIds=k);d.prop("disabled",!0);p.makeAJAXcall({type:"POST",data:e,url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/visit",synchronize:!0,success:function(d,e,f){l?l(d):f.getResponseHeader("Modified-Visits")?($("#pageWrapper").append($(d)),m.triggerEvent("planUtils",
"show-removed-visits-dlg",{cb:function(a,e,f,h){var g;e&&(g=function(){m.triggerEvent(b.eventSource,"stay-add",{uiSource:b.uiSource});m.triggerEvent("explore","show-tab-itinerary",{addToHistory:!1,tabData:{subnav:"calendar",stayId:d.stay,slotIndex:d.slotIndex,visitId:d.visitId}})});c(a,e,g,f,h)}})):(f.getResponseHeader("Forced-Visit")&&(e=f.getResponseHeader("Forced-Visit"),h(e,b)),b.successCB&&b.successCB(d),m.triggerEvent(b.eventSource,"stay-add",{uiSource:b.uiSource}),a.trackEvent(b.analyticsCategory,
g.ACT_ADD_ATTR,b.attractionName.toLowerCase()))},complete:function(){d.prop("disabled",!1);b.completeCB&&b.completeCB()}})}var d=$(this),e=B.getUrlParamsForExplore();e.viewDestinationId=e.destinationId;e.attractionId=k.data("attractionId");e.destinationId=k.data("destinationId");e.domainId=b.requestData.domainId;e.view=b.requestData.view;b.additionalPostParams&&$.extend(e,b.additionalPostParams);n.dialog("close");c(!1)})},close:function(){n.dialog("destroy").remove();b.completeCB&&b.completeCB()}}):
(b.successCB&&b.successCB(e),m.triggerEvent(b.eventSource,"visit-add",{uiSource:b.uiSource}))}},complete:function(){b.completeCB&&b.completeCB()}})}c(!1,!1)};B.openVisitItemDialog=function(a,h,g,i,q,B){var y=$('<div class="ui-widget-overlay"><img class="progress-indicator" src="'+window.ajaxLoaderPath+'" alt="loading"></div>');y.appendTo("body");p.makeAJAXcall({type:"GET",url:"/trip/"+$("#plan").data("planId")+"/visitItemDialog",data:{attractionId:a.attractionId,visitId:a.visitId,stayId:a.stayId,
isOverflow:q},success:function(s){y.remove();var p=$("<div/>").html(s);p.find(".reservation").attr("data-id",a.visitId).attr("data-reservation-type","ActivityReservation");var x=$("<div/>");p.inspirockDialog({resizable:!1,modal:!0,animated:!0,autoOpen:!1,draggable:!1,width:"830",dialogClass:"dlg-calendar-edit-item dlg-visit-item row animated mediumx",open:function(){D(p);a.visitEdit&&p.find(".delete-event").removeClass("hidden");a.stayOverflowMode=q;p.find(".summary-title").remove();f.initialize();
a.hasOwnProperty("name")&&p.find(".event-title").html(a.name).attr("eventSrc","calendar.visit").data("detailsUrl",a.detailsUrl);if(a.hasOwnProperty("start")&&a.hasOwnProperty("end")){var s=c.formatTimeUtil(a.start,a.end);p.find(".time-holder-summary").contents().filter(function(){return 3===this.nodeType})[0].nodeValue=s}var E=p.find(".event-date-copy"),K=v(a.stayArrivalTime).toDate(),L=v(a.stayDepartureTime).toDate(),Q=p.find("#start-time"),N=p.find("#end-time"),s=a.hasOwnProperty("startTimeInMinutes")?
a.startTimeInMinutes:-1,O=a.hasOwnProperty("endTimeInMinutes")?a.endTimeInMinutes:-1,I=0>s,T=L,S=a.timeRanges||[{start:g.clone(),end:i.clone()}],y;for(y in S)S[y].start.isBefore(K)&&(K=S[y].start.clone().startOf("day").toDate()),S[y].end.isAfter(T)&&(T=S[y].end.clone().startOf("day").toDate());E.inspirockDatepicker({minDate:K,maxDate:T,dateFormat:"yyyy-mm-dd",altFormat:"D m/d",altField:E.siblings(".event-date-box"),showAnim:"",appendTo:p,onSelect:function(){p.find(".event-date").removeClass("not-in-range");
var b=E.datepicker("getDate"),a=parseInt(Q.val()),c=parseInt(N.val()),b={date:b,starttime:Q,endtime:N,startTimeInMinutes:a,endTimeInMinutes:c,timeRanges:S,showTimeSelectTitles:I,container:p.parents(".ui-dialog"),isOverflow:q};m.triggerEvent("reserved","setup-time-selects",b);p.find(".save-event").removeAttr("disabled")},beforeShowDay:function(b){var a=!1,c;for(c in S){var d=v(S[c].start.clone().startOf("day")),e=v(S[c].end.clone().startOf("day"));if((d.isSame(b)||d.isBefore(b))&&(e.isSame(b)||e.isAfter(b))){a=
!0;break}}return[a,"",null]},beforeShow:function(){Q.selectmenu("close");N.selectmenu("close");$("#calendarItemContainer").append($("#ui-datepicker-div").addClass("calendar-datepicker"))},onClose:function(){$("body").append($("#ui-datepicker-div").removeClass("calendar-datepicker"))}});L=null;if(a.hasOwnProperty("date")){var z=b(a.date),L=z.clone().toDate();!z.isBefore(b(K))&&!z.isAfter(b(T))?E.datepicker("setDate",L):(p.find(".event-date-box").val(z.clone().format("ddd M/D")),p.find(".event-date").addClass("not-in-range"))}a.notes&&
(p.find(".notes-attachment-wrapper").removeClass("hidden"),p.find(".note-container").removeClass("hidden"),p.find(".add-note-text").val(a.notes),p.parents(".qtip").addClass("big"));if(a.attachments&&a.attachments.length){p.find(".notes-attachment-wrapper").removeClass("hidden");p.find(".note-container").removeClass("hidden");K=p.find(".attachment-list");for(y in a.attachments)K.append(j.getFormattedAttachmentLink(a.attachments[y]));p.parents(".qtip").addClass("big")}p.find(".event-date-box").off("click").on("click",
function(){E.data("isOpen")?E.datepicker("hide").data("isOpen",""):E.datepicker("show").data("isOpen",!0)}).off("mousedown").on("mousedown",function(b){b.stopPropagation()});y={date:L,starttime:Q,endtime:N,startTimeInMinutes:s,endTimeInMinutes:O,timeRanges:S,showTimeSelectTitles:I,container:p.parents(".ui-dialog"),isOverflow:q};m.triggerEvent("reserved","setup-time-selects",y);p.off("click.tag").on("click.tag",".tag",function(){if(!$(this).hasClass("must-see-tag")){p.dialog("close");$(".calendar-container").dialog("close");
var b=$(this),c=h[a.stayId].destinationId,d=b.data("catGroupId"),e=b.data("catId"),b=b.data("otherId");d?B.gotoSelectedTagPlaces([d],null,null,c,"itinerary"):e?B.gotoSelectedTagPlaces(null,[e],null,c,"itinerary"):B.gotoSelectedTagPlaces(null,null,[b],c,"itinerary")}});p.off("keypress.custom-event-name").on("keypress.custom-event-name",".custom-event-name",function(){l.bind($(this))(p)});p.off("input.add-note-text").on("input.add-note-text",".add-note-text",function(){l.bind($(this))(p);j.adjustNotesTextAreaHeight($(this))});
p.off("click.delete-attachment").on("click.delete-attachment",".notes-attachment-wrapper .attachment-cross-wrapper",function(){l.bind($(this))(p);j.adjustNotesTextAreaHeight($(this))});p.find("#start-time, #end-time").on("selectmenuchange",function(){p.find(".save-event").removeAttr("disabled")});p.off("click.save-event").on("click.save-event",".save-event",function(){e.bind($(this))(p,a,x)});p.off("click.delete-event").on("click.delete-event",".delete-event",function(){$(this).is(":visible")&&(p.dialog("close"),
k(a.deleteData))});a.successDialogOpen(!0);p.parents(".ui-dialog").css("position","relative");d.setupDialogOverlay(p,!1);p.off("click.reservation-container").on("click.reservation-container",".reservation-container .add-reservation",function(){var b={};b.position={my:"left center",at:"right center",target:$(this),container:x,adjust:{x:10}};b.tip={corner:!0,width:20,height:10,mimic:"left center",offset:80};$(this).parents(".reservation-container").data("numReservations")&&(b.position={my:"top right",
at:"bottom right",viewport:$(window),container:x},b.tip=!1);u.addReservation($(this),b,n.getReservationRowDataForCalendarDialogs($(this).parents(".reservation")),!1,$(this))});p.off("mouseenter.activity-options-container").on("mouseenter.activity-options-container",".activity-options-container",u.activityOptionsClick);p.off("click.delete-reservation").on("click.delete-reservation",".delete-reservation",function(){$(this).attr("data-reservation-id",$(this).parents(".item-block-wrapper").data("reservationId"));
u.deleteReservation.bind($(this))()});p.off("click.attLink").on("click.attLink",".attLink",function(){p.dialog("close")});p.off("click.view-details").on("click.view-details",".view-details",u.viewDetails);p.off("click.more-link").on("click.more-link",".more-link",r);p.off("click.less-link").on("click.less-link",".less-link",t);j.adjustNotesTextAreaHeight(p.find(".add-note-text"));f.initialize()},beforeClose:function(){d.removeAllErrorToolTips()},close:function(){d.closeDialog(p,x)}});n.createCalendarItemDialogContainer(x,
p)},error:function(b){y.remove();console.log(b)}})};return B});
define("explore/exploreAttractions","modules/analytics modules/analyticsEventParams modules/history modules/ajax modules/events modules/modal modules/utils modules/copyright plan/visits plan/loading plan/planHelper moment jquery jqueryui".split(" "),function(a,g,d,p,m,j,i,c,b,f,u){return function(n,k){function h(){y.css("visibility","hidden");F.css("visibility","hidden");w.find(".progress-txt").text("Loading...");var b=w.parents(".ui-dialog-content").scrollTop();w.css("top",b+"px");w.removeClass("hidden")}
function e(){f.hideLoading(w,y);y.css("visibility","visible");F.css("visibility","visible");w.addClass("hidden")}function l(){var b=F.find("#filter-activity-type"),a=F.find(".plan-destinations-filter-type"),c=b.find("input[type=checkbox]:checked").filter(".cat").map(function(){return parseInt(this.value,10)}).get(),d=b.find("input[type=checkbox]:checked").filter(".catgroup").map(function(){return parseInt(this.value,10)}).get(),b=b.find("input[type=checkbox]:checked").filter(".filterkey").map(function(){return this.value}).get(),
a=a.find("input[type=checkbox]:checked").filter(".filterkey").map(function(){return this.value}).get(),e=F.find(".selected-domain-id").data("domainId"),f=F.find(".hide-attractions-in-plan").is(":checked"),h=0<F.find(".include-side-trip-attractions").length&&!F.find(".include-side-trip-attractions").is(":checked");return{domainId:e,attractionsplanDestinationFilters:a,attractionscategoryFilters:c,attractionscategoryGroupFilters:d,attractionsotherFilters:b,attractionshideInPlan:f,attractionshideOutside:h,
attractionsmaxNumResults:H,attractionspageIndex:0,modal:j.isOpen()}}function t(){var b=l(),a={requestData:$.extend(!0,{dontScrollToTop:!0},b),isModal:j.isOpen(),tab:j.getTab(),modal:"explore"},c=i.getPlanUrl()+"/explore/attractions?"+$.param(b);j.isOpen()?(c=i.planTabUrl()+"/modal/explore/attractions?"+$.param(b),j.pushHistory("browseAttractions",j.getTab(),c,a)):d.push("browseAttractions","explore",c,a);z(b)}function r(){var b=l(),e=$(this);if(!e.data("queryInProgress")){e.data("queryInProgress",
!0);b.attractionspageIndex=parseInt(e.data("pageIndex"))||1;e.data("pageIndex",b.attractionspageIndex+1);var f=$.extend(!0,{},b);f.attractionspageIndex=0;f.attractionsmaxNumResults=(b.attractionspageIndex+1)*H;f.dontScrollToTop=!0;delete f.view;var h=i.getPlanUrl()+"/explore/attractions?"+$.param(f),n={requestData:f,isModal:j.isOpen(),tab:j.getTab()};j.isOpen()&&(window.history.state&&(n.parentId=window.history.state.data.parentId,n.parentTabId=window.history.state.data.parentTabId,n.pathname=window.history.state.data.pathname),
h=location.pathname+"?"+$.param(f));d.replace("browseAttractions","explore",h,n);b.attractionsmaxNumResults=H;b.view="partial";b.tab=j.getTab()?j.getTab():"explore";p.makeAJAXcall({type:"GET",url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/browseAttractions",data:b,complete:function(){e.data("queryInProgress",!1)},success:function(b){var b=$(b).filter("li").clone(),d=s.find(".search-results");b.each(function(){var b=$(this);$("#"+b.attr("id")).length||d.append(b)});c.initialize();e.toggleClass("hidden",
b.length<H);a.trackEvent(g.CAT_PLAN_EXP_DEST_ATTRS,g.SHOW_MORE)}})}}function q(){var a=$(this).parents(".attraction"),c=a.data("attractionId"),d=a.data("name"),f=a.data("destinationId"),g=a.parents("#exploreAttractionsMainPane").data("shouldForceDateTimeAndStay"),i=b.getUrlParamsForExplore();i.viewDestinationId=i.destinationId;i.attractionId=c;i.view="exploreFiltersAndResults";i.destinationId=f;i.dontScrollToTop=!0;i.domainId=M.find(".selected-destination").data("destinationId");g&&(i.forcedDateTime=
a.parents("#exploreAttractionsMainPane").data("forcedDateTime"),i.forcedStayId=a.parents("#exploreAttractionsMainPane").data("forcedStayId"));c={requestData:i,analyticsCategory:"explore.filter-results",eventSource:"explore",attractionId:c,attractionName:d,hideDestinationSelect:!0,userTimeInputRequired:!0,uiSource:"explore.attractions.list",destinationId:f,modal:j.isOpen()?j:null,additionalPostParams:{view:"exploreFiltersAndResults"},successCB:function(b){function c(){x.contents($("<div />").append(b));
m.triggerEvent(G,"visit-add",{uiSource:"explore.attractions"})}"true"===i.attractionshideInPlan?a.css({overflow:"hidden"}).animate({opacity:0,height:0,padding:0,margin:0},function(){h();window.setTimeout(function(){c();e()},300)}):c()},removeCalendarDateAndStay:function(){a.parents("#exploreAttractionsMainPane").removeData("shouldForceDateTimeAndStay").removeData("forcedDateTime").removeData("forcedStayId")}};b.addAttraction(c)}function D(){m.triggerEvent(G,"mmt_track_link",{linkName:"In your plan"})}
function v(){function b(){c.prop("disabled",!0);p.makeAJAXcall({type:"POST",data:{view:"exploreAttractions"},url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/visit/"+d+"/delete",success:function(b){c.parents("li").replaceWith(b);m.triggerEvent(G,"visit-remove",{uiSource:"explore.attractions"});a.trackEvent(g.CAT_PLAN_EXP_DEST_ATTRS,g.ACT_DEL_VISIT,e.toLowerCase())},complete:function(){c.prop("disabled",!1)}})}var c=$(this),d=$(this).data("visitId"),e=$(this).data("attractionName");c.data("hasNotes")?
u.deleteNotesQtip(c,e,function(){b()}):b()}function B(){F.find("input[type=checkbox]:checked").prop("checked",!1);F.find("input[type=checkbox].include-side-trip-attractions").prop("checked",!0);t()}function z(b){b.tab=j.getTab()?j.getTab():"explore";b.dontScrollToTop||window.pageYOffset>=i.pageTopPx()&&$("html, body, .modal-box .ui-dialog-content").animate({scrollTop:i.pageTopPx()},0);h();s.addClass("blank");p.makeAJAXcall({type:"GET",url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/browseAttractions",
data:b,complete:function(){},success:function(d){var f=!F.find("#filter-activity-type .show-more").hasClass("hidden"),d=$(d);F.find(".contents").empty().append(d.find("#filters").html());f||(F.find("#filter-activity-type .show-more").addClass("hidden"),F.find("#filter-activity-type label").removeClass("hidden"));e();s.empty().append(d.find("#results").html());s.removeClass("blank");s.find(".load-more").addClass("hidden");f=s.find(".search-results").find("li").length;c.initialize();s.find(".load-more").toggleClass("hidden",
f<H);C();f=$("#analytics-metadata");d=$("#destination-analytics-metadata");a.setPageTypeNew(f.data("pageTypeNew")+" : destination details : attractions");a.setEntityType(d.data("entityType"));a.setEntity(d.data("entity"));a.trackPageView("/plan/explore/destination/attractions");a.trackNonInteractionEvent(g.CAT_PLAN_EXPLORE,"filter-attractions");a.trackNonInteractionEvent(g.CAT_PLAN_EXPLORE,"filter-attractions-hide-in-plan",b.attractionshideInPlan);a.trackNonInteractionEvent(g.CAT_PLAN_EXPLORE,"filter-attractions-hide-outside",
b.attractionshideOutside);a.trackNonInteractionEvent(g.CAT_PLAN_EXPLORE,"filter-attractions-sort",b.attractionssortBy)}})}function C(){F.find("#filter-activity-type label.hidden").each(function(b,a){if($("#"+$(a).attr("for")).is(":checked"))return F.find("#filter-activity-type .show-more").addClass("hidden"),F.find("#filter-activity-type label").removeClass("hidden"),!1})}var G="explore-attractions",M,w,J,F,y,s,H=10,x=this,A=function(){if(!$(this).hasClass("must-see-tag")){var b=$(this),a=F.find(".attraction-filter.active").data("destinationId"),
c=b.data("catGroupId"),e=b.data("catId"),b=b.data("otherId"),e=e?[e]:null,c=c?[c]:null,b=b?[b]:null,f=F.find(".plan-destinations-filter-type").find("input[type=checkbox]:checked").filter(".filterkey").map(function(){return this.value}).get(),h=F.find(".selected-domain-id").data("domainId"),g=F.find(".hide-attractions-in-plan").is(":checked"),l=!F.find(".include-side-trip-attractions").is(":checked"),e={domainId:h,attractionsplanDestinationFilters:f,attractionscategoryFilters:e,attractionscategoryGroupFilters:c,
attractionsotherFilters:b,attractionshideInPlan:g,attractionshideOutside:l,attractionssortBy:"popularity",attractionsmaxNumResults:H,attractionspageIndex:0,modal:j.isOpen()},a={requestData:$.extend(!0,{dontScrollToTop:!0},e),isModal:j.isOpen(),destinationId:a,tab:j.getTab(),modal:"explore"},c=i.getPlanUrl()+"/explore/attractions?"+$.param(e);j.isOpen()?(c=i.planTabUrl()+"/modal/explore/attractions?"+$.param(e),j.pushHistory("browseAttractions",j.getTab(),c,a)):d.push("browseAttractions","explore",
c,a);z(e)}};x.contents=function(b){F.html(b.find("#exploreAttractionsLeftPane").html());s.html(b.find("#exploreAttractionResultsPane").html());J.toggleClass("hidden",b.find("#attractions").hasClass("hidden"));this.onPageChange()};x.onPageChange=function(){C();s.find(".load-more").data("pageIndex",parseInt(i.getParameterByName("attractionsmaxNumResults"))/H);k.onPageChange()};x.initialize=function(){if(!s||!s.length){M.find(".explore-main-pane");M.find(".explore-subnav-pane");w=M.find("#exploreAttractionLoadingPane");
J=M.find(".explore-attractions-pane");F=M.find(".explore-attractions-left-pane");y=J.find(".explore-attractions-main-pane");s=y.find(".explore-attraction-results-pane");if(!s||0===$.trim(s.html()).length)return;F.off("click.attractionfilter").on("click.attractionfilter",".attraction-filter",t).off("change.attractionfilter").on("change.attractionfilter","#filter-activity-type .filter,.plan-destinations-filter-type .filter",t).off("click.plan-domain").on("click.plan-domain",".plan-domain",t).off("change.include-side-trip-attractions").on("change.include-side-trip-attractions",
".include-side-trip-attractions",t).off("change.hide-attractions-in-plan").on("change.hide-attractions-in-plan",".hide-attractions-in-plan",t);s.off("click.loadMore-attractions").on("click.loadMore-attractions",".load-more.attractions",r).off("click.addBrowseAttraction").on("click.addBrowseAttraction","li.attraction .add-button",q).off("click.inplan").on("click.inplan",".calendarLink",D).off("click.delete-attraction").on("click.delete-attraction","li.attraction .delete-button",v).off("click.reset-filters").on("click.reset-filters",
".no-results .line3 button",B);y.off("click.tag").on("click.tag",".tags-attractions .tag",A)}this.onPageChange()};M=n;x.initialize()}});
define("modules/lazyload",["jquery"],function(){function a(b){var a=new window.Image;a.onload=function(){b.is("img")?b.attr("src",b.data("url")):b.css("background-image","url('"+b.data("url")+"')")};a.src=b.data("url");m=m.add(b)}function g(){if(j.length){var b=i.scrollTop(),d=b+i.height();j=$($.grep(j,function(g){var g=$(g),i=g.offset().top;return i+g.height()>=b-c&&i<=d+c?(a(g),!1):!0}))}}function d(b){b.onscroll?(j=$(".lazyload").not(m),g(),i.off("scroll.ll resize.ll").on("scroll.ll resize.ll",
g)):$(".lazyload").not(m).not(j).each(function(){a($(this))})}var p={},m=$(),j=$(),i=$(window),c=50;p.initialize=function(b){b=b||{};if("complete"===document.readyState)d(b);else $(window).on("load",function(){d(b)})};return p});
define("plan/stay","plan/loading modules/analytics modules/analyticsEventParams modules/ajax modules/events jquery".split(" "),function(a,g,d,p,m){return{add:function(j,i){function c(e,l,t,r,q){h.forceMerge=e;h.userDIY=l;t&&(h.replanStayIds=t);r&&(h.adjustStayIds=r);q&&(h.isAllAdjusted=q);b.prop("disabled",!0);a.showLoading($("#exploreLoadingPane"),$("#exploreMainPane"),"Updating Your Plan...");var u={uiSource:j&&j.data?j.data.uiSource:""},v=j&&j.data&&j.data.eventSource?j.data.eventSource:i.EVENT_SOURCE;
p.makeAJAXcall({type:"POST",url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/stay",data:h,synchronize:!0,complete:function(){b.prop("disabled",!1);a.hideLoading($("#exploreLoadingPane"),$("#exploreMainPane"));l&&m.triggerEvent(i.EVENT_SOURCE,"show-tab-itinerary",{addToHistory:!1,tabData:{subnav:"calendar"}})},success:function(b,a,e){e.getResponseHeader("Modified-Visits")?($("#pageWrapper").append($(b)),m.triggerEvent(v,"show-removed-visits-dlg",{cb:c})):(i.analyticsCategory&&g.trackEvent(i.analyticsCategory,
d.ACT_ADD_DEST,k.toLowerCase()),v&&m.triggerEvent(v,"stay-add",u),i.dontpopulate||f.html(b),i.success&&i.success(b,n))}})}var b=$(this),f=j&&j.data?j.data.detailsPane:null,u=b.parents(".destination-details"),n=b.data("destinationId")||b.find("button").data("destinationId")||u.data("destinationId"),k=b.data("name")||b.find("button").data("name")||u.data("name"),h={destinationId:n,destinationName:k},h=$.extend(!0,{},h,i.destinationData);b.parents(".qtip")&&b.parents(".qtip").qtip("hide",!0);c(!1,!1)}}});
define("minimapHelper","modules/analytics modules/utils modules/ajax modules/events modules/lazyload modules/copyright jquery".split(" "),function(a,g,d,p,m,j){function i(a,b,d,g){if(0===a&&0===b)d();else{var i=Math.pow(2,g.getZoom()),k=g.getProjection().fromLatLngToPoint(g.getCenter()),a=new window.google.maps.Point(a/i||0,b/i||0),k=new window.google.maps.Point(k.x-a.x,k.y+a.y),k=g.getProjection().fromPointToLatLng(k);window.google.maps.event.addListenerOnce(g,"idle",function(){$(".tip-infowindow").length&&
$(".tip-infowindow").qtip("api")&&$(".tip-infowindow").qtip("api").reposition(null,!1);d()});g.panTo(k)}}return{destinationDetailsContents:function(a,b,d){b.find(".photo-div").attr("data-link",a.data("link")).attr("data-destination-id",a.data("destinationId")).html(a.data("photo"));var i=!$("body").hasClass("resultspage");i&&b.find(".photo-div").attr("href",a.data("link"));var n=b.find(".search-item-data");n.attr("data-destination-id",a.data("destinationId"));n.find(".title span.destinationDetailsLink").attr("data-link",
a.data("link")).attr("data-destination-id",a.data("destinationId")).html(a.data("title"));i&&(n.find(".title span.destinationDetailsLink").attr("href",a.data("link")),n.find(".title").html(n.find(".title").html().replace(/<span/g,"<a").replace(/<\/span>/g,"</a>")));n.find(".rating-stars").toggleClass("hidden",!a.data("rating"));n.find(".rating-stars-fill").css("width",100*parseInt(a.data("rating"))/5+"%");a.data("catGroupName")&&n.find(".tags-and-tours .tag").attr("data-cat-group-id",a.data("catGroupId")).html(a.data("catGroupName")).removeClass("hidden");
n.siblings("p.description").html(a.data("description"));i&&(n.siblings("p.description").find(".destinationDetailsLink").attr("href",a.data("link")),n.siblings("p.description").html(n.siblings("p.description").html().replace(/<span/g,"<a").replace(/<\/span>/g,"</a>")));var n=b.find(".add-destination"),k=b.find(".edit-schedule");b.find(".start-a-plan");a.data("inPlan")?(n.addClass("hidden"),k.removeClass("hidden"),k.find(".slot-time-range").attr("data-date",a.data("date")).find(".dynamic-part").html(a.data("buttonText"))):
i?b.find(".start-a-plan").removeClass("hidden").attr("data-destination-id",a.data("destinationId")):(n.removeClass("hidden").addClass(d),k.addClass("hidden"),n.find("button").addClass(g.isEditable()?"add-button":"claimPlanLink add").attr("data-destination-id",a.data("destinationId")).attr("data-name",a.data("name")));return b.html()},destinationDetailsQtip:function(){return{classes:"qtip-infowindow",position:{at:"right center",my:"left center",adjust:{x:-5,y:-5}},tip:{corner:!0,width:20,height:10},
minorPoint:{position:{adjust:{x:-10,y:9}}}}},iconQtip:function(a){a=a||{};return{classes:"icon-tip "+(a.classes||""),position:{my:"bottom center",at:"top center"}}},attractionDetailsContents:function(a,b){b.find(".photo-div").attr("data-link",a.data("link")).attr("data-attraction-id",a.data("attractionId")).html(a.data("photo"));var d=!$("body").hasClass("resultspage"),i=b.find(".search-item-data");i.attr("data-attraction-id",a.data("attractionId"));i.find(".title span.attractionDetailsLink").attr("data-link",
a.data("link")).attr("data-attraction-id",a.data("attractionId")).html(a.data("name"));i.find(".rating-stars").toggleClass("hidden",!a.data("rating"));i.find(".rating-stars-fill").css("width",100*parseInt(a.data("rating"))/5+"%");i.siblings("p.description").html(a.data("description"));var i=b.find(".add-nearbyAttraction-button"),n=b.find(".edit-schedule");a.data("inPlan")?(i.addClass("hidden"),n.removeClass("hidden"),n.find(".calendarLink").attr("data-date",a.find(".in-your-plan").data("date")).attr("data-visit-id",
a.find(".in-your-plan").data("visitId")).find(".dynamic-part").html(a.data("buttonText"))):d?b.find(".start-a-plan").removeClass("hidden").attr("data-attraction-id",a.data("attractionId")):(i.removeClass("hidden"),n.addClass("hidden"),i.attr("data-attraction-id",a.data("attractionId")).attr("data-destination-id",a.data("destinationId")).attr("data-name",a.data("name")).attr("data-container-in-plan",a.data("containerInPlan")).attr("data-in-plan","false").attr("data-is-schedulable",a.data("isSchedulable")).attr("data-view-map",
"true"),g.isEditable()||i.removeClass("add-nearbyAttraction-button").addClass("claimPlanLink"));return b.html()},qtipInfoWindow:function(a){$(a.markerSpan).qtip({content:{text:a.content},style:{classes:"qtip-light qtip-shadow tip-infowindow "+(a.qtip.classes||""),tip:a.qtip.tip},position:{at:a.qtip.position.at,my:a.qtip.position.my,target:a.markerSpan,container:a.qtip.container?a.qtip.container:$(".modal-box").length&&!$(".dlg-large-map").is(":visible")?$(".modal-box .ui-dialog-content"):a.$miniMap,
adjust:a.isMinorPoint&&a.qtip.minorPoint?a.qtip.minorPoint.position.adjust:a.qtip.position.adjust},show:{ready:!0,event:!1,solo:!0},hide:a.hide||{event:"mouseout",fixed:!0},events:{hide:function(b,d){d.target.removeClass("active");d.destroy();a.events&&a.events.hide&&a.events.hide()},show:function(b,d){d.target.addClass("active");d.elements.content.parents(".qtip").addClass("zero-opacity");0===d.elements.content.siblings(".qtip-fillerDiv").length&&$('<div class="qtip-fillerDiv"></div>').insertBefore(d.elements.content);
a.events&&a.events.show&&a.events.show(d)},visible:function(b,d){function g(){n.fadeTo(100,1)}a.events&&a.events.visible&&a.events.visible(d);var n=d.elements.content.parents(".qtip");n.removeClass("zero-opacity").css("opacity",0);var k=n.offset(),h=a.$miniMap.offset(),e=a.$miniMap.width(),l=a.$miniMap.height(),e=h.left+e-(k.left+n.outerWidth()+5),e=0>e?e:0,p=0;0>k.top-h.top?(p=k.top-h.top,i(e,p-5,g,a.googleMap)):(0>k.left-h.left?(p=k.top+n.outerHeight()-(h.top+l),p=0<p?p+5:0,e=h.left-k.left+5):(p=
k.top+n.outerHeight()-(h.top+l),p=0<p?p+5:0),i(e,p,g,a.googleMap));j.initialize();m.initialize()}}}).qtip("api")}}});
define("modules/map",["modules/events","minimapHelper","jquery","qtip"],function(a,g){var d=[],p={},m={addToQueue:function(a){void 0===window.google||void 0===window.google.maps?d.push(a):a()},processQueue:function(){for(var a=d.shift();a;)a(),a=d.shift()},initializeOnLoad:function(){if("complete"===document.readyState)$.getScript("https://maps.googleapis.com/maps/api/js?sensor=false&libraries=geometry,places&language=en&callback=onGoogleMapsApiLoaded&key="+window.gmapsApiKey);else $(window).on("load",
function(){$.getScript("https://maps.googleapis.com/maps/api/js?sensor=false&libraries=geometry,places&language=en&callback=onGoogleMapsApiLoaded&key="+window.gmapsApiKey)})}};window.onGoogleMapsApiLoaded=function(){window.LabelMapMarker=function(a){var c=$(document.createElement("span")).css({position:"absolute"}).addClass("map-marker notranslate"+(a.minorPoint?" minor ":""));if(a.minorPoint)c.html('<span class="circle minor-point"></span>');else if(a.addMarkerIcon&&!a.inPlan)c.html('<span class="circle"></span><svg class="map-marker-icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-new-map-marker-not-in-plan"></use></svg>');
else{var b='<span class="circle"></span><span class="text notranslate">'+a.label+"</span>",b=b+('<svg class="map-marker-icon '+(a.inPlan?"in-plan":"not-in-plan")+'"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-new-map-marker"></use></svg>');c.html(b)}void 0!==a.stayId&&c.data("stayId",a.stayId);a.destinationId&&c.attr("data-destination-id",a.destinationId);this.span_=c[0];this.position_=a.mapPosition;this.infoWindow_=a.infoWindow;this.map_=a.map;this.controller_=a.controller;
this.eventName_=a.eventName;this.destinationId_=a.destinationId;this.markerChecked_=a.markerChecked;this.label_=a.label;this.minorPoint_=a.minorPoint};window.LabelMapMarker.prototype=new window.google.maps.OverlayView;window.LabelMapMarker.prototype.getMarkerSpan=function(){return this.span_};window.LabelMapMarker.prototype.onAdd=function(){this.getPanes().overlayMouseTarget.appendChild(this.span_);var d=this;this.infoWindow_?(this.listeners_=[window.google.maps.event.addDomListener(this.span_,"click",
function(c){void 0!==d.eventName_?a.triggerEvent("map",d.eventName_,{destinationId:d.destinationId_}):d.controller_?d.controller_.showInfoWindow(d.infoWindow_,!0,!0):d.infoWindow_.open&&d.infoWindow_.open(d.map_);if(d.controller_&&d.controller_.onClick)d.controller_.onClick();d.controller_&&c.stopPropagation()}),window.google.maps.event.addDomListener(this.span_,"mouseover",function(){d.controller_?d.controller_.showInfoWindow(d.infoWindow_,!1,!1):d.infoWindow_.open&&d.infoWindow_.open(d.map_)}),
window.google.maps.event.addDomListener(this.span_,"mousemove",function(a){a.stopPropagation()}),window.google.maps.event.addDomListener(this.map_,"mousemove",function(){d.controller_?d.controller_.hideInfoWindow(d.infoWindow_,!1):d.infoWindow_&&d.infoWindow_.close&&d.infoWindow_.close()})],d.infoWindow_ instanceof window.google.maps.InfoWindow&&this.listeners_.push(window.google.maps.event.addDomListener(this.infoWindow_,"closeclick",function(){d.controller_?d.controller_.hideInfoWindow(d.infoWindow_,
!0):d.infoWindow_.close()}))):this.listeners_=[]};window.LabelMapMarker.prototype.onRemove=function(){this.span_.parentNode.removeChild(this.span_);for(var a=0,a=0;a<this.listeners_.length;a++)window.google.maps.event.removeListener(this.listeners_[a])};window.LabelMapMarker.prototype.draw=function(){var a=this.getProjection().fromLatLngToDivPixel(this.position_),c=this.span_;c.style.left=a.x-$(c).outerWidth()/2+"px";c.style.top=a.y-$(c).outerHeight()+5+"px";c.style.display="block"};window.dottedLines=
function(a,c,b,d,g){b={path:"M 0,-1 0,1",strokeOpacity:1,strokeColor:g?g:"#000",strokeWeight:2};new google.maps.LatLng(a.data("lat"),a.data("lng"));new google.maps.LatLng(c.data("lat"),c.data("lng"));g=this.getCurvedPath(a,c,d);b=new google.maps.Polyline({path:g,strokeOpacity:0,icons:[{icon:b,offset:"0",repeat:"20px"}]});b.setMap(d);b.uniqueId=a.data("destinationId")+"_"+c.data("destinationId");return b};window.dottedLines.prototype={getCurvedPath:function(a,c,b){var a=new google.maps.LatLng(a.data("lat"),
a.data("lng")),c=new google.maps.LatLng(c.data("lat"),c.data("lng")),f=google.maps.geometry.spherical.computeDistanceBetween(a,c),g=google.maps.geometry.spherical.computeHeading(a,c),n=google.maps.geometry.spherical.computeHeading(c,a),g=google.maps.geometry.spherical.computeOffset(a,0.4*f,this.modifyLineHeading(g,a)),f=google.maps.geometry.spherical.computeOffset(c,0.4*f,this.modifyLineHeading(n,c));return new d(a,g,f,c,0.01,b)},modifyLineHeading:function(a,c){var b=25+-25/90*Math.abs(c.lat());return 0<
a?a-b:a+b}};window.drawCurve=function(a,c,b,d,g,n){var k=this.getCurvedPath(a,c,d),g=new google.maps.Polyline({path:k,geodesic:!1,strokeColor:g?g:"#000",strokeOpacity:0.57,strokeWeight:4});g.setMap(d);g.content=b;this.attachListners(g,k[Math.floor(k.length/2)],d,n);g.uniqueId=a.data("destinationId")+"_"+c.data("destinationId");return g};window.drawCurve.prototype={attachListners:function(a,c,b,d){a.content&&(window.google.maps.event.addListener(a,"mouseover",function(c){var n="overview-travel-infoWindow"+
a.uniqueId;if($("."+n).length)$("."+n).data("remainOpen",!0);else{p.close&&p.close();var k=null,h;for(h in c)if(c[h]&&c[h].clientX&&c[h].clientY){k=c[h];break}var e=$("<div />").css({top:k.clientY,left:k.clientX,position:"absolute"}).append("<div></div>").appendTo(d),c=e.find("div");g.qtipInfoWindow({markerSpan:c,content:a.content,$miniMap:d,googleMap:b,qtip:g.iconQtip({classes:n}),hide:{event:!1,fixed:!0},events:{hide:function(){e.remove()},visible:function(a){var b=a.elements.content.parents(".qtip"),
c=$(".dlg-large-map").length?$(".dlg-large-map"):void 0,d=b.position().top-(c?c.position().top:0),c=b.position().left-(c?c.position().left:0);b.css("top",d).css("left",c);a.elements.content.off("mouseover.qtip").on("mouseover.qtip",function(){$("."+n).data("remainOpen",!0)})}}})}}),window.google.maps.event.addListener(a,"mouseout",function(){var b="overview-travel-infoWindow"+a.uniqueId;$("."+b).length&&$("."+b).data("remainOpen",!1);setTimeout(function(){$("."+b).length&&!$("."+b).data("remainOpen")&&
$("."+b).data("qtip").hide()},1500)}))},getCurvedPath:function(a,c,b){var a=new google.maps.LatLng(a.data("lat"),a.data("lng")),c=new google.maps.LatLng(c.data("lat"),c.data("lng")),f=google.maps.geometry.spherical.computeDistanceBetween(a,c),g=google.maps.geometry.spherical.computeHeading(a,c),n=google.maps.geometry.spherical.computeHeading(c,a),g=google.maps.geometry.spherical.computeOffset(a,0.4*f,this.modifyLineHeading(g,a)),f=google.maps.geometry.spherical.computeOffset(c,0.4*f,this.modifyLineHeading(n,
c));return new d(a,g,f,c,0.01,b)},modifyLineHeading:function(a,c){var b=25+-25/90*Math.abs(c.lat());return 0<a?a-b:a+b},getAngle:function(a,c){return a*c},addMarker:function(a,c,b){new google.maps.Marker({position:a,label:b,map:c})},drawLine:function(a,c,b){a=[{lat:a.lat(),lng:a.lng()},{lat:c.lat(),lng:c.lng()}];(new window.google.maps.Polyline({path:a,geodesic:!1,strokeColor:"#0000FF",strokeOpacity:1,strokeWeight:4})).setMap(b)}};var d=function(a,c,b,d,g){var n=a.lat(),a=a.lng(),k=c.lat(),c=c.lng(),
h=b.lat(),b=b.lng(),e=d.lat(),l=d.lng(),d=[];if((0<a&&(c>a||0>c)&&0>l&&(b<l||0<b)||0<l&&(b>l||0>b)&&0>a&&(c<a||0<c))&&(90<a||-90>a||90<l||-90>l))0>b&&(b=360+b),0>l&&(l=360+l),0>a&&(a=360+a),0>c&&(c=360+c);for(var j=0;1>=j;j+=g)d.push(this.getBezier({x:n,y:a},{x:k,y:c},{x:h,y:b},{x:e,y:l},j));g=[];for(k=0;k<d.length;k++)180<d[k].y&&(d[k].y-=360),g.push(new google.maps.LatLng(d[k].x,d[k].y));g.push(new google.maps.LatLng(n,a));return g};d.prototype={B1:function(a){return a*a*a},B2:function(a){return 3*
a*a*(1-a)},B3:function(a){return 3*a*(1-a)*(1-a)},B4:function(a){return(1-a)*(1-a)*(1-a)},getBezier:function(a,c,b,d,g){var n={};n.x=a.x*this.B1(g)+c.x*this.B2(g)+b.x*this.B3(g)+d.x*this.B4(g);n.y=a.y*this.B1(g)+c.y*this.B2(g)+b.y*this.B3(g)+d.y*this.B4(g);return n}};m.processQueue()};return m});define("text%21templates/exploreDestinationMapQtip.html",[],function(){return'<!DOCTYPE html>\n<\!--\n Copyright (c) 2012-2017, Inspirock Corporation.\n All rights reserved.\n--\>\n\n    <a href="javascript:void(0);" class="destinationDetailsLink photo-div" data-event-src="browse-results">\n\n    </a>\n    <div class="search-item-data">\n        <div class="title">\n            <span class="destinationDetailsLink clickable-text" data-event-src="browse-results"></span>\n        </div>\n        <div class="rating-stars">\n            <span class="rating-stars-fill"></span>\n        </div>\n        <div class="tags-and-tours hidden">\n            <div class="tags-destinations">\n                <span class="tag"></span>\n            </div>\n        </div>\n    </div>\n    <p class="description">\n    </p>\n    <div class="add-destination hidden">\n        <button class="cta-button small"  data-event-src="claim-plan-itinerary-read">Add to plan</button>\n    </div>\n    <div class="edit-schedule hidden">\n        <button class="slot-time-range cta-button large" type="button" data-event-src="explore.destination-details.info.edit">In your plan <span class="dynamic-part"></span></button>\n    </div>\n    <div class="start-a-plan hidden">\n        <button class="startideaplan cta-button small"  data-event-src="claim-plan-itinerary-read">Start a plan</button>\n    </div>'});
define("jQueryExtensions/linkToCalendarAndMap",["modules/utils","jquery","jqueryui"],function(a){$.fn.linkToCalendarAndMinimap=function(g){var d=$(this),p=g.staySelector,m=g.stayListTitleSelector,j=g.stayListHighlightedClass,i=g.$calendar,c=g.$minimap,b=g.onlyHighlightedInteractive,f=g.highlightColor||"#009cde",u=g.listKey||"stayId",n=g.mapKey||"destinationId",k=g.calendarKey||"stayId",h=function(a){void 0!==i&&i.find(".stay").each(function(){var b=$(this);void 0!==b.data(k)&&b.data(k)===a&&b.addClass("highlighted")})},
e=function(a){void 0!==i&&i.find(".stay").each(function(){var b=$(this);void 0!==b.data(k)&&b.data(k)===a&&b.removeClass("highlighted")})},l=function(a){var b=c.data("infoWindowController");b&&b.highlightStay(a)},t=function(a){var b=c.data("infoWindowController");b&&b.unhighlightStay(a)},r,q=function(a,b){var c;d.find(p).each(function(){if($(this).data(u)===a&&$(this).is(":visible"))return c=$(this),!1});void 0!==c&&(j?c.addClass(j):m&&c.find(m).css({color:f}),b&&(r=c))},D=function(b,c){var e,h;d.find(p).each(function(a){if($(this).data(u)===
b&&$(this).is(":visible"))return e=$(this),h=a,!1});if(void 0!==e&&(c||!r||r&&e.data(u)!==r.data(u)))e.find(".marker").css({"background-color":a.getColor(h)}),j?e.removeClass(j):m&&e.find(m).css({color:""});c&&(r=void 0)};d.off("mouseenter.linkToCalendarAndMinimap").on("mouseenter.linkToCalendarAndMinimap",p,function(){$(this).data(u);var a=$(this).data(k),b=$(this).data(n);h(a);l(b,!1)});d.off("mouseleave.linkToCalendarAndMinimap").on("mouseleave.linkToCalendarAndMinimap",p,function(){$(this).data(u);
var a=$(this).data(k),b=$(this).data(n);e(a);t(b,!1)});void 0!==i&&(i.off("mouseenter.linkToCalendarAndMinimap").on("mouseenter.linkToCalendarAndMinimap",".stay",function(){var a=$(this).data(u),c=$(this).data(k),d=$(this).data(n);if(void 0!==a&&void 0!==c&&void 0!==d&&(!b||$(this).hasClass("highlight")))q(a),h(c),l(d)}),i.off("mouseleave.linkToCalendarAndMinimap").on("mouseleave.linkToCalendarAndMinimap",".stay",function(){var a=$(this).data(u),c=$(this).data(k),d=$(this).data(n);if(void 0!==a&&
void 0!==c&&void 0!==d&&(!b||$(this).hasClass("highlight")))D(a),e(c),t(d)}));c.data("onInfoWindowShow",function(a,b,c){if(void 0===a||null===a)a=b;q(a,c);h(a);l(b,c)});c.data("onInfoWindowHide",function(a,b,c){if(void 0===a||null===a)a=b;D(a,c);e(a);t(b,c)})}});
define("jQueryExtensions/pager",["jquery","touchSwipe"],function(){$.fn.preparePaging=function(a,g){function d(){var d=parseInt(j.data("currentPage"),10),h=a.find(".prev-page"),e=a.find(".next-page");0===d||0===c?h.addClass("disabled").removeAttr("title"):h.removeClass("disabled").attr("title",b);d===c-1||0===c?e.addClass("disabled").removeAttr("title"):e.removeClass("disabled").attr("title",f)}function p(){if(!$(this).hasClass("disabled")){var a=parseInt(j.data("currentPage"),10);!(a>=i.length-1)&&
!j.is(":animated")&&(j.animate({marginLeft:100*-(a+1)+"%"}),j.data("currentPage",a+1),d(),g&&j.height(i.eq(a+1).outerHeight()))}}function m(){if(!$(this).hasClass("disabled")){var a=parseInt(j.data("currentPage"),10);!(0>=a)&&!j.is(":animated")&&(j.animate({marginLeft:100*-(a-1)+"%"}),j.data("currentPage",a-1),d(),g&&j.height(i.eq(a-1).outerHeight()))}}var j=$(this),i=j.find(".page"),c=i.length,b,f;j.width(100*c+"%");0<c&&i.css({width:100/c+"%"});if(a.length){var u=a.find(".prev-page"),n=a.find(".next-page");
b=u.attr("title");f=n.attr("title")}j.swipe({swipeLeft:p,swipeRight:m,threshold:0,preventDefaultEvents:!1});a.find(".next-page").off("click").on("click",p);a.find(".prev-page").off("click").on("click",m);d()}});
define("explore/exploreDestinations","modules/analytics modules/analyticsEventParams modules/ajax modules/events modules/copyright modules/lazyload plan/loading plan/stay modules/history modules/modal modules/utils modules/map minimapHelper text!templates/exploreDestinationMapQtip.html jquery jqueryui qtip jQueryExtensions/linkToCalendarAndMap jQueryExtensions/pager".split(" "),function(a,g,d,p,m,j,i,c,b,f,u,n,k,h){return function(e,l,i){function r(){var a=$(this);c.add.bind(a)(null,{destinationData:{view:"exploreDestinations",
viewDestinationId:z.find(".selected-destination").data("destinationId"),domainId:z.find(".selected-destination").data("destinationId")},EVENT_SOURCE:B,analyticsCategory:"explore.filter-results",dontpopulate:!0,success:function(b,c){var d=$(b),e=d.find('.explore-view-destination-row[data-destination-id="'+c+'"]'),h=G.find('.block[data-destination-id="'+c+'"]'),f=G.find('.destination-row .add-to-plan[data-destination-id="'+c+'"]');h.data("inPlan",!0);w.find(".stay-rows").html(d.filter(".stay-rows").html());
$(".tip-infowindow").qtip("hide",!0);a.after('<span class="secondary-text-link calendarLink" data-date="'+e.data("date")+'">In your plan</span>');a.remove();f.length&&(f.after('<span class="secondary-text-link calendarLink" data-date="'+e.data("date")+'">In your plan</span>'),f.remove());y.onPageChange()}})}function q(a,b,c,d){var e;d&&d.$mapMarkerDataHolders&&d.$mapMarkerDataHolders.length?e=d.$mapMarkerDataHolders:(e=w.find(".block.destination"),e=$.merge(w.find(".explore-view-destination-row"),
e));w.find(".explore-view-destination-row").each(function(a,b){var c=$(b);w.find('.block.destination[data-destination-id="'+c.data("destinationId")+'"]').length&&c.data("ignoreBounds",!1)});a=a?a:G.find("#destinations");if(d)d.$mapMarkerDataHolders=e,d.bounds=b,d.center=c,d.analyticsCategory=g.CAT_EXPLORE_DEST_DESTS,d.donotChangeBounds=void 0!==b,a.prepareMiniMap(d);else{var f=[],l=[];e.each(function(a,b){f.push($(b).data("destinationId"));l.push($(b).data("showDirections"))});a.prepareMiniMap({$rootView:G,
$mapMarkerDataHolders:e,showMarkerLabel:!1,nonInteractive:!0,showDirections:!0,showAddMarkerIcon:!0,bounds:b,enlargeMap:!0,uniqueId:"explore-destination-main-map",strokeColor:"#000",dottedLines:!0,showInfoWindowAsQtip:!0,circularMarker:!0,qtip:k.iconQtip(),analyticsCategory:g.CAT_EXPLORE_DEST_DESTS,modalDataUrl:"/destination-map-modal-data?destinationIds="+f.join(",")+"&showDirections="+l.join(",")+"&planId="+$("#plan").data("planId"),modalDataSelector:".destination",filter:function(a,b){var c=0,
d=$.grep(a,function(a){a=$(a);if(14===c||a.data("inPlan"))return a.data("minorPoints",!1),!1;if(!b||b.contains(new window.google.maps.LatLng({lat:parseFloat(a.data("lat")),lng:parseFloat(a.data("lng"))})))return c++,a.data("minorPoints",7<c),!0;a.data("minorPoints",!1);return!1}),d=$.merge(w.find(".explore-view-destination-row"),d);return $(d)},content:function(a){return a.$dataHolder.data("name")},boundsChanged:function(a,b,c,d){b&&q(a,b,c,d)},modalOverides:{nonInteractive:!1,qtip:k.destinationDetailsQtip(),
enlargeMap:!1,scrollwheel:!0,showMinorPointDetails:!0,content:function(a){var b=$("<div />").append(h);return k.destinationDetailsContents(a.$dataHolder,b)}}})}}function D(c,e,h,g,l,n,k,i,p){e={domainId:c,destinationsmaxNumResults:J,destinationspageIndex:k,destinationscategoryFilters:e,destinationscategoryGroupFilters:h,destinationsotherFilters:g,destinationsplanDestinationFilters:l,destinationshideInPlan:n};c={requestData:$.extend(!0,{dontScrollToTop:!0},e),isModal:f.isOpen(),domainId:c,tab:f.getTab(),
modal:"explore"};e.destinationsaction=i;i=$.extend({},c.requestData);p&&(i.destinationsmaxNumResults=J+z.find(".popular-destinations").find(".block.destinationDetailsLink:not(.hidden)").length,i.destinationspageIndex=0,i.view="full",c.requestData=i);i=u.getPlanUrl()+"/explore/destinations?"+$.param(c.requestData);f.isOpen()?(i=u.planTabUrl()+"/modal/explore/destinations?"+$.param(c.requestData),f.pushHistory("browseDestinations",f.getTab(),i,c,p)):p?b.replace("browseDestinations","explore",i,c):b.push("browseDestinations",
"explore",i,c);$(this).addClass("active");var q=function(){var b=!w.find(".blocks .block:not(.hidden)").length?F:J;w.find(".blocks .block.hidden").each(function(a,c){if(a===b)return!1;$(c).removeClass("hidden")});m.initialize();w.find(".load-more").toggleClass("hidden",!w.find(".blocks .block.hidden").length||25<=w.find(".blocks .block:not(.hidden)").length);var c=$("#analytics-metadata"),d=$("#destination-analytics-metadata");a.setPageTypeNew(c.data("pageTypeNew")+" : destination details : destinations");
a.setEntityType(d.data("entityType"));a.setEntity(d.data("entity"));a.trackPageView("/plan/explore/destination/destinations");C.find(".show-more.regions").toggleClass("hidden",r);r&&C.find("#filter-browse-region-type label").removeClass("hidden");j.initialize()},r=C.find(".show-more.regions").hasClass("hidden"),t=null;"filter-click"===e.destinationsaction?d.makeAJAXcall({type:"GET",url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/explore/destinations",data:e,complete:function(){w.find(".more-filters").addClass("hidden")},
success:function(a){t=$(a);w.find(".blocks").html(t.filter(".blocks").html());q()}}):q()}function v(){var a,b,c,d=$(this).parents(".search-item-data").data("destinationId");$(this).data("catId")?a=[$(this).data("catId")]:$(this).data("catGroupId")?b=[$(this).data("catGroupId")]:$(this).data("filterKey")&&(c=[$(this).data("filterKey")]);$(".tip-infowindow").qtip("hide",!0);$(".tip-infowindow").qtip("hide",!0);p.triggerEvent("details","goto-selected-tag-places",{catGroupIds:b,catIds:a,otherIds:c,destinationId:d,
tab:"explore"});$(".dlg-large-map .ui-dialog-content").dialog("close")}var B="explore-destinations",z,C,G,M,w,J=7,F=7,y=this;y.contents=function(a){w.html(a.find("#destinations").html());w.toggleClass("hidden",a.find("#destinations").hasClass("hidden"));y.onPageChange()};y.onPageChange=function(){n.addToQueue(q);j.initialize();i.onPageChange()};y.initialize=function(){if(!w||!w.length){w=z.find("#destinations");C=z.find(".explore-attractions-left-pane");G=z.find(".explore-main-pane");M=z.find("#exploreSubnavPane");
if(!w||0===$.trim(w.html()).length)return;$("body").off("click.explore_add-dest").on("click.explore_add-dest","#destinations .add-button, #destinations .add-to-plan,\n                     .dlg-large-map .add-button",r);$("body").off("click.explore_tag").on("click.explore_tag",".tags-destinations .tag",v);G.off("mouseover.load-more-destinations").on("mouseover.load-more-destinations",".destination-row .destination-name",function(){G.find('.map-marker[data-destination-id="'+$(this).data("destinationId")+
'"]').addClass("active")});G.off("mouseleave.load-more-destinations").on("mouseleave.load-more-destinations",".destination-row .destination-name",function(){G.find('.map-marker[data-destination-id="'+$(this).data("destinationId")+'"]').removeClass("active")});G.off("click.load-more-destinations").on("click.load-more-destinations",".load-more.destinations",function(){a.trackEvent(g.CAT_EXPLORE_DEST_DESTS,g.ACT_LOAD_MORE);J=9;var b=$(this).data("nextPageIndex"),c=M.find(".selected-destination").data("destinationId"),
d=G.find("#filter-destination-type"),e=d.find("input[type=checkbox]:checked").filter(".cat").map(function(){return parseInt(this.value,10)}).get(),h=d.find("input[type=checkbox]:checked").filter(".catgroup").map(function(){return parseInt(this.value,10)}).get(),d=d.find("input[type=checkbox]:checked").filter(".filterkey").map(function(){return this.value}).get(),f=C.find("#filter-browse-region-type").find("input[type=checkbox]:checked").filter(".filterkey").map(function(){return this.value}).get(),
l=C.find(".hide-destinations-in-plan").length?C.find(".hide-destinations-in-plan").is(":checked"):!0;D(c,e,h,d,f,l,b,"load-more",!0,void 0)});G.off("click.see-more-destinations").on("click.see-more-destinations",".see-more-destinations",function(){(f.isOpen()?$(".modal-box .ui-dialog-content"):$("body")).animate({scrollTop:G.find(".popular-destinations").position().top+40},300)})}y.onPageChange()};z=e;y.initialize()}});
define("explore/exploreSearch",["modules/analytics","modules/analyticsEventParams","modules/ajax","jquery","jqueryui"],function(a,g,d){return function(p){var m,j,i,c=[];this.onPageChange=function(){j=m.find(".explore-search-pane");i=j.find("#explore-search");c=[];var b={},f=m.find(".selected-destination").data("destinationId");m.find("#destinations .stay-rows .explore-view-destination-row, #attractions .plan-destinations-filter-type .destinationDetailsLink").each(function(a,d){var e=$(d),h=e.data("name"),
g=e.data("destinationId"),l=e.data("disambiguationPath");!b[g]&&(!1!==e.data("inPlan")&&f!==g)&&(c.push({id:g,label:h,value:h,description:l,selectable:!0,category:"destination"}),b[g]=1)});if(j.length&&j.is(":visible")){i.siblings(".icon-search").off("click.icon-search").on("click.icon-search",function(){i.parents(".explore-subnav-pane").addClass("show-input");i.parents(".explore-subnav-pane").find(".selected-destination");setTimeout(function(){i.focus()},310)});var p={},n,k={id:void 0,label:"Start typing...",
nightstay:!1,value:void 0,selectable:!1};k.li="<li>"+k.label+"</li>";var h={id:void 0,label:"Type another character...",nightstay:!1,value:void 0,selectable:!1};h.li="<li>"+h.label+"</li>";var e={id:void 0,label:"Searching...",nightstay:!1,value:void 0,selectable:!1};e.li="<li>"+e.label+"</li>";var l={id:void 0,label:"Sorry, We did not recognize this place.",nightstay:!1,value:void 0,selectable:!1,className:"invalid-input"};l.li="<li>"+l.label+"</li>";if(i.data("uiAutocomplete"))try{i.autocomplete("destroy"),
i.removeData("uiAutocomplete")}catch(t){}i.autocomplete({minLength:0,appendTo:j.find(".search-area"),position:{my:"right top",at:"right bottom",offset:"-1 0"},source:function(a,b){var f=a.term;if(p.hasOwnProperty(f))b(p[f]);else if(0===f.length)c.length?b(c):b([k]);else if(1===f.length)b([h]);else{b([e]);a.tab="explore";var g=$("#plan").data("planId")?"/trip/"+$("#plan").data("planId"):"";d.makeAJAXcall({url:window.contextPath+g+"/searchAutocomplete",type:"GET",data:a,success:function(a){try{if(a=
JSON.parse(a),p[f]=a,0===a.length)b([l]);else{for(var c=0;c<a.length;c++)a[c].selectable=!0;b(a)}}catch(d){}}})}},search:function(){var b=i.val().trim();2<=b.length&&(n&&window.clearTimeout(n),n=window.setTimeout(function(){a.trackEvent(g.CAT_EXPLORE_SEARCH,"query",b);n=null},1E3));return!0},select:function(a,b){(a.keyCode===$.ui.keyCode.ENTER||a.keyCode===$.ui.keyCode.TAB)&&$("#search-"+b.item.id).trigger("click");return!1},focus:function(a,b){b.item.selectable||a.preventDefault()},close:function(){},
response:function(){}}).off("focus.inspirockAutoComplete").on("focus.inspirockAutoComplete",function(){!i.val()&&i.parents(".explore-subnav-pane").hasClass("show-input")&&i.autocomplete("search","")}).off("blur.inspirockAutoComplete").on("blur.inspirockAutoComplete",function(){i.parents(".explore-subnav-pane").removeClass("show-input")}).data("uiAutocomplete")._renderItem=function(a,b){var c=RegExp(this.term.replace(" ","|"),"gi"),d;if(!b.category)return c=$(b.li).html(),d=b.id?"":" invalid-data",
$(b.li).empty().addClass("ui-menu-item").addClass(b.id?"":"nonselectable").attr("role","presentation").attr("data-value",b.value).append(!b.selectable?$('<span class="nonselectable menu-list">'+c+"</span>").addClass(b.className?b.className:""):$("<a class="+d+">"+c+"</a>").addClass("ui-corner-all").addClass("menu-list")).appendTo(a);"destination"===b.category?d='<a id="search-'+b.id+'" class="destinationDetailsLink menu-list" data-destination-id="'+b.id+'" data-link="'+window.contextPath+b.url+'" data-event-src="search"><div class="icon-wrap"><svg class="explore-search-icon '+
b.category+'"><use xlink:href="#icon-map-marker" /></svg></div><div class="info"><span class="search-label">'+b.label.replace(c,"<strong>$&</strong>")+"</span>":"attraction"===b.category&&(d='<a id="search-'+b.id+'" class="attractionDetailsLink menu-list" data-link="'+window.contextPath+b.url+'" data-event-src="search"><div class="icon-wrap"><svg class="explore-search-icon '+b.category+'"><use xlink:href="#icon-binocs" /></svg></div><div class="info"><span class="search-label">'+b.label.replace(c,
"<strong>$&</strong>")+"</span>");b.description&&(d+='<div class="search-desc">,&nbsp;'+b.description+"</div>");b.tags&&b.tags.length&&(d+='<span class="tags-attractions"><span class="tag">'+b.tags[0]+"</span></span>");c=$(d?d+'</div><div class="clear"></div></a>':'<div class="clear"></div>');return $("<li>").append(c).appendTo(a)};i.data("uiAutocomplete")._renderMenu=function(a,b){var c=this;$.each(b,function(b,d){c._renderItemData(a,d)});$(a).removeClass("ui-corner-all").addClass("explore")}}};
m=p;this.onPageChange()}});
define("modules/sojern",[],function(){return{trackPixel:function(a,g){if(window.sojernPartnerKey){g.rl=window.stid;var d=$("#plan");d.length&&(g.t=d.data("numAdults")+d.data("numKids")+d.data("numTeens"));var d=[],p=document.createElement("script"),m;for(m in g){var j=g[m];void 0!==j&&(null!==j&&""!==j)&&d.push(m+"="+encodeURIComponent(j))}p.type="text/javascript";p.async=!0;p.src="https://pixel.sojern.com/partner/"+window.sojernPartnerKey+"/"+a+"?"+d.join("&");(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(p)}}}});
define("modules/hotelbooking","modules/analytics modules/analyticsEventParams modules/ajax modules/events modules/dateRange modules/utils moment modules/sojern jquery".split(" "),function(a,g,d,p,m,j,i,c){var b={findHotel:function(a,c,d,h,e,f,g,i){1===a.length?(a=a.eq(0),b.logBookingEvent(c,d,a.data("bookingUrl"),h,e,f),b.openBookingURL(a,e,f)):1<a.length&&g.qtip({overwrite:!0,content:{text:a.clone()},position:{my:"top left",at:"bottom left",effect:!1,target:g,container:i,adjust:{x:0,y:0,scroll:!1}},
show:{event:!1,ready:!0},hide:{event:"unfocus",fixed:!0,effect:!1},events:{show:function(a,g){g.elements.content.find(".booking-option").off("click.booking-option").on("click.booking-option",function(){var a=$(this);b.logBookingEvent(c,d,a.data("bookingUrl"),h,e,f);b.openBookingURL(a,e,f);g.hide()})}},style:{classes:"wts-tip qtip-light qtip-shadow",tip:{corner:!1,width:20,height:10,mimic:"center top"}}})},logBookingEvent:function(b,f,k,h,e,l){var m=document.createElement("a");m.setAttribute("href",
k);a.trackEvent(g.CAT_BOOK_PLAN,g.ACT_BOOK_PLAN,m.hostname);a.trackEvent(b,g.ACT_BOOK_PLAN,f.toLowerCase());p.triggerEvent(b,"mmt_track_link",{linkName:"Find a Hotel"});p.triggerEvent(b,"australia_track_find_hotel",{destinationName:f});if(window.fbGoal3Count)for(b=0;b<fbGoal3Count;b++)fbq("track","ViewContent",{content_name:"Goal 3"});b=a.getClientId();d.makeAJAXcall({url:window.contextPath+"/trackHotelSearchClick",type:"GET",data:{gaClientId:b,bookingUrl:k,planId:$("#plan").data("planId")}});k=i(e);
l=i(l);c.trackPixel("hs",{hd1:k.format(j.ISO_DATE_FORMAT),hd2:l.format(j.ISO_DATE_FORMAT),hc1:f,hn1:h})},openBookingURL:function(a,b,c){var d=a.data("bookingUrl"),e=a.data("bookingCheckinDateFormat"),f=a.data("bookingCheckoutDateFormat"),g=a.data("bookingNightsFormat"),a=a.data("travelerDetails"),j=i(b),m=i(c),e=j.format(e);g&&(b&&c)&&(j=i.duration(m.diff(j,"days",!0)),d=d+e+g+j);f&&(b&&c)&&(b=m.format(f),d=d+e+b);window.open(d+(a?a:""),"_blank")}},f=function(a){var c=$(this).parents(".booking-area"),
d=c.find(".startDate").data("date"),f=c.find(".endDate").data("date");b.logBookingEvent(a,c.data("name"),c.data("bookingUrl"),c.data("countryCode"),d,f);b.openBookingURL(c,d,f)};b.initializeWhereToStay=function(a,b,c,d){b.each(function(){var a=$(this),b=a.find(".startDate"),a=a.find(".endDate");m.prepareDateRange(b,a,60,{$startAltField:b.siblings(".startDate-alt"),$endAltField:a.siblings(".endDate-alt"),altFieldDateFormat:window.dateFormatDisplayPattern,showOpenDateRange:!0,minDate:"+0d",dateFormat:"yy-mm-dd",
container:c?c.container:""})});a.find(".desc").readMore(a.find(".read-more"),a.find(".read-less"));a.off("click.find-hotel").on("click.find-hotel",".find-hotel-button",function(){f.bind($(this))(d)})};return b});
define("modules/viator","modules/analytics modules/analyticsEventParams modules/ajax modules/utils modules/copyright modules/sojern".split(" "),function(a,g,d,p,m,j){function i(){var b=$(this).data("eventCategory");$(this).attr("href")?c.viatorTourLinkClick(b,{tourUrl:$(this).attr("href")}):d.makeAJAXcall({url:"/tickets/"+$(this).data("attractionId"),data:{},type:"GET",success:function(c){var d=$("<div>");d.html(c);a.trackEvent(b,g.ACT_SHOW_VIATOR_TICKETS);d.find(".ticketLink").attr("data-event-category",
b+".ticket-dialog");d.dialog({resizable:!1,modal:!0,draggable:!1,title:"<strong>Attraction tickets</strong>",width:"660px",dialogClass:"dlg-attraction-tickets mediumx",open:function(){p.setupDialogOverlay(d,!1);d.dialog({position:{my:"center",at:"center",of:window}});m.initialize()},close:function(){d.dialog("destroy").remove()}})}})}var c={viatorTourLinkClick:function(b,c){a.trackEvent(b,"viator-tour-link",c.tourUrl);var g=a.getClientId();d.makeAJAXcall({type:"GET",url:window.contextPath+"/trackViatorLinkClick",
data:{gaClientId:g,planId:$("#plan").data("planId"),targetUrl:c.tourUrl}});c.tourName&&(g={},g.vb=c.tourName,g.vf1=c.destinationName,g.vn1=c.destinationCountry,j.trackPixel("vtk",g))},initialize:function(){$("body").off("click.ticket-module").on("click.ticket-module",".ticket-module",i);$("body").off("click.ticket-link").on("click.ticket-link",".ticketLink",function(){var a=$(this).parents(".attraction-ticket"),d=$(this).data("url")||a.data("url"),g={tourUrl:d};g.tourName=a.find(".name").text().trim();
g.destinationName=$(".destination-details,.attraction-details").data("destinationName");g.destinationCountry=$(".destination-details,.attraction-details").data("countryCode");a=$(this).data("eventCategory");window.open(d,"_blank");c.viatorTourLinkClick(a,g)})}};return c});
(function(a){a.fancybox.helpers.thumbs={defaults:{width:50,height:50,position:"bottom",source:function(g){var d;g.element&&(d=a(g.element).find("img").attr("src"));!d&&("image"===g.type&&g.href)&&(d=g.href);return d}},wrap:null,list:null,width:0,init:function(g,d){var p=this,m,j=g.width,i=g.height,c=g.source;m="";for(var b=0;b<d.group.length;b++)m+='<li><a style="width:'+j+"px;height:"+i+'px;" href="javascript:jQuery.fancybox.jumpto('+b+');"></a></li>';this.wrap=a('<div id="fancybox-thumbs"></div>').addClass(g.position).appendTo("body");
this.list=a("<ul>"+m+"</ul>").appendTo(this.wrap);a.each(d.group,function(b){var g=d.group[b],n=c(g);n&&a("<img />").on("load",function(){var c=this.width,d=this.height,e,g,n;p.list&&(c&&d)&&(e=c/j,g=d/i,n=p.list.children().eq(b).find("a"),1<=e&&1<=g&&(e>g?(c=Math.floor(c/g),d=i):(c=j,d=Math.floor(d/e))),a(this).css({width:c,height:d,top:Math.floor(i/2-d/2),left:Math.floor(j/2-c/2)}),n.width(j).height(i),a(this).hide().appendTo(n).fadeIn(300))}).attr("src",n).attr("title",g.title)});this.width=this.list.children().eq(0).outerWidth(!0);
this.list.width(this.width*(d.group.length+1)).css("left",Math.floor(0.5*a(window).width()-(d.index*this.width+0.5*this.width)))},beforeLoad:function(a,d){2>d.group.length?d.helpers.thumbs=!1:d.margin["top"===a.position?0:2]+=a.height+15},afterShow:function(a,d){if(this.list)this.onUpdate(a,d);else this.init(a,d);this.list.children().removeClass("active").eq(d.index).addClass("active")},onUpdate:function(g,d){this.list&&this.list.stop(!0).animate({left:Math.floor(0.5*a(window).width()-(d.index*this.width+
0.5*this.width))},150)},beforeClose:function(){this.wrap&&this.wrap.remove();this.list=this.wrap=null;this.width=0}}})(jQuery);define("fancybox-thumbs",["fancybox","jquery"],function(){});
define("modules/fancybox",["jquery","fancybox","fancybox-thumbs"],function(){function a(a,g,j,i,c){a.toggleClass("disabled",j.group.length<=d||0===i);g.toggleClass("disabled",j.group.length<=d||i===-((j.group.length-d)*c))}var g={},d=8;g.initialize=function(g,m){m&&(d=4);var j=$.fancybox.helpers.thumbs.init,i=$.fancybox.helpers.thumbs.beforeClose;$.fancybox.helpers.nav={onUpdate:function(a,c){1<c.group.length&&(this.left=this.left||$('<div id="fancy-left"><i class="arrow left"></i></div>').appendTo("body"),
this.right=this.right||$('<div id="fancy-right"><i class="arrow right"></i></div>').appendTo("body"),this.left.off("click").on("click",function(){$.fancybox.prev()}),this.right.off("click").on("click",function(){$.fancybox.next()}));this.close=this.close||$('<div id="fancy-close"></div>').appendTo("body");this.close.off("click").on("click",function(){$.fancybox.close()})},beforeClose:function(){this.close&&(this.close.remove(),this.close=null);this.left&&(this.left.remove(),this.right.remove(),this.right=
this.left=null)}};$.fancybox.helpers.thumbs.init=function(b,c){j.call(this,b,c);if(this.wrap){this.list.find("li a").each(function(a){$(this).attr("href")&&$(this).removeAttr("href").click(function(){$.fancybox.jumpto(a)})});this.prev=this.prev||$('<div id="thumb-prev"><i class="arrow left"></i></div>').appendTo("body");this.next=this.next||$('<div id="thumb-next"><i class="arrow right"></i></div>').appendTo("body");var g=this;this.prev.off("click").on("click",function(){if(!$(this).hasClass("disabled")){var b=
$(g.list).find("li").outerWidth(!0),k=parseInt(g.list.css("margin-left")),k=Math.abs(k/b),k=-Math.max(0,k-d/2)*b;g.list.stop(!0).animate({"margin-left":k},150);a(g.prev,g.next,c,k,b)}});this.next.off("click").on("click",function(){if(!$(this).hasClass("disabled")){var b=$(g.list).find("li").outerWidth(!0),k=parseInt(g.list.css("margin-left")),k=Math.abs(k/b),k=-Math.min(c.group.length-d,k+d/2)*b;g.list.stop(!0).animate({"margin-left":k},150);a(g.prev,g.next,c,k,b)}})}};$.fancybox.helpers.thumbs.beforeClose=
function(a,c){i.call(this,a,c);this.prev&&(this.prev.remove(),this.next.remove(),this.next=this.prev=null)};$.fancybox.helpers.thumbs.onUpdate=function(b,c){if(this.list){var g=$(this.list).find("li").outerWidth(!0),n=parseInt(this.list.css("margin-left")),k=Math.abs(n/g),h=k+d-1,e=Math.floor(-(c.index*g)),e=Math.max(Math.floor(-(c.group.length-d)*g),e),l=n;c.index<k?l=e:c.index>h&&(l=n-(c.index-h)*g);l!==n&&this.list.stop(!0).animate({"margin-left":l},150);a(this.prev,this.next,c,l,g)}};var c=$(window).scrollTop();
g.find(".fancybox").fancybox({prevEffect:"fade",nextEffect:"fade",prevSpeed:400,nextSpeed:300,type:"image",padding:0,margin:0,maxWidth:"90%",helpers:{overlay:{locked:!1,css:{background:"rgba(51, 51, 51, 0.95)"}},thumbs:{width:58,height:58,source:function(a){a=a.element.find("div,img").eq(0);if(a.is("div")){var a=a.css("background-image"),c=a.indexOf('"')+1,d=a.lastIndexOf('"');return a.substr(c,d-c)}return a.attr("src")}},nav:!0},tpl:{wrap:'<div class="fancybox-wrap" tabIndex="-1"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div><div class="credits hidden"></div></div></div>'},
beforeLoad:function(){$(this.wrap).length&&$(this.wrap).find(".credits").addClass("hidden")},afterLoad:function(a){var f=a.element.find("div,img").eq(0);f.length&&f.is("div")&&f.find("svg").length?$(this.wrap).find(".credits").addClass("hidden"):f.length&&f.is("img")&&0<=f.attr("src").indexOf("../../../no-image-graphic.html")?$(this.wrap).find(".credits").addClass("hidden"):f.length&&$(this.wrap).length&&f.data("artist")?(a=f.data("artist"),f=f.data("sourceUrl"),$(this.wrap).find(".credits").html('Photo by <a href="'+
f+'" class="artist" rel="nofollow noopener" target="_blank">'+a+"</a>"),g.find(".fancybox").length>d&&($(this.wrap).find(".previous").removeClass("hidden"),$(this.wrap).find(".next").removeClass("hidden"))):$(this.wrap).length&&($(this.wrap).find(".credits").addClass("hidden"),g.find(".fancybox").length>d&&($(this.wrap).find(".previous").removeClass("hidden"),$(this.wrap).find(".next").removeClass("hidden")));$("#pageWrapper").css("top",-c).addClass("fancybox-open")},onUpdate:function(){$(this.wrap).find(".credits").removeClass("hidden").appendTo($(this.wrap).find(".fancybox-title"))},
afterClose:function(){$("#pageWrapper").css("top","").removeClass("fancybox-open");$(window).scrollTop(c)}})};return g});define("text%21templates/exploreAttractionMapQtip.html",[],function(){return'<!DOCTYPE html>\n<\!--\n Copyright (c) 2012-2017, Inspirock Corporation.\n All rights reserved.\n--\>\n<a href="javascript:void(0);" class="attractionDetailsLink photo-div" data-event-src="browse-results">\n\n</a>\n<div class="search-item-data">\n    <div class="title">\n        <span class="attractionDetailsLink clickable-text" data-event-src="browse-results"></span>\n    </div>\n    <div class="rating-stars">\n        <span class="rating-stars-fill"></span>\n    </div>\n    <div class="tags-and-tours hidden">\n        <div class="tags-destinations">\n            <span class="tag"></span>\n        </div>\n    </div>\n</div>\n<p class="description">\n</p>\n<div class="add-nearbyAttraction-button hidden">\n    <button class="cta-button small"  data-event-src="claim-plan-itinerary-read">Add</button>\n</div>\n<div class="edit-schedule hidden">\n    <button class="calendarLink cta-button large" type="button" data-event-src="explore.attraction-details.info.edit">In your plan <span class="dynamic-part"></span></button>\n</div>\n<div class="start-a-plan hidden">\n    <button class="startideaplan cta-button small"  data-event-src="claim-plan-itinerary-read">Start a plan</button>\n</div>'});
define("jQueryExtensions/photoSlider",["jquery","jqueryui","touchSwipe"],function(){$.fn.preparePhotoSlider=function(){function a(){j.data("inClick",!0);j.is(":animated")&&j.stop();var a=j.children(":visible");if(0!==a.length){var b=a.last();if(!(Math.round(b.offset().left+b.outerWidth())<=Math.round(m.offset().left+m.outerWidth()))){var c;a.each(function(){if(Math.round($(this).offset().left)>Math.round(m.offset().left))return c=$(this),!1});var d=parseInt(j.css("margin-left"),10),a=j.offset().left-
c.offset().left;c.index()===b.index()&&(a+=m.outerWidth()-c.outerWidth());b=Math.abs(d-a)/u;j.animate({"margin-left":a+"px"},b,"linear",function(){j.data("inClick",!1);n()})}}}function g(){j.data("inClick",!0);j.is(":animated")&&j.stop();var a=j.children(":visible");if(0!==a.length){var b=$(a.get(0));if(!(Math.round(b.offset().left)>=Math.round(m.offset().left))){var c;a.each(function(){Math.round($(this).offset().left)<Math.round(m.offset().left)&&(c=$(this))});b=parseInt(j.css("margin-left"),10);
a=j.offset().left-c.offset().left;b=Math.abs(b-a)/u;j.animate({"margin-left":a+"px"},b,"linear",function(){j.data("inClick",!1);n()})}}}function d(){var a=j.children(":visible");if(0!==a.length){var b=a.eq(0);t=(t+1)%j.children(":visible").length;var a=parseInt(j.css("margin-left"),10),c=-b.width(),e=Math.abs(a-c)/u;r=window.setTimeout(function(){j.animate({"margin-left":c+"px"},e,"linear",function(){f.find(".bullet").removeClass("active").eq(t).addClass("active");j.append(b).css({"margin-left":0});
d()})},5E3)}}var p=$(this),m=p.find(".slide-wrapper"),j=p.find("ul.slides"),i=j.children(":visible"),c=p.find(".prev"),b=p.find(".next"),f=p.find(".nav-thumbs"),u=1;if(!(1>=i.length)){var n=function(){var a=j.children(":visible");if(0===a.length)c.addClass("disabled"),b.addClass("disabled");else{var d=$(a.get(0));Math.round(d.offset().left)<Math.round(m.offset().left)?c.removeClass("disabled"):c.addClass("disabled");a=a.last();Math.round(a.offset().left+a.outerWidth())<=Math.round(m.offset().left+
m.outerWidth())?b.addClass("disabled"):b.removeClass("disabled")}};b.hover(function(){if(!b.hasClass("disabled")){var a=j.children(":visible").last(),c=parseInt(j.css("margin-left"),10),a=j.offset().left-a.offset().left,c=c-a,d=Math.abs(c)/0.18;0!==c&&j.filter(":not(:animated)").animate({marginLeft:a+"px"},d,"linear",function(){n()})}},function(){j.data("inClick")||(j.stop(),n())});p.swipe({swipeLeft:a,swipeRight:g,threshold:0,preventDefaultEvents:!1});b.click(a);c.hover(function(){if(!c.hasClass("disabled")){var a=
0;j.children(":visible").each(function(){a+=$(this).outerWidth(!0)+4});var b=parseInt(j.css("margin-left"),10)-0,d=Math.abs(b)/0.18;0!==b&&j.filter(":not(:animated)").animate({marginLeft:"0px"},d,"linear",function(){n()})}},function(){j.data("inClick")||(j.stop(),n())});c.click(g);var k=!1,h,e,l;p.off("touchstart").on("touchstart",function(a){var b=0;j.children(":visible").each(function(){b+=$(this).outerWidth(!0)+4});b>$(this).width()&&(k=!0,h=a.originalEvent.touches[0].pageX,e=parseInt(j.css("marginLeft"),
10),l=$(this).width()-b)});p.off("touchend").on("touchend",function(){k=!1;n($(this))});p.off("touchmove").on("touchmove",function(a){if(k){var b=e+(a.originalEvent.touches[0].pageX-h),b=Math.min(b,0),b=Math.max(b,l);parseInt(j.css("marginLeft"),10)!==b&&(j.css({marginLeft:b+"px"}),a.preventDefault())}});var t=0,r;f.find(".bullet").click(function(){j.stop();window.clearTimeout(r);r=void 0;var a=$(this).data("slide"),b=$(this).index();f.find(".bullet").removeClass("active").eq(b).addClass("active");
for(a=j.find("#"+a);0!==a.index();){var c=j.children(":visible").eq(0);j.append(c)}j.css({"margin-left":0});t=b;d()});j.data("autoSlide")&&d()}}});
define("jQueryExtensions/readMore",["modules/utils","modules/view","jquery"],function(a,g){function d(a){a.data.$desc.css({height:"auto","max-height":"none"});a.data.$moreLink.addClass("hidden");a.data.$lessLink.removeClass("hidden")}function p(d){var j=parseFloat(d.data.$desc.css("lineHeight")),i=d.data.$desc.data("collapsedLines")||5;d.data.$desc.css({height:i*j,"max-height":""});d.data.$moreLink.removeClass("hidden");d.data.$lessLink.addClass("hidden");a.isMobile()&&(d.data.$moreLink.attr("id")||
d.data.$moreLink.attr("id","descmore-"+1E6*Math.random()),g.scrollElementIntoView(d.data.$moreLink.attr("id"),-100,!0))}$.fn.readMore=function(g,j){if($(this).length&&g.length&&j.length){var i={$desc:$(this),$moreLink:g,$lessLink:j},c;c=$(this);var b=c.get(0).scrollHeight,f=parseFloat(c.css("lineHeight")),b=Math.round(b/f),u=c.data("collapsedLines")||5,u=Math.min(u,b);c.css({height:u*f});a.display(j,c.height()>f*u);b>u&&c.height()<=f*u?(g.removeClass("hidden"),c=!0):(g.addClass("hidden"),c=!1);c&&
(g.off("click").on("click",i,d),j.off("click").on("click",i,p))}}});
define("plan/details","modules/lazyload modules/analytics modules/analyticsEventParams modules/ajax modules/utils modules/hotelbooking plan/visits modules/events modules/viator plan/loading plan/planUtils plan/planHelper modules/history modules/map modules/modal modules/copyright modules/dateRange modules/fancybox minimapHelper text!templates/exploreAttractionMapQtip.html jquery jQueryExtensions/linkToCalendarAndMap jQueryExtensions/pager jQueryExtensions/photoSlider fancybox jqueryui jQueryExtensions/readMore jQueryExtensions/inspirockSelectmenu".split(" "),function(a,
g,d,p,m,j,i,c,b,f,u,n,k,h,e,l,t,r,q,D){function v(a){function b(h,j){i.forceMerge=h;i.userDIY=j;e.prop("disabled",!0);f.showLoading($("#exploreLoadingPane"),$("#exploreMainPane"),"Updating Your Plan...");p.makeAJAXcall({type:"POST",url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/stay",data:i,synchronize:!0,complete:function(){e.prop("disabled",!1);f.hideLoading($("#exploreLoadingPane"),$("#exploreMainPane"));A.initialize(n,a.data.eventSource,a.data.analyticsCategoryPrefix,k);j&&c.triggerEvent("explore",
"show-tab-itinerary",{addToHistory:!1,tabData:{subnav:"calendar"}})},success:function(e,h,f){f.getResponseHeader("Modified-Visits")?($("#pageWrapper").append($(e)),c.triggerEvent(a.data.eventSource,"show-removed-visits-dlg",{cb:b})):(g.trackEvent(d.CAT_EXPLORE_DEST_RECOS_MAP,d.ACT_ADD_DEST,l.toLowerCase()),c.triggerEvent(a.data.eventSource,"stay-add",{uiSource:a.data.uiSource}),n.html(e))}})}var e=$(this),h=e.data("destinationId"),l=e.data("name"),n=a.data.detailsPane,k="explore.destinations.details",
i={destinationId:h,destinationName:l,view:"destinationDetails",viewDestinationId:e.parents(".destination-details").data("destinationId")};b(!1,!1)}function B(a){function b(h,j){i.forceMerge=h;i.userDIY=j;e.prop("disabled",!0);f.showLoading($("#exploreLoadingPane"),$("#exploreMainPane"),"Updating Your Plan...");p.makeAJAXcall({type:"POST",url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/stay",data:i,synchronize:!0,complete:function(){e.prop("disabled",!1);f.hideLoading($("#exploreLoadingPane"),
$("#exploreMainPane"));A.initialize(n,a.data.eventSource,a.data.analyticsCategoryPrefix,k);j&&c.triggerEvent("explore","show-tab-itinerary",{addToHistory:!1,tabData:{subnav:"calendar"}})},success:function(e,h,f){f.getResponseHeader("Modified-Visits")?($("#pageWrapper").append($(e)),c.triggerEvent(a.data.eventSource,"show-removed-visits-dlg",{cb:b})):(g.trackEvent(d.CAT_EXPLORE_DEST_RECOS_MAP,d.ACT_ADD_DEST,l.toLowerCase()),c.triggerEvent(a.data.eventSource,"stay-add",{uiSource:a.data.uiSource}),n.html(e))}})}
var e=$(this),h=e.data("destinationId"),l=e.data("name"),n=a.data.detailsPane,k=e.data("eventSrc"),i={destinationId:h,destinationName:l,view:"destinationDetails",viewDestinationId:e.parents(".destination-details").data("destinationId")};b(!1,!1)}function z(a){function b(h,j){k.forceMerge=h;k.userDIY=j;e.prop("disabled",!0);f.showLoading($("#exploreLoadingPane"),$("#exploreMainPane"),"Updating Your Plan...");p.makeAJAXcall({type:"POST",url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/stay",
data:k,synchronize:!0,complete:function(){e.prop("disabled",!1);f.hideLoading($("#exploreLoadingPane"),$("#exploreMainPane"));j&&c.triggerEvent("explore","show-tab-itinerary",{addToHistory:!1,tabData:{subnav:"calendar"}})},success:function(e,h,f){f.getResponseHeader("Modified-Visits")?($("#pageWrapper").append($(e)),c.triggerEvent(a.data.eventSource,"show-removed-visits-dlg",{cb:b})):(g.trackEvent(d.CAT_EXPLORE_DEST_RECOS_MAP,d.ACT_ADD_DEST,l.toLowerCase()),c.triggerEvent(a.data.eventSource,"stay-add",
{uiSource:a.data.uiSource}),n.html(e),A.initialize(n,a.data.eventSource,a.data.analyticsCategoryPrefix,i))}})}var e=$(this),h=e.data("destinationId"),l=e.data("name"),n=a.data.detailsPane,i="explore.destinations.details",k={destinationId:h,destinationName:l,view:"destinationDetails",viewDestinationId:e.parents(".destination-details").data("destinationId")};b(!1,!1)}function C(a){a&&a.stopPropagation();var b=a.data.detailsPane,c=$(this).parents(".attraction"),d=c.data("attractionId"),h=c.data("name"),
c=c.parents(".destination-details"),f=c.data("destinationId"),d={requestData:{attractionId:d,view:"destinationDetails",viewDestinationId:f},attractionId:d,attractionName:h,analyticsCategory:a.data.analyticsCategoryPrefix+".destination-details.highlights",eventSource:a.data.eventSource,uiSource:"explore.destinations.details.things-to-do",modal:e,destinationId:f,additionalPostParams:{viewDestinationId:c.data("destinationId")},successCB:function(c){b.html(c);A.initialize(b,a.data.eventSource,a.data.analyticsCategoryPrefix,
"explore.destinations.details.things-to-do")}};i.addAttraction(d);return!1}function G(a){var b=$(this),e=a.data.detailsPane,h=b.parents(".destination-details").data("destinationId"),f=b.data("visitId");b.prop("disabled",!0);p.makeAJAXcall({type:"POST",data:{view:"destinationDetails",viewDestinationId:h},synchronize:!0,url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/visit/"+f+"/delete",success:function(b){e.html(b);c.triggerEvent(a.data.eventSource,"visit-remove",{uiSource:a.data.uiSource});
g.trackEvent(a.data.analyticsCategoryPrefix+".attraction-details",d.ACT_DEL_VISIT);A.initialize(e,a.data.eventSource,a.data.analyticsCategoryPrefix,a.data.uiSource)},complete:function(){b.prop("disabled",!1)}})}function M(a){a&&a.stopPropagation();var b=$(this),c=a.data.detailsPane,d=$(this).parents(".nearbyAttr-tile"),h=0<d.length?d:b,d=h.data("attractionId"),f=h.data("name"),h=h.data("destinationId"),g=a.data.uiSource,l=b.data("viewMap"),d={requestData:{viewAttractionId:c.find(".attraction-details").data("attractionId"),
attractionId:d,destinationId:h,view:"attractionDetails"},attractionId:d,attractionName:f,analyticsCategory:a.data.analyticsCategoryPrefix+".attraction-details",eventSource:a.data.eventSource,uiSource:g,modal:e,destinationId:h,successCB:function(b){$(".qtip-infowindow").hide();c.html(b);A.initialize(c,a.data.eventSource,a.data.analyticsCategoryPrefix,g);l&&c.find(".tab.maps").click()},completeCB:function(){b.prop("disabled",!1)}};b.prop("disabled",!0);i.addAttraction(d);return!1}function w(a){var b=
$(this),c=a.data.detailsPane,d=b.parents(".in-plan"),h=d.parents(".attraction-details").data("attractionId"),f=d.parents(".attraction-details").data("attractionName"),d=d.parents(".attraction-details").data("destinationId"),g=a.data.uiSource,h={requestData:{attractionId:h,destinationId:d,view:"attractionDetails"},attractionId:h,attractionName:f,analyticsCategory:a.data.analyticsCategoryPrefix+".attraction-details",eventSource:a.data.eventSource,uiSource:g,modal:e,destinationId:d,successCB:function(b){c.html(b);
A.initialize(c,a.data.eventSource,a.data.analyticsCategoryPrefix,g)},completeCB:function(){b.prop("disabled",!1)}};b.prop("disabled",!0);i.addAttraction(h)}function J(a){a&&a.stopPropagation();var b=a.data.detailsPane,c=$(this),d=$(this).parents(".attraction-details"),h=d.data("attractionId"),d=d.data("attractionName"),c=c.data("newDestinationId");i.addAttraction({requestData:{attractionId:h,view:"attractionDetails",viewAttractionId:h},attractionId:h,attractionName:d,analyticsCategory:a.data.analyticsCategoryPrefix+
".destination-details.highlights",eventSource:a.data.eventSource,uiSource:"explore.attractions.details",modal:e,destinationId:c,additionalPostParams:{viewAttractionId:h},successCB:function(c){b.html(c);A.initialize(b,a.data.eventSource,a.data.analyticsCategoryPrefix,"explore.attractions.details")}})}function F(){g.trackEvent(d.CAT_DETAILS_ATTR,d.ACT_TA_CLICK);var a=$(this).attr("href"),b=g.getClientId();p.makeAJAXcall({url:window.contextPath+"/tripadvisorLinkClick",type:"GET",data:{gaClientId:b,targetUrl:a}})}
function y(){var a=$(".tours");a.toggleClass("expanded");a.hasClass("expanded")?$(this).html('View fewer tours <i class="fa fa-angle-up"></i>'):$(this).html('View more tours <i class="fa fa-angle-down"></i>')}function s(){if(!$(this).hasClass("must-see-tag")){var a=$(this),a=$(this).data("destinationId")||a.parents(".attraction-details").data("destinationId"),b=$(this).data("catId"),d=$(this).data("catGroupId"),e=$(this).data("otherId");c.triggerEvent("details","goto-selected-tag-places",{catGroupIds:[d],
catIds:[b],otherIds:[e],destinationId:a,tab:"explore"});return!1}}function H(){var a=$(this),c=a.find(".ticket-list"),d=a.data("eventCategory");if(1===c.find(".ticket").length){var a=c.find(".ticket"),c=a.data("url"),e={tourUrl:c};window.open(c,"_blank");e.tourName=a.find(".title").text();e.destinationName=$(".attraction-details").data("destinationName");e.destinationCountry=$(".attraction-details").data("countryCode");b.viatorTourLinkClick(d,e)}else a.qtip({overwrite:!0,content:{text:c.html()},position:{my:"top left",
at:"bottom left",effect:!1,target:$(this),container:$(".modal-box .ui-dialog-content").length?$(".modal-box .ui-dialog-content"):$("body"),adjust:{x:0,y:0}},show:{event:!1,ready:!0},hide:{event:"unfocus",fixed:!0,effect:!1},events:{show:function(a,c){c.elements.content.find(".ticket").off("click.ticket").on("click.ticket",function(){var a=$(this),e=a.data("url");e&&(a={tourUrl:e,tourName:a.find(".title").text(),destinationName:$(".attraction-details").data("destinationName"),destinationCountry:$(".attraction-details").data("countryCode")},
b.viatorTourLinkClick(d,a),window.open(e,"_blank"));c.hide()})}},style:{classes:"ticket-tip qtip-light qtip-shadow",tip:{corner:!1,width:20,height:10,mimic:"center top"}}})}function x(a,b){var c=1,d;b.find(".user-rating .rating-stars").each(function(){c<=a?($(this).addClass("selected"),d=$(this)):d&&d.nextAll().removeClass("selected");c++})}var A={},E=function(a){function b(l,n){j.forceMerge=l;j.userDIY=n;e.prop("disabled",!0);f.showLoading($("#exploreLoadingPane"),$("#exploreMainPane"),"Updating Your Plan...");
p.makeAJAXcall({type:"POST",url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/stay",data:j,synchronize:!0,complete:function(){e.prop("disabled",!1);f.hideLoading($("#exploreLoadingPane"),$("#exploreMainPane"));A.initialize(h,a.data.eventSource,a.data.analyticsCategoryPrefix,i);n&&c.triggerEvent("explore","show-tab-itinerary",{addToHistory:!1,tabData:{subnav:"calendar"}})},success:function(e,f,l){l.getResponseHeader("Modified-Visits")?($("#pageWrapper").append($(e)),c.triggerEvent(a.data.eventSource,
"show-removed-visits-dlg",{cb:b})):(g.trackEvent(a.data.analyticsCategoryPrefix+".destination-details",d.ACT_ADD_DEST,k.toLowerCase()),c.triggerEvent(a.data.eventSource,"stay-add",{uiSource:a.data.uiSource}),h.html(e))}})}var e=$(this),h=a.data.detailsPane,l=e.parents(".destination-details"),n=l.data("destinationId"),k=l.data("name"),i="explore.destinations.details",j={destinationId:n,destinationName:k,view:"destinationDetails"};b(!1,!1)},K=function(a){function b(){e.prop("disabled",!0);p.makeAJAXcall({type:"POST",
data:{view:"attractionDetails"},synchronize:!0,url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/visit/"+f+"/delete",success:function(b){h.html(b);c.triggerEvent(a.data.eventSource,"visit-remove",{uiSource:a.data.uiSource});g.trackEvent(a.data.analyticsCategoryPrefix+".attraction-details",d.ACT_DEL_VISIT,l.toLowerCase());A.initialize(h,a.data.eventSource,a.data.analyticsCategoryPrefix,a.data.uiSource)},complete:function(){e.prop("disabled",!1)}})}var e=$(this),h=a.data.detailsPane,f=$(this).parents(".in-plan").data("visitId"),
l=$(this).parents(".attraction-details").data("attractionName");e.data("hasNotes")?n.deleteNotesQtip(e,l,function(){b()}):b()},L=function(){var a=$(this);if(!a.hasClass("active")){a.addClass("active").siblings().removeClass("active");var b=a.parents(".nearby-attractions").find(".map-holder"),c=a.parents(".nearby-attractions").find(".page-clipper");a.hasClass("list")?(b.addClass("hidden"),c.removeClass("hidden"),c.trigger("isVisible"),window.history.state.data.tabId="list"):(b.removeClass("hidden"),
c.addClass("hidden"),b.trigger("isVisible"),window.history.state.data.tabId="map")}},Q=function(a){g.trackEvent(a.data.analyticsCategoryPrefix+".attraction-details",d.ACT_WEB_CLICK,$(this).data("type"))},N=function(a){var b=a.data.detailsPane,c=b.find(".start-trip-btn").data("isValidDomain"),e=b.find(".destination-details").data("destinationId");c?g.trackEvent(a.data.analyticsCategoryPrefix+".destination-details",d.ACT_START_PLAN_CLICK,e,function(){window.location.href=window.contextPath+"/trip-planner?domains="+
e}):(a=b.find(".destination-details").data("name"),$(document.createElement("div")).text("Cannot generate itinerary for "+a+".").dialog({title:"Error",resizable:!1,modal:!0,draggable:!1,width:"350px",dialogClass:"invalid-domain-errorDialog mediumx",buttons:{OK:function(){$(this).dialog("close")}},open:function(){m.setupDialogOverlay($(this),!1)},close:function(){$(this).dialog("destroy").remove()}}))},O=function(){var a=$(this);a.data("translated")?(a.data("translated",!1),a.siblings(".translated").toggleClass("hidden").siblings(".original").toggleClass("hidden"),
a.find(".secondary-text-link").text("Translate to english")):(a.data("translated",!0),a.siblings(".translated").toggleClass("hidden").siblings(".original").toggleClass("hidden"),a.find(".secondary-text-link").text("View original"));$(".greview").each(function(){$(this).find(".desc").readMore($(this).find(".read-more"),$(this).find(".read-less"))})},I=function(a){var b=$(this).attr("href");g.trackEvent(a.data.analyticsCategoryPrefix+".attraction-details",d.ACT_TOUR_CLICK,b)},T=function(a){var c=$(this),
d={tourUrl:c.attr("href")};c.hasClass("block")&&(d.tourName=c.find(".primarytext").text().trim(),d.destinationName=$(".attraction-details,.destination-details").data("destinationName"),d.destinationCountry=$(".attraction-details,.destination-details").data("countryCode"));c=c.parents(".attraction-details").length?".attraction-details":".destination-details";b.viatorTourLinkClick(a.data.analyticsCategoryPrefix+c,d)};A.initialize=function(b,f,n,i){l.initialize();if(b.is(":visible")){var j=b.find(".nearby-attractions");
a.initialize();var t={detailsPane:b,eventSource:f,analyticsCategoryPrefix:n,uiSource:i};b.off("click.add-dest").on("click.add-dest",".add-destination-button",t,E).off("click.add-side-trip-dest").on("click.add-side-trip-dest",".destination-info .add-side-trip-dest",t,B).off("click.add-highlight").on("click.add-highlight",".dest.things-to-do .add-button",t,C).off("click.delete-attraction-btn").on("click.delete-attraction-btn",".delete-attraction-btn",t,K).off("click.delete-sidetrip").on("click.delete-sidetrip",
".delete-sidetrip-button",t,G).off("click.add-attr").on("click.add-attr",".add-attraction-button",t,w).off("click.add-destattr").on("click.add-destattr",".add-dest-with-attr",t,J).off("click.website").on("click.website",".website",t,Q).off("click.starttrip").on("click.starttrip",".start-trip-btn",t,N).off("click.add-attr-not-schedulable").on("click.add-attr-not-schedulable",".add-attr-not-schedulable",t,w).off("click.translate-review").on("click.translate-review",".translateText",O).off("click.add-nearby-nightstay").on("click.nearby-nightstay",
".vacation-ideas .add-nearby-nightstay",t,z).off("click.add-dest-to-plan").on("click.add-dest-to-plan",".vacation-ideas .add-to-plan",t,v).off("click.tour-click").on("click.tour-click",".tour-link",t,I).off("click.triplink").on("click.triplink",".triplink",t,F).off("click.viator-tour-click").on("click.viator-tour-click",".viator-link",t,T).off("click.tag").on("click.tag",".tags-attractions .tag, .rating-count .tag",s).off("click.buy-tickets").on("click.buy-tickets",".buy-tickets",H).off("click.explore-all-attractions").on("click.explore-all-attractions",
".explore-all-attraction button",function(){c.triggerEvent("details","explore-all-attractions",{tab:e.getTab(),destinationId:$(this).data("destination-id")})}).off("click.load").on("click.load",".viator-tours .load-more",function(){var a=b.find(".viator-tours");a.find(".tour-row").removeClass("hidden");a.find(".viator-url").removeClass("hidden");a.find(".load-more").addClass("hidden")}).off("click.rating-stars").on("click.rating-stars",".attraction-info .ins-rating",function(){var a=$(this).parents(".ui-dialog-content");
a.animate({scrollTop:b.find(".attraction-reviews").offset().top-a.offset().top+a.scrollTop()},"fast")});$(".modal-box").off("click.add-nearbyAttraction").on("click.add-nearbyAttraction",".add-nearbyAttraction-button",t,M).off("click.switchNearbyTabView").on("click.switchNearbyTabView",".view-tabs .tab",L);b.find(".external-rating-box").on("click",function(){var a=$(this).data("slideTarget"),a=b.find(".reviewer-rating."+a);a.length&&(a=a.offset().top-120+$(".modal-box .ui-dialog-content").scrollTop(),
$(".modal-box .ui-dialog-content").animate({scrollTop:a},200))});b.find(".ext-review-count").on("click",function(a){$(this).parents(".external-rating-box").hasClass("tripadvisor")&&F({data:t});window.open($(this).attr("href"),"_blank");a.stopPropagation();return!1});$(".nearby-attractions,.qtip-infowindow").off("click.calendarLink").on("click.calendarLink",".calendarLink",function(){var a=$(this),a={dayNumber:a.data("dayNumber"),date:a.data("date"),visitId:a.data("visitId")};c.triggerEvent("attraction-details",
"dayTime-click",a)});b.find(".photos").preparePhotoSlider(0.24);r.initialize(b,!1);var A=b.find(".static-map");0!==A.length&&A.find("img").click(function(){h.addToQueue(function(){var a=parseFloat(A.data("lat")),b=parseFloat(A.data("lng")),c=parseInt(A.data("zoom"),10),d=new window.google.maps.LatLng(a,b),e=$(document.createElement("div"));e.attr("id","detailsMap");e.css({width:"100%",height:"100%"});var h=new window.google.maps.Map(e[0],{zoom:c,center:d,zoomControl:!0,mapTypeId:window.google.maps.MapTypeId.ROADMAP,
scaleControl:!0,fullscreenControl:!1,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"train",elementType:"labels.icon",stylers:[{visibility:"off"}]}]}),f=new window.google.maps.Marker({position:d,map:h}),g=new window.google.maps.InfoWindow({content:A.data("name")});window.google.maps.event.addListener(f,"click",function(){g.open(h,f)});a=$(this).attr("class")?$(this).attr("class").replace("mini-map",
""):"";e.dialog({resizable:!1,modal:!0,draggable:!1,width:0.95*$(window).width(),height:0.95*$(window).height(),dialogClass:"dlg-large-map mediumx "+a,open:function(){h&&(window.google.maps.event.trigger(h,"resize"),h.setCenter(d),h.setZoom(c));m.setupDialogOverlay(e,!1,void 0,void 0,!0)}})})});b.find("select").inspirockSelectmenu();f=b.find(".viator-tours");f.length&&f.find(".more-tours").click(y);j.find(".page-clipper .pages").preparePaging(j.find(".page-clipper .paging"),!0);h.addToQueue(function(){j.find(".map-holder").prepareMiniMap({$rootView:j.find(".map-holder"),
$mapMarkerDataHolders:j.find(".currentAttr,.nearbyAttr-tile,.planAttr"),showMarkerLabel:!1,idKey:"attractionId",keepOpenAllowed:!0,showInfoWindowAsQtip:!0,qtip:q.destinationDetailsQtip(),content:function(a){var b=$("<div />").append(D),c=j.find('.nearbyAttr-tile[data-attraction-id="'+a.uniqueId+'"]');c.length||(c=j.find('.planAttr[data-attraction-id="'+a.uniqueId+'"]'));c.length||(c=j.find('.currentAttr[data-attraction-id="'+a.uniqueId+'"]'));return q.attractionDetailsContents(c,b)},analyticsCategory:d.CAT_EXPLORE_ATTR_NEARBY})});
b.find(".attraction-details").find(".desc").each(function(){$(this).readMore($(this).parent().find(".read-more"),$(this).parent().find(".read-less"))});0<window.location.href.lastIndexOf("#Related")&&(b.parents(".ui-dialog .ui-dialog-content").animate({scrollTop:b.find(".viator-tours").offset().top-70},300),b.find(".viator-tours .load-more").trigger("click"),f=window.history.state,k.replace(f.id,f.tabId,f.url.replace("#Related",""),f.data));var u=b.find(".attraction-reviews"),ia=b.find(".attraction-info").data("attractionId"),
pa=u.find(".user-rating").find("input").val();x(pa,u);u.find(".user-rating .rating-stars").hover(function(){$(this).prevAll().andSelf().addClass("selected");$(this).nextAll().removeClass("selected")},function(){$(this).prevAll().andSelf().removeClass("selected")});u.find(".user-rating .rating-stars").mouseleave(function(){pa=u.find(".user-rating").find("input").val();x(pa,u)});var ka=u.find(".user-rating .rating-stars");ka.click(function(){var a=ka.index($(this))+1;$(this).parents(".user-rating").find("input").val(a);
if(window.registeredUserLoggedIn){var b={attractionId:ia,rating:a};g.trackEvent(d.CAT_DETAILS_ATTR_REVIEWS,d.ACT_ADD_USER_RATING);p.makeAJAXcall({type:"POST",url:"/addUserRating",data:b,success:function(b){null!==b&&(x(a,u),m.showOkDialog("Thank you!","Thank you for rating "+$(".attraction-wrapper").data("attractionName")+".","OK"))}})}else{var c=$("<div></div>");c.dialog({resizable:!1,modal:!0,draggable:!1,width:"465px",dialogClass:"loginPromt mediumx",open:function(){m.setupDialogOverlay(c,!1)},
create:function(){c.append('<div class="title">You are not logged in.</div>');c.append('<div class="login"><a class="login-link" href="javascript:void(0);">Login to inspirock</a></div>');c.find(".login-link").off("click").on("click",function(){m.login()})},close:function(){c.dialog("destroy").remove()}})}})}};return A});
define("explore/exploreAbout","minimapHelper modules/lazyload modules/analytics modules/analyticsEventParams modules/ajax modules/hotelbooking modules/utils plan/visits modules/events modules/viator plan/details plan/stay plan/loading modules/modal modules/copyright modules/map modules/dateRange modules/view text!templates/exploreDestinationMapQtip.html modules/fancybox jquery jQueryExtensions/linkToCalendarAndMap jQueryExtensions/pager jQueryExtensions/photoSlider fancybox jqueryui jQueryExtensions/readMore".split(" "),function(a,
g,d,p,m,j,i,c,b,f,u,n,k,h,e,l,t,r,q,D){return function(k,m,t,u,G){function M(a){var b=$(this);n.add.bind(b)(a,{destinationData:{view:"destinationDetails",viewDestinationId:b.parents(".destination-details").data("destinationId")},EVENT_SOURCE:x,analyticsCategory:"destination-details.nearby-nightstays-map",success:function(){A.onPageChange()}})}function w(a){a&&a.stopPropagation();var b=$(a.data.detailsPane),d=$(this).parents(".attraction"),e=d.data("attractionId"),f=d.data("name"),d=d.parents(".destination-details"),
g=d.data("destinationId"),a={requestData:{attractionId:e,view:"destinationDetails",viewDestinationId:g},attractionId:e,attractionName:f,analyticsCategory:a.data.analyticsCategoryPrefix+".destination-details.highlights",eventSource:a.data.eventSource,uiSource:"explore.destinations.details.things-to-do",modal:h,destinationId:g,additionalPostParams:{viewDestinationId:d.data("destinationId")},successCB:function(a){var c=b.find(".destination-info .read-more.hidden").length;b.html(a);A.onPageChange();c&&
b.find(".destination-info .read-more").click()}};c.addAttraction(a);return!1}function J(a){return h.isOpen()?a.offset().top+h.scrollTop():a.offset().top}function F(){var a=H.find(".destination-details .region-recos");a.toggleClass("expanded");a.hasClass("expanded")?$(this).html('View fewer regions <i class="fa fa-angle-up"></i>'):$(this).html('View more regions <i class="fa fa-angle-down"></i>');$("html,body,.modal-box .ui-dialog-content").animate({scrollTop:J(H.find(".explore-region"))-80},"fast")}
function y(){var a=H.find(".tours");a.toggleClass("expanded");a.hasClass("expanded")?$(this).html('View fewer tours <i class="fa fa-angle-up"></i>'):$(this).html('View more tours <i class="fa fa-angle-down"></i>');$("html,body,.modal-box .ui-dialog-content").animate({scrollTop:J(H.find(".viator-tours"))-80},"fast")}function s(){var a=$(this).parents(".destination-details").data("destinationId"),c=$(this).data("catGroupId"),d=$(this).data("categoryId");$(".tip-infowindow").qtip("hide",!0);b.triggerEvent("details",
"goto-selected-tag-places",{catGroupIds:[c],catIds:[d],otherIds:null,destinationId:a,tab:"explore"});return!1}var H,x="exploreAbout",A=this,E=function(a){var b=h.isOpen()?$(".modal-box #exploreSubnavPane"):H.parents("#exploreMainPane").siblings("#exploreSubnavPane");n.add.bind($(this))(a,{destinationData:{view:"destinationDetails",viewDestinationId:b.find(".selected-destination").data("destinationId")},EVENT_SOURCE:x,analyticsCategory:a.data.analyticsCategoryPrefix+".destination-details",success:function(){A.onPageChange()}})},
K=function(a){var b=$(this).attr("href");d.trackEvent(a.data.analyticsCategoryPrefix+".attraction-details",p.ACT_TOUR_CLICK,b)},L=function(a){var b=$(this),c={tourUrl:b.attr("href")};b.hasClass("block")&&(c.tourName=b.find(".primarytext").text().trim(),c.destinationName=$(".attraction-details,.destination-details").data("destinationName"),c.destinationCountry=$(".attraction-details,.destination-details").data("countryCode"));b=b.parents(".attraction-details").length?".attraction-details":".destination-details";
f.viatorTourLinkClick(a.data.analyticsCategoryPrefix+b,c)};A.contents=function(a){k.html(a.find("#about").html());k.toggleClass("hidden",a.find("#about").hasClass("hidden"));A.onPageChange()};A.onPageChange=function(){e.initialize();g.initialize();k.find(".photos").preparePhotoSlider(0.24);D.initialize(k,!1);var b=k.find(".viator-tours");if(b.length)b.find(".more-tours").off("click.toggleMoreTours").on("click.toggleMoreTours",y);if(k.find(".destination-details").length){b=k.find(".explore-region");
if(b.length)b.find(".more-regions").off("click.toggleMoreRegions").on("click.toggleMoreRegions",F);k.find(".destination-info .desc").readMore(k.find(".destination-info .read-more"),k.find(".destination-info .read-less"));var c=k.find(".route"),d=c.data("markerLabelStart"),h=!1;c.length&&(h=!0,c.find(".marker").each(function(a){$(this).css("background-color",i.getColor(a))}));l.addToQueue(function(){var b=k.find(".destination-schedules");b.length&&(b.prepareMiniMap({$rootView:b,$mapMarkerDataHolders:b.find(".map-data"),
showMarkerLabel:h,markerLabelStart:d,showDirections:!0,showInfoWindowAsQtip:!0,qtip:a.iconQtip(),analyticsCategory:p.CAT_EXPLORE_DEST_SCHEDULE}),c.linkToCalendarAndMinimap({staySelector:".marker-text",$calendar:b.find(".mini-calendar"),$minimap:b.find(".mini-map"),onlyHighlightedInteractive:!0,stayListTitleSelector:".marker-title"}));var e=k.find(".vacation-ideas");e.length&&(e.prepareMiniMap({$rootView:e,$mapMarkerDataHolders:e.find(".idea,.currentDes,.planDes"),showMarkerLabel:!1,keepOpenAllowed:!0,
showAddMarkerIcon:!0,showInfoWindowAsQtip:!0,qtip:a.destinationDetailsQtip(),content:function(b){var c=$("<div />").append(q),d=e.find('.idea[data-destination-id="'+b.destinationId+'"]');d.length||(d=e.find('.currentDes[data-destination-id="'+b.destinationId+'"]'));d.length||(d=e.find('.planDes[data-destination-id="'+b.destinationId+'"]'));return a.destinationDetailsContents(d,c,"about")},analyticsCategory:p.CAT_EXPLORE_DEST_RECOS}),e.find(".right-col").linkToCalendarAndMinimap({staySelector:".idea",
stayListTitleSelector:".dlink",stayListHighlightedClass:"highlight",$minimap:e.find(".large-map"),onlyHighlightedInteractive:!0,highlightColor:"#000",listKey:"destinationId",mapKey:"destinationId"}))});b=k.find(".destination-where-to-stay");j.initializeWhereToStay(b,b.find(".hotel-booking-module"),{container:k.parents(".ui-dialog-content")},p.CAT_EXPLORE_DEST_ABOUT);G.onPageChange()}};A.initialize=function(){var a={detailsPane:k,eventSource:m,analyticsCategoryPrefix:t,uiSource:u};k.off("click.routeLink").on("click.routeLink",
".routeLink",function(){b.triggerEvent("exploreAbout","show-tab-route",{addToHistory:!0})});k.off("click.guide-link").on("click.guide-link",".guide-link",function(){r.scrollElementIntoView(H.find("#holidayGuide"),-30)});b.addObserver("load-destination-details","explore-about",function(a,c){var e=c.url,f=c.analyticsEventCategory,g=c.addnlData,l=e.split("https://www.inspirock.com/"),n=l[l.length-1],k=n.split("-"),j=e.split("?")[1];0===n.indexOf("trip-planner-")&&1<k.length&&(n=k[k.length-1]);if("d"===n.charAt(0)){n=l[l.length-
2]+"-"+n;f&&d.trackNonInteractionEvent(f,"destination-details",n.toLowerCase());var i;j&&(i=!0);-1!==e.indexOf("modal")&&(e="/trip/"+l[2]+e.split("modal")[1]);j="";for(n=3;n<l.length&&"modal"!==l[n];)""!==j&&(j+="https://www.inspirock.com/"),j+=l[n++];h.open({dialogClass:"full dock-close",data:g,showBack:!0,ajaxParams:{url:e,data:{view:"partial",expanded:i},type:"GET",func:{success:function(a){return $("<div />").append('<div class="details-pane">'+a+"</div>").html()}}},onLoad:function(a){a.off("click.modalRouteLink").on("click.modalRouteLink",
".routeLink",function(){b.triggerEvent(x,"overview-post-refresh-actions",{action:"expandRouteSection",destinationId:$(this).parents(".destination-details").data("destination-id")});h.close();$(".ui-dialog").remove();b.triggerEvent("modal","show-tab-overview",{addToHistory:!0,tabClick:!0})});a.off("click.modalExploreLink").on("click.modalExploreLink",".exploreLink",function(){b.triggerEvent("details","explore-all-attractions",{tab:h.getTab(),destinationId:$(this).data("destinationId")})});a.off("click.modalExploreDestinationsLink").on("click.modalExploreDestinationsLink",
".exploreDestinationsLink",function(){b.triggerEvent("details","explore-all-attractions",{tab:h.getTab(),destinationId:$(this).data("destinationId"),subnav:"destinations"})});a.off("click.modalHideRouteLink").on("click.modalHideRouteLink",".hideRouteLink",function(){b.triggerEvent(x,"collapse-route-section",{})});a.off("click.claimPlan").on("click.claimPlan",".claimPlanLink",function(){b.triggerEvent(x,"claimPlan",{})});a.parents(".modal-box").find(".ui-dialog-titlebar .ui-dialog-title").html('<span class="text">'+
a.find(".destination-details .title").html()+"</span>");a.parents(".modal-box").off("scroll").on("scroll",function(){a.parents(".modal-box").find(".ui-dialog-titlebar").toggleClass("dock",73<=h.scrollTop())});if(f){var c=$("#analytics-metadata"),e=$("#destination-analytics-metadata");d.setPageTypeNew(c.data("pageTypeNew")+" : destination details : about");d.setEntityType(e.data("entityType"));d.setEntity(e.data("entity"));d.trackPageView("/plan/explore/destination/about")}},onUnload:function(a){a.parents(".modal-box").find(".ui-dialog-titlebar").removeClass("dock");
a.parents(".modal-box").find(".ui-dialog-titlebar .ui-dialog-title").html("")}})}});H=k;$("body").off("click.add-dest_about").on("click.add-dest_about",".about.add-destination .add-button, .vacation-ideas .add-to-plan, .destination-details .add-destination-button",a,E);k.off("click.add-side-trip-dest").on("click.add-side-trip-dest",".destination-info .add-side-trip-dest",a,M).off("click.add-highlight").on("click.add-highlight",".dest.things-to-do .add-button",a,w).off("click.add-nearby-nightstay").on("click.add-nearby-nightstay",
".vacation-ideas .add-nearby-nightstay",a,E).off("click.tour-click").on("click.tour-click",".tour-link",a,K).off("click.viator-tour-click").on("click.viator-tour-click",".viator-link",a,L).off("click.tag").on("click.tag",".destination-details .tags-attractions .tag",s).off("click.explore-attractions").on("click.explore-attractions",".explore-attractions button",function(){var a=k.parents("#exploreMainPane").siblings("#exploreSubnavPane");a.length||(a=k.parents(".modal-box").find("#exploreSubnavPane"));
a.find(".tab-attractions").click()}).off("click.explore-destinations").on("click.explore-destinations",".explore-destinations .gotoDestinationsTab",function(){var a=k.parents("#exploreMainPane").siblings("#exploreSubnavPane");a.length||(a=k.parents(".modal-box").find("#exploreSubnavPane"));a.find(".tab-destinations").click()}).off("click.load").on("click.load",".viator-tours .load-more",function(){var a=k.find(".viator-tours");a.find(".tour-row").removeClass("hidden");a.find(".viator-url").removeClass("hidden");
a.find(".load-more").addClass("hidden")});A.onPageChange()};k&&0!==$.trim(k.html()).length&&A.initialize()}});
define("modules/dock",["modules/events","jquery"],function(a){var g={},d={},p=[],m=$("#planHeader").height();g.dockUndockViews=function(){var a,g=$(window).height(),c=$(window).scrollTop()-$("#pageWrapper").offset().top;$("#planHeader");var b=$("footer").is(":visible"),g=$(window).height(),f=$(window).scrollTop(),u=$("footer").offset().top;for(a in d)if(d.hasOwnProperty(a)){var n=d[a][0];if(-1===p.indexOf(a)&&n.is(":visible")){var k=d[a][1],h=k.dockTopAt&&k.dockTopAt.constructor&&k.dockTopAt.call&&
k.dockTopAt.apply?k.dockTopAt():k.dockTopAt,e=k.dockBottomAt&&k.dockBottomAt.constructor&&k.dockBottomAt.call&&k.dockBottomAt.apply?k.dockBottomAt():k.dockBottomAt,l=k.shouldDockBottom,t=k.canScroll,r=n.prop("scrollHeight"),q=k.contentHeight,D=k.scrollHeight,v=b?f+g-u:-1;0<v&&(q-=v);var q=r>q,B=c+m+r+23;k.subNav&&(B+=k.subNav.height());if(q&&!t)n.removeClass("dock-top"),n.removeClass("dock-bottom"),D||n.removeClass("scrollable");else if(c<h&&(0>v||!n.hasClass("scrollable")))D||n.removeClass("scrollable"),
n.removeClass("dock-top"),n.removeClass("dock-bottom");else if(l&&B>e)n.hasClass("dock-bottom")||(n.addClass("dock-bottom"),n.removeClass("dock-top"));else if(c>h||0<v)l=n.hasClass("dock-top"),l||(n.addClass("dock-top"),n.removeClass("dock-bottom")),c<h&&l&&n.removeClass("dock-top"),h=Math.min(g,e-c+23),h-=m,h-=23,h-=23,k.subNav&&(h-=k.subNav.height()),t&&(r>=h||q)?(0<v&&(h-=v),n.css({"max-height":h+"px"}),n.addClass("scrollable")):t&&n.hasClass("scrollable")&&(n.css({"max-height":""}),n.removeClass("scrollable"))}}};
g.dockView=function(a,g,c){c.dockBottomAt=void 0!==c.dockBottomAt?c.dockBottomAt:Number.MAX_VALUE;c.contentHeight=void 0!==c.contentHeight?c.contentHeight:Number.MAX_VALUE;c.shouldDockBottom=c.shouldDockBottom||!1;c.canScroll=c.canScroll||!1;d[a]=[g,c]};g.undockView=function(a){d[a]&&(d[a][0].removeClass("dock-top").removeClass("dock-bottom").removeClass("scrollable").css({"max-height":""}),delete d[a])};g.disableDock=function(a){-1===p.indexOf(a)&&p.push(a);d[a]&&d[a][0].removeClass("dock-top").removeClass("dock-bottom").removeClass("scrollable").css({"max-height":""})};
g.enableDock=function(a){a=p.indexOf(a);-1<a&&p.splice(a,1)};g.changeDockAttr=function(a,i){if(d[a])for(var c in i){var b=c,f=i[c];if(d[a]){var m=d[a][1];m.hasOwnProperty(b)&&(m[b]=f)}}g.dockUndockViews()};g.initialize=function(){a.addObserver("scroll","dock",g.dockUndockViews)};return g});
define("explore/exploreLeftPane",["modules/dock","modules/view","jquery"],function(){return function(a){var g;this.resetLeftPane=function(){g.find(".clickable").removeClass("active");g.find(".filters").find("input").prop("checked",!1);g.find(".filters").removeClass("filtered")};g=a.find(".explore-attractions-left-pane");a.find(".explore-subnav-pane");a.find(".explore-attraction-results-pane");g.off("click.show-more").on("click.show-more",".show-more",function(){$(this).siblings("label").removeClass("hidden");
$(this).addClass("hidden")});g.find(".show-more").each(function(a,g){var m=$(g);m.siblings("input:checked").each(function(a,d){if($(d).next().hasClass("hidden"))return m.siblings("label").removeClass("hidden"),m.addClass("hidden"),!1})})}});
define("explore/explore","seo/landing plan/loading explore/exploreAttractions explore/exploreDestinations explore/exploreSearch explore/exploreAbout explore/exploreLeftPane modules/analytics modules/analyticsEventParams modules/history modules/view modules/events modules/ajax modules/modal modules/copyright modules/utils jquery".split(" "),function(a,g,d,p,m,j,i,c,b,f,u,n,k,h,e,l){return function(a,b){function q(a){G.length&&(G.data("isDirty")||!0===a)?(F.domainId||(F.domainId=J?J.find(".selected-destination").data("destinationId"):
void 0),y||(y="attractions"),a=$("#plan").data("planId")?"/trip/"+$("#plan").data("planId"):"",M&&g.showLoading(w,M,"Loading..."),k.makeAJAXcall({url:window.contextPath+a+"/explore/"+y,data:F,type:"GET",complete:function(){M&&g.hideLoading(w,M)},success:function(a){var b=$("<div />").append(a);$.trim(G.text()).length?(s.contents(b),H.contents(b),x.contents(b),J.html(b.find("#exploreSubnavPane").html()),A.onPageChange()):(h.isOpen()?G.find(".modal-content").html(a):G.html(a),z.initialize());G.data("isDirty",
!1);u.scrollAndUpdate();G.trigger("refreshed");F={}}})):(G.is(":visible")&&n.triggerEvent("explore","show-help-tips",{tabName:"#explore"}),F={},J&&J.find(".tab-"+y).addClass("active").siblings("li").removeClass("active"),M&&M.find("#"+y).removeClass("hidden").siblings("div").addClass("hidden"))}function D(){G.data("isDirty",!0)}function v(a){y=a;F.domainId=J.find(".selected-destination").data("destinationId");var b={requestData:$.extend(!0,{dontScrollToTop:!0},F.requestData),isModal:h.isOpen(),destinationId:F.domainId,
tab:h.getTab(),subnav:a},d=l.getPlanUrl()+"/explore/"+a+"?"+$.param(F);h.isOpen()?(b.modal="explore",d=l.planTabUrl()+"/modal/explore/"+a+"?"+$.param(F),h.pushHistory("browse"+a,h.getTab(),d,b),h.scrollTop(l.pageTopPx())):(f.push("browse"+a,"explore",d,b),$("html,body").scrollTop(l.pageTopPx()));F.view="partial";M.find("#"+y).removeClass("hidden").siblings().addClass("hidden");q();if($(this).data("isDirty")){switch(a){case "attractions":s.onPageChange();break;case "destinations":H.onPageChange();
break;case "about":x.onPageChange()}A.onPageChange();$(this).data("isDirty",!1)}b=$("#analytics-metadata");d=$("#destination-analytics-metadata");c.setPageTypeNew(b.data("pageTypeNew")+" : destination details : "+a);c.setEntityType(d.data("entityType"));c.setEntity(d.data("entity"));c.trackPageView("/plan/explore/destination/"+a)}function B(){var a=$(this).data("visitId"),b=$(this).data("date"),c=$(".modal-box").length?$(".modal-box .ui-dialog-content").scrollTop():window.pageYOffset;$(".tip-infowindow").qtip("hide",
!0);$(".tip-infowindow").qtip("hide",!0);h.close();$(".dlg-large-map .ui-dialog-content").dialog("close");n.triggerEvent("route","show-tab-itinerary",{addToHistory:!1,tabData:{subnav:"calendar",visitId:a,date:b,pageYOffset:c}})}var z={},C="explore",G,M,w,J,F={},y,s,H,x,A,z=this;z.isDirty=function(){return G.data("isDirty")};z.initialize=function(){if($.trim(G.text()).length){e.initialize();var a=G;M=a.find(".explore-main-pane");w=a.find(".explore-loading-pane");a.find(".explore-attractions-pane");
a.find(".explore-attractions-left-pane");J=a.find(".explore-subnav-pane");y=J.find("ul.sub-nav-bar li.active").data("tabName");A=new m(G);new i(G);s=new d(G,A);H=new p(G,b,A);x=new j(M.find("#about"),null,null,null,A);G.is(":visible")&&n.triggerEvent("explore","show-help-tips",{tabName:"#explore"});J.off("click.sub-nav-bar").on("click.sub-nav-bar","ul.sub-nav-bar li",function(){$(this).addClass("active").siblings().removeClass("active");v.bind($(this))($(this).data("tabName"))});$("body").off("click.slot-time-range").on("click.slot-time-range",
".slot-time-range",B)}};G=a;C=b?C+"_"+b:C;G.length&&(n.addObserver("refresh-explore",C,function(a,c){if(b&&h.isOpen()||!b)y=!c.showLanding?y:"attractions",q(c.showLanding)}),n.addObserver("explore-browse",C,function(a,c){if(b&&h.isOpen()||!b)F=c&&c.requestData?c.requestData:{},F.domainId=c.destinationId,y=c.subnav,q()}),n.addObservers("plan-update stay-add stay-remove stay-update visit-add visit-remove".split(" "),C,D),n.addObserver("on-modal-close",C,function(){(b&&h.isOpen()||!b)&&q()}),this.initialize())}});
define("explore/exploreWrapper","modules/analytics explore/explore explore/exploreSearch modules/modal modules/events modules/utils plan/details modules/sojern".split(" "),function(a,g,d,p,m,j,i,c){function b(b){var f=b.url,h=b.analyticsEventCategory,e=f.split("https://www.inspirock.com/"),g=e[e.length-1],g=g.split("-"),g=g[g.length-1];if("a"===g.charAt(0)){g=e[e.length-2]+"-"+e[e.length-1];h&&a.trackNonInteractionEvent(h,"attraction-details",g.toLowerCase());-1!==f.indexOf("modal")&&(f="/trip/"+e[2]+f.split("modal")[1]);
for(var g="",j=3;j<e.length&&"modal"!==e[j];)g.length&&(g+="https://www.inspirock.com/"),g+=e[j++];p.open({dialogClass:"full dock-close explore-search",data:b.addnlData,showBack:!0,ajaxParams:{url:f,data:{view:"partial"},type:"GET",func:{success:function(a){return'<div class="details-pane attractions">'+a+"</div>"},error:function(a){a.append($("<div>").text("An error has occurred").css({"text-align":"center"}))}}},onLoad:function(e){$(p.isOpen()?".modal-box":"html,body").scrollTop(0);i.initialize($(".modal-box .details-pane"),
"details","explore","explore.destinations.details");e.off("click.claimPlan").on("click.claimPlan",".claimPlanLink .create-similar",function(){m.triggerEvent("details","claimPlan",{})});e.parents(".modal-box").find(".ui-dialog-titlebar .explore-search-container").remove();var f=e.parents(".modal-box").find(".ui-dialog-titlebar .ui-dialog-title"),g=f.html();f.replaceWith($('<div id="'+f.attr("id")+'" class="'+f.attr("class")+'" />')).html(g);e.parents(".modal-box").find(".ui-dialog-titlebar .ui-dialog-title").append(e.find(".explore-search-container").removeClass("hidden"));
new d(e.parents(".modal-box"));f=e.find(".attraction-details");c.trackPixel("vp",{vb:f.data("attractionName"),vt:f.find(".tags-attractions .tag").eq(0).text().trim(),vf1:f.data("destinationName"),vs1:f.data("stateCode"),vn1:f.data("countryCode")});h&&(g=$("#analytics-metadata"),a.setPageTypeNew(g.data("pageTypeNew")+" : attraction details"),f.data("isGroup")?a.setEntityType("Attraction group"):a.setEntityType("Attraction"),a.setEntity(f.data("attractionName")+" ("+f.data("attractionId")+")"),a.trackPageView("/plan/explore/attractions"));
"map"===b.tabId&&e.find(".view-tabs .tab.maps").click()},onUnload:function(a){a.parents(".modal-box").find(".ui-dialog-titlebar").removeClass("dock");a.parents(".modal-box").find(".ui-dialog-titlebar .ui-dialog-title").html("")}})}}function f(a){var b=a.data("link")||a.attr("href"),c=$("#plan").data("planId"),d=a.data("destinationId"),f=a.data("subnav")?a.data("subnav"):"about";d||(d=b.split("trip-planner-d")[1]);-1===b.indexOf(c)?j.planTabUrl():(j.planTabUrl(),b.replace(/\/trip\/.*?\//,""));b=a.parents(".tab-content");
0===b.length&&(b=$(".tab-content:visible"));0<b.length&&b.attr("id");a.data("eventSrc")||a.parents(".data-holder").data("eventSrc");a=b.attr("id");a={path:j.getPlanUrl(),requestData:{},history:{id:"browseAbout",tabId:a,url:j.planTabUrl()+"/modal/explore/"+f+"?domainId="+d,data:{detailsUrl:j.planTabUrl()+"/modal/explore/"+f,backText:"",eventSource:a,modal:"explore",tab:a,destinationId:d,requestData:{},isModal:!0}}};$(".tip-infowindow").length&&$(".tip-infowindow").qtip("hide",!0);u.loadExploreInModal(b.attr("id"),
d,a,f);return!1}var u={gotoBrowseNightlife:function(a,b){var c={destinationId:a,attractionscategoryFilters:[],attractionscategoryGroupFilters:[29],attractionsotherFilters:[],attractionshideInPlan:!1,attractionshideOutside:!1,attractionssortBy:"popularity",attractionsmaxNumResults:10,attractionspageIndex:0},c={path:"/trip/"+$("#plan").data("planId")+"/"+b+"/",requestData:c,history:{id:"browseAttractions",tabId:b,url:j.getPlanUrl()+"/"+b+"/modal/explore/attractions?"+$.param(c),data:{detailsUrl:j.getPlanUrl()+
"/"+b+"/modal/explore/attractions?"+$.param(c),backText:"",eventSource:b,modal:"explore",tab:b,destinationId:c.destinationId,requestData:c,isModal:!0}}};u.loadExploreInModal(b,a,c,"attractions")},gotoSelectedTagPlaces:function(a,b,c,d,f,g,i){a={domainId:d,attractionscategoryFilters:b,attractionscategoryGroupFilters:a,attractionsotherFilters:c,attractionshideInPlan:void 0===i?!1:i,attractionshideOutside:!1,attractionssortBy:"popularity",attractionsmaxNumResults:10,attractionspageIndex:0,modal:!0};
a={path:j.planTabUrl(),requestData:a,history:{id:"browseAttractions",tabId:f,url:j.planTabUrl()+"/modal/explore/attractions?"+$.param(a),data:{detailsUrl:j.planTabUrl()+"/modal/explore/attractions?"+$.param(a),backText:"",eventSource:f,modal:"explore",tab:f,destinationId:a.destinationId,requestData:a,isModal:!0}}};g&&(a.forceDateAndStayData=g);u.loadExploreInModal(f,d,a,"attractions")},attractionDetailsPageLinks:function(a){$.fancybox.close();$(".dlg-large-map .ui-dialog-content, .itinerary-maps-pane .ui-dialog-content, .dlg-show-overflow-calendar .ui-dialog-content").dialog("close");
$(".qtip-infowindow").hide();var c=$(this),a=$(a.target),a=a.hasClass("ticket-module")?a:a.parents(".ticket-module");if(!a.length){!c.data("link")&&(!c.data("detailsUrl")&&!c.attr("href"))&&(c=$(this).parents(".data-holder"));$("#explore-search").val("");var a=c.data("link")||c.attr("href")||c.data("detailsUrl"),d=location.pathname,e=$("#plan").data("planId"),a=-1===a.indexOf(e)?j.planTabUrl()+"/modal"+a:j.planTabUrl()+"/modal/"+a.replace(/\/trip\/.*?\//,""),e=$(".tab-content.active"),f="";0<e.length&&
(f+=e.attr("id"));f+="."+(c.data("eventSrc")||c.parents(".data-holder").data("eventSrc"));$(this).parents(".ui-dialog.visitReservedDialog").remove();b({url:a,analyticsEventCategory:f,shouldScroll:!0,backText:"back",addnlData:{path:d,history:{id:"exploreAttractionDetails",tabId:e.attr("id"),url:a,data:{detailsUrl:a,backText:"back",eventSource:f,modal:"explore"}}}});return!1}},destinationDetailsPageLinks:function(a){a.preventDefault();$(".dlg-large-map .ui-dialog-content, .itinerary-maps-pane .ui-dialog-content").dialog("close");
a=$(this);return f(a)},loadExploreInModal:function(b,d,f,e){var l=f&&f.requestData?f.requestData:{destinationId:d};$(".qtip-infowindow").qtip("hide",!0);e=e?e:"attractions";l.domainId||(l.domainId=d);var i=$("#plan").data("planId")?"/trip/"+$("#plan").data("planId"):"";p.open({data:f?f:{path:"/trip/"+$("#plan").data("planId")+"/"+b+"/",history:{id:"browse"+e,tabId:b,url:j.getPlanUrl()+"/"+b+"/modal/explore/"+e+"?destinationId="+d,data:{detailsUrl:j.getPlanUrl()+"/"+b+"/modal/explore/"+e+"?destinationId="+
d,backText:"",eventSource:b,modal:"explore",isModal:!0,tab:b,destinationId:d}}},dialogClass:"full dock-close explore-subnav",showBack:!0,ajaxParams:{url:window.contextPath+i+"/explore/"+e,data:l,type:"GET"},onLoad:function(b){if(b.find(".explore-subnav-pane").length){b.parents(".modal-box").find(".ui-dialog-titlebar .explore-subnav-pane").remove();var d=b.parents(".modal-box").find(".ui-dialog-titlebar .ui-dialog-title"),l=d.html();d.replaceWith($('<div id="'+d.attr("id")+'" class="'+d.attr("class")+
'" />')).html(l);b.parents(".modal-box").find(".ui-dialog-titlebar .ui-dialog-title").append(b.find(".explore-subnav-pane"))}d=$(".modal-box");new g(d,"modal");b.find(".tab-"+e).addClass("active").siblings().removeClass("active");f&&f.forceDateAndStayData&&b.find("#exploreAttractionsMainPane").data("forcedDateTime",f.forceDateAndStayData.date).data("forcedStayId",f.forceDateAndStayData.stayId).data("shouldForceDateTimeAndStay",!0);b=b.find(".destination-details");c.trackPixel("vs",{vf1:b.data("destinationName"),
vs1:b.data("stateCode"),vn1:b.data("countryCode")});b=$("#analytics-metadata");d=$("#destination-analytics-metadata");a.setPageTypeNew(b.data("pageTypeNew")+" : destination details : "+e);a.setEntityType(d.data("entityType"));a.setEntity(d.data("entity"));a.trackPageView("/plan/explore/destination/"+e)}})},initialize:function(a){m.addObserver("load-explore-in-modal","explore",function(a,b){u.loadExploreInModal(b.tab,b.destinationId,b.addlData,b.subnav)});m.addObserver("explore-load-destination-in-modal",
"explore",function(a,b){u.loadExploreInModal(b.tab,b.destinationId,b.addlData,"destinations")});m.addObserver("explore-all-attractions","explore",function(a,b){var c=b.destinationId,d=b.tab,f=b.subnav,g=b.hideInPlan,g={domainId:c,attractionscategoryFilters:[],attractionscategoryGroupFilters:[],attractionsotherFilters:[],attractionshideInPlan:void 0===g?!1:g,attractionshideOutside:!1,attractionssortBy:"popularity",attractionsmaxNumResults:10,attractionspageIndex:0,modal:p.isOpen()},f=f?f:"attractions",
g={path:"/trip/"+$("#plan").data("planId")+"/"+d+"/",requestData:g,history:{id:"browse"+f,tabId:d,url:j.getPlanUrl()+"/"+d+"/modal/explore/"+f+"?"+$.param(g),data:{detailsUrl:j.getPlanUrl()+"/"+d+"/modal/explore/"+f+"?"+$.param(g),backText:"",eventSource:d,modal:"explore",tab:d,subnav:f,destinationId:g.destinationId,requestData:g,isModal:!0}}};u.loadExploreInModal(d,c,g,f)});m.addObserver("goto-selected-tag-places","explore",function(a,b){u.gotoSelectedTagPlaces(b.catGroupIds,b.catIds,b.otherIds,
b.destinationId,b.tab)});m.addObserver("explore-destination-details-click","explore",function(a,b){f(b.target)});m.addObserver("explore-attraction-details","details",function(a,c){b(c)});new g(a,void 0)}};return u});
define("preprocess",["explore/exploreWrapper","modules/events","modules/utils","jquery","qtip"],function(a,g,d){return{initialize:function(){if(-1!==location.pathname.indexOf("https://www.inspirock.com/modal/")){for(var p=location.pathname.split("https://www.inspirock.com/"),m=3,j="";m<p.length&&"modal"!==p[m];)""!==j&&(j+="https://www.inspirock.com/"),j+=p[m++];var p=j,i=location.pathname.split("https://www.inspirock.com/modal/")[1],m=p.split("https://www.inspirock.com/")[0],c=location.pathname,j=location.search?location.search.split("?")[1]:"",b;switch(!0){case /explore.*attractions/.test(i):i=null;j&&(b=d.deparam(j),
b.hasOwnProperty("pageIndex")&&(b.pageIndex=parseInt(b.pageIndex)),b.hasOwnProperty("numResults")&&(b.numResults=parseInt(b.numResults)),i={path:d.planTabUrl()+"/",requestData:b,replaceHistory:!0,history:{id:"browseAttractions",tabId:m,url:d.planTabUrl()+"/modal/explore/attractions?"+j,data:{detailsUrl:d.planTabUrl()+"/modal/explore/attractions?"+j,backText:"",eventSource:p,modal:"explore",tab:p,destinationId:b.destinationId,isModal:!0,requestData:b}}});a.loadExploreInModal(p,b.destinationId,i,"attractions");
break;case /explore.*destinations/.test(i):i=null;j&&(b=d.deparam(j),b.exploreDestinations=!0,b.hasOwnProperty("pageIndex")&&(b.pageIndex=parseInt(b.pageIndex)),b.hasOwnProperty("numResults")&&(b.numResults=parseInt(b.numResults)),i={path:d.planTabUrl()+"/",requestData:b,replaceHistory:!0,history:{id:"browseDestinations",tabId:m,url:d.planTabUrl()+"/modal/explore/destinations?"+j,data:{detailsUrl:d.planTabUrl()+"/modal/explore/destinations?"+j,backText:"",eventSource:p,modal:"explore",tab:p,destinationId:b.destinationId,
isModal:!0,requestData:b}}});g.triggerEvent("overview","explore-load-destination-in-modal",{tab:p,destinationId:b?b.destinationId:null,addlData:i});break;case /explore.*about/.test(i):i=null;j&&(b=d.deparam(j),b.hasOwnProperty("pageIndex")&&(b.pageIndex=parseInt(b.pageIndex)),b.hasOwnProperty("numResults")&&(b.numResults=parseInt(b.numResults)),i={path:d.planTabUrl()+"/",requestData:b,replaceHistory:!0,history:{id:"browseAbout",tabId:m,url:d.planTabUrl()+"/modal/explore/about?"+j,data:{detailsUrl:d.planTabUrl()+
"/modal/explore/about?"+j,backText:"",eventSource:p,modal:"explore",tab:p,destinationId:b.destinationId,isModal:!0,requestData:b}}});a.loadExploreInModal(p,null,i,"about");break;case /.*d[0-9x]*$/.test(i):g.triggerEvent("plan","load-destination-details",{url:c,analyticsEventCategory:p,addnlData:{replaceHistory:!0,path:d.planTabUrl(),history:{id:"exploreDestinationDetails",tabId:m,url:c,data:{detailsUrl:c,backText:"",eventSource:p,modal:"explore"}}}});break;case /.*a[0-9xy_/]*$/.test(i):g.triggerEvent("overview",
"explore-attraction-details",{url:($("#plan").length?"/trip/"+$("#plan").data("planId"):"/trip")+"/"+i,analyticsEventCategory:"itinerary.attraction.modal.reload",shouldScroll:!0,backText:"back",addnlData:{replaceHistory:!0,path:d.planTabUrl()+"/",history:{id:"exploreAttractionDetails",tabId:m,url:c,data:{detailsUrl:c,backText:"",eventSource:p,modal:"explore"}}}})}}}}});define("text%21templates/deleteConfirmation.html",[],function(){return'<div>\n    <div class="delete-confirm">\n        <div class="delete-title alt hidden">Deleting &ldquo;<span class="name"></span>&rdquo; will remove all notes &amp; attachments.</div>\n        <div class="delete-title">Delete Destination?</div>\n        <input type="button" class="cta-button small cancel" value="Cancel">\n        <input type="button" class="cta-button small delete" value="Yes, Delete">\n    </div>\n</div>'});
define("plan/minicalendar",["moment","modules/utils","jquery"],function(a,g){return{generateMiniCalendar:function(d,p,m,j){var i=d.clone().startOf("week"),c=(p.isAfter(m)?p:m).clone().endOf("week"),b;b='<div class="mc">';for(var f="",u=0,n=i.clone(),f=f+'<table class="shell"><thead><tr class="notranslate"><th>S</th><th>M</th><th>T</th><th>W</th><th>T</th><th>F</th><th>S</th></tr></thead>',f=f+"<tbody>";n.isSame(c)||n.isBefore(c);){var k=(n.isSame(d)||n.isAfter(d))&&(n.isSame(p)||n.isBefore(p)),h=
!k&&n.isAfter(p)&&(n.isBefore(m)||n.isSame(m)),e=k&&n.isAfter(m),l=u,t="";0===l&&(t+="<tr>");var r=[];k&&r.push("in-plan");h&&r.push("empty");e&&r.push("extra");t+='<td class="'+g.joinArray(r," ")+'">';if(k||h)t+='<div class="day"></div>';t+="</td>";6===l&&(t+="</tr>");f+=t;u=++u%7;n.add(1,"day")}f+="</tbody>";f+="</table>";b+=f;b+='<div class="stays">';for(var q in j){u=j[q];n=i;f=a.duration(u.startTime.diff(n));f=Math.round(100*(f.asMinutes()/10080));k=Math.max(1,Math.round(100*(u.endTime.diff(u.startTime,
"minutes")/10080)));a.duration(u.endTime.diff(n)).asMinutes();n=0;for(l=f;100<=l;)l-=100,n+=40;f="";for(e=0;0<k;){var h=Math.min(100-l,k),t=0===e&&h===k,r=0===e&&h<k,D=0!==e&&h===k,l=$("<div>").addClass("stay").attr("title",u.title).attr("data-stay-id",u.stayId).attr("data-destination-id",u.destinationId).css("left",l+"%").css("top",n+"px").css("width",h+"%").css("background",u.backgroundColor);t?l.addClass("full"):r?l.addClass("left"):D&&l.addClass("right");u.highlighted&&l.addClass("highlighted");
f+=$("<div>").append(l).html();l=0;k-=h;n+=40;e++}b+=f}j=b+"</div>";q="";b=0;i=i.clone();for(q+='<table class="dates"><tbody  class="notranslate">';i.isSame(c)||i.isBefore(c);){u=(i.isSame(d)||i.isAfter(d))&&(i.isSame(p)||i.isBefore(p));n=!u&&i.isAfter(p)&&(i.isBefore(m)||i.isSame(m));u&&i.isAfter(m);0===b&&(q+="<tr>");q+="<td>";if(u||n)q+='<div class="day">',q+='<div class="date-text">'+i.date()+"</div>",q+="</div>";q+="</td>";6===b&&(q+="</tr>");b=++b%7;i.add(1,"day")}q+="</tbody>";q+="</table>";
b=j+q;return b+="</div>"}}});define("text%21templates/addCustomTravel.html",[],function(){return'<div class="travel-edit">\n    <label for="travel-mode-dlg-field">Travel Options</label>\n    <input type="text" name="custom-travel-mode" class="custom-travel-mode"  placeholder="Enter transportation type"/>\n    <div class="date-time start-container">\n        <div class="custom-event-date calendar-input">\n            <input type="text" name="custom-event-date-copy" class="custom-event-date-copy container-datepicker" readonly="readonly"/>\n            <input type="text" name="custom-event-date-box" class="custom-event-date-box flat" placeholder="Start date" readonly="readonly"/>\n            <svg class="calendar-icon">\n            <use xlink:href="#icon-calendar" />\n            </svg>\n        </div>\n        <div class="time-holder">\n            <select id="start-time" class="time-in-minutes notranslate" name="day"></select>\n        </div>\n    </div>\n    <div class="date-time end-container">\n        <div class="custom-event-date calendar-input">\n            <input type="text" name="custom-event-date-copy" class="custom-event-date-copy container-datepicker" readonly="readonly"/>\n            <input type="text" name="custom-event-date-box" class="custom-event-date-box flat" placeholder="End date" readonly="readonly"/>\n            <svg class="calendar-icon">\n            <use xlink:href="#icon-calendar" />\n            </svg>\n        </div>\n        <div class="time-holder">\n            <select id="end-time" class="time-in-minutes notranslate" name="day"></select>\n        </div>\n    </div>\n    <div class="note-container hidden">\n        <div class="note-header">Notes:</div>\n        <div class="note-text-summary"></div>\n        <div class="add-attachments">\n            <div class="attachment-list"></div>\n        </div>\n    </div>\n    <div class="text-link show-notes"> + Add notes & attachments</div>\n    <div class="clearfix"></div>\n    <div class="notes-attachment-wrapper attachment-container hidden" data-type="travel">\n        <textarea class="activity-name add-note-text flat" placeholder="Add notes"></textarea>\n        <div class="add-attachments">\n            <div class="attachment-list"></div>\n            <div class="attach-icon-wrapper">\n                <svg class="attach-icon">\n                    <use xlink:href="#icon-attach" />\n                </svg>\n            </div>\n            <input type="file" id="multi-attach-file" name="url[]" class="hidden" multiple />\n        </div>\n    </div>\n    <div class="error hidden"></div>\n</div>'});
define("jQueryExtensions/colorCalendar",["modules/utils","jquery","jqueryui"],function(a){$.fn.colorCalendar=function(){$(this).find("td").each(function(){var g=$(this),d=g.find(".day"),p=g.data("stayIndex");void 0!==p&&(p=a.getColor(p),g.removeClass("highlighted").find(".background").css({background:p}));d.hasClass("empty")?g.qtip({content:"You have open days in your plan.",style:{classes:"error-qtip qtip-light qtip-shadow"},position:{viewport:$(window)}}):d.hasClass("extra")&&g.qtip({content:"Your plan is going past your end date.",
style:{classes:"error-qtip qtip-light qtip-shadow"},position:{viewport:$(window),my:"top right",at:"bottom right"}})})}});
define("jQueryExtensions/minimap","modules/utils modules/copyright modules/analytics modules/analyticsEventParams modules/events minimapHelper modules/ajax jquery jqueryui".split(" "),function(a,g,d,p,m,j,i){function c(a,b,c,d,g){var e=$.extend(!0,{},b,b.modalOverides);e.isModal=!0;e.$rootView=null;e.idKey=c||e.idKey;e.donotChangeBounds=d;e.refreshMarkers=g;e.analyticsCategory=b.analyticsCategory+".modal";e.refreshListeners=!0;e.onMapReady=function(){a.children().css("opacity",1)};a.prepareMiniMap(e)}
function b(b,g,j){var k=$("body"),h=k.data("mapDiv");h||(h=$(document.createElement("div")),h.attr("id","detailsMap"),h.addClass("large-map"),h.addClass("name-only-label"),h.css({width:"100%",height:"100%"}),k.data("mapDiv",h));k=$(this).attr("class")?$(this).attr("class").replace("mini-map",""):"";h.dialog({resizable:!1,modal:!0,draggable:!1,width:0.95*$(window).width(),height:0.95*$(window).height(),dialogClass:"dlg-large-map mediumx "+k,open:function(){d.trackEvent(b.analyticsCategory,"show-modal-map");
h.children().css("opacity",0);h.data("googleMap")&&j&&(h.data("googleMap").fitBounds(j.getBounds()),h.data("googleMap").setCenter(j.getCenter()));b.modalDataUrl&&b.modalDataSelector&&!b.modalOverides.$mapMarkerDataHolders?i.makeAJAXcall({type:"GET",url:b.modalDataUrl,success:function(a){b.modalOverides.$mapMarkerDataHolders=$(a).find(b.modalDataSelector);c(h,b,g)}}):c(h,b,g);h.parents(".ui-dialog").data("uniqueId",b.uniqueId);a.setupDialogOverlay(h,!1,void 0,void 0,!0)},beforeClose:function(){$(".tip-infowindow").qtip("hide")},
close:function(){window.google.maps.event.removeListener(window.dragEndListener);window.google.maps.event.removeListener(window.zoomChangedListener);window.google.maps.event.removeListener(window.dragListener)}})}$.fn.prepareMiniMap=function(f){function u(){f.boundsChanged&&!f.nonInteractive&&(window.google.maps.event.removeListener(window.dragEndListener),window.google.maps.event.removeListener(window.zoomChangedListener),window.dragEndListener=window.google.maps.event.addListener(z,"dragend",function(){window.google.maps.event.addListenerOnce(z,
"idle",function(){f.boundsChanged(e,z.getBounds(),z.getCenter(),f)})}),window.zoomChangedListener=window.google.maps.event.addListener(z,"zoom_changed",function(){window.google.maps.event.clearListeners(z,"idle");window.google.maps.event.addListenerOnce(z,"idle",function(){f.boundsChanged(e,z.getBounds(),z.getCenter(),f)})}))}function n(){z.getZoom()>h.maxZoomLevel&&!0!==f.donotChangeBounds&&z.setZoom(h.maxZoomLevel)}function k(){l.is(":visible")&&(window.google.maps.event.trigger(z,"resize"),z&&
(C&&!h.autoZoomComplete)&&(!0!==f.donotChangeBounds&&(z.fitBounds(C),z.setCenter(C.getCenter())),n(),window.google.maps.event.addListenerOnce(z,"idle",function(){n()})))}var h={},e=$(this),l=e.is(".mini-map, .large-map")?e:e.find(".mini-map, .large-map"),t=l.data("unit"),r=f.idKey||"destinationId",q=f.nonInteractive||!1,D=$("body");if(l.length){f.isModal&&(l.removeAttr("data-map-type"),l.attr("data-map-type",f.mapType));f.markerLabelStart||(f.markerLabelStart=0);var v={center:new window.google.maps.LatLng(0,
0),zoomControl:!q,disableDoubleClickZoom:q,scaleControl:l.hasClass("large-map"),fullscreenControl:!1,mapTypeId:window.google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,keyboardShortcuts:!1,overviewMapControl:!1,scrollwheel:f.scrollwheel?f.scrollwheel:!1,streetViewControl:!1,draggable:!q,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit.station",elementType:"labels.icon",stylers:[{visibility:"off"}]}]},
B=void 0!==l.data("googleMap")&&$.trim(l.html());B||(l.data("tracked",""),l.data("mapMarkers",""),l.data("directionLines",""));var z=B?l.data("googleMap"):new window.google.maps.Map(l[0],v),C=new window.google.maps.LatLngBounds,G=[],M={},w={},J={},F={},y,s;l.data("googleMap",z);var H=setTimeout(function(){if(f.onMapReady)f.onMapReady()},500);window.google.maps.event.addListenerOnce(z,"tilesloaded",function(){l.data("tracked")||(l.data("tracked",!0),d.trackNonInteractionEvent(f.analyticsCategory,p.ACT_GMAP_LOAD))});
window.google.maps.event.clearListeners(z,"idle");window.google.maps.event.addListenerOnce(z,"idle",function(){clearTimeout(H);if(t){var b=l.find(".gm-style-cc:not(.gmnoprint):contains(' m'),.gm-style-cc:not(.gmnoprint):contains(' km')").filter(function(){return"MILES"===t&&(a.endsWith($(this).text()," km")||a.endsWith($(this).text()," m"))||"KILOMETERS"===t&&!a.endsWith($(this).text()," km")&&!a.endsWith($(this).text()," m")});b.length&&b.click()}if(f.onMapReady)f.onMapReady();u()});u&&u();if(f.boundsChanged&&
f.refreshMarkers)f.refreshMarkers=!1,f.boundsChanged(e,z.getBounds(),z.getCenter(),f);else{var x={showInfoWindow:function(a,b,c,d){if(c&&y&&y.uniqueId!==a){$(w[y.uniqueId].getMarkerSpan()).removeClass("highlight");var e=y.stayId,h=y.uniqueId;delete J[h];y.close();!d&&l.data("onInfoWindowHide")&&l.data("onInfoWindowHide")(e,h,c)}s&&s!==i&&($(w[s.uniqueId].getMarkerSpan()).removeClass("highlight"),e=s.stayId,h=s.uniqueId,delete J[h],s.close(),!d&&l.data("onInfoWindowHide")&&l.data("onInfoWindowHide")(e,
h,c));var i=J[a]||x.createInfoWindow(a);f.keepOpenAllowed&&b?(y=i,s=null):s=i;!q&&(i&&!i.qtip)&&(i.open(z),window.google.maps.event.addListener(i,"domready",function(){g.initialize()}));!d&&(l.data("onInfoWindowShow")&&i)&&(l.data("onInfoWindowShow")(i.stayId,i.uniqueId,f.keepOpenAllowed&&b),$(w[a].getMarkerSpan()).addClass("highlight"))},hideInfoWindow:function(a,b,c){if(b&&void 0!==y){$(w[y.uniqueId].getMarkerSpan()).removeClass("highlight");var d=y.stayId,e=y.uniqueId;y.close();y=void 0;!c&&l.data("onInfoWindowHide")&&
l.data("onInfoWindowHide")(d,e,b)}d=J[a];void 0!==d&&d!==y&&($(w[a].getMarkerSpan()).removeClass("highlight"),delete J[a],d.close(),!c&&l.data("onInfoWindowHide")&&l.data("onInfoWindowHide")(d.stayId,d.uniqueId,b))},highlightStay:function(a){var a=w[a],b=a.position_;z.getBounds().contains(b)||z.panTo(b);$(a.getMarkerSpan()).css({"z-index":10}).addClass("highlight")},unhighlightStay:function(a){$(w[a].getMarkerSpan()).css({"z-index":""}).removeClass("highlight")},showInfoWindowForStay:function(a,b,
c,d){$(w[a].getMarkerSpan()).css({"z-index":10}).addClass("highlight");x.showInfoWindow(a,b,c,d)},hideInfoWindowForStay:function(a,b,c){$(w[a].getMarkerSpan()).css({"z-index":""}).removeClass("highlight");x.hideInfoWindow(a,b,c)},createInfoWindow:function(a){var b=M[a],c=b.data(r||"destinationId"),d=b.data("lat"),e=b.data("lng"),a=b.data("stayId"),g=b.data("name"),h=new window.google.maps.LatLng(d,e),d='<div class="info-window-content">';f&&f.content?d+=f.content({uniqueId:c,destinationId:c,$dataHolder:b}):
(d+='<div class="title">',d=b.data("link")?d+('<a class="title clickable-text" href='+b.data("link")+">"+g+"</a>"):d+g,d+="</div>");d+="</div>";b=f&&f.getPixelOffset?f.getPixelOffset(b):new window.google.maps.Size(0,-38,"px","px");if(f.showInfoWindowAsQtip){var i;$.each(w,function(a,b){var c=b.position_;c.lat()===h.lat()&&c.lng()===h.lng()&&(i=b)});if((b=1===$(i.getMarkerSpan()).find(".minor-point").length)&&!f.showMinorPointDetails)return;$(".tip-infowindow").qtip("hide");j.qtipInfoWindow({markerSpan:i.getMarkerSpan(),
content:d,isMinorPoint:b,$miniMap:l,googleMap:z,qtip:f.qtip});a={stayId:a,uniqueId:c,qtip:!0,close:function(){$(i.getMarkerSpan()).qtip("hide",!0)}}}else a=new window.google.maps.InfoWindow({content:d,position:h,disableAutoPan:!1,pixelOffset:b,stayId:a,uniqueId:c}),window.google.maps.event.addListener(a,"closeclick",function(){x.hideInfoWindow(c,!0);i&&i.tooltip.destroy(".qtip")});return J[c]=a},onClick:function(){f.enlargeMap&&l.click()}};h.autoZoomComplete=!1;var w={},F={},A=l.data("mapMarkers"),
v=l.data("directionLines");l.data("infoWindowController",x);l.data("mapMarkers",w);l.data("directionLines",F);B=$($.extend([],f.$mapMarkerDataHolders));f.filter&&(B=f.filter(B,z.getBounds()));B.each(function(a){$(this).data("initialOrder",a)});B.sort(function(a,b){var c=$(a).data("minorPoints"),d=$(b).data("minorPoints");return c&&!d?-1:!c&&d?1:$(a).data("lat")<$(b).data("lat")});B.each(function(){var b=$(this),c=b.data("initialOrder"),d=b.data(r),e=b.data("lat"),g=b.data("lng"),h=b.data("ignoreBounds")?
!0:!1,i=b.data("stayId"),e=new window.google.maps.LatLng(e,g),g=b.data("mapMarkerColorIndex")||(l.data("singleColor")?5:c%a.getNumColors()),c=b.data("markerLabel")||(f.showMarkerLabel?f.markerLabelStart+c+1:""),j=b.data("minorPoints"),k=b.data("inPlan")?!0:!1;if(w[d])return!0;M[d]=b;b=new window.LabelMapMarker({label:c,markerIconIndex:g,markerChecked:k,mapPosition:e,infoWindow:d,map:z,controller:f.noInfoWindow?null:x,showMarkerRing:b.data("showMarkerRing"),stayId:i,destinationId:d,eventName:f.eventName,
minorPoint:j,inPlan:b.data("inPlan"),addMarkerIcon:f.showAddMarkerIcon});w[d]=b;h||C.extend(e);G.push(e);if(A&&A[d]&&A[d].markerChecked_===k&&A[d].label_===c&&A[d].minorPoint_===j)return A[d].controller_=f.noInfoWindow?null:x,w[d]=A[d],!0;b.setMap(z)});A&&$.each(A,function(a,b){var c=w[b.destinationId_];(!c||b.markerChecked_!==c.markerChecked_||b.label_!==c.label_||b.minorPoint_!==c.minorPoint_)&&b.setMap(null)});if(f.showDirections){for(B=0;B<f.$mapMarkerDataHolders.length-1;B++){var E=$(f.$mapMarkerDataHolders[B]),
K=$(f.$mapMarkerDataHolders[B+1]);if(!(!1===E.data("show-directions")||!1===K.data("show-directions"))){var L="",Q=$(".dlg-large-map");if(Q.length&&Q.find(".ui-dialog-content").dialog("isOpen")){var N=$("<div />").append($("#travel-row-"+E.data("travel-id")).find(".content .dates").clone());N.find(".mode-type").attr("style","text-transform:capitalize;font-weight:700;");L+=N.html()}N=E.data("destinationId")+"_"+K.data("destinationId");v&&v[N]&&v[N].dottedLines===f.dottedLines?(F[N]=v[N],F[N].content=
L):(E=f.dottedLines?new window.dottedLines(E,K,L,z,f.strokeColor):new window.drawCurve(E,K,L,z,f.strokeColor,Q),E.dottedLines=f.dottedLines,F[N]=E)}}v&&$.each(v,function(a,b){var c=F[b.uniqueId];(!c||c.dottedLines!==b.dottedLines)&&b.setMap(null)})}h.startZoomLevel=void 0===r||"destinationId"===r||"stayId"===r?7:16;h.maxZoomLevel=void 0===r||"destinationId"===r||"stayId"===r?1===G.length?7:l.hasClass("large-map")?12:9:17;h.dataZoom=l.data("zoom");l.on("resize",k);if(f.$rootView&&f.$rootView.length)f.$rootView.off("isVisible.init").on("isVisible.init",
k);k();f.$rootView&&(!l.hasClass("large-map")&&l.data("enlargeMap"))&&(e.off("click.minimap").on("click.minimap",".mini-map, .mini-map .map-marker",function(){b(f,r,z)}),$(".dlg-large-map").is(":visible")&&($(".dlg-large-map").data("uniqueId")===f.uniqueId&&!f.refreshMarkers)&&(f.modalDataUrl&&f.modalDataSelector?i.makeAJAXcall({type:"GET",url:f.modalDataUrl,success:function(a){f.modalOverides.$mapMarkerDataHolders=$(a).find(f.modalDataSelector);c(D.data("mapDiv"),f,r,!0,!0)}}):c(D.data("mapDiv"),
f,r,!0,!0)));m.addObserver("show-map-modal","minimap",function(){b(f,r,z)});return h}}};$.fn.prepareModalMiniMap=function(a){a.$rootView.data("showModal",function(){b(a,a.idKey)})}});
define("plan/route","modules/analytics modules/analyticsEventParams modules/utils modules/ajax modules/events modules/copyright plan/planUtils explore/exploreDestinations modules/dock modules/view modules/modal modules/hotelbooking modules/map moment modules/dateRange modules/preparetravelers text!templates/deleteConfirmation.html plan/minicalendar plan/planHelper modules/flightquotes minimapHelper text!templates/addCustomTravel.html plan/travelEdit jquery jqueryui jQueryExtensions/inspirockAutocomplete qtip jQueryExtensions/linkToCalendarAndMap jQueryExtensions/pager jQueryExtensions/inspirockDatepicker jQueryExtensions/colorCalendar jQueryExtensions/minimap jQueryExtensions/inspirockSelectmenu".split(" "),function(a,
g,d,p,m,j,i,c,b,f,u,n,k,h,e,l,t,r,q,D,v,B,z){function C(){var a=X.find(".mini-map");if(a.is(":visible")){var b=[];R.find(".stay-row").each(function(){b.push($(this).data("destinationId"))});var c=!0;if(c=Da.length===b.length)for(var d=0;d<Da.length;d++)c&=Da[d]===b[d];if(!c||a.is(":empty"))Da=b,a=v.iconQtip(),c=v.iconQtip(),a.container=fa,c.container=null,fa.prepareMiniMap({idKey:"stayId",$rootView:fa,$mapMarkerDataHolders:R.find(".stay-row"),showMarkerLabel:!0,nonInteractive:!0,showDirections:!0,
enlargeMap:!0,uniqueId:"route-right-pane-map",showInfoWindowAsQtip:!0,qtip:a,modalOverides:{nonInteractive:!1,qtip:c,scrollwheel:!0},onMapReady:function(){$(".mini-map .map-marker").click(function(){var a=$(this).data("stayId"),b=$("#destinations-stay-row-"+a);Sa(b);Ja(a,!1)})},analyticsCategory:g.CAT_PLAN_ROUTE})}}function G(a,b){la[a]||(la[a]={});la[a][b]=Ka++}function M(a,b){for(var c=0;c<b.length;c++)la[a]&&delete la[a][b[c]];$.isEmptyObject(la[a])&&delete la[a]}function w(a,b){var c=b?!1:!0;
R.find(".stay-row").each(function(d,e){var f=$(e).data("stayId");c&&M(f,a);f===b&&(c=!0)})}function J(){var a=$("#planHeader");b.dockView("route-right-pane",X,{dockTopAt:a.offset().top+(ta?a.height():0)+18,dockBottomAt:R.offset().top+R.outerHeight()+23,contentHeight:R.outerHeight(),shouldDockBottom:!0});f.scrollAndUpdate()}function F(){ta||(ta=!0,oa.scrollTop=$(window).scrollTop(),$("#overviewRoutePane").css("marginBottom","180px"),$(".plan-edit-hide").addClass("hidden"),$(".page-footer").addClass("hidden"),
ua.addClass("visible"),$("#sendFeedback").addClass("hidden"),$("#request-agent").hide(),$(".plan-heading").addClass("dim"),$("#pageContent").find(".plan-title").removeClass("editable"),m.triggerEvent("route","show-batch-save-bar",{}),J())}function y(){ta=!1;ra={};ua.removeClass("visible");$(".page-footer").removeClass("hidden");$("#sendFeedback").removeClass("hidden");$("#request-agent").show();$(".plan-heading").removeClass("dim");$("body").hasClass("edit-enabled")&&$("#pageContent").find(".plan-title").addClass("editable");
m.triggerEvent("route","hide-batch-save-bar",{});J();$("body").animate({scrollTop:oa.scrollTop},0)}function s(){return h.utc(R.data("endDate"),Z).diff(h.utc(R.data("startDate"),Z),"DAYS")+1}function H(){var b=$(this),c=$(this).parents(".stay-row"),e=c.data("name"),f=c.data("stayId");if(1===R.find(".stay-row").length)d.showMessageDialog("Can't delete all destinations from a plan","OK");else{var h=d.overlay($(this).parents(".edit-details"),t,{background:"#fbfbfb"},$(this).parents(".edit-details"));
ra[f]=h;c.data("hasNotes")&&h.$overlay.find(".delete-title").addClass("hidden").siblings(".delete-title.alt").removeClass("hidden").find(".name").text(c.data("name"));h.$overlay.find("input.delete").off("click.delete-confirm").on("click.delete-confirm",function(){var c=b.parents(".stay-row"),d=c.prev(),l=c.next();w(["Stay_ArrivalDate","Stay_DepartureDate"],c.data("stayId"));c.remove();l.remove();za(d);ba();h.removeOverlay();delete ra[f];a.trackEvent(g.CAT_PLAN_ROUTE_STAY,g.ACT_DEL_STAY,e.toLowerCase());
F();ga()});h.$overlay.find("input.cancel").off("click.cancel").on("click.cancel",function(){h.removeOverlay();delete ra[f]})}}function x(a,b,c,d,e,f,g){m.triggerEvent("route","prompt-flight-search",{startIataCode:a,startSchema:b,endIataCode:c,endSchema:d,outbounddate:e,inbounddate:f,searchData:g,event:"route.travel.prompt-airport"})}function A(){var b=$(this).parents(".travel-row"),c=b.find(".content .dates"),d=b.prev(),e=b.next();c.qtip({overwrite:!0,content:{text:c.parents(".travel-row").find(".options-content").html()},
position:{my:"top left",at:"top left",effect:!1,target:c.parents(".content"),adjust:{x:-88,y:-19}},show:{event:!1,ready:!0},hide:{event:"unfocus",fixed:!0,effect:!1},events:{show:function(f,h){a.trackEvent(g.CAT_PLAN_ROUTE_TRAVEL_OPTIONS,"show");h.elements.content.find(".overview-travel-block").find(".overview-travel-option .route-info").each(function(){var f=$(this).parent(".segment-option"),h=b.data("startDate"),l=f.find(".overview-route-price,.edit-custom-route"),i=f.find(".overview-route-info"),
j=f.data("startId"),k=f.data("endId"),n=f.data("startStopDestinationId"),p=f.data("endStopDestinationId"),s=R.find('.travel-row[data-travel-id="'+f.data("transposeTravelId")+'"]'),t=f.data("isReturn"),r=f.data("roundtrip")&&s.length?s.data("startDate"):null;i.off("click").on("click",function(a){a.stopPropagation()});var q={startDestinationId:n,endDestinationId:p,outbounddate:h,inbounddate:r,tripType:l.parents("li").data("roundtrip")?"roundtrip":"oneway",mode:f.data("mode")};r&&t&&(i=h,h=r,r=i,i=j,
j=k,k=i,i=n,n=p,p=i);"plane"===f.data("mode")&&(j&&k&&j!==k)&&D.getQuote({startDestinationId:n,endDestinationId:p,outboundDateStr:h,inboundDateStr:r},function(a){l.filter(".overview-route-price").html("from "+a.formattedAmount)});if(l.hasClass("overview-route-price")&&"plane"===f.data("mode")){if(!l.length||!j||!k||j===k)return!0;l.off("click").on("click",function(d){function e(){m.triggerEvent("route","show-transport-modal",{searchData:l})}if($(this).hasClass("edit-custom-route"))K($(this),b,"edit"),
c.qtip("hide"),d.stopPropagation();else{a.trackEvent(g.CAT_PLAN_ROUTE_TRAVEL_OPTIONS,g.ACT_ACTION,"search-flights");var l={startDestinationId:n,endDestinationId:p,outbounddate:h,inbounddate:r,cabinclass:"Economy",adults:$("#plan").data("numAdults")+$("#plan").data("numTeens"),children:$("#plan").data("numKids"),infants:0,tripType:f.data("roundtrip")?"roundtrip":"oneway",mode:f.data("mode"),startId:j,endId:k};$(".bottom-pane").hasClass("visible")?La(null,{action:"go-to-car",func:e}):e();d.stopPropagation();
c.qtip("hide")}})}else if(l.hasClass("overview-route-price")&&("car"===f.data("mode")||"taxi"===f.data("mode")))a.trackEvent(g.CAT_PLAN_ROUTE_TRAVEL_OPTIONS,g.ACT_ACTION,"search-cars"),l.off("click").on("click",function(a){function d(){m.triggerEvent("route","show-transport-modal",{searchData:e})}if($(this).hasClass("edit-custom-route"))K($(this),b,"edit"),c.qtip("hide"),a.stopPropagation();else if($(this).parents(".segment-option").data("startId")){var e={mode:f.data("mode"),segmentIndex:$(this).parents(".segment-option").data("segmentIndex"),
routeIndex:$(this).parents("li").data("routeIndex"),travelId:$(this).parents("li").data("travelId")};$(".bottom-pane").hasClass("visible")?La(null,{action:"go-to-car",func:d}):d();a.stopPropagation();c.qtip("hide")}});else l.off("click").on("click",function(i){if(l.hasClass("edit-custom-route"))K(l,b,"edit"),c.qtip("hide"),i.stopPropagation();else if("plane"===f.data("mode")&&d.hasClass("boundary-row")&&!j&&k)a.trackEvent(g.CAT_PLAN_ROUTE_TRAVEL_OPTIONS,g.ACT_PROMPT_START_AIRPORT),x(j,"",k,"cityIata",
h,r,q),i.preventDefault();else if("plane"===f.data("mode")&&e.hasClass("boundary-row")&&!r&&j&&!k)a.trackEvent(g.CAT_PLAN_ROUTE_TRAVEL_OPTIONS,g.ACT_PROMPT_END_AIRPORT),x(j,"cityIata",k,"",h,r,q),i.preventDefault();else if("plane"===f.data("mode")&&e.hasClass("boundary-row")&&r&&!j&&k)a.trackEvent(g.CAT_PLAN_ROUTE_TRAVEL_OPTIONS,g.ACT_PROMPT_END_AIRPORT),x(j,"",k,"cityIata",h,r,q),i.preventDefault();else if(l.hasClass("train-link")){a.trackEvent(g.CAT_PLAN_ROUTE_TRAVEL_OPTIONS,g.ACT_ACTION,"search-trains");
i.preventDefault();var n={mode:"train"},p=function(){m.triggerEvent("route","show-transport-modal",{searchData:n})};$(".bottom-pane").hasClass("visible")?La(null,{action:"go-to-train",func:p}):p();i.stopPropagation();c.qtip("hide")}else{var p=-1<l.attr("href").indexOf("www.google.com/maps"),s=-1<l.attr("href").indexOf("www.rome2rio.com");a.trackEvent(g.CAT_PLAN_ROUTE_TRAVEL_OPTIONS,g.ACT_ACTION,p?"directions-google-maps":s?"more-info-r2r":"other")}i.stopPropagation();c.qtip("hide")})});h.elements.content.off("click.travel-row").on("click.travel-row",
"ul li",function(){function d(){a.trackEvent(g.CAT_PLAN_ROUTE_TRAVEL,"update-travel-mode",b.find(".routeinfo .type").text());F();ga()}var e=$(this);if(e.hasClass("read-only"))m.triggerEvent("route","claimPlan",{}),c.qtip("hide");else if(e.hasClass("selected"))c.qtip("hide");else if(e.hasClass("add-travel-option"))K(e,b,"add"),c.qtip("hide");else{var f=e.data("routeIndex"),h=$(this).parent(".segment-option");e.siblings("li").removeClass("selected").find("svg.tick").remove();e.addClass("selected").find(".overview-travel-option").prepend('<svg class="tick"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-tick"></use></svg>');
b.data("selectedRouteIndex",f);b.data("optionSelected",!0);b.data("duration",e.data("duration"));f=R.find('.travel-row[data-travel-id="'+h.data("transposeTravelId")+'"]');f.length&&f.data("roundtrip",h.data("roundtrip"));b.data("roundtrip",h.data("roundtrip"));c.qtip("hide");if(e.data("isDriving")&&""===R.data("isDriving")){var l=$("<div>We will update your trip based on your preference</div>");l.dialog({resizable:!1,modal:!0,title:"Are you planning to drive<br/>during this trip?",draggable:!1,width:"490px",
dialogClass:"dlg-route-edit dlg-is-driving mediumx",buttons:{No:function(){R.data("isDriving",!1);l.dialog("close")},Yes:function(){R.data("isDriving",!0);R.data("drivingUpdateAll",!0);a.trackEvent(g.CAT_PLAN_ROUTE_TRAVEL,"update-travel-mode-is-driving");l.dialog("close")}},close:function(){d();l.dialog("destroy").remove()}})}else d()}})},hide:function(){}},style:{classes:"overview-tip qtip-light qtip-shadow",tip:{corner:!1,width:20,height:10,mimic:"center top"}}})}function E(a){var b=a.find(".custom-event-date-copy"),
b=h(b.datepicker("getDate"));b.add(parseInt(a.find(".time-in-minutes").val(),10),"m");return b}function K(b,c,d){var e=h(c.data("customTravelStartTime")||c.data("startTime")),f=h(c.data("customTravelEndTime")||c.data("endTime")),l=c.prev(),i=c.next();b.siblings("li").length||(b=b.parents("li"));var j=l.hasClass("boundary-row")?e.clone().startOf("day"):h(l.data("arrivalDateTime")),k=i.hasClass("boundary-row")?f.clone().add("h",24).endOf("day"):h(i.data("departureDateTime"));a.trackEvent(g.CAT_PLAN_ROUTE_TRAVEL_OPTIONS,
"custom-travel","show-dialog");var n={};c.find(".overview-travel-options .tick").siblings(".segment-option").each(function(a){var b={};b.mode=$(this).find(".icons").data("modeIcon");b.modeName=$(this).find(".route-info .mode").text();b.transposeTravelId=$(this).data("transposeTravelId")||-1;b.startDestination={destinationId:$(this).data("startStopDestinationId"),cityIataCode:$(this).data("startId"),destinationName:$(this).data("startStopDestinationName")};b.endDestination={destinationId:$(this).data("endStopDestinationId"),
cityIataCode:$(this).data("endId"),destinationName:$(this).data("endStopDestinationName")};n[a]=b});for(var p in n){var s=n[p];if(void 0!==s&&-1!==s.transposeTravelId){var r;r=R.find("travel-row-"+s.transposeTravelId);r=h(r.data("customTravelStartTime")||r.data("startTime"));s="car"===s.modeName?f.clone():e.clone();r.isBefore(s)}}p=-1;l.hasClass(".stay-row")&&(p=l.data(".stayId"));r=l.hasClass("boundary-row")?j.clone().add(30,"m"):k.clone().subtract(30,"m");s=j.clone().add(30,"m");j=[h(j.format(Aa),
Aa),h(r.format(Aa),Aa)];k=[h(s.format(Aa),Aa),h(k.format(Aa),Aa)];b={id:c.data("travelId"),localStartDateTime:e,localEndDateTime:f,customName:c.data("customTravelName"),notes:c.data("notes"),attachments:c.data("attachments"),segmentItems:n,isBoundary:l.hasClass("boundary-row")||i.hasClass("boundary-row"),stayId:p,startDestination:{destinationName:l.data("name"),destinationId:l.data("destinationId")},endDestination:{destinationName:i.data("name"),destinationId:l.data("destinationId")},isTrainBookable:c.data("isTrainBookable"),
travelRow:c,self:b,addOrEdit:d};z.travelClick(b,void 0,j,k,{successCB:function(){m.triggerEvent("route","refresh-route",{})},successDialogOpen:function(){}},!1,"route")}function L(b,c){var e=$(c.travelDOM),f=$(c.travelRow),l=$(c.self),j=c.addOrEdit,k=h(f.data("customTravelStartTime")||f.data("startTime")),n=h(f.data("customTravelEndTime")||f.data("endTime")),m=f.prev(),p=f.next();l.siblings("li").length||(e.find(".custom-travel-mode").val(l.data("name")),l=l.parents("li"));var s=m.hasClass("boundary-row")?
k.clone().startOf("day"):h(m.data("arrivalDateTime")),r=p.hasClass("boundary-row")?n.clone().add("h",24).endOf("day"):h(p.data("departureDateTime"));E(e.find(".start-container"));E(e.find(".end-container"));$.trim(e.find(".custom-travel-mode").val());var t=!0,p=E(e.find(".start-container")),q=E(e.find(".end-container")),N=$.trim(e.find(".custom-travel-mode").val())||$.trim(e.find(".mode-options option:selected").text()),O=e.find(".mode-options-dropdown.hidden").length?$.trim(e.find(".custom-travel-mode").val()):
"",k=$.trim(e.find(".add-note-text").val()),n=i.getAttachments(e.find(".notes-attachment-wrapper"));e.find(".error").html("");e.find(".error").removeClass("hidden");if(N)if(128<N.length)e.find(".error").html("Transportaion type cannot be more than 128 characters");else if(p.isBefore(s)&&m.hasClass("boundary-row"))e.find(".error").html("Start time too early. Cannot start before plan start date.");else if(p.isBefore(s))e.find(".error").html("Start time too early. Cannot make previous destination have no time.");
else if(p.isAfter(r.clone().subtract(30,"m")))e.find(".error").html("Start time too late. Cannot make destination have no time.");else if(q.isBefore(s.clone().add(30,"m")))e.find(".error").html("End time too early. Cannot make destination have no time.");else if(q.isAfter(r))e.find(".error").html("End time too late. Cannot make next destination have no time.");else{e.find(".error").addClass("hidden");var w=f.data("custom-travel-name"),y=f.data("custom-travel-start-time"),D=f.data("custom-travel-end-time"),
K=f.data("selectedRouteIndex"),A=f.data("custom-travel-edit");f.data("selectedRouteIndex",c.selectedRouteIndex);O?f.data("custom-travel-name",O).data("custom-travel-start-time",p.format(d.ISO_DATE_TIME_FORMAT)).data("custom-travel-end-time",q.format(d.ISO_DATE_TIME_FORMAT)).data("custom-travel-edit",!0).data("selectedRouteIndex",l.siblings("li").length):f.data("start-time",p.format(d.ISO_DATE_TIME_FORMAT)).data("end-time",q.format(d.ISO_DATE_TIME_FORMAT)).data("custom-travel-edit",!1);if(!D&&!p&&
(!p.isSame(h(y))||!q.isSame(h(D))))m=f.next(),l=f.prev(),m.length&&(s=d.toSlot(q),m.data("arrivalDate",q.format("YYYY-MM-DD")),m.data("arrivalMinSlotIndex",s),m.data("arrivalMaxSlotIndex",s),aa(m.data("stayId"),"Stay_ArrivalDate"),aa(m.data("stayId"),"Stay_ArrivalLTRange")),l.length&&(m=d.toSlot(p),l.data("departureDate",p.format("YYYY-MM-DD")),l.data("departureMinSlotIndex",m),l.data("departureMaxSlotIndex",m),aa(l.data("stayId"),"Stay_DepartureDate"),aa(l.data("stayId"),"Stay_DepartureLTRange"));
f.data("notes",k);var p=[],I;for(I in n)p.push({id:n[I].id,name:n[I].name});f.data("attachments",p);var x=[];e.find(".item-block-wrapper.travel-row").each(function(){x.push({id:$(this).data("reservationId")})});f.data("reservations",x);var ka=$(this).siblings(".ui-dialog-buttonpane").find("button:contains('Save')");ka.attr("disabled","disabled");a.trackEvent(g.CAT_PLAN_ROUTE_TRAVEL_OPTIONS,"custom-travel",j);f.data("routeEdited",!0);ga(function(){e.dialog("close")},function(){ka.removeAttr("disabled",
"disabled")},function(){f.data("custom-travel-name",w).data("custom-travel-start-time",y).data("custom-travel-end-time",D).data("selectedRouteIndex",K).data("custom-travel-edit",A).data("routeEdited","")});t=!1}else e.find(".error").html("Enter transportaion type");t?e.find(".error").addClass("populated"):e.find(".error").removeClass("populated")}function Q(a,b,c){b&&b.id&&(a.data("destinationId",b.id).find(".title").text(b.value).siblings(".edit-boundary").find("span").text("Edit"),$("#overviewRoutePane").removeClass("one-destination"),
$(".route-main-pane").removeClass("one-destination"),c&&c())}function N(){var a=$(".dlg-edit-plan-dates"),b=a.find(".startDate"),a=a.find(".endDate"),c=h.utc(R.data("startDate"),Z),d=h.utc(R.data("endDate"),Z),b=h.utc(b.val(),Za),d=b.clone().add(d.diff(c,"days"),"day"),e=h.utc(a.val()?a.val():d,Za);e<b&&(d=b.clone().add(s()-1,"days"),e=d.clone(),X.find(".endDate-alt").val(e.format(window.dateFormatMomentDisplayPattern)));var f=b.format(Z);a.val(e.format(Za));R.data("startDateChanged",R.data("startDate")!==
f||R.data("startDateChanged"));R.data("startDate",b.format(Z));R.data("endDate",d.format(Z));R.data("userEndDate",e.format(Z));b.isSame(c)||w(["Stay_ArrivalDate","Stay_DepartureDate"])}function O(){var a=X.find(".startDate"),b=X.find(".endDate"),a=h.utc(a.val(),Z),c=h.utc(b.val(),Z),d=h.utc(R.data("startDate"),Z),e=h.utc(R.data("endDate"),Z),e=a.clone().add(e.diff(d,"days"),"day");c<a&&(e=a.clone().add(s()-1,"days"),c=e.clone(),b.val(c.format(Z)),X.find(".endDate-alt").val(c.format(window.dateFormatMomentDisplayPattern)));
b=a.format(Z);R.data("startDateChanged",R.data("startDate")!==b||R.data("startDateChanged"));R.data("startDate",b);R.data("endDate",e.format(Z));R.data("userEndDate",c.format(Z));a.isSame(d)||w(["Stay_ArrivalDate","Stay_DepartureDate"])}function I(){ta?La(null,{action:"view-calendar"}):Ia(null,{action:"view-calendar"})}function T(){var a=X.find(".endDate"),b=h(R.data("endDate"));h(R.data("userEndDate")).isSame(b)?X.find(".display-dates").addClass("hidden").siblings(".date-edit").removeClass("hidden"):
X.find(".display-dates").qtip({overwrite:!0,content:{text:'<div class="fix-dates">Fix dates to match the plan</div><div class="edit-dates">Edit dates</div>'},position:{my:"top center",at:"top center",effect:!1,target:X.find(".display-dates"),container:X},show:{event:!1,ready:!0},hide:{event:"unfocus click",fixed:!0},events:{show:function(c,d){d.elements.content.find(".fix-dates").off("click.fix-dates").on("click.fix-dates",function(){R.data("userEndDate",b.format(Z));a.val(b.format(Z));ga();d.hide()});
d.elements.content.find(".edit-dates").off("click.edit-dates").on("click.edit-dates",function(){X.find(".display-dates").addClass("hidden").siblings(".date-edit").removeClass("hidden");d.hide()})},hide:function(){}},style:{classes:"edit-dates-tip qtip-light qtip-shadow",tip:{corner:!1,width:20,height:10,mimic:"center top"}}})}function S(){R.find(".time-slot").each(function(b,c){var d=$(c),e=h(d.parents(".stay-row").data("earliestArrivalDateTime")),f=2*e.hour()+(30>e.minute()?0:1),l=e.clone().add(1410,
"m"),i=2*l.hour()+(30>l.minute()?0:1),j=h(d.parents(".stay-row").data("arrivalDateTime")),k=2*j.hour()+(30>j.minute()?0:1),n=h(d.parents(".stay-row").data("departureDateTime")),p=0<d.parents(".depart").length,s=d.val();d.find("option").each(function(a,c){var d=$(c),g=parseInt(d.data("max")),h=parseInt(d.data("min")),m=!p&&f>g&&e.date()===j.date(),h=p&&k>=h&&j.date()===n.date(),g=0===b?i<g&&l.date()===j.date():!1;m||h||g?d.attr("disabled",!0):d.removeAttr("disabled",!0)});d.inspirockSelectmenu({appendTo:d.parents(".stay-row"),
change:function(b,c){if($("#plan").data("editEnabled")){var e=$(c.item.element);if(e.hasClass("disabled"))e.parents("select").val(s),S();else{var f=e.parents("select").data("type");e.parents(".stay-row").data(f+"MinSlotIndex",e.data("min")).data(f+"MaxSlotIndex",e.data("max"));if("arrival"===f){var h=d.parents(".stay-row");U(h)}aa(e.parents(".stay-row").data("stayId"),"arrival"===f?"Stay_ArrivalLTRange":"Stay_DepartureLTRange");a.trackEvent(g.CAT_PLAN_ROUTE_STAY,"update-stay-"+f+"-time-range");ga()}}else m.triggerEvent("route",
"claimPlan",{})},format:function(a){return"Morning"===a?a+" <span class='hide-on-select'>(6AM - 12PM)</span>":"Afternoon"===a?a+" <span class='hide-on-select'>(12PM - 4PM)</span>":"Evening"===a?a+" <span class='hide-on-select'>(4PM - 8PM)</span>":"Night"===a?a+" <span class='hide-on-select'>(After 8PM)</span>":a}})})}function U(a){var b=a.find(".departDate"),c=a.find(".arriveDate"),b=h(b.datepicker("getDate")),c=h(c.datepicker("getDate")),d=a.find(".depart .time-slot"),e=a.data("arrivalMaxSlotIndex"),
f=a.data("departureMinSlotIndex");b.isSame(c)&&(47===e?(a.data("departureDate",b.add(1,"d").format(Z)),b=d.find("option:first"),a.data("departureMinSlotIndex",b.data("min")).data("departureMaxSlotIndex",b.data("max"))):e>f&&(b=d.find('option[data-min="'+(parseInt(e)+1)+'"]'),a.data("departureMinSlotIndex",b.data("min")).data("departureMaxSlotIndex",b.data("max"))))}function aa(a,b){a&&(G(a,"Stay_Duration"),"Stay_ArrivalDate"!==b&&G(a,"Stay_ArrivalDate"),"Stay_ArrivalLTRange"!==b&&G(a,"Stay_ArrivalLTRange"),
"Stay_DepartureDate"!==b&&G(a,"Stay_DepartureDate"),"Stay_DepartureLTRange"!==b&&G(a,"Stay_DepartureLTRange"),G(a,b))}function W(a,b){var c=$(this),e=c.parents(".boundary-row"),f="start"===e.data("boundaryType")?"Where do you start<br/>your trip from?":"Where do you end<br/>your trip?",g="start"===e.data("boundaryType")?"Enter start city":"Enter end city",h=$('<div><input type="text" name="search" class="boundary-dest-search flat" data-boundary-type="'+e.data("boundaryType")+'" placeholder="'+g+'"/></div>');
h.dialog({resizable:!1,modal:!0,title:f,draggable:!1,width:"490px",dialogClass:"dlg-route-edit dlg-modify-boundary mediumx",buttons:{"Update my plan":function(){var a=h.find(".boundary-dest-search"),f=a.data("inspirockAutocomplete").getSelectedItem();void 0===f||null===f?d.showErrorTooltip(a,"Enter a destination"):(F(),Q(e,f,function(){var g=e.parents(".route-rows").find(".boundary-row.end");"start"===e.data("boundaryType")?(e.next().data("modified",!0),e.next().data("roundtrip",!1)):(e.prev().data("modified",
!0),e.prev().data("roundtrip",!1));if(f.id!=g.find(".title").data("destinationId")&&"start"===a.data("boundaryType")){h.dialog("close");var l=$("<div></div>");l.dialog({resizable:!1,modal:!0,title:"Is this also where your<br/>trip ends?",draggable:!1,width:"490px",dialogClass:"dlg-route-edit dlg-same-end mediumx",buttons:{No:function(){l.dialog("close");var a=c.parents(".route-rows").find(".boundary-row.end");a.find(".title").data("destinationId")?(ga(),d.removeAllErrorToolTips()):a.find(".edit-boundary").trigger("click",
{requireUpdate:!0})},Yes:function(){Q(g,f);g.prev().data("modified",!0);l.dialog("close");ga();d.removeAllErrorToolTips()}},open:function(){},close:function(){l.dialog("destroy").remove()}})}else h.dialog("close"),b||ga()}))}},open:function(){d.setupDialogOverlay(h);var a=$(".boundary-dest-search");a.inspirockAutocomplete({url:window.contextPath+"/homeCityAutocomplete",appendTo:$(".boundary-dest-search").parents(".ui-dialog"),onFocus:function(){d.hideErrorTooltip(a)}})},close:function(){h.dialog("destroy").remove();
b&&b.requireUpdate&&ga();d.removeAllErrorToolTips()}})}function Y(b){var c=$(this),e=c.parents(".ui-dialog").find("#dest-search").data("inspirockAutocomplete").getSelectedItem();if(void 0===e||null===e)d.showErrorTooltip($("#dest-search"),"This field is required.");else{c.prop("disabled",!0);var f=e.id,e=e.value;c.data("newDestinationIds",[f]);R.data("newDestinationIds",[f]);ga();b.dialog("close");a.trackEvent(g.CAT_PLAN_ROUTE,g.ACT_ADD_DEST,e.toLowerCase())}}function V(){var b=$('<div><input type="text" class="flat" name="search" id="dest-search" placeholder="Start typing..." /></div>');
b.dialog({resizable:!1,modal:!0,title:"Add destination",draggable:!1,width:"490px",dialogClass:"dlg-route-edit dlg-modify-boundary dlg-add-destination mediumx",buttons:{"Add to my plan":function(){Y.bind($(this))(b)}},open:function(){b.parents(".ui-dialog").find(".ui-dialog-buttonpane").append($('<div class="text-link explore-all-destination" data-event-src="overview.add-destination">Explore destinations</div>'));$("#dest-search").inspirockAutocomplete({url:window.contextPath+"/nightStayAutocomplete",
appendTo:b.parents(".ui-dialog"),extendDropdown:0});b.parents(".ui-dialog").find(".explore-all-destination").on("click",function(){b.dialog("close");var c=$(this).data("eventSrc");a.trackEvent(c,"explore-destinations");m.triggerEvent("overview","explore-load-destination-in-modal",{tab:"overview",destinationId:$(".overview-reco-pane .explore-all-destination").data("destinationId")})})},close:function(){b.dialog("destroy").remove();d.removeAllErrorToolTips()}})}function ba(){var a=h.utc(R.data("startDate"),
Z),b=h.utc(R.data("endDate"),Z),c=h.utc(R.data("userEndDate"),Z),e=h(R.data("endDateTime"),fb),f=h.utc(R.find(".stay-row:eq(0)").data("arrivalDate"),Z),g=[];"00:00"===e.clone().format("HH:mm")&&b.subtract(1,"days");a.isAfter(f)&&(a=f);fa.find(".stay-row").each(function(a){var b=$(this),c=b.data("name"),e=b.data("nights"),f=b.data("duration"),a={stayId:b.data("stayId"),destinationId:b.data("destinationId"),startTime:h.utc(b.data("arrivalDateTime")),endTime:h.utc(b.data("departureDateTime")),backgroundColor:d.getColor(a),
title:"<b>"+c+"</b><br/>"+(f+(1===f?" day":" days"))+" / "+(e+(1===e?" night":" nights"))};g.push(a)});a=r.generateMiniCalendar(a,b,c,g);X.find(".mini-calendar").html(a);X.find(".mini-calendar td.empty").qtip({content:"You have open days in your plan.",style:{classes:"error-qtip qtip-light qtip-shadow"},show:{delay:50},position:{viewport:$(window),effect:!1,my:"bottom center",at:"top center",container:$(".page-content")}});X.find(".mini-calendar td.extra").qtip({content:"Your plan is going past your end date.",
style:{classes:"error-qtip qtip-light qtip-shadow"},show:{delay:50},position:{viewport:$(window),effect:!1,my:"bottom center",at:"top center",container:$(".page-content")}});X.find(".mini-calendar .stay").qtip({overwrite:!0,content:{text:function(){return $(this).attr("title")}},style:{classes:"qtip-light qtip-shadow minicalendar-stay-tip"},show:{event:"mouseover",delay:50},hide:{event:"mouseout"},position:{viewport:$(window),effect:!1,my:"bottom center",at:"top center",container:$(".page-content")}});
R.linkToCalendarAndMinimap({staySelector:".stay-row,.stay",$calendar:X.find(".mini-calendar"),$minimap:X.find(".mini-map"),stayListHighlightedClass:"highlight",mapKey:"stayId"});k.addToQueue(C)}function ha(){$(this).parent(".stay-row").addClass("hover")}function ia(){$(this).parent(".stay-row").removeClass("hover")}function pa(){$(this).parent(".boundary-row").addClass("hover")}function ka(){$(this).parent(".boundary-row").removeClass("hover")}function na(){$(this).parent(".travel-row").addClass("hover")}
function sa(){$(this).parent(".travel-row").removeClass("hover")}function Na(){$(this).siblings(".edit-details").hasClass("collapse")?Sa($(this).parents(".stay-row")):ma($(this).parents(".stay-row"))}function Qa(){J();k.addToQueue(C);return!1}function Xa(){b.undockView("route-right-pane");return!1}function Ba(a,b){var c=R.find('.travel-row[data-travel-id="'+b.travelId+'"]');window.setTimeout(function(){f.scrollElementIntoView("travel-row-"+b.travelId,-90,!0)},0);A.bind(c.find(".content"))()}function ya(a,
b){var c=R.find('.stay-row[data-destination-id="'+b.destinationId+'"]');Ja(c.data("stayId"),!0);b.expandStay&&Na.bind(c.find(".content"))()}function Ja(a,b){var c=$(this),a=void 0!==a&&null!==a?a:c.data("stayId");window.setTimeout(function(){f.scrollElementIntoView("destinations-stay-row-"+a,-90,!b)},0)}function Ta(){var a=$(this),b=$(this).parents(".stay-row"),c=h.utc(b.data("checkInDate"),Z),e=h.utc(b.data("checkOutDate"),Z);if(!c||!e)d.showExclamationDialog("Uh oh!","Please select a valid start and end date.",
"Close");else{var f=a.siblings(".booking-options").children(".booking-option");n.findHotel(f,g.CAT_PLAN_ROUTE,b.data("name"),b.data("countryCode"),c,e,a,R);return!1}}function Pa(){return R.find(".travel-row").filter(function(){return $(this).data("notes")||$(this).data("attachments").length}).length}function ga(a,b,c){var e=P();Ma.lastGeneratedId=e.lastGeneratedId;if(JSON.stringify(e)===JSON.stringify(Ma))a&&a();else{var f=[];R.find(".stay-row").each(function(a,b){var c=$(b);c.find(".edit-details").hasClass("collapse")||
f.push("#"+c.attr("id"))});var g=Pa();p.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/route/transientUpdate",data:{routeDetails:d.stringify(e)},type:"POST",complete:function(){ua.find(".done-btn").removeClass("disabled");b&&b()},success:function(b){var c=$(b);$(f).each(function(a,b){c.find(b).find(".edit-details").removeClass("collapse").siblings(".content").addClass("editing").siblings(".left").find(".line").addClass("expand")});b=R.prev();R.remove();b.after(c);oa.initialize();
F();a&&a();g!==Pa()&&Fa.data("dataRemoved",!0)},error:function(){c&&c()}})}}function P(){var a={},b=[],c=[],d=R.find(".boundary-row.start"),e=R.find(".boundary-row.end");fa.find(".travel-row").each(function(a,b){var d=$(b),e=d.data("selectedRouteIndex"),f=d.data("duration");if(null===e||void 0===e){var g=d.find(".overview-travel-options li.selected");0===g.length&&(g=d.find(".overview-travel-options li:eq(0)"));e=g.data("routeIndex");f=g.data("duration")}var l=d.data("attachments").length?d.data("attachments"):
[],i=[];for(a in l)i.push(l[a].id);if(d.data("reservations")){var g=d.data("reservations").length?d.data("reservations"):[],j=[];for(a in g)j.push(g[a].id)}var g=d.prev(),k=d.next(),n=$(this).parent(".segment-option"),m=!0===d.data("modified"),p=!0===d.data("optionSelected"),s=d.data("notes"),j={travelId:d.data("travelId"),routeIndex:!e&&0!==e?void 0:e,prevId:g.data("stayId"),nextId:k.data("stayId"),startTime:d.data("startTime"),endTime:d.data("routeEdited")?d.data("endTime"):void 0,duration:Math.round(f),
roundTrip:n.data("roundtrip"),modified:m,optionSelected:p,notes:m?"":s,attachments:m?[]:i,reservations:m?[]:j};(s||l&&l.length)&&m&&Fa.data("dataRemoved",!0);l=d.data("customTravelEdit");d.data("customTravelName")&&!m&&(j.customRoute={travelMode:d.data("customTravelName"),startTime:d.data("customTravelStartTime"),endTime:d.data("customTravelEndTime")},j.customSelected=d.find(".overview-travel-options li.custom-travel").data("routeIndex")===e||l,j.prevId&&l&&(d=h(d.data("customTravelStartTime")),e=
(60*d.get("h")+d.get("m"))/30,g.data("departureDate",d.format("YYYY-MM-DD")).data("departureMinSlotIndex",e).data("departureMaxSlotIndex",e)));c.push(j)});fa.find(".stay-row").each(function(a,c){var d=$(c),d={stayId:d.data("stayId"),destinationId:d.data("destinationId"),duration:d.data("duration"),arrivalDate:d.data("arrivalDate"),departureDate:d.data("departureDate"),arrivalMinSlotIndex:d.data("arrivalMinSlotIndex"),arrivalMaxSlotIndex:d.data("arrivalMaxSlotIndex"),departureMinSlotIndex:d.data("departureMinSlotIndex"),
departureMaxSlotIndex:d.data("departureMaxSlotIndex"),isStaySelected:d.data("isStaySelected"),nights:d.data("nights")};b.push(d)});a.stayDetails=b;a.travelDetails=c;a.startDate=R.data("startDate");a.endDate=R.data("userEndDate");a.startDateChanged=R.data("startDateChanged");a.driving=R.data("isDriving");a.drivingUpdateAll=R.data("drivingUpdateAll");a.startBoundary={destinationId:d.data("destinationId")};a.endBoundary={destinationId:e.data("destinationId")};R.data("newDestinationIds")&&R.data("newDestinationIds").length&&
(a.newDestinationIds=R.data("newDestinationIds").join(","),R.data("newDestinationIds",[]));a.routeCustomizationPriorities=la;a.lastGeneratedId=Ka;return a}function ja(a){var b=d.overlay($("#pageWrapper"),'<div class="update-plan-wrapper"><div class="updating-plan">\n                                <img class="progress-img reverse" src="https://s.inspirock.com/images/misc/spin.gif" alt="Loading..."><br />reverting changes</div></div>',{height:"100%",top:0});d.disableScroll();X.find(".mini-map").remove();
m.triggerEvent("route","stay-update",{uiSource:"route.adjustRoute",overlay:b,pageChangeData:a});Fa.data("dataRemoved",!1);la={};Ka=0}function da(a,b){function c(e,f,h,l,i){ua.find(".done-btn").addClass("disabled");var j=d.overlay($("#pageWrapper"),'<div class="update-plan-wrapper"><div class="updating-plan">\n                                <img class="progress-img" src="https://s.inspirock.com/images/misc/spin.gif" alt="Loading..."><br />updating your plan</div></div>',{height:"100%",top:0});d.disableScroll();
X.find(".mini-map").addClass("hidden");e={routeDetails:d.stringify(g),forceMerge:e,userDIY:f};f||(e.replanStayIds=h,e.adjustStayIds=l);var k=!0;b&&($.extend(e,b),e.isTravelerData=!0,parseInt(b.numAdults)===$("#plan").data("numAdults")&&(parseInt(b.numKids)===$("#plan").data("numKids")&&parseInt(b.numTeens)===$("#plan").data("numTeens"))&&(k=!1));p.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/route/save",data:e,type:"POST",complete:function(){ua.find(".done-btn").removeClass("disabled")},
success:function(e,f,g){if(g.getResponseHeader("Modified-Visits"))$("#pageWrapper").append($(e).addClass("hidden")),$a("",{cb:c}),j.removeOverlay(),d.enableScroll(),ua.find(".done-btn").removeClass("disabled"),X.find(".mini-map").removeClass("hidden");else{Fa.data("dataRemoved",!1);X.find(".mini-map").remove();u.close();var h={uiSource:"route.adjustRoute",overlay:j,pageChangeData:a};if(l&&l.length||i)h.pageChangeDataDisabled=!0,p.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+
"/checkStayOverlapAndFit",data:{adjustStayIds:i?void 0:l,allStays:i},type:"POST",success:function(a,b,c){if(c.getResponseHeader("Stay-Review")){var d=$("<div>"+$(a).html()+"</div>");d.dialog({resizable:!1,modal:!0,title:"",draggable:!1,width:"660px",dialogClass:"dlg-stay-review mediumx",open:function(){d.off("click.goto-calendar").on("click.goto-calendar",".goto-calendar",function(){var a=d.find(".content").find(".conflicts-container").first().data("date");m.triggerEvent("explore","show-tab-itinerary",
{addToHistory:!1,tabData:{subnav:"calendar",date:a}});d.dialog("close")});d.off("click.close-dialog").on("click.close-dialog",".close-dialog",function(){Ia(null,h.pageChangeData);d.dialog("close")})},close:function(){d.dialog("destroy")}})}else Ia(null,h.pageChangeData)}});m.triggerEvent("route","stay-update",h);la={};Ka=0;if(b&&k){var g=b,e=parseInt(g.numAdults),f=parseInt(g.numTeens),g=parseInt(g.numKids),n=$("#plan").data("planId");$("#plan").data({numAdults:e,numTeens:f,numKids:g});var s={};if(window.sessionStorage.hasOwnProperty("cabin-selector-"+
n)){var r=JSON.parse(window.sessionStorage.getItem("cabin-selector-"+n));s.adult=Math.min(e+f,Ua);s.children=Math.min(g,Ua);s.infant=Math.min(parsInt(r.infant),s.adult);s.cabin=r.cabin;s["cabin-text"]=r["cabin-text"]}else s.adult=Math.min(e+f,Ua),s.children=Math.min(g,Ua),s.infant=0,s.cabin="Economy",s["cabin-text"]="Economy";window.sessionStorage.setItem("cabin-selector-"+n,JSON.stringify(s))}}},error:function(){j.removeOverlay();d.enableScroll();X.find(".mini-map").removeClass("hidden")}})}if(!$(this).hasClass("disabled")){var e=
R.data("startDateTime"),f=R.data("endDateTime"),e=h(e);if(60<h(f).diff(e,"days"))d.showMessageDialog("Plan length cannot exceed 60 days.","OK");else{var g=P();c(!1,!1)}}}function Va(a,b){var c=$("<div>Saving the plan will delete notes and attachments associated with travel and activities that are being deleted.</div>"),e=!1;c.dialog({resizable:!1,modal:!0,title:"Warning!",draggable:!1,width:"565px",dialogClass:"dlg-route-edit dlg-save-or-discard mediumx",buttons:{Cancel:function(){c.dialog("close")},
Continue:function(){e=!0;a&&a();c.dialog("close")}},open:function(){d.setupDialogOverlay(c)},close:function(){!e&&b&&b();c.dialog("destroy").remove()}})}function $a(a,b){function c(){d.removeClass("hidden");var a=b,e=$("<div>"+d.html()+"</div>");e.dialog({resizable:!1,modal:!0,title:"",draggable:!1,width:"660px",dialogClass:"dlg-removed-visits mediumx",open:function(){e.off("click.confirm-changes").on("click.confirm-changes",".confirm-changes",function(){if(!$(this).hasClass("disabled")){var b=[],
c=[],d=!0;e.find(".stay-selector").each(function(){var a=$(this),e=a.parents(".stay-change-details").data("stayId");a.prop("checked")?(b.push(e),d=!1):c.push(e)});e.dialog("close");a.cb&&a.cb(!0,!1,b,c,d)}});e.off("click.preview-changes").on("click.preview-changes",".preview-changes",function(){var a=$(this).parents(".stay-change-details").find(".changes-in-detail");if(a.hasClass("hidden")){a.removeClass("hidden");$(this).html("Hide &laquo;");var b=$(this).parents(".content").scrollTop()+$(this).parents(".stay-change-details").position().top;
$(this).parents(".content").animate({scrollTop:b},200)}else b=$(this).parents(".content").scrollTop(),a.addClass("hidden"),$(this).html("Preview &raquo;"),$(this).parents(".content").scrollTop(b);e.dialog({position:{my:"center",at:"center",of:window}})});e.off("click.close").on("click.close",".close",function(){e.dialog("close")});e.off("click.diy-link").on("click.diy-link",".diy-link",function(){u.close();var b=[],c=[];e.find(".stay-selector").each(function(){var a=$(this).parents(".stay-change-details").data("stayId");
c.push(a)});e.dialog("close");a.cb&&a.cb(!0,!0,b,c,!0)});e.off("change.stay-selector").on("change.stay-selector",".stay-selector",function(){var a=!0;e.find(".stay-selector").each(function(){if($(this).prop("checked"))return a=!1});a?e.find(".confirm-changes").addClass("disabled"):e.find(".confirm-changes").removeClass("disabled")});e.dialog({position:{my:"center",at:"center",of:window}});j.initialize()},close:function(){e.dialog("destroy")}});d.remove()}var d=$("#removed-visits"),e=$("#notes-removed").length;
d.length?d.data("has-notes")?Va(function(){c()},function(){d.remove()}):c():e&&Va(function(){b.cb(!0,!1)})}function za(a){a.hasClass("travel-row")&&(a.data("modified",!0),a.find(".content .dates").html("Updating..."),a.find(".content .options").remove(),a.find(".left").html('<div class="line"></div>'))}function gb(){var b=$(this).parents(".stay-row"),c=b.prev().prev(),d=b.next().next(),e=b.clone(!0),f=c.clone(!0);F();b.hasClass("last")&&(f.addClass("last"),e.removeClass("last"));c.hasClass("first")&&
(e.addClass("first"),f.removeClass("first"));b.after(f);c.after(e);b.remove();c.remove();e.prev().prev().data("destinationId")&&za(e.prev());e.data("destinationId")&&za(e.next());d.data("destinationId")&&za(d.prev());M(b.data("stayId"),["Stay_ArrivalDate","Stay_DepartureDate"]);M(c.data("stayId"),["Stay_ArrivalDate","Stay_DepartureDate"]);a.trackEvent(g.CAT_PLAN_ROUTE_STAY,"move-stay-up",b.data("name").toLowerCase());ba();ga();return!1}function lb(){var b=$(this).parents(".stay-row"),c=b.next().next();
b.prev().prev();var d=b.clone(!0),e=c.clone(!0);F();b.hasClass("first")&&(e.addClass("first"),d.removeClass("first"));c.hasClass("last")&&(d.addClass("last"),e.removeClass("last"));b.after(e);c.after(d);b.remove();c.remove();e.prev().prev().data("destinationId")&&za(e.prev());e.data("destinationId")&&za(e.next());d.next().next().data("destinationId")&&za(d.next());M(b.data("stayId"),["Stay_ArrivalDate","Stay_DepartureDate"]);M(c.data("stayId"),["Stay_ArrivalDate","Stay_DepartureDate"]);a.trackEvent(g.CAT_PLAN_ROUTE_STAY,
"move-stay-down",b.data("name").toLowerCase());ga(function(){ba()});return!1}function Sa(a){a.find(".edit-details").removeClass("collapse");a.find(".content").addClass("editing");a.find(".left").find(".line").addClass("expand");window.setTimeout(J,300);window.setTimeout(J,50)}function ma(a){a.find(".edit-details").addClass("collapse");a.find(".content").removeClass("editing");a.find(".left").find(".line").removeClass("expand");window.setTimeout(J,50);window.setTimeout(J,300)}function va(){var a=$(this).parents(".stay-row");
Sa(a);return!1}function ab(){var a=$(this).parents(".stay-row"),b=a.data("stayId");ma(a);ra[b]&&(ra[b].removeOverlay(),delete ra[b]);return!1}function Ia(a,b){"view-calendar"===b.action&&m.triggerEvent("route","dayTime-click",{});("go-to-car"===b.action||"go-to-train"===b.action)&&b.func()}function La(a,b){if(ta){var c=$("<div>Please save or discard your changes<br/>in order to continue.</div>");c.dialog({resizable:!1,modal:!0,title:"You have unsaved changes",draggable:!1,width:"490px",dialogClass:"dlg-route-edit dlg-save-or-discard mediumx",
buttons:{Discard:function(){ja.bind(ua.find(".cancel-btn"))(b);c.dialog("close")},"Save changes":function(){da.bind(ua.find(".done-btn"))(b);c.dialog("close")}},open:function(){d.setupDialogOverlay(c)},close:function(){c.dialog("destroy").remove()}})}else m.triggerEvent("route","post-route-change",b)}function bb(){if(!$(".bottom-pane").hasClass("visible")){var a=$(".plan-heading");a.find(".plan-title-wrapper").addClass("hidden");var b=$("#overviewRoutePane").find(".edit-container").clone().removeClass("hidden"),
c=$(b);c.dialog({resizable:!1,modal:!0,draggable:!1,width:458,height:242,dialogClass:"dlg-edit-plan-dates mediumx",open:function(){$("body").off("click.dlg-edit-plan-dates").on("click.dlg-edit-plan-dates",".dlg-edit-plan-dates",function(a){$(a.target).hasClass("dlg-edit-plan-dates")&&c.dialog("close")});d.setupDialogOverlay(c,!1);var a={$startAltField:c.find(".calendar-input .startDate-alt"),$endAltField:c.find(".calendar-input .endDate-alt"),altFieldDateFormat:window.dateFormatDisplayPattern,container:c.find(".calendar-input"),
positionMy:"top right",positionAt:"bottom right",adjustMethod:"none",showOpenDateRange:!0,onSelect:N};e.prepareDateRange(c.find(".calendar-input .startDate"),c.find(".calendar-input .endDate"),60,a);l.prepareTravelers(c.find(".travelers-btn"),!0);c.off("click.edit-plan").on("click.edit-plan",".edit-plan",function(a){var b={};b.numAdults=c.find(".whoAdults").val();b.numTeens=c.find(".whoTeens").val();b.numKids=c.find(".whoKids").val();c.dialog("close");da(a,b)});c.find(".travel-with :input").each(function(){var a=
$(this);0<parseInt(a.val())&&(a.removeClass("disabled"),a.siblings("span").removeClass("disabled"))});var a=c.find(".calendar-input .startDate").val(),b=c.find(".calendar-input .endDate").val();c.find(".calendar-input .startDate-alt").val($.datepicker.formatDate(wa,$.datepicker.parseDate(hb,a)));c.find(".calendar-input .endDate-alt").val($.datepicker.formatDate(wa,$.datepicker.parseDate(hb,b)))},close:function(){a.find(".plan-title-wrapper").removeClass("hidden");$(this).dialog("destroy").remove()}})}}
var oa={},Fa,fa,R,X,ua,ta=!1,Z=d.ISO_DATE_FORMAT,fb=d.ISO_DATE_TIME_FORMAT,Aa=d.ISO_DATE_TIME_FORMAT,Wa=d.JQUERY_ISO_DATE_FORMAT,Za=d.EDIT_PLAN_DATE_FORMAT,hb=d.DEFAULT_DATE_FORMAT,wa=d.DEFAULT_DISPLAY_DATE_FORMAT,ra={},la={},Da=[],Ka=0,Ma={},Ua=d.MAX_TRAVELERS_FLIGHT,Ga=!1;oa.isDirty=function(){return Ga};oa.refreshIfInvalid=function(){Ga&&(fa.empty(),p.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/route",type:"GET",success:function(a){Da=[];fa.html(a);oa.initialize();
J();Ga=!1}}))};oa.isExpanded=function(){return fa.find(".title-row .routeLink").hasClass("hidden")};oa.expand=function(){};oa.collapse=function(){};oa.initialize=function(){Fa=$("#overview");fa=$("#route");ua=$(".bottom-pane");ra={};j.initialize();if(fa.length){R=fa.find(".route-main-pane");X=fa.find(".route-right-pane");fa.find("#routeBottomPane");fa.find("#routeAddPane");m.addObserver("refresh-route","route",oa.refreshIfInvalid);m.addObserver("page-change","route",La);m.addObserver("expand-route-section",
"route",ya);m.addObserver("open-travel-options","route",Ba);m.addObserver("post-route-change","route",Ia);m.addObserver("hide-bottom-pane","route",y);m.addObserver("save-route-travel","route",L);m.addObserver("on-modal-close","route",function(){$("#overview").is(":visible")&&J()});m.addObserver("show-removed-visits-dlg","route",$a);m.addObserver("expand-route-tip","route",function(){Fa.find(".overview-route-pane").removeClass("one-view");ba()});fa.off("click.route").on("click.route",function(b){var c=
$(b.target),d=c.data("eventLabel"),b=c.data("stayId");if(c.parents(".stay-title").length)b=c.parents(".stay-title").data("stayId"),d="stay-title";else if(c.parents(".mini-calendar .hasData").length)b=c.parents(".mini-calendar .hasData").data("stayId"),d="calendar-box";else if(c.is(".map-marker")||c.parents(".mini-map .map-marker").length)b=c.is(".map-marker")?b:c.parents(".mini-map .map-marker").data("stayId"),d="map-marker";c.is(".title-row")||c.parents(".title-row").length?(a.trackEvent(g.CAT_PLAN_ROUTE,
"collapse-route",d),collapseRouteSection()):c.parents(".mini-calendar").length&&(c=$("#destinations-stay-row-"+b),Sa(c),Ja(b,!0))});$(".route-row.stay-row").first().addClass("first");$(".route-row.stay-row").last().addClass("last");S();if($("#plan").data("editEnabled"))R.find(".departDate-alt").each(function(){var b=h($(this).siblings(".container-datepicker").val(),Z).toDate(),c=$(this);b&&c.val($.datepicker.formatDate(wa,b));var d=c.parents(".stay-row"),e=h(d.data("arrivalDateTime"));20<=e.hours()&&
e.add("1","d");c.siblings(".container-datepicker").inspirockDatepicker({minDate:e.toDate(),maxDate:e.clone().add(59,"days").toDate(),dateFormat:"dd-mm-yyyy",altFormat:wa,altField:$(this),defaultDate:b,onSelect:function(){d.data("departureDate",h(c.siblings(".container-datepicker").datepicker("getDate")).format(Z));U(d);aa(d.data("stayId"),"Stay_DepartureDate");a.trackEvent(g.CAT_PLAN_ROUTE_STAY,"update-stay-departure-date");ga()},beforeShow:function(){c.parents(".route-row").append($("#ui-datepicker-div").addClass("plan-datepicker-depart"));
$("#ui-datepicker-div").hide()},onClose:function(){$("body").append($("#ui-datepicker-div").removeClass("plan-datepicker-depart"))}});$(this).off("click").on("click",function(){var a=$(this).siblings(".container-datepicker");a.datepicker(a.datepicker("widget").is(":visible")?"hide":"show")})}),R.find(".arriveDate-alt").each(function(b){var c=h($(this).siblings(".container-datepicker").val(),Z).toDate(),d=$(this);c&&d.val($.datepicker.formatDate(wa,c));var e=d.parents(".stay-row"),f=h(e.data("earliestArrivalDateTime"));
d.siblings(".container-datepicker").inspirockDatepicker({minDate:f.toDate(),maxDate:0===b?f.clone().add(1409,"m").toDate():f.clone().add(59,"days").toDate(),dateFormat:"dd-mm-yyyy",altFormat:wa,altField:$(this),defaultDate:c,onSelect:function(){var b=$(this),c=$(this).parents(".edit-details").find(".departDate.container-datepicker"),b=b.datepicker("getDate");c.datepicker("getDate");null!==b?c.datepicker("option","minDate",b):c.datepicker("option","minDate","+0d");e.data("arrivalDate",h(d.siblings(".container-datepicker").datepicker("getDate")).format(Z));
e.data("duration",null);U(e);aa(e.data("stayId"),"Stay_ArrivalDate");a.trackEvent(g.CAT_PLAN_ROUTE_STAY,"update-stay-arrival-date");ga()},beforeShow:function(){d.parents(".route-row").append($("#ui-datepicker-div").addClass("plan-datepicker-arrive"));$("#ui-datepicker-div").hide()},onClose:function(){$("body").append($("#ui-datepicker-div").removeClass("plan-datepicker-arrive"))}});$(this).off("click").on("click",function(){var a=$(this).siblings(".container-datepicker");a.datepicker(a.datepicker("widget").is(":visible")?
"hide":"show")})});else R.find(".departDate-alt,.arriveDate-alt").off("click").on("click",function(){m.triggerEvent("route","claimPlan",{})});var b=X.find(".date-edit .startDate"),c=X.find(".date-edit .endDate"),b=h.utc(b.val(),Z),c=h.utc(c.val(),Z);X.find(".date-edit .startDate-alt").val(b.format(window.dateFormatMomentDisplayPattern));X.find(".date-edit .endDate-alt").val(c.format(window.dateFormatMomentDisplayPattern));X.find(".display-dates .dates").html(b.format("ddd, MMM D")+" &mdash; "+c.format("ddd, MMM D"));
ba();R.find("svg.edit").off("click.edit-stay").on("click.edit-stay",va);R.find("svg.collapse").off("click.collapse-stay").on("click.collapse-stay",ab);R.off("mouseenter.travel-row").on("mouseenter.travel-row",".travel-row .left, .travel-row .content",na).off("mouseleave.travel-row").on("mouseleave.travel-row",".travel-row .left, .travel-row .content",sa).off("mouseenter.stay-row").on("mouseenter.stay-row",".stay-row .left, .stay-row .content",ha).off("mouseleave.stay-row").on("mouseleave.stay-row",
".stay-row .left, .stay-row .content",ia).off("mouseenter.boundary-row").on("mouseenter.boundary-row",".boundary-row .left, .boundary-row .content",pa).off("mouseleave.boundary-row").on("mouseleave.boundary-row",".boundary-row .left, .boundary-row .content",ka).off("click.travel-row").on("click.travel-row",".travel-row .left, .travel-row .content .dates, .travel-row .content .options",A).off("click.stay-row").on("click.stay-row",".stay-row .left, .stay-row .content",Na).off("click.find-a-hotel").on("click.find-a-hotel",
".find-hotel",Ta);X.off("click.view-full-calendar").on("click.view-full-calendar",".view-full-calendar",I);$("#plan").data("editEnabled")&&(R.off("click.delete").on("click.delete",".delete-destination",H).off("click.boundary-row").on("click.boundary-row",".boundary-row .left, .boundary-row .content .title, .boundary-row .content .edit-boundary",W),X.off("click.add-destination").on("click.add-destination",".add-destination",V).off("click.edit-dates").on("click.edit-dates",".display-dates",T),R.find("svg.arrow-up").off("click.stay-arrow-up").on("click.stay-arrow-up",
gb),R.find("svg.arrow-down").off("click.stay-arrow-down").on("click.stay-arrow-down",lb),$("button.done-btn").off("click.done-btn").on("click.done-btn",da),$("button.cancel-btn").off("click.cancel-btn").on("click.cancel-btn",ja),c={dateFormat:Wa,$startAltField:X.find(".date-edit .startDate-alt"),$endAltField:X.find(".date-edit .endDate-alt"),altFieldDateFormat:window.dateFormatDisplayPattern,container:fa,positionMy:"top right",positionAt:"bottom right",adjustMethod:"none",hideDelete:!0,onSelect:O,
onClose:function(){var b=X.find(".startDate"),c=X.find(".endDate"),b=h.utc(b.val(),Z),d=h.utc(c.val(),Z);b.isValid()&&!d.isValid()&&(d=b.clone().add(1,"day"),c.val(d.format(Z)),X.find(".endDate-alt").val(d.format(window.dateFormatMomentDisplayPattern)),R.data("userEndDate",d.format(Z)));a.trackEvent(g.CAT_PLAN_ROUTE,"update-plan-dates");ga()},showOpenDateRange:!0},e.prepareDateRange(X.find(".date-edit .startDate"),X.find(".date-edit .endDate"),60,c),$(".plan-heading").off("click.edit-plan-dates").on("click.edit-plan-dates",
".edit-plan-dates",bb));fa.off("click.edit").on("click.edit",".one-dest-toggle",function(){Fa.find(".overview-route-pane").removeClass("one-view");ba()});fa.off("isVisible").on("isVisible",Qa).off("isHidden").on("isHidden",Xa);fa.is(":visible")&&Qa();ba();R.find(".stay-row").each(function(a,b){var c=$(b),d=c.data("stayProperties");d&&(la[c.data("stayId")]=d)});Ka=R.data("priorityId");Ma=P()}};return oa});define("text%21templates/userComment.html",[],function(){return'<li class="comment">\n    <div>\n        <span class="username"></span>\n        <span class="time"></span>\n    </div>\n    <div class="message"><span class="answer"></span><a href="javascript:void(0);" class="delete"><i class="fa fa-times"></i> delete</a></div>\n</li>'});
define("text%21templates/newCollaborator.html",[],function(){return'<div class="collaborator">\n    <div class="title"></div>\n    <input type="text" class="shaded name" placeholder="Name * (so you know who\'s who as you plan)">\n    <input type="text" class="shaded email" placeholder="Email * (we\'ll send an invitation to join this plan)">\n</div>'});define("text%21templates/manageCollaborator.html",[],function(){return'<div class="collaborator clearfix">\n    <div class="name pull-left"></div>\n    <div class="email pull-left"></div>\n    <i class="delete fa fa-times pull-right clickable-text"></i>\n    <div class="clearfix"></div>\n    <div class="invite">has not joined <a href="javascript:void(0);" class="resend">Resend invitation</a></div>\n</div>'});
define("text%21templates/userInfo.html",[],function(){return'<div class="update-user-info">\n    <div class="message"></div>\n    <div class="column2"><input type="text" class="shaded firstname right-gap" placeholder="First Name *" id="signupFirstName"></div>\n    <div class="column2"><input type="text" class="shaded lastname left-gap" placeholder="Last Name *" id="signupLastName"></div>\n    <div class="clearfix"></div>\n    <div class="column">\n        <input type="text" class="shaded email" placeholder="Email *" id="signupUsername">\n    </div>\n    <div class="error-message"></div>\n</div>'});
define("plan/collaboration","modules/analytics modules/ajax modules/utils modules/events text!templates/newCollaborator.html text!templates/manageCollaborator.html text!templates/userInfo.html jquery jqueryui qtip".split(" "),function(a,g,d,p,m,j,i){function c(a,b,c,e,f,g,i){for(var j=$("<div></div>"),p=0;p<a;p++){var v=$(m);v.find(".title").text((d.numToStr(p+1)||"Add")+" "+c);j.append(v)}j.append($("<a>").append($("<i>").addClass("fa fa-plus")).append(e).addClass("add-more text-link"));j.dialog({resizable:!1,
modal:!0,draggable:!1,title:b,width:"560px",dialogClass:"dlg-collab add-collaborator mediumx",buttons:{Send:function(){var a=j.find(".collaborator"),b=!1,c=[];a.each(function(){var a=$(this),e=a.find(".name"),a=a.find(".email"),g=e.val().trim(),h=a.val().trim();0===g.length&&0===h.length||(50>g.length&&d.validateEmail(h)&&d.isName(g)?c.push({name:g,email:h,role:f}):(b=!0,!g.length||!d.isName(g)?d.showErrorTooltip(e,"Please provide a valid name"):(d.hideErrorTooltip(e),50<=g.length?d.showErrorTooltip(e,
"Name cannot be more than 50 characters"):d.hideErrorTooltip(e)),d.validateEmail(h)?d.hideErrorTooltip(a):d.showErrorTooltip(a,"Please provide valid email")))});b||(c.length?(d.params.add("plan.collaborators.add.collaborators",c),d.params.add("plan.collaborators.add.role",f),d.params.add("plan.collaborators.add.commentParentId",g),d.params.add("post-login-url",location.href),u.requireUserNameExists({success:function(a,b){u.sendAddCollaboratorsRequest("collaboration.add-collaborator-dialog",c,f,g,
j,a,b,i)}},void 0,c)):d.showErrorTooltip(a.eq(0).find(".name"),"Please provide name"))}},open:function(){d.setupDialogOverlay(j,!1);j.on("click",".add-more",function(){var a=$(m);a.find(".title").text((d.numToStr(j.find(".collaborator").length+1)||"Add")+" "+c);a.insertBefore($(this));a.find("input").blur();j.dialog({position:{my:"center",at:"center",of:window}})});j.find("input").blur();$(".dlg-collab").addClass("mediumx")},close:function(a){$(".qtip-default.error").qtip("destroy");j.dialog("destroy").remove();
i&&i.close&&i.close(a)}})}function b(b,c,f,e,l){if(!$(".dlg-collab.manage-collaborator").length){var i=$("<div></div>"),m=function(b){i.empty();$(".dlg-collab.manage-collaborator").find(".num").html(b.length);$(".show-others .num").html(b.length-2);for(var c=0;c<b.length;c++){var k=$(j);k.find(".name").text(b[c].name);b[c].email&&k.find(".email").text(b[c].email);k.data("collaborator",b[c]);d.display(k.find(".invite"),b[c].inviteUrl&&!l);d.display(k.find(".delete.clickable-text"),b[c].deleteUrl&&
!l);i.append(k);i.dialog({position:{my:"center",at:"center",of:window}})}i.off("click.x").on("click.x",".delete",function(){var b=$(this),c=b.parents(".collaborator"),d=c.data("collaborator"),l=$('<div class="delete-confirm clickable"><input type="button" class="button cta-button small" value="'+f+'"></div>');l.click(function(){b.qtip("api").destroy();g.makeAJAXcall({type:"POST",url:window.contextPath+d.deleteUrl,success:function(){a.trackEvent("collaboration.manage-collaborator-dialog","delete-collaborator",
e.toLowerCase());u.removeCollaboratorData({collaborator:d});p.triggerEvent("collaboration","collaborator-remove",{collaborator:d});c.remove();i.find(".collaborator").length||i.dialog("close")}})});b.qtip({overwrite:!0,content:l,position:{my:"top right",at:"top right",container:i.parents(".ui-dialog")},show:{event:"click",delay:0,ready:!0},hide:{event:"unfocus",fixed:!0},events:{show:function(){c.addClass("dim")},hide:function(a,b){c.removeClass("dim");b.destroy()}},style:{classes:"noShadow noBorder deleteConfirm",
tip:{corner:!1}}})});$(".collaborator .invite .resend").blur().off("click").on("click",function(){var b=$(this).parents(".collaborator"),c=b.data("collaborator");b.find(".invite").hide(100);g.makeAJAXcall({type:"POST",url:window.contextPath+c.inviteUrl,success:function(){a.trackEvent("collaboration.manage-collaborator-dialog","resend-invite",c.role.toLowerCase());b.find(".invite").html("invitation sent successfully.");b.find(".invite").show(100)}})})};i.dialog({resizable:!1,modal:!0,draggable:!1,
title:b,width:"465px",dialogClass:"dlg-collab manage-collaborator mediumx",open:function(){d.setupDialogOverlay(i,!1);m(c);i.dialog({position:{my:"center",at:"center",of:window}})},create:function(){var a="COTRAVELER"===e?"co-traveler":"friend";$(".dlg-collab.manage-collaborator").append('<div class="small-action add-cotraveler-from-manage"><a href="javascript:void(0);" class="add-more-cotraveler text-link"><i class="fa fa-plus"></i>Add more '+a+" to this plan</a></div>");$(".add-more-cotraveler").off("click").on("click",
function(){$(".dlg-collab.manage-collaborator").hide();var a=function(a){a&&("FRIEND"===e&&a.friends?m(a.friends):"COTRAVELER"===e&&a.cotravelers&&m(a.cotravelers))},b=function(a){$(".dlg-collab.manage-collaborator").show();a&&(a.handleObj&&"click"===a.handleObj.origType)&&i.dialog("close")};"COTRAVELER"===e?u.showAddCotravelerDialog(1,{success:a,close:b}):u.showAddFriendDialog(1,null,{success:a,close:b})})},close:function(){i.dialog("destroy").remove()}})}}function f(a,b,c,e,f,g){var i={};i[e]=function(b){b=
$(b.currentTarget);if(!b.data("clicked")){var c=a.find(".update-user-info"),h=c.find(".firstname"),i=c.find(".lastname"),j=c.find(".email"),h=h.val().trim(),i=i.val().trim(),j=j.is(":visible")?j.val().trim():void 0,k=!1;$(".firstname,.lastname,.email").off("input").on("input",function(){r.html("")});var m='<div class="error-message">';h||(k=!0,m="Please provide first name");i||(k=!0,m=m+(m?"<br />":"")+"Please provide last name");void 0!==j&&!d.validateEmail(j)&&(k=!0,m+=m?"<br />":"",m+="Please provide a valid email address");
for(var p=0;p<g.length;p++)if(j===g[p].email){k=!0;m+="Your email Id and collaborator's email Id cannot be same.";break}var r=c.find(".error-message");r.html("");k&&(r.length?r.html(m):c.find(".message").after());k||(c={firstname:h,lastname:i,email:j},b.data("clicked",!0),b.data("orginal-text",e),b.data("processing-text",u.collaborationTemplates.buttons.toProcessingText(e)),f.success(a,c))}};a.dialog({resizable:!1,modal:!0,draggable:!1,title:b,width:"465px",dialogClass:c+" mediumx",buttons:i,open:function(){d.setupDialogOverlay(a,
!1);var b=a.find(".update-user-info"),c=b.find(".email");window.registeredUserLoggedIn?c.hide():c.show();b.find("input").blur()},create:function(){window.registeredUserLoggedIn||(d.params.add("post-login-url",location.href),$("."+c).append('<div class="footer"><span class="account-text">Have an account?</span> <a class="login-link" href="javascript:void(0);">Log in to inspirock</a></div>'),$("."+c+" .login-link").off("click").on("click",function(){d.login()}))},close:function(){$(".qtip").qtip("destroy");
a.dialog("destroy").remove();f&&f.close&&f.close()}})}var u={collaborationTemplates:{buttons:{"Request Access":"Requesting ...","OK, That's me":"Saving ...",toProcessingText:function(a){return u.collaborationTemplates.buttons[a]?u.collaborationTemplates.buttons[a]:"Processing ..."}}},loginErrorModal:function(a){var b=$(document.createElement("div"));b.html("<p><center>"+a+"</center></p>");b.dialog({title:"Error",resizable:!1,modal:!0,draggable:!1,width:"350px",dialogClass:"errorDialog mediumx",buttons:{Login:function(){b.dialog("close");
d.login()}},close:function(){b.dialog("destroy").remove()},open:function(){d.setupDialogOverlay(b,!1)}})},sendAddCollaboratorsRequest:function(b,c,f,e,l,i,j,m){g.makeAJAXcall({type:"POST",data:{collaborators:d.stringify(c),commentParentId:e,user:d.stringify(j)},url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/collaborators",synchronize:!0,success:function(d){if(!i||u.userCreationSuccess(d,i))d&&d.error&&d.needsLogin?u.loginErrorModal(d.message):(a.trackEvent(b,"add-collaborator",f.toLowerCase()),
p.triggerEvent("collaboration","mmt_track_link",{linkName:"Add "+f.toLowerCase()}),$("#plan").data("collaborationEnabled",!0),j&&$("#plan").data("currentUserFirstname",j.firstname),p.triggerEvent("collaboration","collaborator-add",{collaborators:c}),m&&m.success&&m.success(d.additionalData),l&&l.dialog("close"))}})},showReadonlyCollaborationDialog:function(a,c){var d="COTRAVELER"===c?"co-travelers":"friends";b('Visible to <span class="bold"><span class="num">'+a.length+"</span> "+d+"</span>",a,"",
c?c:"",!0)},showAddFriendDialog:function(a,b,d){c(a,'Ask more <span class="bold">friends</span>',"friend","Add more friends","FRIEND",b,d)},showAddCotravelerDialog:function(a,b){c(a,'Add <span class="bold">co-travelers</span>',"co-traveler","Add more co-travelers","COTRAVELER",null,b)},showManageCotravelerDialog:function(){g.makeAJAXcall({type:"GET",url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/cotravelers",success:function(a){b('Manage <span class="bold">co-travelers</span>',a,"Delete co-traveler?",
"COTRAVELER")}})},addCollaboratorData:function(a){var b=$("#plan"),c=b.data("collaboratorNames"),d=b.data("cotravelerNames"),f;for(f in a.collaborators)c&&(c+=","),c+=a.collaborators[f].name;b.data("collaboratorNames",c);for(f in a.collaborators)"COTRAVELER"===a.collaborators[f].role&&(d&&(d+=","),d+=a.collaborators[f].name);b.data("cotravelerNames",d)},removeCollaboratorData:function(a){var b=$("#plan"),c=b.data("collaboratorNames").split(","),e=c.indexOf(a.collaborator.name),f=b.data("cotravelerNames").split(","),
a=f.indexOf(a.collaborator.name);-1<e&&(c.splice(e,1),b.data("collaboratorNames",d.joinArray(c,",")));-1<a&&(f.splice(a,1),b.data("cotravelerNames",d.joinArray(f,",")))},requireUserNameExists:function(a,b,c){if($("#plan").data("currentUserFirstname"))a&&a.success&&a.success();else{var b=b||'<div class="first">We don\'t seem to have your name...</div><div class="second">Please add your name to your profile so your friends know who you are:</div>',d=$("<div></div>").append(i);d.find(".message").html(b);
f(d,'Tell us <span class="bold">who you are</span>',"dlg-update-user-info","OK, That's me",a,c);a&&a.open&&a.open(d)}},requestAccessDialog:function(a){if($("#plan").data("currentUserFirstname"))a&&a.success&&a.success();else{var b=$("<div></div>").append(i);f(b,"Request Access","dlg-request-access-user-info","Request Access",a)}},isFriend:function(){return"OWNER"!==$("#plan").data("planUserRole")&&"COTRAVELER"!==$("#plan").data("planUserRole")},formatCollaboratorNames:function(a){for(var a=a.split(","),
b=a.length,c="",d=0;d<b;d++)if(0<d&&(d===b-1||2===d)?c+=" & ":0<d&&(c+=", "),2>d||3>=b)c+=a[d].trim();else{c+='<a href="javascript:void(0);" class="show-others text-link"><span class = "num">';c+=b-3+1;c+="</span> others</a>";break}return c},userCreationSuccess:function(b,c){if(b&&b.additionalData){if(b.additionalData.needsLogin)return u.loginErrorModal(b.additionalData.message),$(".resultspage").find(".dlg-update-user-info").remove(),!1;if(b.additionalData.needsReload)return d.showErrorModal(b.additionalData.errorMessage,
{"Reload Now":function(){window.location.href=document.location.pathname+d.addUrlParam(document.location.search,"force_reload","")}}),!1}if(c&&b&&b.errors&&b.errors.length){var f=c.find(".update-user-info"),e=f.find(".firstname"),g=f.find(".lastname"),f=f.find(".email"),i;for(i in b.errors){i=b.errors[i];"signupFirstName"===i.field?d.showErrorTooltip(e,i.error):"signupLastName"===i.field?d.showErrorTooltip(g,i.error):"signupUsername"===i.field&&d.showErrorTooltip(f,i.error);break}return!1}b&&b.additionalData&&
b.additionalData.tempAccountCreated?(a.trackEvent("collaboration.user-info-dialog","create-temp-account"),d.showFlash("Your co-traveler has been added and you are now logged in. Please check your email to confirm your account in the next 24 hours. Meanwhile keep exploring!",!0)):a.trackEvent("collaboration.user-info-dialog","update-user-name");p.triggerEvent("collaboration","login",b.additionalData);$("#plan").data("currentUserFirstname",!0);window.registeredUserLoggedIn=!0;c.dialog("close");return!0}};
return u});define("text%21templates/commentsModal.html",[],function(){return'<div id="commentsModal">\n    <div class="bubbles">\n        <span class="fa fa-comment-o bubble1"></span>\n        <span class="fa fa-comment-o bubble2"></span>\n    </div>\n    <div class="content">\n        <div class="line1">\n            <span class="user"></span> has <span class="num-questions"></span> for you:\n        </div>\n        <div class="line1-alternative hidden">Someone has added you to the conversation about:</div>\n        <div class="question"></div>\n    </div>\n</div>'});
define("plan/collabQuestionsDialog",["modules/utils","text!templates/commentsModal.html"],function(a,g){function d(){if(j.length){var b=j[c];$("#commentsModal .content .user").html($("#plan").data("planOwnerFirstname"));$("#commentsModal .content .question").html(a.unescape(b.content.message))}}function p(){1<j.length&&u.removeClass("hidden");j.length===c+1?b.addClass("disabled"):b.removeClass("disabled");0===c?f.addClass("disabled"):f.removeClass("disabled")}var m={},j=[],i=!1,c=0,b,f,u,n,k=$("#plan"),
h=k.data("userId"),k=k.data("planUserRole"),e="OWNER"===k||"COTRAVELER"===k;m.addComments=function(l,m){if(m.parentId==m.itemId&&"1"!==a.getParameterByName("sto"))if(l){if(!(e||void 0===a.params.get("token"))){if(!i){n=$("<div></div>");var k=$(g);n.append(k);k="FRIEND"===$("#plan").data("collab-invite-role");a.display(n.find(".line1"),!k);a.display(n.find(".line1-alternative"),k);n.dialog({resizable:!1,modal:!0,draggable:!1,title:'Welcome to <span class="bold">'+$("#plan").data("planOwnerFirstname")+
"'s plan</span>",width:"560px",dialogClass:"dlg-collab inverted questions mediumx",buttons:{"ANSWER THIS":function(){var a=j[c];$("html,body").scrollTo("#comments-list-"+a.content.itemId,{duration:"slow",offsetTop:"50"});$("#comments-list-"+a.content.itemId+" .hide-show .fa").hasClass("fa-chevron-up")||$("#comments-list-"+a.content.itemId+" .action").trigger("click");$("#comments-list-"+a.content.itemId+" .response .new-comment").focus();n.dialog("destroy").remove()}},open:function(){a.setupDialogOverlay(n,
!1);u=$(".dlg-collab.questions .footer");f=u.find(".prev");b=u.find(".next");f.off("click").on("click",function(){$(this).hasClass("disabled")||(c--,p(),d())});b.off("click").on("click",function(){$(this).hasClass("disabled")||(c++,p(),d())})},create:function(){n.parent(".dlg-collab.questions").append('<div class="footer hidden"><div class="nav clearfix"><a href="javascript:void(0);" class="prev">&lsaquo; last question</a><a href="javascript:void(0);" class="next">next question &rsaquo;</a></div></div>')},
close:function(){n.dialog("destroy").remove()}});i=!0}k={};k.content=m;k.read=!1;j.push(k);k=1===j.length?"a question":j.length+" questions";$("#commentsModal .content .num-questions").html(k);1===j.length&&d();p()}}else{a:{for(k=0;k<j.length;k++)if(h==m.userId&&m.itemId==j[k].content.parentId)break a;k=-1}0<=k&&(j.splice(k,1),j.length<=c&&c--,0===j.length&&n.dialog("destroy").remove(),k=1===j.length?"a question":j.length+" questions",$("#commentsModal .content .num-questions").html(k),d(),p())}};
return m});define("text%21templates/askQuestionWithNoCollab.html",[],function(){return'<div class="clearfix">\n    <textarea class="new-question" placeholder="Ask your question here... *"></textarea>\n    <div class="friends-info">\n    <input type="text" class="name" placeholder="Friend\'s Name * (so we know who\u2019s who)">\n    <input type="text" class="email" placeholder="Friend\'s Email * (we\'ll send an invitation to join this plan)">\n    </div>\n    <button class="cta-button small ask-question">Send</button>\n    <span class="add-friends clickable-text"><i class="fa fa-plus"></i>Ask more friends</span>\n</div>'});
define("text%21templates/askQuestionWithCollab.html",[],function(){return'<div class="with-collab clearfix">\n    <textarea class="new-question" placeholder="Ask your question here... *"></textarea>\n    <button class="cta-button small ask-question">Send</button>\n    <span class="collaborators">Visible to: <span class="names"></span></span>\n    <span class="add-friends clickable-text"><i class="fa fa-plus"></i>Add a friend to this conversation</span>\n</div>'});
define("text%21templates/conversation.html",[],function(){return'<li class="conversation">\n    <div class="question clearfix">\n        <div class="bubbles">\n            <i class="fa fa-comment-o bubble1"></i>\n            <i class="fa fa-comment-o bubble2"></i>\n        </div>\n        <div class="title"><span class="qtext"></span> <a href="javascript:void(0);" class="delete"><i class="fa fa-times"></i> delete</a></div>\n        <div class="hide-show text-link">\n            <span class="action">post a comment</span>\n            <i class="fa fa-chevron-down"></i>\n        </div>\n    </div>\n    <div class="comments hidden">\n        <div class="load-more-comments hidden">load more replies</div>\n        <ul class="comments-list"></ul>\n        <div class="response"></div>\n    </div>\n</li>'});
define("text%21templates/postComment.html",[],function(){return'<div class="with-collab clearfix">\n    <textarea class="new-comment" placeholder="Post a comment here..."></textarea>\n    <button class="cta-button small post-comment">POST</button>\n    <span class="collaborators">Visible to: <span class="names"></span></span>\n    <span class="add-friends clickable-text"><i class="fa fa-plus"></i>Add a friend to this conversation</span>\n</div>'});define("text%21templates/postQuestion.html",[],function(){return'<div class="with-collab clearfix">\n    <textarea class="new-comment" placeholder="Post a question here..."></textarea>\n    <button class="cta-button small post-comment">POST</button>\n    <span class="collaborators">Visible to: <span class="names"></span></span>\n    <span class="add-friends clickable-text"><i class="fa fa-plus"></i>Add a friend to this conversation</span>\n</div>'});
define("text%21templates/startConversation.html",[],function(){return'<li class="conversation" data-placeholder="true">\n    <div class="question clearfix">\n        <div class="bubbles">\n            <i class="fa fa-comment-o bubble1"></i>\n            <i class="fa fa-comment-o bubble2"></i>\n        </div>\n        <div class="title">Ask your friends</div>\n        <div class="desc">Get advice and recommendations from people you know who have been here before.</div>\n        <div class="hide-show text-link"><span class="action">start a conversation</span><i class="fa fa-chevron-down"></i></div>\n    </div>\n    <div class="comments hidden">\n        <div class="response"></div>\n    </div>\n</li>'});
define("text%21templates/addFriends.html",[],function(){return'<div class="friends-info">\n<input type="text" class="name" placeholder="Name * (so you know who\'s who as you plan)">\n<input type="text" class="email" placeholder="Email * (we\'ll send an invitation to join this plan)">\n</div>'});define("text%21templates/confirmUser.html",[],function(){return'<div id="confirmUser">\n    <div class="bubbles">\n        <span class="fa fa-comment-o bubble1"></span>\n        <span class="fa fa-comment-o bubble2"></span>\n    </div>\n    <div class="content">\n        <div class="line1">First things first...</div>\n        <div class="desc main">We want to make sure we keep track of who\'s who around here. This invitation was sent to</div>\n        <div class="desc alternative">We want to make sure we keep track of who\'s who around here. <span class="sentByname"></span> sent this invitation to</div>\n        <div class="desc">"<span class="name"></span>"</div>\n        <div class="desc">Is that you?</div>\n    </div>\n</div>'});
define("text%21templates/noQuestionFriend.html",[],function(){return'<div class="line1">Got Advice?</div>\n<div class="line2">Your friend hasn\'t asked a specific question, but you can still give them feedback</div>'});define("text%21templates/commentsWithoutQuestion.html",[],function(){return'<div class="line1">You\'ve got a Comment</div>\n<div class="line2">Your friends have begun to comment on your plan. If you\'d still like to ask them a specific question, you can. \n    <a href="javascript:void(0);" class="post-a-question">Post a question &raquo;</a></div>'});
define("plan/comments","modules/ajax modules/events text!templates/userComment.html moment modules/utils plan/collaboration plan/collabQuestionsDialog text!templates/askQuestionWithNoCollab.html text!templates/askQuestionWithCollab.html text!templates/conversation.html text!templates/postComment.html text!templates/postQuestion.html text!templates/startConversation.html text!templates/addFriends.html text!templates/confirmUser.html text!templates/noQuestionFriend.html text!templates/commentsWithoutQuestion.html modules/analytics".split(" "),
function(a,g,d,p,m,j,i,c,b,f,u,n,k,h,e,l,t,r){function q(a){var b=$(d);b.attr("id","comments-list-"+a.id);b.find(".username").text(a.author||"Anonymous");b.find(".time").text(a&&a.timestamp?p.utc(a.timestamp).fromNow():"");b.find(".message .answer").text(m.unescape(a.message));a.userId===$("#plan").data("user-id")||"FRIEND"!==$("#plan").data("planUserRole")?b.find(".message .delete").data("comment-id",a.id):b.find(".message .delete").remove();b.data("comment",a);return b}function D(a,b){if(0===b){var c=
a.data("questionPresent");a.find(".hide-show .action").text(c?"post a comment":"start a conversation");if(a.data("dummy")||j.isFriend()&&!c)c=a.parents(".collab-area"),B(c,null)}else a.find(".hide-show .action").text(b+(1<b?" replies":" reply"))}function v(a){var b=a.data("comment"),c=$("#comments-list-"+b.parentId),d=!1;$.each(c.find("li"),function(c,e){e=$(e);e.data("comment").timestamp>b.timestamp&&(e.hasClass("hidden")&&a.addClass("hidden"),e.before(a),d=!0)});d||c.append(a)}function B(a,b){var c=
a.find(".conversation"),c=c.data("reuse")?c:$(f);!b||!b.userId?("OWNER"!==$("#plan").data("planUserRole")&&"COTRAVELER"!==$("#plan").data("planUserRole")?c.find(".question .title .qtext").html(l):c.find(".question .title .qtext").html(t),c.find(".question .delete").addClass("hidden"),c.data("dummy",!0)):(c.find(".question .title .qtext").text(m.unescape(b.message)),m.display(c.find(".question .delete"),"OWNER"===$("#plan").data("planUserRole")||"COTRAVELER"===$("#plan").data("planUserRole")),c.data("questionPresent",
!0));b&&(c.data("commentId",b.id),c.find(".comments-list").attr("id","comments-list-"+b.id),c.find(".question .delete").data("comment-id",b.id),c.find(".question .delete").data("comment-parentId",b.parentId));c.find(".response.inline").addClass("hidden");c.data("reuse")||a.find(".conversation").remove();c.data("reuse",!0);a.append(c)}function z(a,b,c){var d=a.parents(".comments"),e=d.siblings(".new-comment-btn"),f=d.find(".load-more-comments");c?(a.append(b),b=a.children().length,2<b&&(a.children().addClass("hidden").slice(-2).removeClass("hidden"),
f.text("load more comments ("+(b-2)+" hidden)"),f.removeClass("hidden").click(function(){a.children().removeClass("hidden");f.addClass("hidden")}))):(v(b),e.removeClass("hidden"));b=a.children().length;D(a.parents(".conversation"),b)}function C(a,b){var c=$("#plan").data("collaboratorNames");if(a&&c){b.find(".response .collaborators").removeClass("hidden");b.find(".response .collaborators .names").html(j.formatCollaboratorNames(c));var c=c.split(","),d=[];$.each(c,function(a,b){d.push({name:b})});
b.find(".response .collaborators .names .show-others").off("click").on("click",function(){j.showReadonlyCollaborationDialog(d)})}else b.find(".response .collaborators .names").html(""),b.find(".response .collaborators").addClass("hidden")}function G(b,c,d,e,f,h,l){e.fullname&&(c=e.fullname.split(" "),e.firstname=c[0],e.lastname=1<c.length?c.slice(1).join(" "):"",delete e.fullname);l&&(e.user=m.stringify(l));a.makeAJAXcall({url:d,type:"POST",data:e,complete:function(){f&&f.complete&&f.complete()},
success:function(a){if(j.userCreationSuccess(a,h))if(a&&a.needsLogin)j.loginErrorModal(a.message);else if(a&&a.errors&&a.errors.length){var c="",d;for(d in a.errors)c&&(c+="<br />"),c+=a.errors[d].error;h?h.find(".error-message").html(c):f&&f.error&&f.error(a)}else a=a.additionalData.comment,f&&f.success&&f.success(),c=$("#comments-list-"+a.parentId),c.length||(c=$("#comments-list-"+a.itemId),a.parentId!=a.itemId&&(B(c,{id:a.parentId,parentId:a.itemId}),c=$("#comments-list-"+a.parentId))),c.length&&
(E.push(a.id),a.parentId==a.itemId?B(c,a):(d=q(a),v(d),d=c.children().length,D(c.parents(".conversation"),d)),g.triggerEvent("comments","comment-added",a)),$("#plan").data("currentUserFirstname",!0),$("#plan").data("hasEmail",!0),e.collaborators&&(JSON.parse(e.collaborators),$("#plan").data("collaborationEnabled",!0)),r.trackEvent(b,"post-comment"),e.isQuestion&&g.triggerEvent("collaboration","mmt_track_link",{linkName:"Start Conversation"})}})}function M(a,d){a.removeClass("hidden");d.find(".fa").removeClass("fa-chevron-down").addClass("fa-chevron-up");
var e=d.parents(".conversation"),f=$("#plan").data("collaborationEnabled"),g=$("#plan").data("collaboratorNames");e.data("placeholder")?f&&g?e.find(".response").html(b):e.find(".response").html(c):e.find(".comments .response").html(u);C(f,e);e=e.find(".response input, .response textarea").eq(0);e.length&&e.focus()}function w(a){a=$("#comments-list-"+a).parents(".collab-area");a.find(".conversation").remove();a.append(k);D(a.find(".conversation"),0)}function J(a){var a=$("#comments-list-"+a),b=a.data("comment");
a.remove();a=$("#comments-list-"+b.parentId);D(a.parents(".conversation"),a.children().length)}function F(b,c,d,e){var d=$('<div class="delete-confirm clickable"><input type="button" class="button cta-button small" value="'+d+'"></div>'),f=$(document.createElement("div"));d.click(function(){b.qtip("api").destroy();a.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/comment/"+c+"/delete",type:"POST",success:function(a){e&&e(a)}})});f.append(d);b.qtip({overwrite:!0,content:f,
position:{my:"center left",at:"center left"},show:{event:"click",delay:0,ready:!0},hide:{event:"unfocus",fixed:!0},events:{hide:function(a,b){b.destroy()}},style:{classes:"noShadow noBorder deleteConfirm",tip:{corner:!1}}})}function y(a,b){var c=$("#comments-list-"+a),d=c.parents(".conversation"),e=d.find(".hide-show"),f=c.parents(".collab-area"),g=e.parents(".question").siblings(".comments");M(g,e);$("html").scrollTo("#"+f.attr("id"),{duration:"slow",offsetTop:"50"});d.find(".new-comment").focus();
c.is("ul")?b&&d.addClass("highlight"):(b&&c.addClass("highlight"),c.removeClass("hidden"))}function s(a,b){y(b.commentId,!1)}function H(a,b){var c=b.comments;if(c&&c.length){L=L.concat(c);c.sort(function(a,b){return a.itemId==a.parentId?-1:a.timestamp-b.timestamp});for(var d=0;d<c.length;d++){var e=c[d],f=K,h=$("#comments-list-"+e.parentId);h.length||(h=$("#comments-list-"+e.itemId),e.parentId!=e.itemId&&(B(h,{id:e.parentId,parentId:e.itemId}),h=$("#comments-list-"+e.parentId)));h.length&&0>E.indexOf(e.id)&&
(e.userId&&E.push(e.id),e.parentId==e.itemId?B(h,e):(e=q(e),z(h,e,f)))}g.triggerEvent("comments","comments-loaded",c)}!K&&(b.notifications&&b.notifications.length)&&$.each(b.notifications,function(a,b){"DELETE_COMMENT"===b.action&&b.extra.commentId&&(b.extra.commentParentId==b.itemId?w(b.extra.commentId):J(b.extra.commentId));"ADD"===b.action&&"COLLABORATOR"===b.itemType&&(j.addCollaboratorData({collaborators:[{name:b.extra.collaboratorName,role:b.extra.collaboratorRole}]}),x(),g.triggerEvent("collaboration",
"collaborator-add",{collaborators:b.extra}));if(("REMOVE"===b.action||"LEAVE"===b.action)&&"COLLABORATOR"===b.itemType)j.removeCollaboratorData({collaborator:{name:b.extra.collaboratorName,role:b.extra.collaboratorRole}}),x(),$("#plan").data("userId")===b.itemId&&(window.location.href=document.location.pathname+m.addUrlParam(document.location.search,"force_reload",""))});K&&((c=$("#plan").data("response-comment-id"))&&y(c,!0),c=m.params.get("plan.comments.post"),d=m.params.get("plan.collaborators.add"),
c&&(c.data.user&&delete c.data.user,G("collaboration.post-login-action",c.parentId,c.url,c.data)),d&&j.sendAddCollaboratorsRequest("collaboration.post-login-action",d.collaborators,d.role,d.commentParentId),m.params.flush(),x(),$.each($(".conversation"),function(){var a=$(this).find(".comments-list li");D($(this),a.length)}));K=!1}function x(){var a=$("#plan").data("collaborationEnabled");$.each($(".conversation"),function(){C(a,$(this))})}function A(){$(".comment").each(function(){var a=$(this),
b=a.data("comment");a.find(".time").text(b&&b.timestamp?p.utc(b.timestamp).fromNow():"")})}var i={},E=[],K=!0,L=[];i.refreshComments=function(){L.sort(function(a,b){return a.timestamp-b.timestamp});for(var a=0;a<L.length;a++){var b=L[a],c=$("#comments-list-"+b.parentId);c.length||(c=$("#comments-list-"+b.itemId),b.parentId!=b.itemId&&(B(c,{id:b.parentId,parentId:b.itemId}),c=$("#comments-list-"+b.itemId)));if(c.length)if(b.parentId==b.itemId)B(c,b);else{var d=q(b);z(c,d,!0)}}g.triggerEvent("comments",
"comment-added",b)};i.prepareCommentAreas=function(a){a.off("click.askquestion").on("click.askquestion",".ask-question,.post-comment",function(){var a=$(this),b=a.siblings("textarea"),c=b.parents(".collab-area").data("postUrl"),d=b.siblings(".friends-info"),f,g,h=b.parents(".conversation").data("commentId")||b.parents(".collab-area").data("commentParentId"),l={message:b.val().trim(),parentId:h,fullname:$("#plan").data("collabInviteName")};l.isQuestion=a.parents(".inline").length?!0:!1;if(0===l.message.length)m.showErrorTooltip(b,
"Please enter a comment"),b.off("blur").on("blur",function(){b.val().length&&m.hideErrorTooltip(b)});else{var i=function(){d.each(function(){f=$(this).find(".name").val().trim();g=$(this).find(".email").val().trim();if(!f.length&&!g.length)return m.hideErrorTooltip($(this).find(".email")),!0;f.length&&m.validateEmail(g)&&(l.collaborators.push({name:f,email:g}),m.hideErrorTooltip($(this).find(".email")));f.length||(m.showErrorTooltip($(this).find(".name"),"Please provide your friend's name."),k=!0);
m.isName(f)||(m.showErrorTooltip($(d[0]).find(".name"),"Friend's name cannot contain following characters <br /> (0-9<>[]{}()?/:;\"!@#$%^&*_+=)."),k=!0);g||(m.showErrorTooltip($(this).find(".email"),"Please provide your friend's email."),k=!0);m.validateEmail(g)||(m.showErrorTooltip($(this).find(".email"),"Please provide an valid email Id."),k=!0)})};if(d.length){l.collaborators=[];var k=!1;i();if(k||0===l.collaborators.length){d.find(".name,.email").off("blur").on("blur",function(){i()});0===l.collaborators.length&&
(f.length||m.showErrorTooltip($(d[0]).find(".name"),"Please provide your friend's name."),m.isName(f)||m.showErrorTooltip($(d[0]).find(".name"),"Friend's name cannot contain following characters <br /> (0-9<>[]{}()?/:;\"!@#$%^&*_+=)."),g||m.showErrorTooltip($(d[0]).find(".email"),"Please provide your friend's email."),m.validateEmail(g)||m.showErrorTooltip($(this).find(".email"),"Please provide an valid email Id."));return}l.collaborators=JSON.stringify(l.collaborators)}m.params.add("plan.comments.post.data",
l);m.params.add("plan.comments.post.url",c);m.params.add("plan.comments.post.parentId",h);m.params.add("post-login-url",location.href);b.attr("disabled","disabled");var n=function(a,d){G("collaboration",h,c,l,p,a,d);b.removeAttr("disabled")},p={success:function(a){b.val("");a&&a.dialog("close")},complete:function(){b.removeAttr("disabled")},error:function(a){j.requireUserNameExists({success:n,close:function(){b.removeAttr("disabled")},open:function(b){if(a&&a.additionalData)for(var c in a.additionalData)b.find("#"+
c).val(a.additionalData[c]);if(a&&a.additionalData){c="";for(var d in a.errors)c&&(c+="<br />"),c+=a.errors[d].error;b.find(".error-message").html(c)}}})}};if(!window.registeredUserLoggedIn&&!$("#plan").data("currentUserFirstname")&&"OWNER"!==$("#plan").data("planUserRole")){var s={success:n,close:function(){b.removeAttr("disabled")}};$("#plan").data("plan-id");var t={},q=$("<div></div>");q.append(e);a="FRIEND"===$("#plan").data("collab-invite-role");m.display(q.find(".main"),!a);m.display(q.find(".alternative"),
a);q.find(".name").text($("#plan").data("collabInviteName"));q.find(".sentByname").text($("#plan").data("collab-invite-user"));q.dialog({resizable:!1,modal:!0,draggable:!1,title:'Welcome to <span class="bold">'+$("#plan").data("planOwnerFirstname")+"'s plan</span>",width:"560px",dialogClass:"dlg-collab inverted confirm-user",buttons:{"Yes, That's me":function(){t.token=$("#plan").data("collabInviteToken");q.dialog("close");s.success(null,t)},"No, Enter My Name":function(){q.dialog("close");j.requireUserNameExists({success:function(a,
b){$("#plan").data("collabInviteToken","");s&&s.success&&s.success(a,b);r.trackEvent("collaboration.confirm-user-dialog","confirm-user","other")}},'<div class="second">Please add your name to your profile so your friends know who you are:</div>')}},open:function(){m.setupDialogOverlay(q,!1)},close:function(){q.dialog("destroy").remove();s&&s.close&&s.close()}})}else j.requireUserNameExists({success:n,close:function(){b.removeAttr("disabled")}})}});a.off("click.addfriends").on("click.addfriends",".add-friends",
function(){var a=$(this).siblings(".friends-info"),b=$(this).parents(".collab-area").data("commentParentId");a.length?$(a.last()).after(h):j.showAddFriendDialog(1,b)});a.off("click.tgl-comment").on("click.tgl-comment",".collab-area .hide-show,.collab-area .conversation .question .qtext",function(){var a=$(this),b=a.parents(".question").siblings(".comments");a.hasClass("hide-show")||(a=$(a).parents(".title").siblings(".hide-show"));a.find(".fa").hasClass("fa-chevron-up")?(b.addClass("hidden"),a.find(".fa").removeClass("fa-chevron-up").addClass("fa-chevron-down"),
a.parents(".collab-area").find(".error-qtip").qtip("destroy")):M(b,a);g.triggerEvent("comments","comment-toggle",{})});a.off("click.postAquestion").on("click.postAquestion",".post-a-question",function(){$(this).hasClass("hidden")||($(this).parents(".question").append('<div class="response inline">'+n+"</div>"),x(),$(this).addClass("hidden"))});a.off("click.deleteComment").on("click.deleteComment",".message .delete",function(){var a=$(this).data("comment-id");F($(this),a,"Delete comment?",function(){J(a);
r.trackEvent("collaboration","delete-comment")})});a.off("click.deleteQuestion").on("click.deleteQuestion",".question .delete",function(){var a=$(this).data("comment-id");F($(this),a,"Delete question?",function(){w(a);r.trackEvent("collaboration","delete-comment")})});a.off("click.newcomments").on("click.newcomments",".collab-area .new-comment-btn",function(){var a=$(this),b=a.siblings(".comments");a.addClass("hidden");b.each(function(){var a=$(this).children(".comments-list"),b=a.children(":visible").first();
b.length?a.children().filter(function(){return $(this).data("comment").timestamp>b.data("comment").timestamp}).removeClass("hidden"):a.children().removeClass("hidden")})})};i.initialize=function(){g.addObserver("poll","comments",H);g.addObservers(["collaborator-add","collaborator-remove"],"comments",x);g.addObserver("scroll-to-comment","comments",s);window.setInterval(A,2E4)};return i});
define("plan/overview","modules/analytics modules/analyticsEventParams modules/ajax modules/lazyload modules/fbutil modules/utils modules/history modules/events plan/route plan/loading modules/view modules/hotelbooking moment plan/comments plan/collaboration explore/exploreWrapper jquery qtip jQueryExtensions/linkToCalendarAndMap jQueryExtensions/readMore".split(" "),function(a,g,d,p,m,j,i,c,b,f,u,n,k,h,e,l){function t(){var a=$(this),b=$(this).parents(".overview-stay-pane"),c=k.utc(b.data("checkInDate"),
x),d=k.utc(b.data("checkOutDate"),x);if(!c||!d)j.showExclamationDialog("Uh oh!","Please select a valid start and end date.","Close");else{var e=a.siblings(".booking-options").children(".booking-option");n.findHotel(e,g.CAT_PLAN_OVERVIEW_STAY,b.data("name"),b.data("countryCode"),c,d,a,s);return!1}}function r(){$(".tab-people > a").trigger("click");i.push("people","people",$("#people").data("url"),void 0)}function q(a){var b=$(this).parents(".overview-stay-pane").data("destinationId"),c=$(this).data("catGroupId");
l.gotoSelectedTagPlaces([c],null,null,b,"overview");a.stopPropagation();return!1}function D(){var a=$(this),b=a.parents(".travel-row").find(".options-content"),c=a.find(".fa");b.hasClass("hidden")?(c.removeClass("fa-chevron-down").addClass("fa-chevron-up"),b.removeClass("hidden"),a.find(".text-link").text("hide travel options")):(c.removeClass("fa-chevron-up").addClass("fa-chevron-down"),b.addClass("hidden"),a.find(".text-link").text("travel options"))}function v(a,b){A=!0;s.is(":visible")?y.refreshIfInvalid(a,
b):(b.overlay&&(b.overlay.removeOverlay(),j.enableScroll()),b&&(b.pageChangeData&&!b.pageChangeDataDisabled)&&c.triggerEvent("overview","post-route-change",b.pageChangeData))}function B(){var a=$(this).parents(".cotravelers-pane").find(".num-people"),a=a.is(":visible")?a.val():1;e.showAddCotravelerDialog(10>=a?a:10)}function z(){for(var a=$("#plan").data("cotravelerNames").split(","),b=a.length,c="",d=0;d<b;d++)if(0<d&&(d===b-1||2===d)?c+=" & ":0<d&&(c+=", "),2>d||3>=b)c+=a[d].trim().split(" ")[0];
else{c+=b-3+1;c+=" others";break}return c}function C(){if($("#plan").data("cotravelerNames")){s.find(".cotravelers-pane .no-cotravelers").addClass("hidden");s.find(".cotravelers-pane .yes-cotravelers").removeClass("hidden");s.find(".cotravelers-pane .yes-cotravelers .names").text(z());var a=$("#plan").data("cotravelerNames").split(","),b=[];$.each(a,function(a,c){b.push({name:c})});s.find(".cotravelers-pane .yes-cotravelers .names .show-others").off("click").on("click",function(){e.showReadonlyCollaborationDialog(b)})}else s.find(".cotravelers-pane .no-cotravelers").removeClass("hidden"),
s.find(".cotravelers-pane .yes-cotravelers").addClass("hidden")}function G(){c.triggerEvent("overview","mmt_track_link",{linkName:"Edit Itinerary"})}function M(a,b){E.push(b)}function w(){for(var a in E)switch(E[a].action){case "expandRouteSection":c.triggerEvent("overview","expand-route-section",{addToHistory:!0,destinationId:E[a].destinationId,expandStay:E[a].expandStay});break;case "openTravelOptions":c.triggerEvent("overview","open-travel-options",{addToHistory:!0,travelId:E[a].travelId})}E=[]}
function J(){a.trackEvent("overview.stay.autogen","click.trip-planner-link")}function F(){$(".autogen").each(function(){$(this).find(".desc").readMore($(this).find(".read-more"),$(this).find(".read-less"))})}var y={},s,H,x=j.ISO_DATE_FORMAT,A=!1,E=[];y.refreshIfInvalid=function(a,e){if(A){var g=b.isExpanded();(!e||!e.overlay)&&f.showLoading($("#planRecalculating"),$("#resultpageContent"),"Loading...");d.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/overview",type:"GET",
success:function(a){s.html(a);y.initialize();h.refreshComments();u.scrollAndUpdate();A=!1;s.trigger("refreshed");g?b.expand():b.collapse();w()},complete:function(){f.hideLoading($("#planRecalculating"),$("#resultpageContent"));e&&e.overlay&&(e.overlay.removeOverlay(),j.enableScroll());c.triggerEvent("overview","hide-bottom-pane",{});e&&(e.pageChangeData&&!e.pageChangeDataDisabled)&&c.triggerEvent("overview","post-route-change",e.pageChangeData)}})}else w(),s.is(":visible")&&($("#overviewRoutePane").hasClass("one-view")?
c.triggerEvent("overview","show-help-tips",{tabName:"#overviewOneStay"}):c.triggerEvent("overview","show-help-tips",{tabName:"#overview"}))};y.isDirty=function(){return A};y.initialize=function(){s=$("#overview");H=$("#route");s.find("#overviewRoutePane");s.find(".overview-friends-pane");s.find(".overview-continue");s.find(".add-friends").click(function(){c.triggerEvent("alerts","show-tab-collaboration",{addToHistory:!0})});c.addObservers("plan-update stay-add stay-remove stay-update visit-add visit-remove visit-update travel-update".split(" "),
"overview",v);c.addObserver("refresh-overview","overview",y.refreshIfInvalid);c.addObservers(["collaborator-add","collaborator-remove"],"overview",C);c.addObserver("overview-post-refresh-actions","overview",M);s.off("click.helper").on("click.helper",".friends-module .helper",r).off("click.options").on("click.options",".overview-travel-pane .content",D).off("click.edit-itin").on("click.edit-itin",".dayByDayStayLink",G).off("click.stay-trip-planner-link").on("click.stay-trip-planner-link",".overview-stay-pane .landing-trip-planner-link",
J).off("click.tag").on("click.tag",".tags-destinations .tag",q);s.find(".overview-stay-pane").off("click.find-a-hotel").on("click.find-a-hotel",".find-hotel",t);s.find(".facebook-login-button").click(function(){m.loginToFB("overview.main")});s.off("click.add-cotraveler").on("click.add-cotraveler",".add-cotraveler",B);s.off("click.explore-all").on("click.explore-all",".explore-all-destination",function(){var b=$(this).data("eventSrc");a.trackEvent(b,"explore-destinations");c.triggerEvent("overview",
"explore-load-destination-in-modal",{tab:"overview",destinationId:$(this).data("destinationId")})});h.prepareCommentAreas(s);C();var e=s.find("#planDescriptionTextArea");e.off("blur").on("blur",function(){var a=$.trim(e.val());d.makeAJAXcall({type:"POST",url:e.data("remoteUrl"),data:{description:a},success:function(){},error:function(){}})});s.find(".stay-description-text-area").each(function(){$(this).off("blur").on("blur",function(){var a=$.trim($(this).val());d.makeAJAXcall({type:"POST",url:$(this).data("remoteUrl"),
data:{description:a},success:function(){},error:function(){}})})});$(".num-people").off("keyup").on("keyup",function(){10<$(this).val()&&$(this).val(10)});s.off("isVisible").on("isVisible",function(){F();H.trigger("isVisible")});F();c.addObserver("overview-init","overview",function(){y.initialize()});b.initialize();p.initialize();s.is(":visible")&&($("#overviewRoutePane").hasClass("one-view")?c.triggerEvent("overview","show-help-tips",{tabName:"#overviewOneStay"}):c.triggerEvent("overview","show-help-tips",
{tabName:"#overview"}))};return y});
define("plan/reserveds","modules/ajax plan/planHelper plan/planUtils modules/utils plan/travelEdit moment modules/events plan/reservation/reservation plan/reservation/utils/reservationUtils plan/reservation/reservationFactory jquery jqueryui".split(" "),function(a,g,d,p,m,j,i,c,b){function f(b){var c=b.reservedId;a.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/reserved/"+c+"/delete",type:"POST",data:{view:b.view,isOverflow:b.isOverflow},synchronize:!0,success:function(a){void 0!==
b.successCB&&b.successCB(a)},complete:function(){void 0!==b.completeCB&&b.completeCB()}})}function u(c,f,g){if(!$(this).hasClass("disabled")){var h;c.find(".event-date").hasClass("not-in-range")?(h=c.find(".event-date-box").val(),h=null!==h?j(h,"ddd M/D").format("YYYY-MM-DD"):null):(h=c.find(".event-date-copy").datepicker("getDate"),h=null!==h?j(h).format("YYYY-MM-DD"):null);var i=f.activityTitle||c.find(".event-name").val().trim(),m=JSON.stringify(b.getAddress(c.find(".event-location"),"")),n=f.fromTime||
parseInt(c.find(".time-holder #start-time").val()),u=f.toTime||parseInt(c.find(".time-holder #end-time").val()),z=c.find(".add-note-text").val().trim(),C=d.getAttachmentIds(c.find(".notes-attachment-wrapper"));""===i?p.showErrorTooltip(c.find(".event-name"),"Please enter reserved item title.",null,{}):null===h?p.showErrorTooltip(c.find(".event-date-box"),"Please choose a schedule.",null,{}):isNaN(n)||isNaN(u)||u<=n?p.showErrorTooltip(c.find(".time-holder #end-time-button"),"Please select valid start & end times.",
null,{}):(h={name:i,location:m,date:h,fromTime:n,toTime:u,view:f.view,notes:z,isOverflow:f.isOverflow,isOverflowMode:f.stayOverflowMode,attachments:C},f.hasOwnProperty("stayId")&&(h.stayId=f.stayId),a.makeAJAXcall({type:"POST",data:h,url:f.url,synchronize:!0,complete:function(){p.closeDialog(c,g)},success:function(a){f.successCB(a.calendarData?a.calendarData:a);void 0!==f.saveReservation&&(f.saveReservation({reservedId:a.reservedId,stayId:a.stayId}),f.reservedId=a.reservedId,f.stayId=a.stayId,f.saveReservation=
void 0,f.url=window.contextPath+"/trip/"+$("#plan").data("planId")+"/reserved/"+a.reservedId,$("#calendarlink").hasClass("active")&&k.openReservedItemDialog(f,f.planStartDate,f.planEndDate))}}))}}function n(a){return j(a.format(h),h)}var k={},h=p.ISO_DATE_TIME_FORMAT;k.removeFromPlan=function(a){a.hasNotes?g.deleteNotesQtip(a.$target,a.title,function(){f(a)}):f(a)};k.openReservedItemDialog=function(e,f,g,m){var q=$('<div class="ui-widget-overlay"><img class="progress-indicator" src="'+window.ajaxLoaderPath+
'" alt="loading"></div>');q.appendTo("body");a.makeAJAXcall({type:"GET",data:{reservedId:e.reservedId,stayId:e.stayId,isOverflow:m},url:"/trip/"+$("#plan").data("planId")+"/reservedItemDialog",success:function(a){q.remove();var v=$("<div/>").html(a);v.find(".reservation").attr("data-id",e.reservedId).attr("data-reservation-type","CustomReservation");var B=$("<div>");e.reserveEdit&&v.find(".delete-event").removeClass("hidden");e.stayOverflowMode=m;var z=v.find(".event-date-copy"),C=j((e.stayArrivalTime||
f).format(h),h).toDate(),G=j((e.stayDepartureTime||g).format(h),h).toDate(),M=v.find("#start-time"),a=e.hasOwnProperty("startTimeInMinutes")?e.startTimeInMinutes:600,w=e.hasOwnProperty("endTimeInMinutes")?e.endTimeInMinutes:630,J=0>a,F=v.find("#end-time");parseInt(v.find(".add-note-text").css("maxHeight"));var y=e.timeRanges||[{start:f.clone(),end:!e.stayDepartureTime?g.clone().add(86399,"seconds"):g.clone().subtract(1,"seconds")}],s;for(s in y)y[s].start.isBefore(C)&&(C=y[s].start.clone().startOf("day").toDate()),
y[s].end.isAfter(G)&&(G=y[s].end.clone().startOf("day").toDate());z.inspirockDatepicker({minDate:C,maxDate:G,dateFormat:"yyyy-mm-dd",altFormat:window.dateFormatDisplayPattern,altField:z.siblings(".event-date-box"),showAnim:"",onSelect:function(){v.find(".event-date").removeClass("not-in-range");var a=z.datepicker("getDate"),b=parseInt(M.val()),c=parseInt(F.val());i.triggerEvent("reserved","setup-time-selects",{date:a,starttime:M,endtime:F,startTimeInMinutes:b,endTimeInMinutes:c,timeRanges:y,showTimeSelectTitles:J,
container:v,isOverflow:m});x.bind($(this))(v)},beforeShowDay:function(a){var b=!1,c;for(c in y){var d=n(y[c].start.clone().startOf("day")),e=n(y[c].end.clone().startOf("day"));if((d.isSame(a)||d.isBefore(a))&&(e.isSame(a)||e.isAfter(a))){b=!0;break}}return[b,"",null]},beforeShow:function(){M.selectmenu("close");F.selectmenu("close");$("#calendarItemContainer").append($("#ui-datepicker-div").addClass("calendar-datepicker"))},onClose:function(){$("body").append($("#ui-datepicker-div").removeClass("calendar-datepicker"))}});
s=null;if(e.hasOwnProperty("date")){var H=j(e.date);s=H.clone().toDate();!H.isBefore(j(C))&&!H.isAfter(j(G))?z.datepicker("setDate",s):(v.find(".event-date-box").val(H.clone().format("ddd M/D")),v.find(".event-date").addClass("not-in-range"))}i.triggerEvent("reserved","setup-time-selects",{date:s,starttime:M,endtime:F,startTimeInMinutes:a,endTimeInMinutes:w,timeRanges:y,showTimeSelectTitles:J,container:v,isOverflow:m});var a=v.find(".event-location"),x=function(){var a=v.find(".save-event");""!==
v.find(".event-name").val()&&""!==v.find(".event-date-box").val()&&null!==v.find("#start-time").val()&&null!==v.find("#end-time").val()&&!a.hasClass("uploading")?a.removeAttr("disabled"):a.attr("disabled","disabled")};a.googleAutocomplete({element:a[0],addressElement:a[0],onSelect:x});a.off("input.saveCheck").on("input.saveCheck",x);v.find(".event-date-box").off("click").on("click",function(){z.datepicker("show")}).off("mousedown").on("mousedown",function(a){a.stopPropagation()});k.initializeReservedItemData(v,
e);v.off("input.event-name").on("input.event-name",".event-name",function(){x.bind($(this))(v)});v.find("#start-time, #end-time").on("selectmenuchange",function(){x.bind($(this))(v)});v.off("input.add-note-text").on("input.add-note-text",".add-note-text",function(){x.bind($(this))(v);d.adjustNotesTextAreaHeight($(this))});v.off("input.event-location").on("input.event-location",".event-location",function(){""===v.find(".event-location").val()&&x.bind($(this))(v)});v.off("click.save-event").on("click.save-event",
".save-event",function(){u.bind($(this))(v,e,B)});v.off("click.delete-event").on("click.delete-event",".delete-event",function(){$(this).is(":visible")&&(v.dialog("close"),k.removeFromPlan(e.deleteData))});v.inspirockDialog({resizable:!1,modal:!0,draggable:!1,animated:!0,width:"830",dialogClass:"dlg-calendar-edit-item dlg-reserved-item row animated mediumx",open:function(){e.successDialogOpen(!0);v.parents(".ui-dialog").css("position","relative");p.setupDialogOverlay(v,!1);v.off("click.reservation-container").on("click.reservation-container",
".reservation-container .add-reservation",function(){var a={};a.position={my:"left center",at:"right center",target:$(this),container:B,adjust:{x:10}};a.tip={corner:!0,width:20,height:10,mimic:"left center",offset:80};$(this).parents(".reservation-container").data("numReservations")&&(a.position={my:"top right",at:"bottom right",viewport:$(window),container:B},a.tip=!1);if(!e.reservedId){var d=e,i=v.find(".event-date-copy").datepicker("getDate"),i=null!==i?j(i).format("YYYY-MM-DD"):null,k=parseInt(v.find(".time-holder #start-time").val()),
m=parseInt(v.find(".time-holder #end-time").val()),k=null!==i?j(i).startOf("day").minutes(k).format(h):"",i=null!==i?j(i).startOf("day").minutes(m).format(h):"";d.startTime=k;d.endTime=i;d.reservedItemDialog=v;d.dialogContainer=B;d.planStartDate=f;d.planEndDate=g;d.createReservedItem=function(a){u(a.reservedItemDialog,a,a.dialogContainer)}}c.addReservation($(this),a,b.getReservationRowDataForCalendarDialogs($(this).parents(".reservation")),!1,$(this),d)});v.off("mouseenter.activity-options-container").on("mouseenter.activity-options-container",
".activity-options-container",c.activityOptionsClick);v.off("click.delete-reservation").on("click.delete-reservation",".delete-reservation",function(){$(this).attr("data-reservation-id",$(this).parents(".item-block-wrapper").data("reservationId"));c.deleteReservation.bind($(this))()});v.off("click.view-details").on("click.view-details",".view-details",c.viewDetails);d.adjustNotesTextAreaHeight(v.find(".add-note-text"))},beforeClose:function(){p.removeAllErrorToolTips()},close:function(){p.closeDialog(v,
B)}});b.createCalendarItemDialogContainer(B,v)}})};k.initializeReservedItemData=function(a,c){c.hasOwnProperty("name")&&(a.find(".event-title").html(p.encodeHtml(c.name)),a.find(".event-name").val(c.name));if(c.hasOwnProperty("location")&&c.location){var f=JSON.parse(c.location);null!==f&&null!==f.address&&(a.find(".event-location").val(b.unescapeHtml(f.address)).data("savedLocation",f),a.find(".event-location").html(p.encodeHtml(f.address)))}c.notes&&(a.find(".notes-attachment-wrapper").removeClass("hidden"),
a.find(".note-container").removeClass("hidden"),a.find(".add-note-text").val(c.notes));if(c.attachments&&c.attachments.length){a.find(".notes-attachment-wrapper").removeClass("hidden");a.find(".note-container").removeClass("hidden");var f=a.find(".attachment-list"),g;for(g in c.attachments)f.append(d.getFormattedAttachmentLink(c.attachments[g]));a.parents(".qtip").addClass("big")}c.hasOwnProperty("start")&&c.hasOwnProperty("end")&&(g=m.formatTimeUtil(c.start,c.end),a.find(".time-holder-summary").html(g))};
return k});
define("plan/daybydayerrors",["modules/view","modules/history","modules/events","plan/reservation/reservation","jquery"],function(a,g,d,p){function m(a,b,c,d){a.qtip({content:{text:b,button:!0},overwrite:!0,position:{at:"bottom center",my:"top center",adjust:{y:3}},show:{ready:!0},hide:{fixed:!0,event:"unfocus"},events:{show:function(a,b){0===b.elements.content.siblings(".qtip-fillerDiv").length&&$('<div class="qtip-fillerDiv"></div>').insertBefore(b.elements.content);c&&c($(this),b)},hide:function(a,
b){d&&d();b.destroy(!0)}},style:{classes:"timeline-error-qtip",tip:{width:14,height:7,offset:-100},width:"320"}})}function j(){var b=$(this),c=b.parents(".day-title").find(".stayName").html(),d=b.parents(".day-title").data("stayId"),c=$("<div class='error-container'><div class='error-text stay-error'>Your "+c+" plan has errors. We can help you optmize your plan</div><div class='error-link see-error'><span class='text-link'>see errors</span></div></div>");m(b,c,function(b,c){b.off("click.see-error").on("click.see-error",
".see-error",function(){c.hide();var b=n.find(".error-row").filter("[data-stay-id='"+d+"']").first();a.scrollDayByDayElementIntoView(b,!0)})},null)}function i(){var a=$(this),b=$(this).parents(".itinerary-row").data("id"),c=$(this).parents(".day-block").data("date"),f=$(this).parents(".day-block").data("stayId"),i=a.parents(".left-col"),j,n,p;i.hasClass("conflict")&&(j="You are visiting when the attraction is closed.");i.hasClass("overlap")&&(n="Your activity conflicts with other events.");i.hasClass("res-error")&&
(p="Your activity on your calendar does not match your reservation details.");var v='<svg><use xlink:href="#icon-error-circle"></use></svg><span class="help-text">Help us help you!</span>';i.hasClass("res-error")&&(!i.hasClass("conflict")&&!i.hasClass("overlap"))&&(v='<svg class="res-error"><use xlink:href="#icon-error-circle"></use></svg>');i=$("<div class='error-container'><div class='help-container'>"+v+"</div>"+(j?"<div class='error-text conflict-error'>"+j+"</div>":"")+(n?"<div class='error-text overlap-error'>"+
n+"</div>":"")+(p?"<div class='error-text res-error'>"+p+"</div>":"")+"<div class='error-link edit-plan activity-errors'><span class='text-link'>Edit plan</span></div></div>");m(a,i,function(a,i){a.off("click.edit-plan").on("click.edit-plan",".edit-plan",function(){i.hide();var a={};a.date=c;a.visitId=b;a.stayId=f;a.visitNoOpen=!0;g.push("daybyday","itinerary",$("#itinerary").data("url"),{subnavLinkId:"daybydaylink"});d.triggerEvent("daybyday","itinerary-subnav",{targetId:"calendar",subnavLinkId:"calendarlink",
data:a})})},null)}function c(){var a=$(this),b=a.parents(".left-col").data("startEndDate"),c=a.parents(".itinerary-row"),f=c.data("startEndDate"),g=c.data("sameDate"),i=c.data("name"),j=c.data("destinationId"),n=c.find(".reservation").data("isManual"),b=$("<div class='error-container'><div class='help-container'><svg><use xlink:href=\"#icon-error-circle\"></use></svg><span class=\"help-text\">Help us help you!</span></div><div class='error-text hotel-error'>"+("According to your plan you'll be in "+
i+(g?" on ":" between ")+"<b>"+f+"</b>")+"</div><div class='error-text hotel-error'>"+("However, your <b>hotel reservation <br/></b> is for <b>"+b+"</b>")+"</div><div class='error-link edit-plan'><span class='text-link'>Edit plan</span></div>"+(n?"<div class='error-link edit-reservation'><span class='text-link'>Edit reservation</span></div>":"")+"</div>");m(a,b,function(a,b){a.off("click.edit-plan").on("click.edit-plan",".edit-plan",function(){b.hide();d.triggerEvent("daybyday","overview-post-refresh-actions",
{action:"expandRouteSection",destinationId:j,expandStay:!0});d.triggerEvent("daybyday","show-tab-overview",{addToHistory:!0,tabClick:!0})});a.off("click.edit-reservation").on("click.edit-reservation",".edit-reservation",function(){b.hide();p.viewDetails.apply(c.find(".view-details"))})},null)}function b(){var a=$(this),b=a.parents(".itinerary-row"),c,f;a.hasClass("overflow")&&(c="Your travel conflicts with other events");a.hasClass("duration-error")&&(f="The total duration of your reservations is longer than the travel duration");
c=$("<div class='error-container'><div class='help-container'><svg><use xlink:href=\"#icon-error-circle\"></use></svg><span class=\"help-text\">Help us help you!</span></div>"+(c?"<div class='error-text overflow-error'>"+c+"</div>":"")+(f?"<div class='error-text duration-error'>"+f+"</div>":"")+"<div class='error-link edit-plan'><span class='text-link'>Edit plan</span></div></div>");m(a,c,function(a,c){a.off("click.edit-plan").on("click.edit-plan",".edit-plan",function(){c.hide();c.hide();var a={};
a.date=b.data("startDate");a.visitId=b.data("travelId");a.visitNoOpen=!0;g.push("daybyday","itinerary",$("#itinerary").data("url"),{subnavLinkId:"daybydaylink"});d.triggerEvent("daybyday","itinerary-subnav",{targetId:"calendar",subnavLinkId:"calendarlink",data:a})})},null)}function f(){var a=$(this);a.parents(".visit-row").length||a.parents(".reserved-row").length?i.bind(a)():a.parents(".hotels-row").length?c.bind(a)():a.parents(".travel-row").length?b.bind(a)():a.parents(".day-title").length&&j.bind(a)()}
var u={},n;u.reservationError=function(a){var b="You already have a hotel reservation associated with your stay in "+a.parents(".itinerary-row").data("destination")+". Currently we only support one hotel reservation per destination.",b=$("<div class='error-container'><div class='help-container'><svg class=\"res-error\"><use xlink:href=\"#icon-error-circle\"></use></svg></div><div class='error-text hotel-res-error'>"+b+"</div><div class='error-link remove-reservation'><span class='text-link'>Remove reservation</span></div></div>");
m(a,b,function(a,b){a.off("click.remove-reservation").on("click.remove-reservation",".remove-reservation",function(){b.hide();d.triggerEvent("daybydayerrors","delete-event",{$row:$(this)})})},null)};u.initialize=function(){n=$("#daybyday");n.off("click.conflict-icon").on("click.conflict-icon",".conflict-icon",f)};return u});define("text%21templates/dbdActivityOptions.html",[],function(){return'<!DOCTYPE html>\n<\!--\n Copyright (c) 2012-2017, Inspirock Corporation.\n All rights reserved.\n--\>\n<div>\n    <div class="options-container events hidden">\n        <div class="edit view-full-calendar">Edit in calendar</div>\n        <div class="delete">Delete event</div>\n        <div class="add-reservation">Add reservation</div>\n        <div class="remove-all-reservations hidden">Delete all reservations</div>\n    </div>\n    <div class="options-container reservation hidden">\n        <div class="add-reservation">Add reservation</div>\n        <div class="remove-reservation">Remove</div>\n    </div>\n    <div class="options-container reservation-bubble hidden">\n        <div class="attach-reservation">Add to plan</div>\n        <div class="remove-reservation">Remove reservation</div>\n        <div class="view-reservation">View details</div>\n    </div>\n    <div class="options-container upsell hidden">\n        <div class="add-reservation">Add reservation</div>\n        <div class="remove-upsell">Remove</div>\n    </div>\n</div>\n'});
define("plan/daybyday","modules/analytics modules/analyticsEventParams modules/ajax modules/events modules/history plan/visits plan/reserveds plan/reservation/reservation explore/exploreWrapper plan/daybydayerrors modules/view plan/comments plan/loading modules/flightquotes modules/hotelbooking modules/utils moment modules/viator text!templates/dbdActivityOptions.html jquery jqueryui qtip".split(" "),function(a,g,d,p,m,j,i,c,b,f,u,n,k,h,e,l,t,r,q){function D(){var a=$(this),b=t(a.data("checkinDate"),
l.ISO_DATE_FORMAT),c=t(a.data("checkoutDate"),l.ISO_DATE_FORMAT);e.logBookingEvent(g.CAT_PLAN_DBD_LIST_HOTEL_UPSELL,a.parents(".hotels-row").data("name"),a.data("bookingUrl"));e.openBookingURL(a,b,c);l.detectIE()&&($("#planHeader").hide(),window.setTimeout(function(){$("#planHeader").show()},10));return!1}function v(a,b,c,d,e){p.triggerEvent("route","prompt-flight-search",{startIataCode:a,startSchema:b,endIataCode:c,endSchema:d,outbounddate:e,event:"route.travel.prompt-airport"})}function B(){try{E.find(".edit.view-full-calendar").qtip("destroy",
!0)}catch(a){}}function z(){try{E.find(".open-in-calendar").qtip("destroy",!0)}catch(a){}}function C(){B();z();var b=$(this).data("id");void 0===b&&(b=$(this).parents(".visit-row").data("visitId"));void 0===b&&(b=$(this).parents(".reserved-row").data("reservedId"));void 0===b&&(b=$(this).parents(".travel-row").data("travelId"));a.trackEvent(g.CAT_PLAN_DBD_LIST_VISIT,g.ACT_EDIT_CALENDAR);var c={};c.date=$(this).parents(".day-block").data("date");c.visitId=b;m.push("daybyday","itinerary",$("#itinerary").data("url"),
{subnavLinkId:"daybydaylink"});p.triggerEvent("daybyday","itinerary-subnav",{targetId:"calendar",subnavLinkId:"calendarlink",data:c})}function G(){B();E.find(".edit.view-full-calendar").qtip({overwrite:!0,content:"EDIT IN CALENDAR",position:{my:"bottom center",at:"top center",container:E},show:{event:"mouseover"},hide:{event:"mouseout",delay:50},style:{classes:"noShadow noBorder icon-tip"}})}function M(){z();E.find(".open-in-calendar").qtip({overwrite:!0,content:"OPEN IN CALENDAR",position:{my:"bottom center",
at:"top center",container:E},show:{event:"mouseover"},hide:{event:"mouseout",delay:50},style:{classes:"noShadow noBorder icon-tip",tip:{mimic:"center bottom",offset:45,width:10,height:5}}})}function w(a,b){var e=$('<div class="ui-widget-overlay"><img class="progress-indicator" src="'+window.ajaxLoaderPath+'" alt="loading"></div>');e.appendTo("body");d.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/reservation/"+a+"/match",type:"GET",complete:function(){b&&b()},success:function(a){e.remove();
var b=$("<div />").append(a);b.inspirockDialog({resizable:!1,modal:!0,draggable:!1,autoOpen:!1,width:"830px",animated:!0,dialogClass:"attach-reservation mediumx animated",open:function(){b.off("click.add-reservation-to-plan").on("click.add-reservation-to-plan",".add-reservation-to-plan",function(){c.addReservationToPlan($(this),function(){p.triggerEvent("daybyday","plan-update",{scrollTo:$(window).scrollTop()})})})},close:function(){l.closeDialog(b,d)}});var d=$("<div>");l.createDialogContainer(d,
b)}})}function J(){var a=$(this);if(a.parents(".itinerary-row").data("canAdd")){if(!a.hasClass("disabled")){a.addClass("disabled");var b=a.parents(".reservation-row").data("reservationId");w(b,function(){a.removeClass("disabled")})}}else f.reservationError(a)}function F(a,b,c){a.dialog({resizable:!1,modal:!0,draggable:!1,width:"480px",autoOpen:!1,dialogClass:"dlg-delete-event",buttons:[{text:"Cancel",click:function(){a.dialog("close")}},{text:"Delete "+b,click:function(){c();a.dialog("close")}}],
close:function(){a.dialog("destroy").remove();$(".resultspage").removeClass("scroll-hide");d.remove();l.removeAllErrorToolTips()}});var d=$("<div>");$(".resultspage").addClass("scroll-hide");d.css({position:"fixed",left:0,top:0,right:0,bottom:0,overflow:"auto","z-index":100}).attr("id","reservationContainer");d.appendTo($("body"));a.parents(".ui-dialog").appendTo(d);a.dialog("open");d.off("click").on("click",function(b){"reservationContainer"===$(b.target).attr("id")&&a.dialog("close")})}function y(){var a=
$(this),b=a.hasClass("delete-reservation")?a.parents(".itinerary-row"):a.parents(".qtip").data("qtip").target.parents(".itinerary-row"),d={view:"daybyday",successCB:function(a){$("#itinerary").html(a);p.triggerEvent("daybyday","initialize-itinerary",{});E.trigger("refreshed")}};if(a.hasClass("delete-reservation")||a.hasClass("remove-reservation")||a.hasClass("remove-all-reservations")){var e=a.hasClass("delete-reservation")?a.parents(".reservation"):void 0,a="reservation",f=!1,g=b.hasClass("car-rental-row")||
b.hasClass("hotels-row"),h;b.hasClass("travel-row")&&1<b.find(".reservation").length&&!e?(a="reservations",f=!0,h=function(){d.travelId=b.data("travelId");c.removeAllFromTravel(d)}):e&&e.length||g?h=function(){N.bind(b.find(".delete-reservation"))()}:b.hasClass("reservation-row")&&(h=function(){d.reservationId=b.data("reservationId");c.removeFromPlan(d)});e=$("<div class='delete-container'><div class='head'>Delete "+a+"?</div><div class='message'>Deleting "+(f?"these ":"this ")+a+" will delete all of"+
(f?" their":" its")+" instances from your timeline</div></div>");F(e,a,h)}else if(a.hasClass("delete")){h=b.find(".reservation").length;a=0<h;e=b.data("hasNotes");f="";g=b.hasClass("visit-row")?"<b>"+b.find(".name").text()+"</b>":"the activity";!a&&!e&&(f="Are you sure you want to delete "+g+"?");if(a||e)f="Deleting "+g+" will delete its",e&&!a?f+=" notes and attachments":e&&a?f+=" notes, attachments and reservation"+(1<h?"s":""):a&&(f+=" reservation"+(1<h?"s":""));h=$("<div class='delete-container'><div class='head'>Delete activity?</div><div class='message'>"+
f+"</div></div>");F(h,"activity",function(){b.hasClass("visit-row")?(d.visitId=b.data("visitId"),j.removeFromPlan(d)):b.hasClass("reserved-row")&&(d.reservedId=b.data("reservedId"),i.removeFromPlan(d))})}}function s(){var b={mode:"car",stayId:$(this).data("stayId")};a.trackEvent(g.CAT_PLAN_DBD_LIST_CAR_UPSELL,g.ACT_ACTION,"search-cars");p.triggerEvent("daybyday","show-transport-modal",{searchData:b})}function H(a){var b,c,d,e,f,g,h;a.hasClass("travel-row")?(b="planItem",c="travel",d=a.data("travelId"),
f="TravelReservation"):a.hasClass("hotels-row")?(b="planItem",c="stay",d=a.parents(".day-block").data("stayId"),f="HotelReservation"):a.hasClass("car-rental-upsell-row")?(b="car-rental",c="car",f="CarReservation",d=a.data("id")):a.hasClass("nightlife-row")?(c=b="night-life",f="AttractionReservation",e=d=a.parents(".day-block").data("stayId"),g=!0,h=a.parents(".day-block").data("date")):(b=a.data("visitId")?"visit":"reserved",c=a.data("visitId")?"visit":"reserved",f=a.data("visitId")?"AttractionReservation":
"CustomReservation",d=a.data("visitId")?a.data("visitId"):a.data("reservedId"),e=a.parents(".day-block").data("stayId"));var i={};b&&(i.type=b);c&&(i.itemType=c);null!==d&&void 0!==d&&(i.id=d);null!==e&&void 0!==e&&(i.stayId=e);g&&(i.isNightLife=g);h&&(i.date=h);i.reservationType=f;var j=[];a.find(".reservation-wrapper").find(".reservation").each(function(){j.push($(this).data("reservationId"))});j.length&&(i.eventReservations=j);return i}function x(){var a={},b=$(this),d=b.parents(".itinerary-row");
a.position={my:"left center",at:"right center",target:$(this),adjust:{x:10}};a.tip={corner:!0,width:20,height:10,mimic:"left center",offset:80};var e=d.hasClass("hotels-row");c.addReservation(b,a,H(d),e,b.parents(".itinerary-row"))}var A={},E,K,L=!1,q=l.removeTagsFromString(q,".add-reservation",$("#plan").data("reservationsEnabled"));A.updateRightRail=function(){var a=$(".day-box.active"),b=a.data("destinationId");b||(b=a.next().data("destinationId"));if(b){var a=K.find(".dest-rail"),c=b?a.filter("[data-destination-id="+
b+"]"):[];if(!c.length||!c.hasClass("active"))b=K.find(".dest-rail.active"),b.length?(c.addClass("active"),a.filter(":not(.active)").stop(!0).hide(),b.removeClass("active").stop(!0).fadeOut(200,function(){c.hasClass("active")&&c.fadeIn(200)})):c.length&&c.addClass("active").fadeIn(200)}};var Q=function(){function a(){b.qtip("api").destroy()}var b=$(this),e=b.parents(".itinerary-row"),f=e.parents(".day-block"),g=$(q);e.hasClass("car-rental-upsell-row")||e.hasClass("nightlife-row")||e.is(".hotels-row.upsell")?
g.find(".upsell").removeClass("hidden"):e.hasClass("hotels-row")?(g.find(".reservation").removeClass("hidden"),g.find(".add-reservation").addClass("hidden")):e.hasClass("car-rental-row")?(g.find(".reservation").removeClass("hidden"),g.find(".add-reservation").addClass("hidden")):e.hasClass("reservation-row")?g.find(".reservation-bubble").removeClass("hidden"):g.find(".events").removeClass("hidden");e.hasClass("travel-row")&&(g.find(".delete").addClass("hidden"),1<e.find(".reservation").length&&g.find(".remove-all-reservations").removeClass("hidden"));
b.qtip({overwrite:!0,content:g,position:{my:"top right",at:"bottom right",container:b.parents(".day-block"),viewport:E,adjust:{method:"flip"}},show:{delay:0,ready:!0},hide:{event:"mouseout",fixed:!0},events:{show:function(h,i){var j=e.data("visitId");void 0===j&&(j=e.data("reservedId"));void 0===j&&(j=e.data("travelId"));g.click(a);g.find(".view-full-calendar").data("id",j);g.find(".view-full-calendar").data("date",f.data("date"));g.off("click.add-reservation").on("click.add-reservation",".add-reservation",
function(){var a={},d=b.parents(".itinerary-row");a.position={my:"top right",at:"bottom right"};a.tip=!1;c.addReservation(b.find(".activity-facade"),a,H(d),d.hasClass("hotels-row"),d)});0===i.elements.content.siblings(".qtip-fillerDiv").length&&$('<div class="qtip-fillerDiv"></div>').insertBefore(i.elements.content);g.off("click.attach-reservation").on("click.attach-reservation",".attach-reservation",function(){w(e.data("reservationId"))});g.off("click.remove-reservation").on("click.remove-reservation",
".remove-reservation",y);g.off("click.view-reservation").on("click.view-reservation",".view-reservation",function(){c.viewDetails.apply(e)});g.off("click.remove-all-reservations").on("click.remove-all-reservations",".remove-all-reservations",y);g.off("click.remove-upsell").on("click.remove-upsell",".remove-upsell",function(){d.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/disableUpsell",data:{stayId:f.data("stayId"),date:f.data("date"),upsell:e.data("upsell")},type:"POST",
synchronize:!0,success:function(a){E.html(a);A.initialize();E.trigger("refreshed")}})})},hide:function(a,b){b.destroy(!0)}},style:{classes:"noShadow noBorder activity-options-tip",tip:{corner:!1}}})},N=function(){var a=$(this),b=a.parents(".reservation"),d=b.data("reservationId"),e=a.parents(".itinerary-row"),f,g,h;e.hasClass("travel-row")?(f="planItem",g=e.data("travelId")):e.hasClass("nightlife-row")||e.hasClass("hotels-row")?(f="planItem",g=e.parents(".day-block").data("stayId")):e.hasClass("car-rental-row")?
f="car-rental":(f=e.data("visitId")?"visit":"reserved",g=e.data("visitId")?e.data("visitId"):e.data("reservedId"),h=e.parents(".day-block").data("stayId"));a={title:b.data("name"),reservationId:d,view:"daybyday",hasNotes:b.data("hasNotes"),$target:a,type:f,id:g,stayId:h,successCB:function(a){$("#itinerary").html(a);p.triggerEvent("daybyday","initialize-itinerary",{});E.trigger("refreshed")}};c.removeFromPlan(a)},O=function(){var b=$(this).parents(".qtip").data("qtip").target,c=b.parents(".reserved-row"),
d=c.data("reservedId"),e=$(document.createElement("div")),f=$('<div class="delete-confirm clickable"><input type="button" class="button cta-button small" value="Delete Blocked Time?"></div>');f.click(function(){b.qtip("api").destroy();a.trackEvent(g.CAT_PLAN_DBD_LIST_RESERVED,g.ACT_DEL_RESERVED);var e={title:c.find(".blocked-static-title").text(),reservedId:d,view:"daybyday",hasNotes:c.data("hasNotes"),$target:b,successCB:function(a){E.html(a);p.triggerEvent("daybyday","initialize-itinerary",{});
E.trigger("refreshed")}};i.removeFromPlan(e)});e.append(f);b.qtip({overwrite:!0,content:e,position:{my:"top right",at:"top right",container:c},show:{event:"click",delay:0,ready:!0},hide:{event:"unfocus"},events:{hide:function(a,b){b.destroy()}},style:{classes:"noShadow noBorder deleteConfirm",tip:{corner:!1}}});a.trackEvent(g.CAT_PLAN_DBD_LIST_RESERVED,"delete-reserved")},I=function(){var b=$(this),c=b.parents(".visit-row"),e=c.data("visitId"),f=c.data("duration"),h=c.data("name"),c=f+30;b.hasClass("disabled")||
1440<=f?b.addClass("disabled"):((1410<=f||60>=f)&&b.addClass("disabled"),d.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/visit/"+e+"/duration",data:{duration:c,view:"daybyday"},type:"POST",synchronize:!0,success:function(b){E.html(b);A.initialize();p.triggerEvent("daybyday","visit-update",{uiSource:"itinerary.daybyday.addTime"});E.trigger("refreshed");a.trackEvent(g.CAT_PLAN_DBD_LIST_VISIT,g.ACT_CHANGE_DURATION,h.toLowerCase())},error:function(a){("invalid startTimeInMins"===
a||"invalid endTimeInMins"===a)&&b.addClass("disabled")}}))},T=function(){var b=$(this).parents(".visit-row"),c=b.data("visitId"),e=b.data("name"),b=b.data("duration");30<b&&(b-=30,d.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/visit/"+c+"/duration",data:{duration:b,view:"daybyday"},type:"POST",synchronize:!0,success:function(b){E.html(b);A.initialize();p.triggerEvent("daybyday","visit-update",{source:"itinerary.daybyday.minusTime"});E.trigger("refreshed");a.trackEvent(g.CAT_PLAN_DBD_LIST_VISIT,
g.ACT_CHANGE_DURATION,e.toLowerCase())}}))},S=function(){var b=$(this),c=b.parents(".reserved-row"),e=c.data("reservedId"),c=c.data("duration"),f=c+30;b.hasClass("disabled")||1440<=c?b.addClass("disabled"):((1410<=c||60>=c)&&b.addClass("disabled"),d.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/reserved/"+e+"/duration",data:{duration:f,view:"daybyday"},type:"POST",synchronize:!0,success:function(b){E.html(b);A.initialize();p.triggerEvent("daybyday","reserved-update",{uiSource:"itinerary.daybyday.addTime"});
E.trigger("refreshed");a.trackEvent(g.CAT_PLAN_DBD_LIST_RESERVED,g.ACT_CHANGE_DURATION)}}))},U=function(){var b=$(this).parents(".reserved-row"),c=b.data("reservedId"),b=b.data("duration");30<b&&(b-=30,d.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/reserved/"+c+"/duration",data:{duration:b,view:"daybyday"},type:"POST",synchronize:!0,success:function(b){E.html(b);A.initialize();p.triggerEvent("daybyday","reserved-update",{uiSource:"itinerary.daybyday.minusTime"});E.trigger("refreshed");
a.trackEvent(g.CAT_PLAN_DBD_LIST_RESERVED,g.ACT_CHANGE_DURATION)}}))},aa=function(){a.trackEvent(g.CAT_PLAN_DBD_LIST_HOP,g.ACT_DIR_CLICK)},W=function(){var a=$(this).parents(".nightlife-row").data("destinationId");b.gotoBrowseNightlife(a,"itinerary")},Y=function(){if(!$(this).hasClass("must-see-tag")){var a=$(this).parents(".day-block").data("destinationId"),c=$(this).data("catGroupId"),d=$(this).data("catId"),e=$(this).data("otherId");c?b.gotoSelectedTagPlaces([c],null,null,a,"itinerary"):d?b.gotoSelectedTagPlaces(null,
[d],null,a,"itinerary"):b.gotoSelectedTagPlaces(null,null,[e],a,"itinerary")}},V=function(){var a=$(this).parents(".right-col").data("destinationId"),b=$("#itinerarySubnavPane").find(".subnav-tabs ").find(".active"),c=b.attr("id"),d=b.data("target"),e={},f=$("#itineraryLeftTimelinePane").find(".active");e.stayId=f.data("stayId");e.date=f.data("date");e.dayIndex=f.data("dayIndex");m.push("itinerary","itinerary",b.data("url"),{targetId:d,subnavLinkId:c,historyData:e});p.triggerEvent("itinerary","load-explore-in-modal",
{tab:"itinerary",destinationId:a,subnav:"attractions",addlData:{requestData:{attractionshideInPlan:!0}}})},ba=function(){var a=$(this).siblings(".options-content"),b=$(this).find(".fa");a.hasClass("hidden")?(b.removeClass("fa-chevron-down"),b.addClass("fa-chevron-up"),a.removeClass("hidden")):(b.removeClass("fa-chevron-up"),b.addClass("fa-chevron-down"),a.addClass("hidden"))};A.refreshIfInvalid=function(a,b){var c=$(window).scrollTop();if(L&&!E.data("refreshInProgress"))E.css("visibility","hidden"),
k.showLoading($("#planRecalculating"),$("#itineraryMainPane"),"Loading..."),E.data("refreshInProgress",!0),d.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/daybyday",type:"GET",complete:function(){E.data("refreshInProgress",!1);k.hideLoading($("#planRecalculating"),$("#itineraryMainPane"))},success:function(d){E.html(d).css("visibility","");A.initialize();L=!1;E.trigger("refreshed");if(void 0!==b){d=$('.day-block[data-date="'+b+'"]');if(void 0!==a){var e=d.find(".day-title[data-stay-id="+
a+"]");e.length&&(d=e)}u.scrollDayByDayElementIntoView(d)}else $(window).scrollTop(c)}});else if(void 0!==b){var e=$('.day-block[data-date="'+b+'"]');if(void 0!==a){var f=e.find(".day-title[data-stay-id="+a+"]");f.length&&(e=f)}E.is(":visible")&&(u.scrollDayByDayElementIntoView(e),p.triggerEvent("daybyday","show-help-tips",{tabName:"#itinerary"}))}G();M()};A.isDirty=function(){return L};var ha=function(){L=!0;E.is(":visible")&&A.refreshIfInvalid()},ia=function(){function a(c){e.parents(".right-col").addClass("unabridged");
e.data("shortDesc",f).data("fullDesc",c);e.find(".trim-desc").html(c);e.append($('<span class="less-link secondary-text-link">See less</span>'));b.data("requestInProgress",!1);b.find(".full-details-link").removeClass("hidden");g.remove()}var b=$(this).parents(".itinerary-row"),c=b.data("attractionId"),e=b.find(".desc");if(!b.data("requestInProgress")){b.data("requestInProgress",!0);e.find(".more-link").addClass("no-click");var f=e.html(),g=$("<div>").addClass("spinner").append($("<img>").addClass("progress-indicator").attr("src",
window.ajaxLoaderPath)).appendTo(e);e.data("fullDesc")?a(e.data("fullDesc")):d.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/attraction/"+c+"/desc",type:"GET",synchronize:!1,success:function(b){a(b)}})}},pa=function(){var a=$(this).parents(".desc"),b=a.parents(".visit-row");a.empty();a.html(a.data("shortDesc"));a.data("shortDesc","");a.parents(".right-col").removeClass("unabridged");a.find(".more-link").removeClass("no-click");b.find(".full-details-link").addClass("hidden")};
A.initialize=function(){E=$("#daybyday");K=$(".dbd-right-rail");var b=$("#itinerary");p.addObservers("visit-add visit-remove visit-update reserved-add reserved-remove reserved-update hop-add hop-remove hop-update plan-update".split(" "),"daybyday",ha);p.addObserver("delete-event","daybyday",function(a,b){y.bind(b.$row)()});E.off("click.visit-delete").on("click.visit-delete",".activity-options-tip .delete, .delete-reservation",y);E.off("mouseenter.activity-options-container").on("mouseenter.activity-options-container",
".activity-options-container",Q);E.off("click.visit-addTime").on("click.visit-addTime",".visit-row .addTime",I);E.off("click.visit-reduceTime").on("click.visit-reduceTime",".visit-row .reduceTime",T);E.off("click.reserved-delete").on("click.reserved-delete",".reserved-row .delete",O);E.off("click.reserved-addTime").on("click.reserved-addTime",".reserved-row .addTime",S);E.off("click.reserved-reduceTime").on("click.reserved-reduceTime",".reserved-row .reduceTime",U);E.off("click.directions").on("click.directions",
".directions",aa);E.find(".nightlife-row").off("click.nightlife-text").on("click.nightlife-text",".nightlife-text",W);E.off("click.tag").on("click.tag",".tags-attractions .tag",Y);E.off("click.gap-row").on("click.gap-row",".gap-row .right-col .add-link",V);E.off("click.options").on("click.options",".options",ba);E.find(".hotels-row").off("click.booking-option").on("click.booking-option",".booking-option",D);b.off("click.view-full-calendar").on("click.view-full-calendar",".view-full-calendar",C);E.off("click.open-in-calendar").on("click.open-in-calendar",
".open-in-calendar",C);E.find(".itinerary-row").off("click.more-link").on("click.more-link",".more-link",ia);E.find(".itinerary-row").off("click.less-link").on("click.less-link",".less-link",pa);E.find(".itinerary-row").find(".reservation-wrapper").off("click.view-details").on("click.view-details",".view-details",c.viewDetails);E.find(".car-rental-upsell-row").off("click.carsearch").on("click.carsearch",".carrental-link",s);K.off("click.rail-link").on("click.rail-link","a",function(){var a=$(this),
b=a.parents(".dest-rail"),a={tourUrl:a.attr("href"),tourName:a.find(".tour-title").text(),destinationName:b.data("destinationName"),destinationCountry:b.data("countryCode")};r.viatorTourLinkClick("daybyday.rightrail",a)});E.find(".itinerary-row").off("click.reservation-container").on("click.reservation-container",".reservation-container .add-reservation",x);E.find(".reservation-row").off("click.attach-to").on("click.attach-to",".attach-to",J);E.find(".travel-row").each(function(){var b=$(this);if(b.find(".down-arrow").length){var c=
b.height()-(b.find(".arrival-container").last().offset().top-b.offset().top);b.find(".down-arrow").css("bottom",c+"px")}var d=b.data("startDate");b.find(".bookable-link").each(function(){var b=$(this),c=b.find(".overview-route-price,.overview-route-info"),e=b.data("startId"),f=b.data("endId"),i=b.data("startStopDestinationId"),j=b.data("endStopDestinationId"),l=E.find('.travel-row[data-travel-id="'+b.data("transposeTravelId")+'"]'),m=b.data("isReturn");if((l=b.data("roundtrip")&&l.length?l.data("startDate"):
null)&&m)m=d,d=l,l=m,m=e,e=f,f=m,m=i,i=j,j=m;"plane"===b.data("mode")&&(e&&f&&e!==f)&&h.getQuote({startDestinationId:i,endDestinationId:j,outboundDateStr:d,inboundDateStr:l},function(a){c.html("Flights from "+a.formattedAmount)});if(c.hasClass("overview-route-price")&&"plane"===b.data("mode")){if(!c.length||!e||!f||e===f)return!0;var k={startDestinationId:i,endDestinationId:j,outbounddate:d,inbounddate:l,tripType:b.data("roundtrip")?"roundtrip":"oneway",mode:b.data("mode")};c.off("click").on("click",
function(b){a.trackEvent(g.CAT_PLAN_DBD_LIST_TRAVEL,g.ACT_ACTION,"search-flights");p.triggerEvent("daybyday","show-transport-modal",{searchData:k});b.stopPropagation()})}else if(c.hasClass("overview-route-price")&&("car"===b.data("mode")||"taxi"===b.data("mode")))c.off("click").on("click",function(c){var d={mode:b.data("mode"),segmentIndex:b.data("segmentIndex"),travelId:b.data("travelId")};a.trackEvent(g.CAT_PLAN_DBD_LIST_TRAVEL,g.ACT_ACTION,"search-cars");p.triggerEvent("daybyday","show-transport-modal",
{searchData:d});c.stopPropagation()});else c.off("click").on("click",function(h){if("plane"===b.data("mode")&&"first"===b.data("boundary")&&!e&&f)a.trackEvent(g.CAT_PLAN_DBD_LIST_TRAVEL,g.ACT_PROMPT_START_AIRPORT),v(e,"",f,"cityIata",d),h.preventDefault();else if("plane"===b.data("mode")&&"last"===b.data("boundary")&&e&&!f)a.trackEvent(g.CAT_PLAN_DBD_LIST_TRAVEL,g.ACT_PROMPT_END_AIRPORT),v(e,"cityIata",f,"",d),h.preventDefault();else if(c.hasClass("train-link"))a.trackEvent(g.CAT_PLAN_DBD_LIST_TRAVEL,
g.ACT_ACTION,"search-trains"),p.triggerEvent("daybyday","show-transport-modal",{searchData:{mode:"train"}}),h.preventDefault();else{var i=-1<c.attr("href").indexOf("www.google.com/maps"),j=-1<c.attr("href").indexOf("www.rome2rio.com");a.trackEvent(g.CAT_PLAN_DBD_LIST_TRAVEL,g.ACT_ACTION,i?"directions-google-maps":j?"more-info-r2r":"other")}h.stopPropagation()})})});n.prepareCommentAreas(E);E.find(".trim-desc").each(function(){var a=$(this).text(),b=$(this).data("moreLink");""!==a.trim()&&($(this).append("<span data-link='"+
b+"' class='more-link secondary-text-link' title='Read More'>See more</span>"),a=$(this)[0].offsetHeight,b=parseFloat($(this).css("lineHeight")),Math.round(a/b))});E.is(":visible")&&p.triggerEvent("daybyday","show-help-tips",{tabName:"#itinerary"});G();M();var d={};E.find(".error-row").each(function(){var a=$(this).data("stayId");a&&-1!==a&&(d[a]=a)});Object.keys(d).forEach(function(a){E.find(".stay-"+a).find(".conflict-icon").removeClass("hidden")});f.initialize()};return A});
define("text%21templates/reservedDropDown.html",[],function(){return'<div class="event-data-summary">\n    <div class="event-title">Meeting with Yael</div>\n    <div class="event-location"></div>\n    <div class="time-holder-summary">Mon 8/19, 1PM - 8PM</div>\n    <div class="note-container hidden">\n        <div class="note-header">Notes:</div>\n        <div class="note-text-summary"></div>\n        <div class="add-attachments">\n            <div class="attachment-list"></div>\n        </div>\n    </div>\n</div>\n<div class="clearfix">\n    <div class="edit-event edit-delete-event">\n        <svg class="icons edit-activity actvity"><use xlink:href="#icon-edit" /></svg>\n        <span class="edit-text text">EDIT</span>\n    </div>\n    <div class="delete-event edit-delete-event">\n        <svg class="icons delete-activity activity"><use xlink:href="#icon-trash" /></svg>\n        <span class="delete-text text">DELETE</span>\n    </div>\n</div>'});
define("text%21templates/visitDropDown.html",[],function(){return'<div class="visit event-data-summary">\n    <div class="event-title attLink attractionDetailsLink summary-title">Meeting with Yael</div>\n    <div class="time-holder-summary">Mon 8/19, 1PM - 8PM</div>\n    <div class="note-container hidden">\n        <div class="note-header">Notes:</div>\n        <div class="note-text-summary"></div>\n        <div class="add-attachments">\n            <div class="attachment-list"></div>\n        </div>\n    </div>\n</div>\n<div class="clearfix">\n    <div class="edit-event edit-delete-event">\n        <svg class="edit-activity actvity"><use xlink:href="#icon-edit" /></svg>\n        <span class="edit-text text">EDIT</span>\n    </div>\n    <div class="delete-event edit-delete-event">\n        <svg class="delete-activity activity"><use xlink:href="#icon-trash" /></svg>\n        <span class="delete-text text">DELETE</span>\n    </div>\n</div>'});
define("text%21templates/calendarDropDown.html",[],function(){return'<div class="activities-container">\n    <div class="items">\n        <div class="add-activity item">Add activity</div>\n        <div class="explore-page item">Explore things to do</div>\n        <div class="add-reservation item">Add reservation</div>\n        <div class="custom-event item">Create custom event</div>\n    </div>\n    <div class="explore-things-to-do hidden">\n        <h3>Explore things to do</h3>\n        <div class="destination-list"></div>\n    </div>\n</div>'});
(function(a){"function"===typeof define&&define.amd?define("fullCalendar",["jquery","moment"],a):"object"===typeof exports?module.exports=a(require("jquery"),require("moment")):a(jQuery,moment)})(function(a,g){function d(a,b){b.left&&a.css({"border-left-width":1,"margin-left":b.left-1});b.right&&a.css({"border-right-width":1,"margin-right":b.right-1})}function p(a){a.css({"margin-left":"","margin-right":"","border-left-width":"","border-right-width":""})}function m(){a("body").addClass("fc-not-allowed")}
function j(){a("body").removeClass("fc-not-allowed")}function i(b,c,d){var e=Math.floor(c/b.length),f=Math.floor(c-e*(b.length-1)),g=[],h=[],i=[],j=0;b.height("");b.each(function(c,d){var xa=c===b.length-1?f:e,cb=a(d).outerHeight(!0);cb<xa?(g.push(d),h.push(cb),i.push(a(d).height())):j+=cb});d&&(c-=j,e=Math.floor(c/g.length),f=Math.floor(c-e*(g.length-1)));a(g).each(function(b,ea){var c=b===g.length-1?f:e,d=h[b],xa=c-(d-i[b]);d<c&&a(ea).height(xa)})}function c(b){var c=0;b.find("> *").each(function(b,
ea){var d=a(ea).outerWidth();d>c&&(c=d)});c++;b.width(c);return c}function b(a,b){var c=a.add(b),d;c.css({position:"relative",left:-1});d=a.outerHeight()-b.outerHeight();c.css({position:"",left:""});return d}function f(b){var c=b.css("position"),d=b.parents().filter(function(){var b=a(this);return/(auto|scroll)/.test(b.css("overflow")+b.css("overflow-y")+b.css("overflow-x"))}).eq(0);return"fixed"===c||!d.length?a(b[0].ownerDocument||document):d}function u(a,b){var c=a.offset(),d=c.left-(b?b.left:
0),c=c.top-(b?b.top:0);return{left:d,right:d+a.outerWidth(),top:c,bottom:c+a.outerHeight()}}function n(a,b){var c=a.offset(),d=k(a),e=c.left+(parseFloat(a.css("border-left-width"))||0)+d.left-(b?b.left:0),c=c.top+(parseFloat(a.css("border-top-width"))||0)+d.top-(b?b.top:0);return{left:e,right:e+a[0].clientWidth,top:c,bottom:c+a[0].clientHeight}}function k(b){var c=b[0].offsetWidth-b[0].clientWidth,d=b[0].offsetHeight-b[0].clientHeight,c=h(c),d=h(d),d={left:0,right:0,top:0,bottom:d};if(null===Va){var e=
a("<div><div/></div>").css({position:"absolute",top:-1E3,left:0,border:0,padding:0,overflow:"scroll",direction:"rtl"}).appendTo("body"),f=e.children().offset().left>e.offset().left;e.remove();Va=f}Va&&"rtl"==b.css("direction")?d.left=c:d.right=c;return d}function h(a){a=Math.max(0,a);return a=Math.round(a)}function e(a){var b=a.originalEvent.touches;return b&&b.length?b[0].pageX:a.pageX}function l(a){var b=a.originalEvent.touches;return b&&b.length?b[0].pageY:a.pageY}function t(a){a.addClass("fc-unselectable").on("selectstart",
r)}function r(a){a.preventDefault()}function q(a,b){var c={left:Math.max(a.left,b.left),right:Math.min(a.right,b.right),top:Math.max(a.top,b.top),bottom:Math.min(a.bottom,b.bottom)};return c.left<c.right&&c.top<c.bottom?c:!1}function D(b){var c=[],d=[],e;"string"===typeof b?d=b.split(/\s*,\s*/):"function"===typeof b?d=[b]:a.isArray(b)&&(d=b);for(b=0;b<d.length;b++)e=d[b],"string"===typeof e?c.push("-"==e.charAt(0)?{field:e.substring(1),order:-1}:{field:e,order:1}):"function"===typeof e&&c.push({func:e});
return c}function v(a,b,c){var d,e;for(d=0;d<c.length;d++)if(e=B(a,b,c[d]))return e;return 0}function B(a,b,c){return c.func?c.func(a,b):z(a[c.field],b[c.field])*(c.order||1)}function z(b,c){return!b&&!c?0:null==c?-1:null==b?1:"string"===a.type(b)||"string"===a.type(c)?String(b).localeCompare(String(c)):b-c}function C(a,b){var c=a.start,d=a.end,e=b.start,f=b.end;if(d>e&&c<f)return c>=e?(c=c.clone(),e=!0):(c=e.clone(),e=!1),d<=f?(d=d.clone(),f=!0):(d=f.clone(),f=!1),{start:c,end:d,isStart:e,isEnd:f}}
function G(a,b){return g.duration({days:a.clone().stripTime().diff(b.clone().stripTime(),"days"),ms:a.time()-b.time()})}function M(a,b){return g.duration({days:a.clone().stripTime().diff(b.clone().stripTime(),"days")})}function w(a,b){var c,d,e;for(c=0;c<za.length;c++){d=za[c];e=d;var f=a;e=null!=b?b.diff(f,e,!0):g.isDuration(f)?f.as(e):f.end.diff(f.start,e,!0);if(1<=e&&aa(e))break}return d}function J(a,b){var c=w(a);"week"===c&&("object"===typeof b&&b.days)&&(c="day");return c}function F(a,b){var c,
d;if(A(a)||A(b))return a/b;c=a.asMonths();d=b.asMonths();return 1<=Math.abs(c)&&aa(c)&&1<=Math.abs(d)&&aa(d)?c/d:a.asDays()/b.asDays()}function y(a,b){a={start:a.start.clone(),end:a.end.clone()};b.start&&(a.start=s(a.start,b));b.end&&(a.end=(a.end.isBefore(b.end)?a.end:b.end).clone());return a}function s(a,b){a=a.clone();b.start&&(a=(a.isAfter(b.start)?a:b.start).clone());b.end&&a>=b.end&&(a=b.end.clone().subtract(1));return a}function H(a,b){return(!b.start||a>=b.start)&&(!b.end||a<b.end)}function x(a,
b){return(!b.start||a.start>=b.start)&&(!b.end||a.end<=b.end)}function A(a){return Boolean(a.hours()||a.minutes()||a.seconds()||a.milliseconds())}function E(a){return/^\d+\:\d+(?:\:\d+\.?(?:\d{3})?)?$/.test(a)}function K(a,b){var c={},d,e,f,g,h;if(b)for(d=0;d<b.length;d++){e=b[d];f=[];for(g=a.length-1;0<=g;g--)if(h=a[g][e],"object"===typeof h)f.unshift(h);else if(void 0!==h){c[e]=h;break}f.length&&(c[e]=K(f))}for(d=a.length-1;0<=d;d--)for(e in f=a[d],f)e in c||(c[e]=f[e]);return c}function L(a){var b=
function(){};b.prototype=a;return new b}function Q(a,b){for(var c in a)gb.call(a,c)&&(b[c]=a[c])}function N(b,c,d){a.isFunction(b)&&(b=[b]);if(b){var e,f;for(e=0;e<b.length;e++)f=b[e].apply(c,d)||f;return f}}function O(){for(var a=0;a<arguments.length;a++)if(void 0!==arguments[a])return arguments[a]}function I(a){return(a+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;").replace(/\n/g,"<br />")}function T(b){var c=[];a.each(b,function(a,
b){null!=b&&c.push(a+":"+b)});return c.join(";")}function S(a){return a.charAt(0).toUpperCase()+a.slice(1)}function U(a,b){return a-b}function aa(a){return 0===a%1}function W(a,b){var c=a[b];return function(){return c.apply(a,arguments)}}function Y(a,b,c){var d,e,f,g,h,i=function(){var j=+new Date-g;j<b?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),f=e=null))};return function(){f=this;e=arguments;g=+new Date;var j=c&&!d;d||(d=setTimeout(i,b));j&&(h=a.apply(f,e),f=e=null);return h}}function V(b,c,
d){var e=b[0],f=1==b.length&&"string"===typeof e,h,i,j;if(g.isMoment(e)||"[object Date]"===Object.prototype.toString.call(e)||e instanceof Date||void 0===e)b=g.apply(null,b);else{i=h=!1;if(f)if(lb.test(e))e+="-01",b=[e],i=h=!0;else{if(j=Sa.exec(e))h=!j[5],i=!0}else a.isArray(e)&&(i=!0);b=c||h?g.utc.apply(g,b):g.apply(null,b);h?(b._ambigTime=!0,b._ambigZone=!0):d&&(i?b._ambigZone=!0:f&&b.utcOffset(e))}b._fullCalendar=!0;return b}function ba(a){return"en"!==a.locale()?a.clone().locale("en"):a}function ha(){}
function ia(a,b){a.then=function(c){"function"===typeof c&&c(b);return a}}function pa(a){a.then=function(b,c){"function"===typeof c&&c();return a}}function ka(a,b){return!a&&!b?!0:a&&b?a.component===b.component&&na(a,b)&&na(b,a):!1}function na(a,b){for(var c in a)if(!/^(component|left|right|top|bottom)$/.test(c)&&a[c]!==b[c])return!1;return!0}function sa(a){return{start:a.start.clone(),end:a.end?a.end.clone():null,allDay:a.allDay}}function Na(a){a=O((a.source||{}).rendering,a.rendering);return"background"===
a||"inverse-background"===a}function Qa(a,b){return a.start-b.start}function Xa(a,b){return a.leftCol-b.leftCol}function Ba(a){var b=a.forwardSegs,c=0,d,e;if(void 0===a.forwardPressure){for(d=0;d<b.length;d++)e=b[d],Ba(e),c=Math.max(c,1+e.forwardPressure);a.forwardPressure=c}}function ya(a,b,c){for(var c=c||[],d=0;d<b.length;d++){var e;e=b[d];e="Hop"===a.event.eventType||"Hop"===e.event.eventType?!1:a.bottom>e.top&&a.top<e.bottom;e&&c.push(b[d])}return c}function Ja(a){this.items=a||[]}function Ta(b,
c){function d(){g&&(g.remove(),g=f.el=null)}function e(d){var f=a('<div class="fc-'+d+'"/>'),d=c.layout[d],g=b.opt("customButtons")||{},cb=b.opt("buttonText")||{};d&&a.each(d.split(" "),function(){var c=a(),d=!0,e;a.each(this.split(","),function(e,f){var xa,j,l,m,k,mb,n;"title"==f?(c=c.add(a("<h2>&nbsp;</h2>")),d=!1):((xa=g[f])?(l=function(a){xa.click&&xa.click.call(n[0],a)},m="",k=xa.text):(j=b.getViewSpec(f))?(l=function(){b.changeView(f)},h.push(f),m=j.buttonTextOverride,k=j.buttonTextDefault):
b[f]&&(l=function(){b[f]()},m=(b.overrides.buttonText||{})[f],k=cb[f]),l&&(j=xa?xa.themeIcon:b.opt("themeButtonIcons")[f],mb=xa?xa.icon:b.opt("buttonIcons")[f],m=m?I(m):j&&b.opt("theme")?"<span class='ui-icon ui-icon-"+j+"'></span>":mb&&!b.opt("theme")?"<span class='fc-icon fc-icon-"+mb+"'></span>":I(k),k=["fc-"+f+"-button",i+"-button",i+"-state-default"],n=a('<button type="button" class="'+k.join(" ")+'">'+m+"</button>").click(function(a){n.hasClass(i+"-state-disabled")||(l(a),(n.hasClass(i+"-state-active")||
n.hasClass(i+"-state-disabled"))&&n.removeClass(i+"-state-hover"))}).mousedown(function(){n.not("."+i+"-state-active").not("."+i+"-state-disabled").addClass(i+"-state-down")}).mouseup(function(){n.removeClass(i+"-state-down")}).hover(function(){n.not("."+i+"-state-active").not("."+i+"-state-disabled").addClass(i+"-state-hover")},function(){n.removeClass(i+"-state-hover").removeClass(i+"-state-down")}),c=c.add(n)))});d&&c.first().addClass(i+"-corner-left").end().last().addClass(i+"-corner-right").end();
1<c.length?(e=a("<div/>"),d&&e.addClass("fc-button-group"),e.append(c),f.append(e)):f.append(c)});return f}var f=this;f.setToolbarOptions=function(a){c=a};f.render=function(){var f=c.layout;i=b.opt("theme")?"ui":"fc";f?(g?g.empty():g=this.el=a("<div class='fc-toolbar "+c.extraClasses+"'/>"),g.append(e("left")).append(e("right")).append(e("center")).append('<div class="fc-clear"/>')):d()};f.removeElement=d;f.updateTitle=function(a){g&&g.find("h2").text(a)};f.activateButton=function(a){g&&g.find(".fc-"+
a+"-button").addClass(i+"-state-active")};f.deactivateButton=function(a){g&&g.find(".fc-"+a+"-button").removeClass(i+"-state-active")};f.disableButton=function(a){g&&g.find(".fc-"+a+"-button").prop("disabled",!0).addClass(i+"-state-disabled")};f.enableButton=function(a){g&&g.find(".fc-"+a+"-button").prop("disabled",!1).removeClass(i+"-state-disabled")};f.getViewsWithButtons=function(){return h};f.el=null;var g,h=[],i}function Pa(b){a.each(ub,function(a,c){null==b[a]&&(b[a]=c(b))})}function ga(a){a._allDay=
a.allDay;a._start=a.start.clone();a._end=a.end?a.end.clone():null}var P=a.fullCalendar={version:"3.4.0",internalApiVersion:9},ja=P.views={};a.fn.fullCalendar=function(b){var c=Array.prototype.slice.call(arguments,1),d=this;this.each(function(e,f){var g=a(f),h=g.data("fullCalendar");"string"===typeof b?h&&a.isFunction(h[b])&&(h=h[b].apply(h,c),e||(d=h),"destroy"===b&&g.removeData("fullCalendar")):h||(h=new ca(g,b),g.data("fullCalendar",h),h.render())});return d};var da=["header","footer","buttonText",
"buttonIcons","themeButtonIcons"];P.intersectRanges=C;P.applyAll=N;P.debounce=Y;P.isInt=aa;P.htmlEscape=I;P.cssToStr=T;P.proxy=W;P.capitaliseFirstLetter=S;P.getOuterRect=u;P.getClientRect=n;P.getContentRect=function(a,b){var c=a.offset(),d=c.left+(parseFloat(a.css("border-left-width"))||0)+(parseFloat(a.css("padding-left"))||0)-(b?b.left:0),c=c.top+(parseFloat(a.css("border-top-width"))||0)+(parseFloat(a.css("padding-top"))||0)-(b?b.top:0);return{left:d,right:d+a.width(),top:c,bottom:c+a.height()}};
P.getScrollbarWidths=k;var Va=null;P.preventDefault=r;P.intersectRects=q;P.parseFieldSpecs=D;P.compareByFieldSpecs=v;P.compareByFieldSpec=B;P.flexibleCompare=z;P.computeGreatestUnit=w;P.divideRangeByDuration=function(a,b,c){var d;if(A(c))return(b-a)/c;d=c.asMonths();return 1<=Math.abs(d)&&aa(d)?b.diff(a,"months",!0)/d:b.diff(a,"days",!0)/c.asDays()};P.divideDurationByDuration=F;P.multiplyDuration=function(a,b){var c;if(A(a))return g.duration(a*b);c=a.asMonths();return 1<=Math.abs(c)&&aa(c)?g.duration({months:c*
b}):g.duration({days:a.asDays()*b})};P.durationHasTime=A;var $a="sun mon tue wed thu fri sat".split(" "),za="year month week day hour minute second millisecond".split(" ");P.log=function(){var a=window.console;if(a&&a.log)return a.log.apply(a,arguments)};P.warn=function(){var a=window.console;return a&&a.warn?a.warn.apply(a,arguments):P.log.apply(P,arguments)};var gb={}.hasOwnProperty;P.createObject=L;var lb=/^\s*\d{4}-\d\d$/,Sa=/^\s*\d{4}-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?)?$/,
ma=g.fn,va=a.extend({},ma),ab=g.momentProperties;ab.push("_fullCalendar");ab.push("_ambigTime");ab.push("_ambigZone");P.moment=function(){return V(arguments)};P.moment.utc=function(){var a=V(arguments,!0);a.hasTime()&&a.utc();return a};P.moment.parseZone=function(){return V(arguments,!0,!0)};ma.week=ma.weeks=function(a){var b=this._locale._fullCalendar_weekCalc;return null==a&&"function"===typeof b?b(this):"ISO"===b?va.isoWeek.apply(this,arguments):va.week.apply(this,arguments)};ma.time=function(a){if(!this._fullCalendar)return va.time.apply(this,
arguments);if(null==a)return g.duration({hours:this.hours(),minutes:this.minutes(),seconds:this.seconds(),milliseconds:this.milliseconds()});this._ambigTime=!1;!g.isDuration(a)&&!g.isMoment(a)&&(a=g.duration(a));var b=0;g.isDuration(a)&&(b=24*Math.floor(a.asDays()));return this.hours(b+a.hours()).minutes(a.minutes()).seconds(a.seconds()).milliseconds(a.milliseconds())};ma.stripTime=function(){this._ambigTime||(this.utc(!0),this.set({hours:0,minutes:0,seconds:0,ms:0}),this._ambigZone=this._ambigTime=
!0);return this};ma.hasTime=function(){return!this._ambigTime};ma.stripZone=function(){var a;this._ambigZone||(a=this._ambigTime,this.utc(!0),this._ambigTime=a||!1,this._ambigZone=!0);return this};ma.hasZone=function(){return!this._ambigZone};ma.local=function(a){va.local.call(this,this._ambigZone||a);this._ambigZone=this._ambigTime=!1;return this};ma.utc=function(a){va.utc.call(this,a);this._ambigZone=this._ambigTime=!1;return this};ma.utcOffset=function(a){null!=a&&(this._ambigZone=this._ambigTime=
!1);return va.utcOffset.apply(this,arguments)};ma.format=function(){return this._fullCalendar&&arguments[0]?Za(this,arguments[0]):this._ambigTime?wa(ba(this),"YYYY-MM-DD"):this._ambigZone?wa(ba(this),"YYYY-MM-DD[T]HH:mm:ss"):this._fullCalendar?wa(ba(this)):va.format.apply(this,arguments)};ma.toISOString=function(){return this._ambigTime?wa(ba(this),"YYYY-MM-DD"):this._ambigZone?wa(ba(this),"YYYY-MM-DD[T]HH:mm:ss"):this._fullCalendar?va.toISOString.apply(ba(this),arguments):va.toISOString.apply(this,
arguments)};var Ia=function(a,b){return va.format.call(a,b)},La=function(a){a=bb(a);return{fakeFormatString:oa(a),sameUnits:Fa(a)}},bb=function(a){for(var b=[],c,d=/\[([^\]]*)\]|\(([^\)]*)\)|(LTS|LT|(\w)\4*o?)|([^\w\[\(]+)/g;c=d.exec(a);)c[1]?b.push.apply(b,". "===c[1]?["."," "]:[c[1]]):c[2]?b.push({maybe:bb(c[2])}):c[3]?b.push({token:c[3]}):c[5]&&b.push.apply(b,". "===c[5]?["."," "]:[c[5]]);return b},oa=function(a){var b=[],c,d;for(c=0;c<a.length;c++)d=a[c],"string"===typeof d?b.push("["+d+"]"):
d.token?d.token in fb?b.push(ua+"["+d.token+"]"):b.push(d.token):d.maybe&&b.push(ta+oa(d.maybe)+ta);return b.join(X)},Fa=function(a){var b=[],c,d;for(c=0;c<a.length;c++)d=a[c],d.token?(d=Aa[d.token.charAt(0)],b.push(d?d.unit:"second")):d.maybe?b.push.apply(b,Fa(d.maybe)):b.push(null);return b},fa=function(a,b){var c=[],d=Ia(b,a).split(X),e,f;for(e=0;e<d.length;e++)f=d[e],f.charAt(0)===ua?c.push(fb[f.substring(1)](b)):c.push(f);return c},R=function(a){return a.replace(Z,function(a,b){return b.match(/[1-9]/)?
b:""})};P.formatDate=function(a,b){var c=(Wa[b]||(Wa[b]=La(b))).fakeFormatString;return R(fa(c,a).join(""))};P.formatRange=function(a,b,c,d,e){var a=P.moment.parseZone(a),b=P.moment.parseZone(b),c=a.localeData().longDateFormat(c)||c,f=Wa[c]||(Wa[c]=La(c)),g=a,h=b,d=d||" - ",b=f.sameUnits,a=g.clone().stripZone(),c=h.clone().stripZone(),g=fa(f.fakeFormatString,g),f=fa(f.fakeFormatString,h),i,h="",j,l="",m="",k="",n="";for(i=0;i<b.length&&(!b[i]||a.isSame(c,b[i]));i++)h+=g[i];for(j=b.length-1;j>i&&(!b[j]||
a.isSame(c,b[j]))&&!(j-1===i&&"."===g[j]);j--)l=g[j]+l;for(b=i;b<=j;b++)m+=g[b],k+=f[b];if(m||k)n=e?k+d+m:m+d+k;return R(h+n+l)};P.oldMomentFormat=Ia;P.queryMostGranularFormatUnit=function(a){var a=bb(a),b,c,d;for(b=0;b<a.length;b++)if(c=a[b],c.token&&(c=Aa[c.token.charAt(0)])&&(!d||c.value>d.value))d=c;return d?d.unit:null};var X="\x0B",ua="\u001f",ta="\u001e",Z=RegExp(ta+"([^"+ta+"]*)"+ta,"g"),fb={t:function(a){return Ia(a,"a").charAt(0)},T:function(a){return Ia(a,"A").charAt(0)}},Aa={Y:{value:1,
unit:"year"},M:{value:2,unit:"month"},W:{value:3,unit:"week"},w:{value:3,unit:"week"},D:{value:4,unit:"day"},d:{value:4,unit:"day"}},Wa={},Za=P.formatDate,hb=P.formatRange,wa=P.oldMomentFormat;P.Class=ha;ha.extend=function(){var a=arguments.length,b,c;for(b=0;b<a;b++)c=arguments[b],b<a-1&&Q(c,this.prototype);var d=this,a=c||{},e;gb.call(a,"constructor")&&(e=a.constructor);"function"!==typeof e&&(e=a.constructor=function(){d.apply(this,arguments)});e.prototype=L(d.prototype);Q(a,e.prototype);Q(d,e);
return e};ha.mixin=function(a){Q(a,this.prototype)};var ra=ha.extend(Ma,Ga,{_props:null,_watchers:null,_globalWatchArgs:null,constructor:function(){this._watchers={};this._props={};this.applyGlobalWatchers()},applyGlobalWatchers:function(){var a=this._globalWatchArgs||[],b;for(b=0;b<a.length;b++)this.watch.apply(this,a[b])},has:function(a){return a in this._props},get:function(a){return void 0===a?this._props:this._props[a]},set:function(a,b){var c;"string"===typeof a?(c={},c[a]=void 0===b?null:b):
c=a;this.setProps(c)},reset:function(a){var b=this._props,c={},d;for(d in b)c[d]=void 0;for(d in a)c[d]=a[d];this.setProps(c)},unset:function(a){var b={},c,a="string"===typeof a?[a]:a;for(c=0;c<a.length;c++)b[a[c]]=void 0;this.setProps(b)},setProps:function(a){var b={},c=0,d,e;for(d in a)if(e=a[d],"object"===typeof e||e!==this._props[d])b[d]=e,c++;if(c){this.trigger("before:batchChange",b);for(d in b)e=b[d],this.trigger("before:change",d,e),this.trigger("before:change:"+d,e);for(d in b)e=b[d],void 0===
e?delete this._props[d]:this._props[d]=e,this.trigger("change:"+d,e),this.trigger("change",d,e);this.trigger("batchChange",b)}},watch:function(a,b,c,d){var e=this;this.unwatch(a);this._watchers[a]=this._watchDeps(b,function(b){(b=c.call(e,b))&&b.then?(e.unset(a),b.then(function(b){e.set(a,b)})):e.set(a,b)},function(){e.unset(a);d&&d.call(e)})},unwatch:function(a){var b=this._watchers[a];b&&(delete this._watchers[a],b.teardown())},_watchDeps:function(a,b,c){var d=this,e=0,f=a.length,g=0,h={},i=[],
j=!1;a.forEach(function(a){var ea=!1;"?"===a.charAt(0)&&(a=a.substring(1),ea=!0);var l="before:change:"+a,m=function(){e++;1===e&&g===f&&(j=!0,c(),j=!1)};d.on(l,m);i.push([l,m]);l="change:"+a;m=function(c){var d=a,i=ea;void 0===c?(!i&&void 0!==h[d]&&g--,delete h[d]):(!i&&void 0===h[d]&&g++,h[d]=c);e--;e||g===f&&(j||b(h))};d.on(l,m);i.push([l,m])});a.forEach(function(a){var b=!1;"?"===a.charAt(0)&&(a=a.substring(1),b=!0);d.has(a)?(h[a]=d.get(a),g++):b&&g++});g===f&&b(h);return{teardown:function(){for(var a=
0;a<i.length;a++)d.off(i[a][0],i[a][1]);i=null;g===f&&c()},flash:function(){g===f&&(c(),b(h))}}},flash:function(a){(a=this._watchers[a])&&a.flash()}});ra.watch=function(){var a=this.prototype;a._globalWatchArgs||(a._globalWatchArgs=[]);a._globalWatchArgs.push(arguments)};P.Model=ra;var la={construct:function(b){var c=a.Deferred(),d=c.promise();"function"===typeof b&&b(function(a){c.resolve(a);ia(d,a)},function(){c.reject();pa(d)});return d},resolve:function(b){var c=a.Deferred().resolve(b).promise();
ia(c,b);return c},reject:function(){var b=a.Deferred().reject().promise();pa(b);return b}};P.Promise=la;var Da=ha.extend(Ma,{q:null,isPaused:!1,isRunning:!1,constructor:function(){this.q=[]},queue:function(){this.q.push.apply(this.q,arguments);this.tryStart()},pause:function(){this.isPaused=!0},resume:function(){this.isPaused=!1;this.tryStart()},tryStart:function(){!this.isRunning&&this.canRunNext()&&(this.isRunning=!0,this.trigger("start"),this.runNext())},canRunNext:function(){return!this.isPaused&&
this.q.length},runNext:function(){this.runTask(this.q.shift())},runTask:function(a){this.runTaskFunc(a)},runTaskFunc:function(a){function b(){c.canRunNext()?c.runNext():(c.isRunning=!1,c.trigger("stop"))}var c=this;(a=a())&&a.then?a.then(b):b()}});P.TaskQueue=Da;var Ka=Da.extend({waitsByNamespace:null,waitNamespace:null,waitId:null,constructor:function(a){Da.call(this);this.waitsByNamespace=a||{}},queue:function(a,b,c){var a={func:a,namespace:b,type:c},d;b&&(d=this.waitsByNamespace[b]);this.waitNamespace&&
(b===this.waitNamespace&&null!=d?this.delayWait(d):(this.clearWait(),this.tryStart()));this.compoundTask(a)&&(!this.waitNamespace&&null!=d?this.startWait(b,d):this.tryStart())},startWait:function(a,b){this.waitNamespace=a;this.spawnWait(b)},delayWait:function(a){clearTimeout(this.waitId);this.spawnWait(a)},spawnWait:function(a){var b=this;this.waitId=setTimeout(function(){b.waitNamespace=null;b.tryStart()},a)},clearWait:function(){this.waitNamespace&&(clearTimeout(this.waitId),this.waitNamespace=
this.waitId=null)},canRunNext:function(){if(!Da.prototype.canRunNext.apply(this,arguments))return!1;if(this.waitNamespace){for(var a=this.q,b=0;b<a.length;b++)if(a[b].namespace!==this.waitNamespace)return!0;return!1}return!0},runTask:function(a){this.runTaskFunc(a.func)},compoundTask:function(a){var b=this.q,c=!0,d,e;if(a.namespace&&("destroy"===a.type||"init"===a.type)){for(d=b.length-1;0<=d;d--)e=b[d],e.namespace===a.namespace&&("add"===e.type||"remove"===e.type)&&b.splice(d,1);"destroy"===a.type?
b.length&&(e=b[b.length-1],e.namespace===a.namespace&&("init"===e.type?(c=!1,b.pop()):"destroy"===e.type&&(c=!1))):"init"===a.type&&b.length&&(e=b[b.length-1],e.namespace===a.namespace&&"init"===e.type&&b.pop())}c&&b.push(a);return c}});P.RenderQueue=Ka;var Ma=P.EmitterMixin={on:function(b,c){a(this).on(b,this._prepareIntercept(c));return this},one:function(b,c){a(this).one(b,this._prepareIntercept(c));return this},_prepareIntercept:function(b){var c=function(a,c){return b.apply(c.context||this,c.args||
[])};b.guid||(b.guid=a.guid++);c.guid=b.guid;return c},off:function(b,c){a(this).off(b,c);return this},trigger:function(b){var c=Array.prototype.slice.call(arguments,1);a(this).triggerHandler(b,{args:c});return this},triggerWith:function(b,c,d){a(this).triggerHandler(b,{context:c,args:d});return this}},Ua=0,Ga=P.ListenerMixin={listenerId:null,listenTo:function(b,c,d){if("object"===typeof c)for(var e in c)c.hasOwnProperty(e)&&this.listenTo(b,e,c[e]);else if("string"===typeof c)b.on(c+"."+this.getListenerNamespace(),
a.proxy(d,this))},stopListeningTo:function(a,b){a.off((b||"")+"."+this.getListenerNamespace())},getListenerNamespace:function(){null==this.listenerId&&(this.listenerId=Ua++);return"_listener"+this.listenerId}},rb=ha.extend(Ga,{isHidden:!0,options:null,el:null,margin:10,constructor:function(a){this.options=a||{}},show:function(){this.isHidden&&(this.el||this.render(),this.el.show(),this.position(),this.isHidden=!1,this.trigger("show"))},hide:function(){this.isHidden||(this.el.hide(),this.isHidden=
!0,this.trigger("hide"))},render:function(){var b=this,c=this.options;this.el=a('<div class="fc-popover"/>').addClass(c.className||"").css({top:0,left:0}).append(c.content).appendTo(c.parentEl);this.el.on("click",".fc-close",function(){b.hide()});c.autoHide&&this.listenTo(a(document),"mousedown",this.documentMousedown)},documentMousedown:function(b){this.el&&!a(b.target).closest(this.el).length&&this.hide()},removeElement:function(){this.hide();this.el&&(this.el.remove(),this.el=null);this.stopListeningTo(a(document),
"mousedown")},position:function(){var b=this.options,c=this.el.offsetParent().offset(),d=this.el.outerWidth(),e=this.el.outerHeight(),g=a(window),h=f(this.el),i,j,l,m;l=b.top||0;m=void 0!==b.left?b.left:void 0!==b.right?b.right-d:0;h.is(window)||h.is(document)?(h=g,j=i=0):(j=h.offset(),i=j.top,j=j.left);i+=g.scrollTop();j+=g.scrollLeft();!1!==b.viewportConstrain&&(l=Math.min(l,i+h.outerHeight()-e-this.margin),l=Math.max(l,i+this.margin),m=Math.min(m,j+h.outerWidth()-d-this.margin),m=Math.max(m,j+
this.margin));this.el.css({top:l-c.top,left:m-c.left})},trigger:function(a){this.options[a]&&this.options[a].apply(this,Array.prototype.slice.call(arguments,1))}}),db=P.CoordCache=ha.extend({els:null,forcedOffsetParentEl:null,origin:null,boundingRect:null,isHorizontal:!1,isVertical:!1,lefts:null,rights:null,tops:null,bottoms:null,constructor:function(b){this.els=a(b.els);this.isHorizontal=b.isHorizontal;this.isVertical=b.isVertical;this.forcedOffsetParentEl=b.offsetParent?a(b.offsetParent):null},
build:function(){var a=this.forcedOffsetParentEl;!a&&0<this.els.length&&(a=this.els.eq(0).offsetParent());this.origin=a?a.offset():null;this.boundingRect=this.queryBoundingRect();this.isHorizontal&&this.buildElHorizontals();this.isVertical&&this.buildElVerticals()},clear:function(){this.bottoms=this.tops=this.rights=this.lefts=this.boundingRect=this.origin=null},ensureBuilt:function(){this.origin||this.build()},buildElHorizontals:function(){var b=[],c=[];this.els.each(function(d,e){var f=a(e),g=f.offset().left,
f=f.outerWidth();b.push(g);c.push(g+f)});this.lefts=b;this.rights=c},buildElVerticals:function(){var b=[],c=[];this.els.each(function(d,e){var f=a(e),g=f.offset().top,f=f.outerHeight();b.push(g);c.push(g+f)});this.tops=b;this.bottoms=c},getHorizontalIndex:function(a){this.ensureBuilt();var b=this.lefts,c=this.rights,d=b.length,e;for(e=0;e<d;e++)if(a>=b[e]&&a<c[e])return e},getVerticalIndex:function(a){this.ensureBuilt();var b=this.tops,c=this.bottoms,d=b.length,e;for(e=0;e<d;e++)if(a>=b[e]&&a<c[e])return e},
getLeftOffset:function(a){this.ensureBuilt();return this.lefts[a]},getLeftPosition:function(a){this.ensureBuilt();return this.lefts[a]-this.origin.left},getRightOffset:function(a){this.ensureBuilt();return this.rights[a]},getRightPosition:function(a){this.ensureBuilt();return this.rights[a]-this.origin.left},getWidth:function(a){this.ensureBuilt();return this.rights[a]-this.lefts[a]},getTopOffset:function(a){this.ensureBuilt();return this.tops[a]},getTopPosition:function(a){this.ensureBuilt();return this.tops[a]-
this.origin.top},getBottomOffset:function(a){this.ensureBuilt();return this.bottoms[a]},getBottomPosition:function(a){this.ensureBuilt();return this.bottoms[a]-this.origin.top},getHeight:function(a){this.ensureBuilt();return this.bottoms[a]-this.tops[a]},queryBoundingRect:function(){var a;return 0<this.els.length&&(a=f(this.els.eq(0)),!a.is(document))?n(a):null},isPointInBounds:function(a,b){return this.isLeftInBounds(a)&&this.isTopInBounds(b)},isLeftInBounds:function(a){return!this.boundingRect||
a>=this.boundingRect.left&&a<this.boundingRect.right},isTopInBounds:function(a){return!this.boundingRect||a>=this.boundingRect.top&&a<this.boundingRect.bottom}}),Ca=P.DragListener=ha.extend(Ga,{options:null,subjectEl:null,originX:null,originY:null,scrollEl:null,isInteracting:!1,isDistanceSurpassed:!1,isDelayEnded:!1,isDragging:!1,isTouch:!1,isGeneric:!1,delay:null,delayTimeoutId:null,minDistance:null,shouldCancelTouchScroll:!0,scrollAlwaysKills:!1,constructor:function(a){this.options=a||{}},startInteraction:function(b,
c){if("mousedown"===b.type){if(qa.get().shouldIgnoreMouse()||1!=b.which||b.ctrlKey)return;b.preventDefault()}this.isInteracting||(c=c||{},this.delay=O(c.delay,this.options.delay,0),this.minDistance=O(c.distance,this.options.distance,0),this.subjectEl=this.options.subjectEl,t(a("body")),this.isInteracting=!0,this.isTouch=/^touch/.test(b.type),this.isGeneric="dragstart"===b.type,this.isDistanceSurpassed=this.isDelayEnded=!1,this.originX=e(b),this.originY=l(b),this.scrollEl=f(a(b.target)),this.bindHandlers(),
this.initAutoScroll(),this.handleInteractionStart(b),this.startDelay(b),this.minDistance||this.handleDistanceSurpassed(b))},handleInteractionStart:function(a){this.trigger("interactionStart",a)},endInteraction:function(b,c){this.isInteracting&&(this.endDrag(b),this.delayTimeoutId&&(clearTimeout(this.delayTimeoutId),this.delayTimeoutId=null),this.destroyAutoScroll(),this.unbindHandlers(),this.isInteracting=!1,this.handleInteractionEnd(b,c),a("body").removeClass("fc-unselectable").off("selectstart",
r))},handleInteractionEnd:function(a,b){this.trigger("interactionEnd",a,b||!1)},bindHandlers:function(){var b=qa.get();this.isGeneric?this.listenTo(a(document),{drag:this.handleMove,dragstop:this.endInteraction}):this.isTouch?this.listenTo(b,{touchmove:this.handleTouchMove,touchend:this.endInteraction,scroll:this.handleTouchScroll}):this.listenTo(b,{mousemove:this.handleMouseMove,mouseup:this.endInteraction});this.listenTo(b,{selectstart:r,contextmenu:r})},unbindHandlers:function(){this.stopListeningTo(qa.get());
this.stopListeningTo(a(document))},startDrag:function(a,b){this.startInteraction(a,b);this.isDragging||(this.isDragging=!0,this.handleDragStart(a))},handleDragStart:function(a){this.trigger("dragStart",a)},handleMove:function(a){var b=e(a)-this.originX,c=l(a)-this.originY,d=this.minDistance;this.isDistanceSurpassed||b*b+c*c>=d*d&&this.handleDistanceSurpassed(a);this.isDragging&&this.handleDrag(b,c,a)},handleDrag:function(a,b,c){this.trigger("drag",a,b,c);this.updateAutoScroll(c)},endDrag:function(a){this.isDragging&&
(this.isDragging=!1,this.handleDragEnd(a))},handleDragEnd:function(a){this.trigger("dragEnd",a)},startDelay:function(a){var b=this;this.delay?this.delayTimeoutId=setTimeout(function(){b.handleDelayEnd(a)},this.delay):this.handleDelayEnd(a)},handleDelayEnd:function(a){this.isDelayEnded=!0;this.isDistanceSurpassed&&this.startDrag(a)},handleDistanceSurpassed:function(a){this.isDistanceSurpassed=!0;this.isDelayEnded&&this.startDrag(a)},handleTouchMove:function(a){this.isDragging&&this.shouldCancelTouchScroll&&
a.preventDefault();this.handleMove(a)},handleMouseMove:function(a){this.handleMove(a)},handleTouchScroll:function(a){(!this.isDragging||this.scrollAlwaysKills)&&this.endInteraction(a,!0)},trigger:function(a){this.options[a]&&this.options[a].apply(this,Array.prototype.slice.call(arguments,1));this["_"+a]&&this["_"+a].apply(this,Array.prototype.slice.call(arguments,1))}});Ca.mixin({isAutoScroll:!1,scrollBounds:null,scrollTopVel:null,scrollLeftVel:null,scrollIntervalId:null,scrollSensitivity:30,scrollSpeed:200,
scrollIntervalMs:50,initAutoScroll:function(){var a=this.scrollEl;(this.isAutoScroll=this.options.scroll&&a&&!a.is(window)&&!a.is(document))&&this.listenTo(a,"scroll",Y(this.handleDebouncedScroll,100))},destroyAutoScroll:function(){this.endAutoScroll();this.isAutoScroll&&this.stopListeningTo(this.scrollEl,"scroll")},computeScrollBounds:function(){this.isAutoScroll&&(this.scrollBounds=u(this.scrollEl))},updateAutoScroll:function(a){var b=this.scrollSensitivity,c=this.scrollBounds,d,f,g,h=0,i=0;c&&
(d=(b-(l(a)-c.top))/b,f=(b-(c.bottom-l(a)))/b,g=(b-(e(a)-c.left))/b,a=(b-(c.right-e(a)))/b,0<=d&&1>=d?h=-1*d*this.scrollSpeed:0<=f&&1>=f&&(h=f*this.scrollSpeed),0<=g&&1>=g?i=-1*g*this.scrollSpeed:0<=a&&1>=a&&(i=a*this.scrollSpeed));this.setScrollVel(h,i)},setScrollVel:function(a,b){this.scrollTopVel=a;this.scrollLeftVel=b;this.constrainScrollVel();if((this.scrollTopVel||this.scrollLeftVel)&&!this.scrollIntervalId)this.scrollIntervalId=setInterval(W(this,"scrollIntervalFunc"),this.scrollIntervalMs)},
constrainScrollVel:function(){var a=this.scrollEl;0>this.scrollTopVel?0>=a.scrollTop()&&(this.scrollTopVel=0):0<this.scrollTopVel&&a.scrollTop()+a[0].clientHeight>=a[0].scrollHeight&&(this.scrollTopVel=0);0>this.scrollLeftVel?0>=a.scrollLeft()&&(this.scrollLeftVel=0):0<this.scrollLeftVel&&a.scrollLeft()+a[0].clientWidth>=a[0].scrollWidth&&(this.scrollLeftVel=0)},scrollIntervalFunc:function(){var a=this.scrollEl,b=this.scrollIntervalMs/1E3;this.scrollTopVel&&a.scrollTop(a.scrollTop()+this.scrollTopVel*
b);this.scrollLeftVel&&a.scrollLeft(a.scrollLeft()+this.scrollLeftVel*b);this.constrainScrollVel();!this.scrollTopVel&&!this.scrollLeftVel&&this.endAutoScroll()},endAutoScroll:function(){this.scrollIntervalId&&(clearInterval(this.scrollIntervalId),this.scrollIntervalId=null,this.handleScrollEnd())},handleDebouncedScroll:function(){this.scrollIntervalId||this.handleScrollEnd()},handleScrollEnd:function(){}});var Ya=Ca.extend({component:null,origHit:null,hit:null,coordAdjust:null,constructor:function(a,
b){Ca.call(this,b);this.component=a},handleInteractionStart:function(a){var b=this.subjectEl,c,d,f;this.component.hitsNeeded();this.computeScrollBounds();a?(f=d={left:e(a),top:l(a)},b&&(c=u(b),f={left:Math.min(Math.max(f.left,c.left),c.right),top:Math.min(Math.max(f.top,c.top),c.bottom)}),this.origHit=this.queryHit(f.left,f.top),b&&this.options.subjectCenter&&(this.origHit&&(c=q(this.origHit,c)||c),f={left:(c.left+c.right)/2,top:(c.top+c.bottom)/2}),this.coordAdjust={left:f.left-d.left,top:f.top-
d.top}):this.coordAdjust=this.origHit=null;Ca.prototype.handleInteractionStart.apply(this,arguments)},handleDragStart:function(a){var b;Ca.prototype.handleDragStart.apply(this,arguments);(b=this.queryHit(e(a),l(a)))&&this.handleHitOver(b)},handleDrag:function(a,b,c){var d;Ca.prototype.handleDrag.apply(this,arguments);d=this.queryHit(e(c),l(c));ka(d,this.hit)||(this.hit&&this.handleHitOut(),d&&this.handleHitOver(d))},handleDragEnd:function(){this.handleHitDone();Ca.prototype.handleDragEnd.apply(this,
arguments)},handleHitOver:function(a){var b=ka(a,this.origHit);this.hit=a;this.trigger("hitOver",this.hit,b,this.origHit)},handleHitOut:function(){this.hit&&(this.trigger("hitOut",this.hit),this.handleHitDone(),this.hit=null)},handleHitDone:function(){this.hit&&this.trigger("hitDone",this.hit)},handleInteractionEnd:function(){Ca.prototype.handleInteractionEnd.apply(this,arguments);this.hit=this.origHit=null;this.component.hitsNotNeeded()},handleScrollEnd:function(){Ca.prototype.handleScrollEnd.apply(this,
arguments);this.isDragging&&(this.component.releaseHits(),this.component.prepareHits())},queryHit:function(a,b){this.coordAdjust&&(a+=this.coordAdjust.left,b+=this.coordAdjust.top);return this.component.queryHit(a,b)}});P.touchMouseIgnoreWait=500;var qa=ha.extend(Ga,Ma,{isTouching:!1,mouseIgnoreDepth:0,handleScrollProxy:null,bind:function(){var b=this;this.listenTo(a(document),{touchstart:this.handleTouchStart,touchcancel:this.handleTouchCancel,touchend:this.handleTouchEnd,mousedown:this.handleMouseDown,
mousemove:this.handleMouseMove,mouseup:this.handleMouseUp,click:this.handleClick,selectstart:this.handleSelectStart,contextmenu:this.handleContextMenu});window.addEventListener("touchmove",this.handleTouchMoveProxy=function(c){b.handleTouchMove(a.Event(c))},{passive:!1});window.addEventListener("scroll",this.handleScrollProxy=function(c){b.handleScroll(a.Event(c))},!0)},unbind:function(){this.stopListeningTo(a(document));window.removeEventListener("touchmove",this.handleTouchMoveProxy);window.removeEventListener("scroll",
this.handleScrollProxy,!0)},handleTouchStart:function(a){this.stopTouch(a,!0);this.isTouching=!0;this.trigger("touchstart",a)},handleTouchMove:function(a){this.isTouching&&this.trigger("touchmove",a)},handleTouchCancel:function(a){this.isTouching&&(this.trigger("touchcancel",a),this.stopTouch(a))},handleTouchEnd:function(a){this.stopTouch(a)},handleMouseDown:function(a){this.shouldIgnoreMouse()||this.trigger("mousedown",a)},handleMouseMove:function(a){this.shouldIgnoreMouse()||this.trigger("mousemove",
a)},handleMouseUp:function(a){this.shouldIgnoreMouse()||this.trigger("mouseup",a)},handleClick:function(a){this.shouldIgnoreMouse()||this.trigger("click",a)},handleSelectStart:function(a){this.trigger("selectstart",a)},handleContextMenu:function(a){this.trigger("contextmenu",a)},handleScroll:function(a){this.trigger("scroll",a)},stopTouch:function(a,b){this.isTouching&&(this.isTouching=!1,this.trigger("touchend",a),b||this.startTouchMouseIgnore())},startTouchMouseIgnore:function(){var a=this,b=P.touchMouseIgnoreWait;
b&&(this.mouseIgnoreDepth++,setTimeout(function(){a.mouseIgnoreDepth--},b))},shouldIgnoreMouse:function(){return this.isTouching||Boolean(this.mouseIgnoreDepth)}}),Ra=null,ib=0;qa.get=function(){Ra||(Ra=new qa,Ra.bind());return Ra};qa.needed=function(){qa.get();ib++};qa.unneeded=function(){ib--;ib||(Ra.unbind(),Ra=null)};var sb=ha.extend(Ga,{options:null,sourceEl:null,el:null,parentEl:null,top0:null,left0:null,y0:null,x0:null,topDelta:null,leftDelta:null,isFollowing:!1,isHidden:!1,isAnimating:!1,
constructor:function(b,c){this.options=c=c||{};this.sourceEl=b;this.parentEl=c.parentEl?a(c.parentEl):b.parent()},start:function(b){this.isFollowing||(this.isFollowing=!0,this.y0=l(b),this.x0=e(b),this.leftDelta=this.topDelta=0,this.isHidden||this.updatePosition(),/^touch/.test(b.type)?this.listenTo(a(document),"touchmove",this.handleMove):this.listenTo(a(document),"mousemove",this.handleMove))},stop:function(b,c){function d(){e.isAnimating=!1;e.removeElement();e.top0=e.left0=null;c&&c()}var e=this,
f=this.options.revertDuration;this.isFollowing&&!this.isAnimating&&(this.isFollowing=!1,this.stopListeningTo(a(document)),b&&f&&!this.isHidden?(this.isAnimating=!0,this.el.animate({top:this.top0,left:this.left0},{duration:f,complete:d})):d())},getEl:function(){var a=this.el;a||(a=this.el=this.sourceEl.clone().addClass(this.options.additionalClass||"").css({position:"absolute",visibility:"",display:this.isHidden?"none":"",margin:0,right:"auto",bottom:"auto",width:this.sourceEl.width(),height:this.sourceEl.height(),
opacity:this.options.opacity||"",zIndex:this.options.zIndex}),a.addClass("fc-unselectable"),a.appendTo(this.parentEl));return a},removeElement:function(){this.el&&(this.el.remove(),this.el=null)},updatePosition:function(){var a,b;this.getEl();null===this.top0&&(a=this.sourceEl.offset(),b=this.el.offsetParent().offset(),this.top0=a.top-b.top,this.left0=a.left-b.left);this.el.css({top:this.top0+this.topDelta,left:this.left0+this.leftDelta})},handleMove:function(a){this.topDelta=l(a)-this.y0;this.leftDelta=
e(a)-this.x0;this.isHidden||this.updatePosition()},hide:function(){this.isHidden||(this.isHidden=!0,this.el&&this.el.hide())},show:function(){this.isHidden&&(this.isHidden=!1,this.updatePosition(),this.getEl().show())}}),Ha=P.Grid=ha.extend(Ga,{hasDayInteractions:!0,view:null,isRTL:null,start:null,end:null,el:null,elsByFill:null,eventTimeFormat:null,displayEventTime:null,displayEventEnd:null,minResizeDuration:null,largeUnit:null,dayClickListener:null,daySelectListener:null,segDragListener:null,segResizeListener:null,
externalDragListener:null,constructor:function(a){this.view=a;this.isRTL=a.opt("isRTL");this.elsByFill={};this.dayClickListener=this.buildDayClickListener();this.daySelectListener=this.buildDaySelectListener()},computeEventTimeFormat:function(){return this.view.opt("smallTimeFormat")},computeDisplayEventTime:function(){return!0},computeDisplayEventEnd:function(){return!0},setRange:function(a){this.start=a.start.clone();this.end=a.end.clone();this.rangeUpdated();this.processRangeOptions()},rangeUpdated:function(){},
processRangeOptions:function(){var a=this.view,b;this.eventTimeFormat=a.opt("eventTimeFormat")||a.opt("timeFormat")||this.computeEventTimeFormat();b=a.opt("displayEventTime");null==b&&(b=this.computeDisplayEventTime());a=a.opt("displayEventEnd");null==a&&(a=this.computeDisplayEventEnd());this.displayEventTime=b;this.displayEventEnd=a},spanToSegs:function(){},diffDates:function(a,b){return this.largeUnit?g.duration(Math.round(a.diff(b,this.largeUnit,!0)),this.largeUnit):G(a,b)},hitsNeededDepth:0,hitsNeeded:function(){this.hitsNeededDepth++||
this.prepareHits()},hitsNotNeeded:function(){this.hitsNeededDepth&&!--this.hitsNeededDepth&&this.releaseHits()},prepareHits:function(){},releaseHits:function(){},queryHit:function(){},getSafeHitSpan:function(a){a=this.getHitSpan(a);return!x(a,this.view.activeRange)?null:a},getHitSpan:function(){},getHitEl:function(){},setElement:function(a){this.el=a;this.hasDayInteractions&&(t(a),this.bindDayHandler("touchstart",this.dayTouchStart),this.bindDayHandler("mousedown",this.dayMousedown));this.bindSegHandlers();
this.bindGlobalHandlers()},bindDayHandler:function(b,c){var d=this;this.el.on(b,function(b){if(!a(b.target).is(d.segSelector+","+d.segSelector+" *,.fc-more,a[data-goto]"))return c.call(d,b)})},removeElement:function(){this.unbindGlobalHandlers();this.clearDragListeners();this.el.remove()},renderSkeleton:function(){},renderDates:function(){},unrenderDates:function(){},bindGlobalHandlers:function(){this.listenTo(a(document),{dragstart:this.externalDragStart,sortstart:this.externalDragStart})},unbindGlobalHandlers:function(){this.stopListeningTo(a(document))},
dayMousedown:function(a){var b=this.view;qa.get().shouldIgnoreMouse()||(this.dayClickListener.startInteraction(a),b.opt("selectable")&&this.daySelectListener.startInteraction(a,{distance:b.opt("selectMinDistance")}))},dayTouchStart:function(a){var b=this.view,c;!b.isSelected&&!b.selectedEvent&&(c=b.opt("selectLongPressDelay"),null==c&&(c=b.opt("longPressDelay")),this.dayClickListener.startInteraction(a),b.opt("selectable")&&this.daySelectListener.startInteraction(a,{delay:c}))},buildDayClickListener:function(){var a=
this,b=this.view,c,d=new Ya(this,{scroll:b.opt("dragScroll"),interactionStart:function(){c=d.origHit},hitOver:function(a,b){b||(c=null)},hitOut:function(){c=null},interactionEnd:function(d,e){var f;!e&&c&&(f=a.getSafeHitSpan(c))&&b.triggerDayClick(f,a.getHitEl(c),d)}});d.shouldCancelTouchScroll=!1;d.scrollAlwaysKills=!0;return d},buildDaySelectListener:function(){var a=this,b=this.view,c;return new Ya(this,{scroll:b.opt("dragScroll"),interactionStart:function(){c=null},dragStart:function(){b.unselect()},
hitOver:function(b,d,e){e&&(d=a.getSafeHitSpan(e),b=a.getSafeHitSpan(b),(c=d&&b?a.computeSelection(d,b):null)?a.renderSelection(c):!1===c&&m())},hitOut:function(){c=null;a.unrenderSelection()},hitDone:function(){j()},interactionEnd:function(a,d){!d&&c&&b.reportSelection(c,a)}})},clearDragListeners:function(){this.dayClickListener.endInteraction();this.daySelectListener.endInteraction();this.segDragListener&&this.segDragListener.endInteraction();this.segResizeListener&&this.segResizeListener.endInteraction();
this.externalDragListener&&this.externalDragListener.endInteraction()},renderEventLocationHelper:function(a,b){var c=this.fabricateHelperEvent(a,b);return this.renderHelper(c,b)},fabricateHelperEvent:function(a,b){var c=b?L(b.event):{};c.start=a.start.clone();c.end=a.end?a.end.clone():null;c.allDay=null;this.view.calendar.normalizeEventDates(c);c.className=(c.className||[]).concat("fc-helper");b||(c.editable=!1);return c},renderHelper:function(){},unrenderHelper:function(){},renderSelection:function(a){this.renderHighlight(a)},
unrenderSelection:function(){this.unrenderHighlight()},computeSelection:function(a,b){var c=this.computeSelectionSpan(a,b);return c&&!this.view.calendar.isSelectionSpanAllowed(c)?!1:c},computeSelectionSpan:function(a,b){var c=[a.start,a.end,b.start,b.end];c.sort(U);return{start:c[0].clone(),end:c[3].clone()}},renderHighlight:function(a){this.renderFill("highlight",this.spanToSegs(a))},unrenderHighlight:function(){this.unrenderFill("highlight")},highlightSegClasses:function(){return["fc-highlight"]},
renderBusinessHours:function(){},unrenderBusinessHours:function(){},getNowIndicatorUnit:function(){},renderNowIndicator:function(){},unrenderNowIndicator:function(){},renderFill:function(){},unrenderFill:function(a){var b=this.elsByFill[a];b&&(b.remove(),delete this.elsByFill[a])},renderFillSegEls:function(b,c){var d=this,e=this[b+"SegEl"],f="",g=[],h;if(c.length){for(h=0;h<c.length;h++)f+=this.fillSegHtml(b,c[h]);a(f).each(function(b,f){var ea=c[b],h=a(f);e&&(h=e.call(d,ea,h));h&&(h=a(h),h.is(d.fillSegTag)&&
(ea.el=h,g.push(ea)))})}return g},fillSegTag:"div",fillSegHtml:function(a,b){var c=this[a+"SegClasses"],d=this[a+"SegCss"],c=c?c.call(this,b):[],d=T(d?d.call(this,b):{});return"<"+this.fillSegTag+(c.length?' class="'+c.join(" ")+'"':"")+(d?' style="'+d+'"':"")+" />"},getDayClasses:function(a,b){var c=this.view,d=[],e;H(a,c.activeRange)?(d.push("fc-"+$a[a.day()]),1==c.currentRangeAs("months")&&a.month()!=c.currentRange.start.month()&&d.push("fc-other-month"),e=c.calendar.getNow(),a.isSame(e,"day")?
(d.push("fc-today"),!0!==b&&d.push(c.highlightStateClass)):a<e?d.push("fc-past"):d.push("fc-future")):d.push("fc-disabled-day");return d}});Ha.mixin({segSelector:".fc-event-container > *",mousedOverSeg:null,isDraggingSeg:!1,isResizingSeg:!1,isDraggingExternal:!1,segs:null,renderEvents:function(a){var b=[],c=[],d;for(d=0;d<a.length;d++)(Na(a[d])?b:c).push(a[d]);this.segs=[].concat(this.renderBgEvents(b),this.renderFgEvents(c))},renderBgEvents:function(a){a=this.eventsToSegs(a);return this.renderBgSegs(a)||
a},renderFgEvents:function(a){a=this.eventsToSegs(a);return this.renderFgSegs(a)||a},unrenderEvents:function(){this.handleSegMouseout();this.clearDragListeners();this.unrenderFgSegs();this.unrenderBgSegs();this.segs=null},getEventSegs:function(){return this.segs||[]},renderFgSegs:function(){},unrenderFgSegs:function(){},renderFgSegEls:function(b,c){var d=this.view,e="",f=[],g;if(b.length){for(g=0;g<b.length;g++)e+=this.fgSegHtml(b[g],c);a(e).each(function(c,e){var g=b[c],h=d.resolveEventEl(g.event,
a(e));h&&(h.data("fc-seg",g),g.el=h,f.push(g))})}return f},fgSegHtml:function(){},renderBgSegs:function(a){return this.renderFill("bgEvent",a)},unrenderBgSegs:function(){this.unrenderFill("bgEvent")},bgEventSegEl:function(a,b){return this.view.resolveEventEl(a.event,b)},bgEventSegClasses:function(a){a=a.event;return["fc-bgevent"].concat(a.className,(a.source||{}).className||[])},bgEventSegCss:function(a){return{"background-color":this.getSegSkinCss(a)["background-color"]}},businessHoursSegClasses:function(){return["fc-nonbusiness",
"fc-bgevent"]},buildBusinessHourSegs:function(a,b){return this.eventsToSegs(this.buildBusinessHourEvents(a,b))},buildBusinessHourEvents:function(b,c){var d=this.view.calendar;null==c&&(c=d.opt("businessHours"));d=d.computeBusinessHourEvents(b,c);!d.length&&c&&(d=[a.extend({},pb,{start:this.view.activeRange.end,end:this.view.activeRange.end,dow:null})]);return d},bindSegHandlers:function(){this.bindSegHandlersToEl(this.el)},bindSegHandlersToEl:function(a){this.bindSegHandlerToEl(a,"touchstart",this.handleSegTouchStart);
this.bindSegHandlerToEl(a,"mouseenter",this.handleSegMouseover);this.bindSegHandlerToEl(a,"mouseleave",this.handleSegMouseout);this.bindSegHandlerToEl(a,"mousedown",this.handleSegMousedown);this.bindSegHandlerToEl(a,"click",this.handleSegClick)},bindSegHandlerToEl:function(b,c,d){var e=this;b.on(c,this.segSelector,function(b){var c=a(this).data("fc-seg");if(c&&!e.isDraggingSeg&&!e.isResizingSeg)return d.call(e,c,b)})},handleSegClick:function(a,b){!1===this.view.publiclyTrigger("eventClick",a.el[0],
a.event,b)&&b.preventDefault()},handleSegMouseover:function(a,b){!qa.get().shouldIgnoreMouse()&&!this.mousedOverSeg&&(this.mousedOverSeg=a,this.view.isEventResizable(a.event)&&a.el.addClass("fc-allow-mouse-resize"),this.view.publiclyTrigger("eventMouseover",a.el[0],a.event,b))},handleSegMouseout:function(a,b){b=b||{};this.mousedOverSeg&&(a=a||this.mousedOverSeg,this.mousedOverSeg=null,this.view.isEventResizable(a.event)&&a.el.removeClass("fc-allow-mouse-resize"),this.view.publiclyTrigger("eventMouseout",
a.el[0],a.event,b))},handleSegMousedown:function(a,b){!this.startSegResize(a,b,{distance:5})&&this.view.isEventDraggable(a.event)&&this.buildSegDragListener(a).startInteraction(b,{distance:5})},handleSegTouchStart:function(a,b){var c=this.view,d=a.event,e=c.isEventSelected(d),f=c.isEventDraggable(d),d=c.isEventResizable(d),g=!1;e&&d&&(g=this.startSegResize(a,b));if(!g&&(f||d))d=c.opt("eventLongPressDelay"),null==d&&(d=c.opt("longPressDelay")),c=f?this.buildSegDragListener(a):this.buildSegSelectListener(a),
c.startInteraction(b,{delay:e?0:d})},startSegResize:function(b,c,d){return a(c.target).is(".fc-resizer")?(this.buildSegResizeListener(b,a(c.target).is(".fc-start-resizer")).startInteraction(c,d),!0):!1},buildSegDragListener:function(a){var b=this,c=this.view,d=a.el,e=a.event,f,g,h;if(this.segDragListener)return this.segDragListener;var i=this.segDragListener=new Ya(c,{scroll:c.opt("dragScroll"),subjectEl:d,subjectCenter:!0,interactionStart:function(d){a.component=b;f=!1;g=new sb(a.el,{additionalClass:"fc-dragging",
parentEl:c.el,opacity:i.isTouch?null:c.opt("dragOpacity"),revertDuration:c.opt("dragRevertDuration"),zIndex:2});g.hide();g.start(d)},dragStart:function(d){i.isTouch&&!c.isEventSelected(e)&&c.selectEvent(e);f=!0;b.handleSegMouseout(a,d);b.segDragStart(a,d);c.hideEvent(e)},hitOver:function(d,f,j){var l=!0,k;a.hit&&(j=a.hit);j=j.component.getSafeHitSpan(j);d=d.component.getSafeHitSpan(d);l=j&&d?(h=b.computeEventDrop(j,d,e))&&b.isEventLocationAllowed(h,e):!1;l||(h=null,m());h&&(k=c.renderDrag(h,a))?(k.addClass("fc-dragging"),
i.isTouch||b.applyDragOpacity(k),g.hide()):g.show();f&&(h=null)},hitOut:function(){c.unrenderDrag();g.show();h=null},hitDone:function(){j()},interactionEnd:function(i){delete a.component;g.stop(!h,function(){f&&(c.unrenderDrag(),b.segDragStop(a,i));h?c.reportSegDrop(a,h,b.largeUnit,d,i):c.showEvent(e)});b.segDragListener=null}});return i},buildSegSelectListener:function(a){var b=this,c=this.view,d=a.event;if(this.segDragListener)return this.segDragListener;var e=this.segDragListener=new Ca({dragStart:function(){e.isTouch&&
!c.isEventSelected(d)&&c.selectEvent(d)},interactionEnd:function(){b.segDragListener=null}});return e},segDragStart:function(a,b){this.isDraggingSeg=!0;this.view.publiclyTrigger("eventDragStart",a.el[0],a.event,b,{})},segDragStop:function(a,b){this.isDraggingSeg=!1;this.view.publiclyTrigger("eventDragStop",a.el[0],a.event,b,{})},computeEventDrop:function(a,b,c){var d=this.view.calendar,a=a.start,b=b.start;a.hasTime()===b.hasTime()?(b=this.diffDates(b,a),c.allDay&&A(b)?(c={start:c.start.clone(),end:d.getEventEnd(c),
allDay:!1},d.normalizeEventTimes(c)):c=sa(c),c.start.add(b),c.end&&c.end.add(b)):c={start:b.clone(),end:null,allDay:!b.hasTime()};return c},applyDragOpacity:function(a){var b=this.view.opt("dragOpacity");null!=b&&a.css("opacity",b)},externalDragStart:function(b,c){var d=this.view,e;if(d.opt("droppable")&&(e=a((c?c.item:null)||b.target),d=d.opt("dropAccept"),a.isFunction(d)?d.call(e[0],e):e.is(d)))this.isDraggingExternal||this.listenToExternalDrag(e,b,c)},listenToExternalDrag:function(b,c,d){var e=
this,f=this.view,h,i=P.dataAttrPrefix,l,k,n,p;i&&(i+="-");if(l=b.data(i+"event")||null)l="object"===typeof l?a.extend({},l):{},k=l.start,null==k&&(k=l.time),n=l.duration,p=l.stick,delete l.start,delete l.time,delete l.duration,delete l.stick;null==k&&(k=b.data(i+"start"));null==k&&(k=b.data(i+"time"));null==n&&(n=b.data(i+"duration"));null==p&&(p=b.data(i+"stick"));k=null!=k?g.duration(k):null;n=null!=n?g.duration(n):null;p=Boolean(p);h={eventProps:l,startTime:k,duration:n,stick:p};var s;(e.externalDragListener=
new Ya(this,{interactionStart:function(){e.isDraggingExternal=!0},hitOver:function(a){var b=!0;b=(a=a.component.getSafeHitSpan(a))?(s=e.computeExternalDrop(a,h))&&e.isExternalLocationAllowed(s,h.eventProps):!1;b||(s=null,m());s&&e.renderDrag(s)},hitOut:function(){s=null},hitDone:function(){j();e.unrenderDrag()},interactionEnd:function(a){s&&f.reportExternalDrop(h,s,b,a,d);e.isDraggingExternal=!1;e.externalDragListener=null}})).startDrag(c)},computeExternalDrop:function(a,b){var c={start:this.view.calendar.applyTimezone(a.start),
end:null};b.startTime&&!c.start.hasTime()&&c.start.time(b.startTime);b.duration&&(c.end=c.start.clone().add(b.duration));return c},renderDrag:function(){},unrenderDrag:function(){},buildSegResizeListener:function(a,b){var c=this,d=this.view,e=a.el,f=a.event,g=d.calendar.getEventEnd(f),h,i;return this.segResizeListener=new Ya(this,{scroll:d.opt("dragScroll"),subjectEl:e,interactionStart:function(){h=!1},dragStart:function(b){h=!0;c.handleSegMouseout(a,b);c.segResizeStart(a,b)},hitOver:function(e,h,
j){h=!0;j=c.getSafeHitSpan(j);e=c.getSafeHitSpan(e);h=j&&e?(i=b?c.computeEventStartResize(j,e,f):c.computeEventEndResize(j,e,f))&&c.isEventLocationAllowed(i,f):!1;h?i.start.isSame(f.start.clone().stripZone())&&i.end.isSame(g.clone().stripZone())&&(i=null):(i=null,m());i&&(d.hideEvent(f),c.renderEventResize(i,a))},hitOut:function(){i=null;d.showEvent(f)},hitDone:function(){c.unrenderEventResize();j()},interactionEnd:function(b){h&&c.segResizeStop(a,b);i?d.reportSegResize(a,i,c.largeUnit,e,b):d.showEvent(f);
c.segResizeListener=null}})},segResizeStart:function(a,b){this.isResizingSeg=!0;this.view.publiclyTrigger("eventResizeStart",a.el[0],a.event,b,{})},segResizeStop:function(a,b){this.isResizingSeg=!1;this.view.publiclyTrigger("eventResizeStop",a.el[0],a.event,b,{})},computeEventStartResize:function(a,b,c){return this.computeEventResize("start",a,b,c)},computeEventEndResize:function(a,b,c){return this.computeEventResize("end",a,b,c)},computeEventResize:function(a,b,c,d){var e=this.view.calendar,c=this.diffDates(c[a],
b[a]),b={start:d.start.clone(),end:e.getEventEnd(d),allDay:d.allDay};b.allDay&&A(c)&&(b.allDay=!1,e.normalizeEventTimes(b));b[a].add(c);b.start.isBefore(b.end)||(d=this.minResizeDuration||(d.allDay?e.defaultAllDayEventDuration:e.defaultTimedEventDuration),"start"==a?b.start=b.end.clone().subtract(d):b.end=b.start.clone().add(d));return b},renderEventResize:function(){},unrenderEventResize:function(){},getEventTimeText:function(a,b,c){null==b&&(b=this.eventTimeFormat);null==c&&(c=this.displayEventEnd);
return this.displayEventTime&&a.start.hasTime()?c&&a.end?this.view.formatRange(a,b):a.start.format(b):""},getSegClasses:function(a,b,c){var d=this.view,e=["fc-event",a.isStart?"fc-start":"fc-not-start",a.isEnd?"fc-end":"fc-not-end"].concat(this.getSegCustomClasses(a));b&&e.push("fc-draggable");c&&e.push("fc-resizable");d.isEventSelected(a.event)&&e.push("fc-selected");return e},getSegCustomClasses:function(a){a=a.event;return[].concat(a.className,a.source?a.source.className:[])},getSegSkinCss:function(a){return{"background-color":this.getSegBackgroundColor(a),
"border-color":this.getSegBorderColor(a),color:this.getSegTextColor(a)}},getSegBackgroundColor:function(a){return a.event.backgroundColor||a.event.color||this.getSegDefaultBackgroundColor(a)},getSegDefaultBackgroundColor:function(a){a=a.event.source||{};return a.backgroundColor||a.color||this.view.opt("eventBackgroundColor")||this.view.opt("eventColor")},getSegBorderColor:function(a){return a.event.borderColor||a.event.color||this.getSegDefaultBorderColor(a)},getSegDefaultBorderColor:function(a){a=
a.event.source||{};return a.borderColor||a.color||this.view.opt("eventBorderColor")||this.view.opt("eventColor")},getSegTextColor:function(a){return a.event.textColor||this.getSegDefaultTextColor(a)},getSegDefaultTextColor:function(a){return(a.event.source||{}).textColor||this.view.opt("eventTextColor")},isEventLocationAllowed:function(a,b){if(this.isEventLocationInRange(a)){var c=this.view.calendar,d=this.eventToSpans(a),e;if(d.length){for(e=0;e<d.length;e++)if(!c.isEventSpanAllowed(d[e],b))return!1;
return!0}}return!1},isExternalLocationAllowed:function(a,b){if(this.isEventLocationInRange(a)){var c=this.view.calendar,d=this.eventToSpans(a),e;if(d.length){for(e=0;e<d.length;e++)if(!c.isExternalSpanAllowed(d[e],a,b))return!1;return!0}}return!1},isEventLocationInRange:function(a){return x(this.eventToRawRange(a),this.view.validRange)},eventToSegs:function(a){return this.eventsToSegs([a])},eventToSpans:function(a){var b=this.eventToRange(a);return b?this.eventRangeToSpans(b,a):[]},eventsToSegs:function(b,
c){var d=this,e={},f,g;for(f=0;f<b.length;f++)g=b[f],(e[g._id]||(e[g._id]=[])).push(g);var h=[];a.each(e,function(a,b){var e=[],f=[],g,ea;for(ea=0;ea<b.length;ea++)if(g=d.eventToRange(b[ea]))f.push(g),e.push(b[ea]);if("inverse-background"===O((b[0].source||{}).rendering,b[0].rendering)){f=d.invertRanges(f);for(ea=0;ea<f.length;ea++)h.push.apply(h,d.eventRangeToSegs(f[ea],b[0],c))}else for(ea=0;ea<f.length;ea++)h.push.apply(h,d.eventRangeToSegs(f[ea],e[ea],c))});return h},eventToRange:function(a){return this.refineRawEventRange(this.eventToRawRange(a))},
refineRawEventRange:function(a){var b=this.view,c=b.calendar;if(a=C(a,b.activeRange))return c.localizeMoment(a.start),c.localizeMoment(a.end),a},eventToRawRange:function(a){var b=this.view.calendar,c=a.start.clone().stripZone(),a=(a.end?a.end.clone():b.getDefaultEventEnd(null!=a.allDay?a.allDay:!a.start.hasTime(),a.start)).stripZone();return{start:c,end:a}},eventRangeToSegs:function(a,b,c){var a=this.eventRangeToSpans(a,b),d=[],e;for(e=0;e<a.length;e++)d.push.apply(d,this.eventSpanToSegs(a[e],b,c));
return d},eventRangeToSpans:function(b){return[a.extend({},b)]},eventSpanToSegs:function(a,b,c){var c=c?c(a):this.spanToSegs(a),d,e;for(d=0;d<c.length;d++)e=c[d],a.isStart||(e.isStart=!1),a.isEnd||(e.isEnd=!1),e.event=b,e.eventStartMS=+a.start,e.eventDurationMS=a.end-a.start;return c},invertRanges:function(a){var b=this.view,c=b.activeRange.start.clone(),b=b.activeRange.end.clone(),d=[],e,f;a.sort(Qa);for(e=0;e<a.length;e++)f=a[e],f.start>c&&d.push({start:c,end:f.start}),f.end>c&&(c=f.end);c<b&&d.push({start:c,
end:b});return d},sortEventSegs:function(a){a.sort(W(this,"compareEventSegs"))},compareEventSegs:function(a,b){return a.eventStartMS-b.eventStartMS||a.eventDurationMS-b.eventDurationMS||b.event.allDay-a.event.allDay||parseInt(a.event.id,10)-parseInt(b.event.id,10)||v(a.event,b.event,this.view.eventOrderSpecs)}});P.pluckEventDateProps=sa;P.isBgEvent=Na;P.dataAttrPrefix="";var nb=P.DayTableMixin={breakOnWeeks:!1,dayDates:null,dayIndices:null,daysPerRow:null,rowCnt:null,colCnt:null,colHeadFormat:null,
updateDayTable:function(){for(var a=this.view,b=this.start.clone(),c=-1,d=[],e=[];b.isBefore(this.end);)a.isHiddenDay(b)?d.push(c+0.5):(c++,d.push(c),e.push(b.clone())),b.add(1,"days");if(this.breakOnWeeks){b=e[0].day();for(a=1;a<e.length&&e[a].day()!=b;a++);b=Math.ceil(e.length/a)}else b=1,a=e.length;this.dayDates=e;this.dayIndices=d;this.daysPerRow=a;this.rowCnt=b;this.updateDayTableCols()},updateDayTableCols:function(){this.colCnt=this.computeColCnt();this.colHeadFormat=this.view.opt("columnFormat")||
this.computeColHeadFormat()},computeColCnt:function(){return this.daysPerRow},getCellDate:function(a,b){return this.dayDates[this.getCellDayIndex(a,b)].clone()},getCellRange:function(a,b){var c=this.getCellDate(a,b),d=c.clone().add(1,"days");return{start:c,end:d}},getCellDayIndex:function(a,b){return a*this.daysPerRow+this.getColDayIndex(b)},getColDayIndex:function(a){return this.isRTL?this.colCnt-1-a:a},getDateDayIndex:function(a){var b=this.dayIndices,a=a.diff(this.start,"days");return 0>a?b[0]-
1:a>=b.length?b[b.length-1]+1:b[a]},computeColHeadFormat:function(){return 1<this.rowCnt||10<this.colCnt?"ddd":1<this.colCnt?this.view.opt("dayOfMonthFormat"):"dddd"},sliceRangeByRow:function(a){var b=this.daysPerRow,c=this.view.computeDayRange(a),a=this.getDateDayIndex(c.start),c=this.getDateDayIndex(c.end.clone().subtract(1,"days")),d=[],e,f,g,h;for(e=0;e<this.rowCnt;e++)f=e*b,g=f+b-1,h=Math.max(a,f),g=Math.min(c,g),h=Math.ceil(h),g=Math.floor(g),h<=g&&d.push({row:e,firstRowDayIndex:h-f,lastRowDayIndex:g-
f,isStart:h===a,isEnd:g===c});return d},sliceRangeByDay:function(a){var b=this.daysPerRow,c=this.view.computeDayRange(a),a=this.getDateDayIndex(c.start),c=this.getDateDayIndex(c.end.clone().subtract(1,"days")),d=[],e,f,g,h,i,j;for(e=0;e<this.rowCnt;e++){f=e*b;g=f+b-1;for(h=f;h<=g;h++)i=Math.max(a,h),j=Math.min(c,h),i=Math.ceil(i),j=Math.floor(j),i<=j&&d.push({row:e,firstRowDayIndex:i-f,lastRowDayIndex:j-f,isStart:i===a,isEnd:j===c})}return d},renderHeadHtml:function(){return'<div class="fc-row '+
this.view.widgetHeaderClass+'"><table><thead>'+this.renderHeadTrHtml()+"</thead></table></div>"},renderHeadIntroHtml:function(){return this.renderIntroHtml()},renderHeadTrHtml:function(){return"<tr>"+(this.isRTL?"":this.renderHeadIntroHtml())+this.renderHeadDateCellsHtml()+(this.isRTL?this.renderHeadIntroHtml():"")+"</tr>"},renderHeadDateCellsHtml:function(){var a=[],b,c;for(b=0;b<this.colCnt;b++)c=this.getCellDate(0,b),a.push(this.renderHeadDateCellHtml(c));return a.join("")},renderHeadDateCellHtml:function(a,
b,c){var d=this.view,e=H(a,d.activeRange),f=["fc-day-header",d.widgetHeaderClass],g=I(a.format(this.colHeadFormat));1===this.rowCnt?f=f.concat(this.getDayClasses(a,!0)):f.push("fc-"+$a[a.day()]);return'<th class="'+f.join(" ")+'"'+(1===(e&&this.rowCnt)?' data-date="'+a.format("YYYY-MM-DD")+'"':"")+(1<b?' colspan="'+b+'"':"")+(c?" "+c:"")+">"+(e?d.buildGotoAnchorHtml({date:a,forceOff:1<this.rowCnt||1===this.colCnt},g):g)+"</th>"},renderBgTrHtml:function(a){return"<tr>"+(this.isRTL?"":this.renderBgIntroHtml(a))+
this.renderBgCellsHtml(a)+(this.isRTL?this.renderBgIntroHtml(a):"")+"</tr>"},renderBgIntroHtml:function(){return this.renderIntroHtml()},renderBgCellsHtml:function(a){var b=[],c,d;for(c=0;c<this.colCnt;c++)d=this.getCellDate(a,c),b.push(this.renderBgCellHtml(d));return b.join("")},renderBgCellHtml:function(a,b){var c=this.view,d=H(a,c.activeRange),e=this.getDayClasses(a);e.unshift("fc-day",c.widgetContentClass);return'<td class="'+e.join(" ")+'"'+(d?' data-date="'+a.format("YYYY-MM-DD")+'"':"")+(b?
" "+b:"")+"></td>"},renderIntroHtml:function(){},bookendCells:function(a){var b=this.renderIntroHtml();b&&(this.isRTL?a.append(b):a.prepend(b))}},eb=P.DayGrid=Ha.extend(nb,{numbersVisible:!1,bottomCoordPadding:0,rowEls:null,cellEls:null,helperEls:null,rowCoordCache:null,colCoordCache:null,renderDates:function(a){var b=this.view,c=this.rowCnt,d=this.colCnt,e="",f;for(f=0;f<c;f++)e+=this.renderDayRowHtml(f,a);this.el.html(e);this.rowEls=this.el.find(".fc-row");this.cellEls=this.el.find(".fc-day, .fc-disabled-day");
this.rowCoordCache=new db({els:this.rowEls,isVertical:!0});this.colCoordCache=new db({els:this.cellEls.slice(0,this.colCnt),isHorizontal:!0});for(f=0;f<c;f++)for(a=0;a<d;a++)b.publiclyTrigger("dayRender",null,this.getCellDate(f,a),this.getCellEl(f,a))},unrenderDates:function(){this.removeSegPopover()},renderBusinessHours:function(){var a=this.buildBusinessHourSegs(!0);this.renderFill("businessHours",a,"bgevent")},unrenderBusinessHours:function(){this.unrenderFill("businessHours")},renderDayRowHtml:function(a,
b){var c=["fc-row","fc-week",this.view.widgetContentClass];b&&c.push("fc-rigid");return'<div class="'+c.join(" ")+'"><div class="fc-bg"><table>'+this.renderBgTrHtml(a)+'</table></div><div class="fc-content-skeleton"><table>'+(this.numbersVisible?"<thead>"+this.renderNumberTrHtml(a)+"</thead>":"")+"</table></div></div>"},renderNumberTrHtml:function(a){return"<tr>"+(this.isRTL?"":this.renderNumberIntroHtml(a))+this.renderNumberCellsHtml(a)+(this.isRTL?this.renderNumberIntroHtml(a):"")+"</tr>"},renderNumberIntroHtml:function(){return this.renderIntroHtml()},
renderNumberCellsHtml:function(a){var b=[],c,d;for(c=0;c<this.colCnt;c++)d=this.getCellDate(a,c),b.push(this.renderNumberCellHtml(d));return b.join("")},renderNumberCellHtml:function(a){var b=this.view,c="",d=H(a,b.activeRange),e=b.dayNumbersVisible&&d,f,g;if(!e&&!b.cellWeekNumbersVisible)return"<td/>";f=this.getDayClasses(a);f.unshift("fc-day-top");b.cellWeekNumbersVisible&&(g="ISO"===a._locale._fullCalendar_weekCalc?1:a._locale.firstDayOfWeek());c+='<td class="'+f.join(" ")+'"'+(d?' data-date="'+
a.format()+'"':"")+">";b.cellWeekNumbersVisible&&a.day()==g&&(c+=b.buildGotoAnchorHtml({date:a,type:"week"},{"class":"fc-week-number"},a.format("w")));e&&(c+=b.buildGotoAnchorHtml(a,{"class":"fc-day-number"},a.date()));return c+"</td>"},computeEventTimeFormat:function(){return this.view.opt("extraSmallTimeFormat")},computeDisplayEventEnd:function(){return 1==this.colCnt},rangeUpdated:function(){this.updateDayTable()},spanToSegs:function(a){var a=this.sliceRangeByRow(a),b,c;for(b=0;b<a.length;b++)c=
a[b],this.isRTL?(c.leftCol=this.daysPerRow-1-c.lastRowDayIndex,c.rightCol=this.daysPerRow-1-c.firstRowDayIndex):(c.leftCol=c.firstRowDayIndex,c.rightCol=c.lastRowDayIndex);return a},prepareHits:function(){this.colCoordCache.build();this.rowCoordCache.build();this.rowCoordCache.bottoms[this.rowCnt-1]+=this.bottomCoordPadding},releaseHits:function(){this.colCoordCache.clear();this.rowCoordCache.clear()},queryHit:function(a,b){if(this.colCoordCache.isLeftInBounds(a)&&this.rowCoordCache.isTopInBounds(b)){var c=
this.colCoordCache.getHorizontalIndex(a),d=this.rowCoordCache.getVerticalIndex(b);if(null!=d&&null!=c)return this.getCellHit(d,c)}},getHitSpan:function(a){return this.getCellRange(a.row,a.col)},getHitEl:function(a){return this.getCellEl(a.row,a.col)},getCellHit:function(a,b){return{row:a,col:b,component:this,left:this.colCoordCache.getLeftOffset(b),right:this.colCoordCache.getRightOffset(b),top:this.rowCoordCache.getTopOffset(a),bottom:this.rowCoordCache.getBottomOffset(a)}},getCellEl:function(a,
b){return this.cellEls.eq(a*this.colCnt+b)},renderDrag:function(a,b){var c=this.eventToSpans(a),d;for(d=0;d<c.length;d++)this.renderHighlight(c[d]);if(b&&b.component!==this)return this.renderEventLocationHelper(a,b)},unrenderDrag:function(){this.unrenderHighlight();this.unrenderHelper()},renderEventResize:function(a,b){var c=this.eventToSpans(a),d;for(d=0;d<c.length;d++)this.renderHighlight(c[d]);return this.renderEventLocationHelper(a,b)},unrenderEventResize:function(){this.unrenderHighlight();this.unrenderHelper()},
renderHelper:function(b,c){var d=[],e=this.eventToSegs(b),f,e=this.renderFgSegEls(e);f=this.renderSegRows(e);this.rowEls.each(function(b,e){var g=a(e),h=a('<div class="fc-helper-skeleton"><table/></div>'),ea;ea=c&&c.row===b?c.el.position().top:g.find(".fc-content-skeleton tbody").position().top;h.css("top",ea).find("table").append(f[b].tbodyEl);g.append(h);d.push(h[0])});return this.helperEls=a(d)},unrenderHelper:function(){this.helperEls&&(this.helperEls.remove(),this.helperEls=null)},fillSegTag:"td",
renderFill:function(b,c,d){var e=[],f,g,h,c=this.renderFillSegEls(b,c);for(f=0;f<c.length;f++)g=c[f],h=this.renderFillRow(b,g,d),this.rowEls.eq(g.row).append(h),e.push(h[0]);this.elsByFill[b]=a(e);return c},renderFillRow:function(b,c,d){var e=this.colCnt,f=c.leftCol,g=c.rightCol+1,d=d||b.toLowerCase(),b=a('<div class="fc-'+d+'-skeleton"><table><tr/></table></div>'),d=b.find("tr");0<f&&d.append('<td colspan="'+f+'"/>');d.append(c.el.attr("colspan",g-f));g<e&&d.append('<td colspan="'+(e-g)+'"/>');this.bookendCells(d);
return b}});eb.mixin({rowStructs:null,unrenderEvents:function(){this.removeSegPopover();Ha.prototype.unrenderEvents.apply(this,arguments)},getEventSegs:function(){return Ha.prototype.getEventSegs.call(this).concat(this.popoverSegs||[])},renderBgSegs:function(b){b=a.grep(b,function(a){return a.event.allDay});return Ha.prototype.renderBgSegs.call(this,b)},renderFgSegs:function(b){var c,b=this.renderFgSegEls(b);c=this.rowStructs=this.renderSegRows(b);this.rowEls.each(function(b,d){a(d).find(".fc-content-skeleton > table").append(c[b].tbodyEl)});
return b},unrenderFgSegs:function(){for(var a=this.rowStructs||[],b;b=a.pop();)b.tbodyEl.remove();this.rowStructs=null},renderSegRows:function(a){var b=[],c,a=this.groupSegRows(a);for(c=0;c<a.length;c++)b.push(this.renderSegRow(c,a[c]));return b},fgSegHtml:function(a,b){var c=this.view,d=a.event,e=c.isEventDraggable(d),f=!b&&d.allDay&&a.isStart&&c.isEventResizableFromStart(d),c=!b&&d.allDay&&a.isEnd&&c.isEventResizableFromEnd(d),e=this.getSegClasses(a,e,f||c),g=T(this.getSegSkinCss(a)),h="",i;e.unshift("fc-day-grid-event",
"fc-h-event");a.isStart&&(i=this.getEventTimeText(d))&&(h='<span class="fc-time">'+I(i)+"</span>");i='<span class="fc-title">'+(I(d.title||"")||"&nbsp;")+"</span>";return'<a class="'+e.join(" ")+'"'+(d.url?' href="'+I(d.url)+'"':"")+(g?' style="'+g+'"':"")+'><div class="fc-content">'+(this.isRTL?i+" "+h:h+" "+i)+"</div>"+(f?'<div class="fc-resizer fc-start-resizer" />':"")+(c?'<div class="fc-resizer fc-end-resizer" />':"")+"</a>"},renderSegRow:function(b,c){function d(b){for(;n<b;)(q=(l[m-1]||[])[n])?
q.attr("rowspan",parseInt(q.attr("rowspan")||1,10)+1):(q=a("<td/>"),p.append(q)),j[m][n]=q,l[m][n]=q,n++}var e=this.colCnt,f=this.buildSegLevels(c),g=Math.max(1,f.length),h=a("<tbody/>"),i=[],j=[],l=[],m,k,n,p,s,r,q;for(m=0;m<g;m++){k=f[m];n=0;p=a("<tr/>");i.push([]);j.push([]);l.push([]);if(k)for(s=0;s<k.length;s++){r=k[s];d(r.leftCol);q=a('<td class="fc-event-container"/>').append(r.el);for(r.leftCol!=r.rightCol?q.attr("colspan",r.rightCol-r.leftCol+1):l[m][n]=q;n<=r.rightCol;)j[m][n]=q,i[m][n]=
r,n++;p.append(q)}d(e);this.bookendCells(p);h.append(p)}return{row:b,tbodyEl:h,cellMatrix:j,segMatrix:i,segLevels:f,segs:c}},buildSegLevels:function(a){var b=[],c,d,e;this.sortEventSegs(a);for(c=0;c<a.length;c++){d=a[c];for(e=0;e<b.length;e++){var f;a:{f=b[e];for(var g=void 0,h=void 0,g=0;g<f.length;g++)if(h=f[g],h.leftCol<=d.rightCol&&h.rightCol>=d.leftCol){f=!0;break a}f=!1}if(!f)break}d.level=e;(b[e]||(b[e]=[])).push(d)}for(e=0;e<b.length;e++)b[e].sort(Xa);return b},groupSegRows:function(a){var b=
[],c;for(c=0;c<this.rowCnt;c++)b.push([]);for(c=0;c<a.length;c++)b[a[c].row].push(a[c]);return b}});eb.mixin({segPopover:null,popoverSegs:null,removeSegPopover:function(){this.segPopover&&this.segPopover.hide()},limitRows:function(a){var b=this.rowStructs||[],c,d;for(c=0;c<b.length;c++)this.unlimitRow(c),d=a?"number"===typeof a?a:this.computeRowLevelLimit(c):!1,!1!==d&&this.limitRow(c,d)},computeRowLevelLimit:function(b){function c(b,d){g=Math.max(g,a(d).outerHeight())}var d=this.rowEls.eq(b).height(),
b=this.rowStructs[b].tbodyEl.children(),e,f,g;for(e=0;e<b.length;e++)if(f=b.eq(e).removeClass("fc-limited"),g=0,f.find("> td > :first-child").each(c),f.position().top+g>d)return e;return!1},limitRow:function(b,c){function d(f){for(;h<f;)n=e.getCellSegs(b,h,c),n.length&&(q=j[c-1][h],x=e.renderMoreLink(b,h,n),w=a("<div/>").append(x),q.append(w),g.push(w[0])),h++}var e=this,f=this.rowStructs[b],g=[],h=0,i,j,l,m,k,n,p,s,q,r,t,y,w,x;if(c&&c<f.segLevels.length){i=f.segLevels[c-1];j=f.cellMatrix;l=f.tbodyEl.children().slice(c).addClass("fc-limited").get();
for(m=0;m<i.length;m++){k=i[m];d(k.leftCol);s=[];for(p=0;h<=k.rightCol;)n=this.getCellSegs(b,h,c),s.push(n),p+=n.length,h++;if(p){q=j[c-1][k.leftCol];p=q.attr("rowspan")||1;r=[];for(t=0;t<s.length;t++)y=a('<td class="fc-more-cell"/>').attr("rowspan",p),n=s[t],x=this.renderMoreLink(b,k.leftCol+t,[k].concat(n)),w=a("<div/>").append(x),y.append(w),r.push(y[0]),g.push(y[0]);q.addClass("fc-limited").after(a(r));l.push(q[0])}}d(this.colCnt);f.moreEls=a(g);f.limitedEls=a(l)}},unlimitRow:function(a){a=this.rowStructs[a];
a.moreEls&&(a.moreEls.remove(),a.moreEls=null);a.limitedEls&&(a.limitedEls.removeClass("fc-limited"),a.limitedEls=null)},renderMoreLink:function(b,c,d){var e=this,f=this.view;return a('<a class="fc-more"/>').text(this.getMoreLinkText(d.length)).on("click",function(g){var h=f.opt("eventLimitClick"),i=e.getCellDate(b,c),j=a(this),l=e.getCellEl(b,c),m=e.getCellSegs(b,c),m=e.resliceDaySegs(m,i),k=e.resliceDaySegs(d,i);"function"===typeof h&&(h=f.publiclyTrigger("eventLimitClick",null,{date:i,dayEl:l,
moreEl:j,segs:m,hiddenSegs:k},g));"popover"===h?e.showSegPopover(b,c,j,m):"string"===typeof h&&f.calendar.zoomTo(i,h)})},showSegPopover:function(a,b,c,d){var e=this,f=this.view,c=c.parent(),g;g=1==this.rowCnt?f.el:this.rowEls.eq(a);a={className:"fc-more-popover",content:this.renderSegPopoverContent(a,b,d),parentEl:this.view.el,top:g.offset().top,autoHide:!0,viewportConstrain:f.opt("popoverViewportConstrain"),hide:function(){if(e.popoverSegs)for(var a,b=0;b<e.popoverSegs.length;++b)a=e.popoverSegs[b],
f.publiclyTrigger("eventDestroy",a.event,a.event,a.el);e.segPopover.removeElement();e.segPopover=null;e.popoverSegs=null}};this.isRTL?a.right=c.offset().left+c.outerWidth()+1:a.left=c.offset().left-1;this.segPopover=new rb(a);this.segPopover.show();this.bindSegHandlersToEl(this.segPopover.el)},renderSegPopoverContent:function(b,c,d){var e=this.view,f=e.opt("theme"),g=this.getCellDate(b,c).format(e.opt("dayPopoverFormat")),e=a('<div class="fc-header '+e.widgetHeaderClass+'"><span class="fc-close '+
(f?"ui-icon ui-icon-closethick":"fc-icon fc-icon-x")+'"></span><span class="fc-title">'+I(g)+'</span><div class="fc-clear"/></div><div class="fc-body '+e.widgetContentClass+'"><div class="fc-event-container"></div></div>'),f=e.find(".fc-event-container");this.popoverSegs=d=this.renderFgSegEls(d,!0);for(g=0;g<d.length;g++)this.hitsNeeded(),d[g].hit=this.getCellHit(b,c),this.hitsNotNeeded(),f.append(d[g].el);return e},resliceDaySegs:function(b,c){var d=a.map(b,function(a){return a.event}),e=c.clone(),
f=e.clone().add(1,"days"),g={start:e,end:f},b=this.eventsToSegs(d,function(a){return(a=C(a,g))?[a]:[]});this.sortEventSegs(b);return b},getMoreLinkText:function(a){var b=this.view.opt("eventLimitText");return"function"===typeof b?b(a):"+"+a+" "+b},getCellSegs:function(a,b,c){for(var a=this.rowStructs[a].segMatrix,c=c||0,d=[],e;c<a.length;)(e=a[c][b])&&d.push(e),c++;return d}});var ob=P.TimeGrid=Ha.extend(nb,{slotDuration:null,snapDuration:null,snapsPerSlot:null,labelFormat:null,labelInterval:null,
colEls:null,slatContainerEl:null,slatEls:null,nowIndicatorEls:null,colCoordCache:null,slatCoordCache:null,constructor:function(){Ha.apply(this,arguments);this.processOptions()},renderDates:function(){this.el.html(this.renderHtml());this.colEls=this.el.find(".fc-day, .fc-disabled-day");this.slatContainerEl=this.el.find(".fc-slats");this.slatEls=this.slatContainerEl.find("tr");this.colCoordCache=new db({els:this.colEls,isHorizontal:!0});this.slatCoordCache=new db({els:this.slatEls,isVertical:!0});this.renderContentSkeleton()},
renderHtml:function(){return'<div class="fc-bg"><table>'+this.renderBgTrHtml(0)+'</table></div><div class="fc-slats"><table>'+this.renderSlatRowHtml()+"</table></div>"},renderSlatRowHtml:function(){for(var a=this.view,b=this.isRTL,c="",d=g.duration(+this.view.minTime),e,f,h;d<this.view.maxTime;)e=this.start.clone().time(d),f=aa(F(d,this.labelInterval)),h='<td class="fc-axis fc-time notranslate '+a.widgetContentClass+'" '+a.axisStyleAttr()+">"+(f?"<span>"+I(e.format(this.labelFormat))+"</span>":"")+
"</td>",c+='<tr data-time="'+e.format("HH:mm:ss")+'"'+(f?"":' class="fc-minor"')+">"+(!b?h:"")+'<td class="'+a.widgetContentClass+'"/>'+(b?h:"")+"</tr>",d.add(this.slotDuration);return c},processOptions:function(){var b=this.view,c=b.opt("slotDuration"),d=b.opt("snapDuration"),c=g.duration(c),d=d?g.duration(d):c;this.slotDuration=c;this.snapDuration=d;this.snapsPerSlot=c/d;this.minResizeDuration=d;d=b.opt("slotLabelFormat");a.isArray(d)&&(d=d[d.length-1]);this.labelFormat=d||b.opt("smallTimeFormat");
this.labelInterval=(d=b.opt("slotLabelInterval"))?g.duration(d):this.computeLabelInterval(c)},computeLabelInterval:function(a){var b,c,d;for(b=qb.length-1;0<=b;b--)if(c=g.duration(qb[b]),d=F(c,a),aa(d)&&1<d)return c;return g.duration(a)},computeEventTimeFormat:function(){return this.view.opt("noMeridiemTimeFormat")},computeDisplayEventEnd:function(){return!0},prepareHits:function(){this.colCoordCache.build();this.slatCoordCache.build()},releaseHits:function(){this.colCoordCache.clear()},queryHit:function(a,
b){var c=this.snapsPerSlot,d=this.colCoordCache,e=this.slatCoordCache;if(d.isLeftInBounds(a)&&e.isTopInBounds(b)){var f=d.getHorizontalIndex(a),g=e.getVerticalIndex(b);if(null!=f&&null!=g){var h=e.getTopOffset(g),i=e.getHeight(g),e=Math.floor((b-h)/i*c),j=h+e/c*i,h=h+(e+1)/c*i;return{col:f,snap:g*c+e,component:this,left:d.getLeftOffset(f),right:d.getRightOffset(f),top:j,bottom:h}}}},getHitSpan:function(a){var b=this.getCellDate(0,a.col),a=this.computeSnapTime(a.snap);b.time(a);a=b.clone().add(this.snapDuration);
return{start:b,end:a}},getHitEl:function(a){return this.colEls.eq(a.col)},rangeUpdated:function(){this.updateDayTable()},computeSnapTime:function(a){return g.duration(this.view.minTime+this.snapDuration*a)},spanToSegs:function(a){var a=this.sliceRangeByTimes(a),b;for(b=0;b<a.length;b++)a[b].col=this.isRTL?this.daysPerRow-1-a[b].dayIndex:a[b].dayIndex;return a},sliceRangeByTimes:function(a){var b=[],c,d;for(d=0;d<this.daysPerRow;d++)if(c=this.dayDates[d].clone().time(0),c={start:c.clone().add(this.view.minTime),
end:c.clone().add(this.view.maxTime)},c=C(a,c))c.dayIndex=d,b.push(c);return b},updateSize:function(a){this.slatCoordCache.build();a&&this.updateSegVerticals([].concat(this.fgSegs||[],this.bgSegs||[],this.businessSegs||[]))},getTotalSlatHeight:function(){return this.slatContainerEl.outerHeight()},computeDateTop:function(a,b){return this.computeTimeTop(g.duration(a-b.clone().stripTime()))},computeTimeTop:function(a){var b=this.slatEls.length,c=(a-this.view.minTime)/this.slotDuration,c=Math.max(0,c),
c=Math.min(b,c),a=Math.floor(c),a=Math.min(a,b-1),b=c-a;return this.slatCoordCache.getTopPosition(a)+this.slatCoordCache.getHeight(a)*b},renderDrag:function(a,b){var c,d;if(b)return this.renderEventLocationHelper(a,b);c=this.eventToSpans(a);for(d=0;d<c.length;d++)this.renderHighlight(c[d])},unrenderDrag:function(){this.unrenderHelper();this.unrenderHighlight()},renderEventResize:function(a,b){return this.renderEventLocationHelper(a,b)},unrenderEventResize:function(){this.unrenderHelper()},renderHelper:function(a,
b){return this.renderHelperSegs(this.eventToSegs(a),b)},unrenderHelper:function(){this.unrenderHelperSegs()},renderBusinessHours:function(){this.renderBusinessSegs(this.buildBusinessHourSegs())},unrenderBusinessHours:function(){this.unrenderBusinessSegs()},getNowIndicatorUnit:function(){return"minute"},renderNowIndicator:function(b){var c=this.spanToSegs({start:b,end:b}),b=this.computeDateTop(b,b),d=[],e;for(e=0;e<c.length;e++)d.push(a('<div class="fc-now-indicator fc-now-indicator-line"></div>').css("top",
b).appendTo(this.colContainerEls.eq(c[e].col))[0]);0<c.length&&d.push(a('<div class="fc-now-indicator fc-now-indicator-arrow"></div>').css("top",b).appendTo(this.el.find(".fc-content-skeleton"))[0]);this.nowIndicatorEls=a(d)},unrenderNowIndicator:function(){this.nowIndicatorEls&&(this.nowIndicatorEls.remove(),this.nowIndicatorEls=null)},renderSelection:function(a){this.view.opt("selectHelper")?this.renderEventLocationHelper(a):this.renderHighlight(a)},unrenderSelection:function(){this.unrenderHelper();
this.unrenderHighlight()},renderHighlight:function(a){this.renderHighlightSegs(this.spanToSegs(a))},unrenderHighlight:function(){this.unrenderHighlightSegs()}});ob.mixin({colContainerEls:null,fgContainerEls:null,bgContainerEls:null,helperContainerEls:null,highlightContainerEls:null,businessContainerEls:null,fgSegs:null,bgSegs:null,helperSegs:null,highlightSegs:null,businessSegs:null,renderContentSkeleton:function(){var b="",c;for(c=0;c<this.colCnt;c++)b+='<td><div class="fc-content-col"><div class="fc-event-container fc-helper-container"></div><div class="fc-event-container"></div><div class="fc-highlight-container"></div><div class="fc-bgevent-container"></div><div class="fc-business-container"></div></div></td>';
b=a('<div class="fc-content-skeleton"><table><tr>'+b+"</tr></table></div>");this.colContainerEls=b.find(".fc-content-col");this.helperContainerEls=b.find(".fc-helper-container");this.fgContainerEls=b.find(".fc-event-container:not(.fc-helper-container)");this.bgContainerEls=b.find(".fc-bgevent-container");this.highlightContainerEls=b.find(".fc-highlight-container");this.businessContainerEls=b.find(".fc-business-container");this.bookendCells(b.find("tr"));this.el.append(b)},renderFgSegs:function(a){return this.fgSegs=
a=this.renderFgSegsIntoContainers(a,this.fgContainerEls)},unrenderFgSegs:function(){this.unrenderNamedSegs("fgSegs")},renderHelperSegs:function(b,c){var d=[],e,f,g,b=this.renderFgSegsIntoContainers(b,this.helperContainerEls);for(e=0;e<b.length;e++)f=b[e],c&&c.col===f.col&&(g=c.el,f.el.css({left:g.css("left"),right:g.css("right"),"margin-left":g.css("margin-left"),"margin-right":g.css("margin-right")})),d.push(f.el[0]);this.helperSegs=b;return a(d)},unrenderHelperSegs:function(){this.unrenderNamedSegs("helperSegs")},
renderBgSegs:function(a){a=this.renderFillSegEls("bgEvent",a);this.updateSegVerticals(a);this.attachSegsByCol(this.groupSegsByCol(a),this.bgContainerEls);return this.bgSegs=a},unrenderBgSegs:function(){this.unrenderNamedSegs("bgSegs")},renderHighlightSegs:function(a){a=this.renderFillSegEls("highlight",a);this.updateSegVerticals(a);this.attachSegsByCol(this.groupSegsByCol(a),this.highlightContainerEls);this.highlightSegs=a},unrenderHighlightSegs:function(){this.unrenderNamedSegs("highlightSegs")},
renderBusinessSegs:function(a){a=this.renderFillSegEls("businessHours",a);this.updateSegVerticals(a);this.attachSegsByCol(this.groupSegsByCol(a),this.businessContainerEls);this.businessSegs=a},unrenderBusinessSegs:function(){this.unrenderNamedSegs("businessSegs")},groupSegsByCol:function(a){var b=[],c;for(c=0;c<this.colCnt;c++)b.push([]);for(c=0;c<a.length;c++)b[a[c].col].push(a[c]);return b},attachSegsByCol:function(a,b){var c,d,e;for(c=0;c<this.colCnt;c++){d=a[c];for(e=0;e<d.length;e++)b.eq(c).append(d[e].el)}},
unrenderNamedSegs:function(a){var b=this[a],c;if(b){for(c=0;c<b.length;c++)b[c].el.remove();this[a]=null}},renderFgSegsIntoContainers:function(a,b){var c,d,a=this.renderFgSegEls(a);c=this.groupSegsByCol(a);for(d=0;d<this.colCnt;d++)this.updateFgSegCoords(c[d]);this.attachSegsByCol(c,b);return a},fgSegHtml:function(a,b){var c=this.view,d=a.event,e=c.isEventDraggable(d),f=!b&&a.isStart&&c.isEventResizableFromStart(d),h=!b&&a.isEnd&&c.isEventResizableFromEnd(d),e=this.getSegClasses(a,e,f||h),f=T(this.getSegSkinCss(a)),
i,j,l;e.unshift("fc-time-grid-event","fc-v-event");30>=g.duration(a.end-a.start).asMinutes()&&e.push("event-min-time");30<g.duration(a.end-a.start).asMinutes()&&60>=g.duration(a.end-a.start).asMinutes()&&e.push("event-hour-time");if(c.isMultiDayEvent(d)){if(a.isStart||a.isEnd)i=this.getEventTimeText(a),j=this.getEventTimeText(a,"LT"),l=this.getEventTimeText(a,null,!1)}else i=this.getEventTimeText(d),j=this.getEventTimeText(d,"LT"),l=this.getEventTimeText(d,null,!1);return'<a class="'+e.join(" ")+
'"'+(d.url?' href="'+I(d.url)+'"':"")+(f?' style="'+f+'"':"")+'><div class="fc-content">'+(i?'<div class="fc-time" data-start="'+I(l)+'" data-full="'+I(j)+'"><span>'+I(i)+"</span></div>":"")+(d.title?'<div class="fc-title">'+I(d.title)+"</div>":"")+'</div><div class="fc-bg"/>'+(h?'<div class="fc-resizer fc-end-resizer" />':"")+"</a>"},updateSegVerticals:function(a){this.computeSegVerticals(a);this.assignSegVerticals(a)},computeSegVerticals:function(a){var b,c,d;for(b=0;b<a.length;b++)c=a[b],d=this.dayDates[c.dayIndex],
c.top=this.computeDateTop(c.start,d),c.bottom=this.computeDateTop(c.end,d)},assignSegVerticals:function(a){var b,c;for(b=0;b<a.length;b++)c=a[b],c.el.css(this.generateSegVerticalCss(c))},generateSegVerticalCss:function(a){return{top:a.top+1,height:a.bottom-a.top-2}},updateFgSegCoords:function(a){this.computeSegVerticals(a);this.computeFgSegHorizontals(a);this.assignSegVerticals(a);this.assignFgSegHorizontals(a)},computeFgSegHorizontals:function(a){var b;this.sortEventSegs(a);b=[];var c,d,e;for(c=
0;c<a.length;c++){d=a[c];for(e=0;e<b.length&&ya(d,b[e]).length;e++);d.level=e;(b[e]||(b[e]=[])).push(d)}for(var f,a=0;a<b.length;a++){c=b[a];for(d=0;d<c.length;d++){e=c[d];e.forwardSegs=[];for(f=a+1;f<b.length;f++)ya(e,b[f],e.forwardSegs)}}if(b=b[0]){for(a=0;a<b.length;a++)Ba(b[a]);for(a=0;a<b.length;a++)this.computeFgSegForwardBack(b[a],0,0)}},computeFgSegForwardBack:function(a,b,c){var d=a.forwardSegs;if(void 0===a.forwardCoord){d.length?(this.sortForwardSegs(d),this.computeFgSegForwardBack(d[0],
b+1,c),a.forwardCoord=d[0].backwardCoord):a.forwardCoord=1;a.backwardCoord=a.forwardCoord-(a.forwardCoord-c)/(b+1);for(b=0;b<d.length;b++)this.computeFgSegForwardBack(d[b],0,a.forwardCoord)}},sortForwardSegs:function(a){a.sort(W(this,"compareForwardSegs"))},compareForwardSegs:function(a,b){return b.forwardPressure-a.forwardPressure||(a.backwardCoord||0)-(b.backwardCoord||0)||this.compareEventSegs(a,b)},assignFgSegHorizontals:function(a){var b,c;for(b=0;b<a.length;b++)c=a[b],c.el.css(this.generateFgSegHorizontalCss(c)),
30>c.bottom-c.top&&c.el.addClass("fc-short")},generateFgSegHorizontalCss:function(a){var b=this.view.opt("slotEventOverlap"),c=a.backwardCoord,d=a.forwardCoord,e=this.generateSegVerticalCss(a),f;b&&(d=Math.min(1,c+2*(d-c)));this.isRTL?f=1-d:(f=c,c=1-d);e.zIndex=a.level+1;e.left=100*f+"%";e.right=100*c+"%";b&&a.forwardPressure&&(e[this.isRTL?"marginLeft":"marginRight"]=20);return e}});var Ea=P.View=ra.extend({type:null,name:null,title:null,calendar:null,viewSpec:null,options:null,el:null,renderQueue:null,
batchRenderDepth:0,isDatesRendered:!1,isEventsRendered:!1,isBaseRendered:!1,queuedScroll:null,isRTL:!1,isSelected:!1,selectedEvent:null,eventOrderSpecs:null,widgetHeaderClass:null,widgetContentClass:null,highlightStateClass:null,nextDayThreshold:null,isHiddenDayHash:null,isNowIndicatorRendered:null,initialNowDate:null,initialNowQueriedMs:null,nowIndicatorTimeoutID:null,nowIndicatorIntervalID:null,constructor:function(a,b){ra.prototype.constructor.call(this);this.calendar=a;this.viewSpec=b;this.type=
b.type;this.options=b.options;this.name=this.type;this.nextDayThreshold=g.duration(this.opt("nextDayThreshold"));this.initThemingProps();this.initHiddenDays();this.isRTL=this.opt("isRTL");this.eventOrderSpecs=D(this.opt("eventOrder"));this.renderQueue=this.buildRenderQueue();this.initAutoBatchRender();this.initialize()},buildRenderQueue:function(){var a=this,b=new Ka({event:this.opt("eventRenderWait")});b.on("start",function(){a.freezeHeight();a.addScroll(a.queryScroll())});b.on("stop",function(){a.thawHeight();
a.popScroll()});return b},initAutoBatchRender:function(){var a=this;this.on("before:change",function(){a.startBatchRender()});this.on("change",function(){a.stopBatchRender()})},startBatchRender:function(){this.batchRenderDepth++||this.renderQueue.pause()},stopBatchRender:function(){--this.batchRenderDepth||this.renderQueue.resume()},initialize:function(){},opt:function(a){return this.options[a]},publiclyTrigger:function(a,b){var c=this.calendar;return c.publiclyTrigger.apply(c,[a,b||this].concat(Array.prototype.slice.call(arguments,
2),[this]))},updateTitle:function(){this.title=this.computeTitle();this.calendar.setToolbarsTitle(this.title)},computeTitle:function(){var a;a=/^(year|month)$/.test(this.currentRangeUnit)?this.currentRange:this.activeRange;return this.formatRange({start:this.calendar.applyTimezone(a.start),end:this.calendar.applyTimezone(a.end)},this.opt("titleFormat")||this.computeTitleFormat(),this.opt("titleRangeSeparator"))},computeTitleFormat:function(){return"year"==this.currentRangeUnit?"YYYY":"month"==this.currentRangeUnit?
this.opt("monthYearFormat"):1<this.currentRangeAs("days")?"ll":"LL"},formatRange:function(a,b,c){var d=a.end;d.hasTime()||(d=d.clone().subtract(1));return hb(a.start,d,b,c,this.opt("isRTL"))},getAllDayHtml:function(){return this.opt("allDayHtml")||I(this.opt("allDayText"))},buildGotoAnchorHtml:function(b,c,d){var e,f,g;a.isPlainObject(b)?(e=b.date,f=b.type,g=b.forceOff):e=b;e=P.moment(e);b={date:e.format("YYYY-MM-DD"),type:f||"day"};"string"===typeof c&&(d=c,c=null);if(c){var h=[];a.each(c,function(a,
b){null!=b&&h.push(a+'="'+I(b)+'"')});c=" "+h.join(" ")}else c="";d=d||"";return!g&&this.opt("navLinks")?"<a"+c+' data-goto="'+I(JSON.stringify(b))+'">'+d+"</a>":"<span"+c+">"+d+"</span>"},setElement:function(a){this.el=a;this.bindGlobalHandlers();this.bindBaseRenderHandlers();this.renderSkeleton()},removeElement:function(){this.unsetDate();this.unrenderSkeleton();this.unbindGlobalHandlers();this.unbindBaseRenderHandlers();this.el.remove()},renderSkeleton:function(){},unrenderSkeleton:function(){},
setDate:function(a){var b=this.get("dateProfile"),a=this.buildDateProfile(a,null,!0);(!b||!(b.activeRange.start&&a.activeRange.start&&b.activeRange.start.isSame(a.activeRange.start)||!b.activeRange.start&&!a.activeRange.start)||!(b.activeRange.end&&a.activeRange.end&&b.activeRange.end.isSame(a.activeRange.end)||!b.activeRange.end&&!a.activeRange.end))&&this.set("dateProfile",a);return a.date},unsetDate:function(){this.unset("dateProfile")},requestDateRender:function(a){var b=this;this.renderQueue.queue(function(){b.executeDateRender(a)},
"date","init")},requestDateUnrender:function(){var a=this;this.renderQueue.queue(function(){a.executeDateUnrender()},"date","destroy")},fetchInitialEvents:function(a){return this.calendar.requestEvents(a.activeRange.start,a.activeRange.end)},bindEventChanges:function(){this.listenTo(this.calendar,"eventsReset",this.resetEvents)},unbindEventChanges:function(){this.stopListeningTo(this.calendar,"eventsReset")},setEvents:function(a){this.set("currentEvents",a);this.set("hasEvents",!0)},unsetEvents:function(){this.unset("currentEvents");
this.unset("hasEvents")},resetEvents:function(a){this.startBatchRender();this.unsetEvents();this.setEvents(a);this.stopBatchRender()},requestEventsRender:function(a){var b=this;this.renderQueue.queue(function(){b.executeEventsRender(a)},"event","init")},requestEventsUnrender:function(){var a=this;this.renderQueue.queue(function(){a.executeEventsUnrender()},"event","destroy")},executeDateRender:function(a,b){this.setDateProfileForRendering(a);this.updateTitle();this.calendar.updateToolbarButtons();
this.render&&this.render();this.renderDates();this.updateSize();this.renderBusinessHours();this.startNowIndicator();b||this.addScroll(this.computeInitialDateScroll());this.isDatesRendered=!0;this.trigger("datesRendered")},executeDateUnrender:function(){this.unselect();this.stopNowIndicator();this.trigger("before:datesUnrendered");this.unrenderBusinessHours();this.unrenderDates();this.destroy&&this.destroy();this.isDatesRendered=!1},renderDates:function(){},unrenderDates:function(){},bindBaseRenderHandlers:function(){var a=
this;this.on("datesRendered.baseHandler",function(){a.onBaseRender()});this.on("before:datesUnrendered.baseHandler",function(){a.onBeforeBaseUnrender()})},unbindBaseRenderHandlers:function(){this.off(".baseHandler")},onBaseRender:function(){this.applyScreenState();this.publiclyTrigger("viewRender",this,this,this.el)},onBeforeBaseUnrender:function(){this.applyScreenState();this.publiclyTrigger("viewDestroy",this,this,this.el)},bindGlobalHandlers:function(){this.listenTo(qa.get(),{touchstart:this.processUnselect,
mousedown:this.handleDocumentMousedown})},unbindGlobalHandlers:function(){this.stopListeningTo(qa.get())},initThemingProps:function(){var a=this.opt("theme")?"ui":"fc";this.widgetHeaderClass=a+"-widget-header";this.widgetContentClass=a+"-widget-content";this.highlightStateClass=a+"-state-highlight"},renderBusinessHours:function(){},unrenderBusinessHours:function(){},startNowIndicator:function(){var a=this,b,c,d;if(this.opt("nowIndicator")&&(b=this.getNowIndicatorUnit()))c=W(this,"updateNowIndicator"),
this.initialNowDate=this.calendar.getNow(),this.initialNowQueriedMs=+new Date,this.renderNowIndicator(this.initialNowDate),this.isNowIndicatorRendered=!0,d=this.initialNowDate.clone().startOf(b).add(1,b)-this.initialNowDate,this.nowIndicatorTimeoutID=setTimeout(function(){a.nowIndicatorTimeoutID=null;c();d=+g.duration(1,b);d=Math.max(100,d);a.nowIndicatorIntervalID=setInterval(c,d)},d)},updateNowIndicator:function(){this.isNowIndicatorRendered&&(this.unrenderNowIndicator(),this.renderNowIndicator(this.initialNowDate.clone().add(new Date-
this.initialNowQueriedMs)))},stopNowIndicator:function(){this.isNowIndicatorRendered&&(this.nowIndicatorTimeoutID&&(clearTimeout(this.nowIndicatorTimeoutID),this.nowIndicatorTimeoutID=null),this.nowIndicatorIntervalID&&(clearTimeout(this.nowIndicatorIntervalID),this.nowIndicatorIntervalID=null),this.unrenderNowIndicator(),this.isNowIndicatorRendered=!1)},getNowIndicatorUnit:function(){},renderNowIndicator:function(){},unrenderNowIndicator:function(){},updateSize:function(a){var b;a&&(b=this.queryScroll());
this.updateHeight(a);this.updateWidth(a);this.updateNowIndicator();a&&this.applyScroll(b)},updateWidth:function(){},updateHeight:function(){var a=this.calendar;this.setHeight(a.getSuggestedViewHeight(),a.isHeightAuto())},setHeight:function(){},addForcedScroll:function(b){this.addScroll(a.extend(b,{isForced:!0}))},addScroll:function(b){var c=this.queuedScroll||(this.queuedScroll={});c.isForced||a.extend(c,b)},popScroll:function(){this.applyQueuedScroll();this.queuedScroll=null},applyQueuedScroll:function(){this.queuedScroll&&
this.applyScroll(this.queuedScroll)},queryScroll:function(){var b={};this.isDatesRendered&&a.extend(b,this.queryDateScroll());return b},applyScroll:function(a){this.isDatesRendered&&this.applyDateScroll(a)},computeInitialDateScroll:function(){return{}},queryDateScroll:function(){return{}},applyDateScroll:function(){},freezeHeight:function(){this.calendar.freezeContentHeight()},thawHeight:function(){this.calendar.thawContentHeight()},executeEventsRender:function(a){this.renderEvents(a);this.isEventsRendered=
!0;this.onEventsRender()},executeEventsUnrender:function(){this.onBeforeEventsUnrender();this.destroyEvents&&this.destroyEvents();this.unrenderEvents();this.isEventsRendered=!1},onEventsRender:function(){this.applyScreenState();this.renderedEventSegEach(function(a){this.publiclyTrigger("eventAfterRender",a.event,a.event,a.el)});this.publiclyTrigger("eventAfterAllRender")},onBeforeEventsUnrender:function(){this.applyScreenState();this.renderedEventSegEach(function(a){this.publiclyTrigger("eventDestroy",
a.event,a.event,a.el)})},applyScreenState:function(){this.thawHeight();this.freezeHeight();this.applyQueuedScroll()},renderEvents:function(){},unrenderEvents:function(){},resolveEventEl:function(b,c){var d=this.publiclyTrigger("eventRender",b,b,c);!1===d?c=null:d&&!0!==d&&(c=a(d));return c},showEvent:function(a){this.renderedEventSegEach(function(a){a.el.css("visibility","")},a)},hideEvent:function(a){this.renderedEventSegEach(function(a){a.el.css("visibility","hidden")},a)},renderedEventSegEach:function(a,
b){var c=this.getEventSegs(),d;for(d=0;d<c.length;d++)(!b||c[d].event._id===b._id)&&c[d].el&&a.call(this,c[d])},getEventSegs:function(){return[]},isEventDraggable:function(a){return this.isEventStartEditable(a)},isEventStartEditable:function(a){return O(a.startEditable,(a.source||{}).startEditable,this.opt("eventStartEditable"),this.isEventGenerallyEditable(a))},isEventGenerallyEditable:function(a){return O(a.editable,(a.source||{}).editable,this.opt("editable"))},reportSegDrop:function(a,b,c,d,e){var f=
this.calendar,g=f.mutateSeg(a,b,c);this.triggerEventDrop(a.event,g.dateDelta,function(){g.undo();f.reportEventChange()},d,e);f.reportEventChange()},triggerEventDrop:function(a,b,c,d,e){this.publiclyTrigger("eventDrop",d[0],a,b,c,e,{})},reportExternalDrop:function(b,c,d,e,f){var g=b.eventProps,h;g&&(g=a.extend({},g,c),h=this.calendar.renderEvent(g,b.stick)[0]);this.triggerExternalDrop(h,c,d,e,f)},triggerExternalDrop:function(a,b,c,d,e){this.publiclyTrigger("drop",c[0],b.start,d,e);a&&this.publiclyTrigger("eventReceive",
null,a)},renderDrag:function(){},unrenderDrag:function(){},isEventResizableFromStart:function(a){return this.opt("eventResizableFromStart")&&this.isEventResizable(a)},isEventResizableFromEnd:function(a){return this.isEventResizable(a)},isEventResizable:function(a){var b=a.source||{};return O(a.durationEditable,b.durationEditable,this.opt("eventDurationEditable"),a.editable,b.editable,this.opt("editable"))},reportSegResize:function(a,b,c,d,e){var f=this.calendar,g=f.mutateSeg(a,b,c);this.triggerEventResize(a.event,
g.durationDelta,function(){g.undo();f.reportEventChange()},d,e);f.reportEventChange()},triggerEventResize:function(a,b,c,d,e){this.publiclyTrigger("eventResize",d[0],a,b,c,e,{})},select:function(a,b){this.unselect(b);this.renderSelection(a);this.reportSelection(a,b)},renderSelection:function(){},reportSelection:function(a,b){this.isSelected=!0;this.triggerSelect(a,b)},triggerSelect:function(a,b){this.publiclyTrigger("select",null,this.calendar.applyTimezone(a.start),this.calendar.applyTimezone(a.end),
b)},unselect:function(a){this.isSelected&&(this.isSelected=!1,this.destroySelection&&this.destroySelection(),this.unrenderSelection(),this.publiclyTrigger("unselect",null,a))},unrenderSelection:function(){},selectEvent:function(a){if(!this.selectedEvent||this.selectedEvent!==a)this.unselectEvent(),this.renderedEventSegEach(function(a){a.el.addClass("fc-selected")},a),this.selectedEvent=a},unselectEvent:function(){this.selectedEvent&&(this.renderedEventSegEach(function(a){a.el.removeClass("fc-selected")},
this.selectedEvent),this.selectedEvent=null)},isEventSelected:function(a){return this.selectedEvent&&this.selectedEvent._id===a._id},handleDocumentMousedown:function(a){1==a.which&&!a.ctrlKey&&this.processUnselect(a)},processUnselect:function(a){this.processRangeUnselect(a);this.processEventUnselect(a)},processRangeUnselect:function(b){var c;this.isSelected&&this.opt("unselectAuto")&&(c=this.opt("unselectCancel"),(!c||!a(b.target).closest(c).length)&&this.unselect(b))},processEventUnselect:function(b){this.selectedEvent&&
(a(b.target).closest(".fc-selected").length||this.unselectEvent())},triggerDayClick:function(a,b,c){this.publiclyTrigger("dayClick",b,this.calendar.applyTimezone(a.start),c)},computeDayRange:function(a){var b=a.start.clone().stripTime(),a=a.end,c=null,d;a&&(c=a.clone().stripTime(),(d=+a.time())&&d>=this.nextDayThreshold&&c.add(1,"days"));if(!a||c<=b)c=b.clone().add(1,"days");return{start:b,end:c}},isMultiDayEvent:function(a){a=this.computeDayRange(a);return 1<a.end.diff(a.start,"days")}});Ea.watch("displayingDates",
["dateProfile"],function(a){this.requestDateRender(a.dateProfile)},function(){this.requestDateUnrender()});Ea.watch("initialEvents",["dateProfile"],function(a){return this.fetchInitialEvents(a.dateProfile)});Ea.watch("bindingEvents",["initialEvents"],function(a){this.setEvents(a.initialEvents);this.bindEventChanges()},function(){this.unbindEventChanges();this.unsetEvents()});Ea.watch("displayingEvents",["displayingDates","hasEvents"],function(){this.requestEventsRender(this.get("currentEvents"))},
function(){this.requestEventsUnrender()});Ea.mixin({currentRange:null,currentRangeUnit:null,renderRange:null,activeRange:null,validRange:null,dateIncrement:null,minTime:null,maxTime:null,usesMinMaxTime:!1,start:null,end:null,intervalStart:null,intervalEnd:null,setDateProfileForRendering:function(a){this.currentRange=a.currentRange;this.currentRangeUnit=a.currentRangeUnit;this.renderRange=a.renderRange;this.activeRange=a.activeRange;this.validRange=a.validRange;this.dateIncrement=a.dateIncrement;this.minTime=
a.minTime;this.maxTime=a.maxTime;this.start=a.activeRange.start;this.end=a.activeRange.end;this.intervalStart=a.currentRange.start;this.intervalEnd=a.currentRange.end},buildPrevDateProfile:function(a){a=a.clone().startOf(this.currentRangeUnit).subtract(this.dateIncrement);return this.buildDateProfile(a,-1)},buildNextDateProfile:function(a){a=a.clone().startOf(this.currentRangeUnit).add(this.dateIncrement);return this.buildDateProfile(a,1)},buildDateProfile:function(a,b,c){var d=this.buildValidRange(),
e=null,f=null,h;c&&(a=s(a,d));b=this.buildCurrentRangeInfo(a,b);c=this.buildRenderRange(b.range,b.unit);h={start:c.start.clone(),end:c.end.clone()};this.opt("showNonCurrentDates")||(h=y(h,b.range));e=g.duration(this.opt("minTime"));f=g.duration(this.opt("maxTime"));this.adjustActiveRange(h,e,f);h=y(h,d);a=s(a,h);return{validRange:d,currentRange:b.range,currentRangeUnit:b.unit,activeRange:h,renderRange:c,minTime:e,maxTime:f,isValid:(!d.start||b.range.end>=d.start)&&(!d.end||b.range.start<d.end),date:a,
dateIncrement:this.buildDateIncrement(b.duration)}},buildValidRange:function(){return this.getRangeOption("validRange",this.calendar.getNow())||{}},buildCurrentRangeInfo:function(a,b){var c=null,d=null,e=null;this.viewSpec.duration?(c=this.viewSpec.duration,d=this.viewSpec.durationUnit,e=this.buildRangeFromDuration(a,b,c,d)):(e=this.opt("dayCount"))?(d="day",e=this.buildRangeFromDayCount(a,b,e)):(e=this.buildCustomVisibleRange(a))?d=w(e.start,e.end):(c=this.getFallbackDuration(),d=w(c),e=this.buildRangeFromDuration(a,
b,c,d));this.normalizeCurrentRange(e,d);return{duration:c,unit:d,range:e}},getFallbackDuration:function(){return g.duration({days:1})},normalizeCurrentRange:function(a,b){/^(year|month|week|day)$/.test(b)?(a.start.stripTime(),a.end.stripTime()):(a.start.hasTime()||a.start.time(0),a.end.hasTime()||a.end.time(0))},adjustActiveRange:function(a,b,c){var d=!1;this.usesMinMaxTime&&(0>b&&(a.start.time(0).add(b),d=!0),864E5<c&&(a.end.time(c-864E5),d=!0),d&&(a.start.hasTime()||a.start.time(0),a.end.hasTime()||
a.end.time(0)))},buildRangeFromDuration:function(a,b,c,d){var e=this.opt("dateAlignment"),a=a.clone();1>=c.as("days")&&this.isHiddenDay(a)&&(a=this.skipHiddenDays(a,b),a.startOf("day"));e||((b=this.opt("dateIncrement"))?(e=g.duration(b),e=e<c?J(e,b):d):e=d);a.startOf(e);c=a.clone().add(c);return{start:a,end:c}},buildRangeFromDayCount:function(a,b,c){var d=this.opt("dateAlignment"),e=0,a=a.clone();d&&a.startOf(d);a.startOf("day");a=this.skipHiddenDays(a,b);b=a.clone();do b.add(1,"day"),this.isHiddenDay(b)||
e++;while(e<c);return{start:a,end:b}},buildCustomVisibleRange:function(a){return(a=this.getRangeOption("visibleRange",this.calendar.moment(a)))&&(!a.start||!a.end)?null:a},buildRenderRange:function(a){return this.trimHiddenDays(a)},buildDateIncrement:function(a){var b=this.opt("dateIncrement"),c;return b?g.duration(b):(c=this.opt("dateAlignment"))?g.duration(1,c):a?a:g.duration({days:1})},trimHiddenDays:function(a){return{start:this.skipHiddenDays(a.start),end:this.skipHiddenDays(a.end,-1,!0)}},currentRangeAs:function(a){var b=
this.currentRange;return b.end.diff(b.start,a,!0)},getRangeOption:function(a){var b=this.opt(a);"function"===typeof b&&(b=b.apply(null,Array.prototype.slice.call(arguments,1)));if(b)return this.calendar.parseRange(b)},initHiddenDays:function(){var b=this.opt("hiddenDays")||[],c=[],d=0,e;!1===this.opt("weekends")&&b.push(0,6);for(e=0;7>e;e++)(c[e]=-1!==a.inArray(e,b))||d++;if(!d)throw"invalid hiddenDays";this.isHiddenDayHash=c},isHiddenDay:function(a){g.isMoment(a)&&(a=a.day());return this.isHiddenDayHash[a]},
skipHiddenDays:function(a,b,c){a=a.clone();for(b=b||1;this.isHiddenDayHash[(a.day()+(c?b:0)+7)%7];)a.add(b,"days");return a}});var jb=P.Scroller=ha.extend({el:null,scrollEl:null,overflowX:null,overflowY:null,constructor:function(a){a=a||{};this.overflowX=a.overflowX||a.overflow||"auto";this.overflowY=a.overflowY||a.overflow||"auto"},render:function(){this.el=this.renderEl();this.applyOverflow()},renderEl:function(){return this.scrollEl=a('<div class="fc-scroller"></div>')},clear:function(){this.setHeight("auto");
this.applyOverflow()},destroy:function(){this.el.remove()},applyOverflow:function(){this.scrollEl.css({"overflow-x":this.overflowX,"overflow-y":this.overflowY})},lockOverflow:function(a){var b=this.overflowX,c=this.overflowY,a=a||this.getScrollbarWidths();"auto"===b&&(b=a.top||a.bottom||this.scrollEl[0].scrollWidth-1>this.scrollEl[0].clientWidth?"scroll":"hidden");"auto"===c&&(c=a.left||a.right||this.scrollEl[0].scrollHeight-1>this.scrollEl[0].clientHeight?"scroll":"hidden");this.scrollEl.css({"overflow-x":b,
"overflow-y":c})},setHeight:function(a){this.scrollEl.height(a)},getScrollTop:function(){return this.scrollEl.scrollTop()},setScrollTop:function(a){this.scrollEl.scrollTop(a)},getClientWidth:function(){return this.scrollEl[0].clientWidth},getClientHeight:function(){return this.scrollEl[0].clientHeight},getScrollbarWidths:function(){return k(this.scrollEl)}});Ja.prototype.proxyCall=function(a){var b=Array.prototype.slice.call(arguments,1),c=[];this.items.forEach(function(d){c.push(d[a].apply(d,b))});
return c};var ca=P.Calendar=ha.extend(Ma,{view:null,viewsByType:null,currentDate:null,loadingLevel:0,constructor:function(b,c){qa.needed();this.el=b;this.viewsByType={};this.viewSpecCache={};this.initOptionsInternals(c);this.initMomentInternals();this.initCurrentDate();var d=function(){var a=S,b=[],c,d;for(c=0;c<a.length;c++)d=a[c],d.start.clone().stripZone()<L&&v.getEventEnd(d).stripZone()>u&&b.push(d);T=b;v.trigger("eventsReset",T)},e=function(a,b){return!u||a<u||b>L},f=function(a,b){u=a;L=b;return h()},
h=function(){return i(da,"reset")},i=function(a,b){var c,d;"reset"===b?S=[]:"add"!==b&&(S=t(S,a));for(c=0;c<a.length;c++)d=a[c],"pending"!==d._status&&B++,d._fetchId=(d._fetchId||0)+1,d._status="pending";for(c=0;c<a.length;c++)d=a[c],j(d,d._fetchId);return B?la.construct(function(a){v.one("eventsReceived",a)}):la.resolve(T)},j=function(b,c){m(b,function(d){var e=a.isArray(b.events),f,g;if(c===b._fetchId&&"rejected"!==b._status){b._status="resolved";if(d)for(f=0;f<d.length;f++)g=d[f],(g=e?g:D(g,b))&&
S.push.apply(S,I(g));l()}})},l=function(){B--;B||(d(S),v.trigger("eventsReceived",T))},m=function(b,c){var d,e=P.sourceFetchers,f;for(d=0;d<e.length;d++){f=e[d].call(v,b,u.clone(),L.clone(),v.opt("timezone"),c);if(!0===f)return;if("object"==typeof f){m(f,c);return}}if(d=b.events)a.isFunction(d)?(v.pushLoading(),d.call(v,u.clone(),L.clone(),v.opt("timezone"),function(a){c(a);v.popLoading()})):a.isArray(d)?c(d):c();else if(b.url){var g=b.success,h=b.error,i=b.complete;d=a.isFunction(b.data)?b.data():
b.data;d=a.extend({},d||{});e=O(b.startParam,v.opt("startParam"));f=O(b.endParam,v.opt("endParam"));var j=O(b.timezoneParam,v.opt("timezoneParam"));e&&(d[e]=u.format());f&&(d[f]=L.format());v.opt("timezone")&&"local"!=v.opt("timezone")&&(d[j]=v.opt("timezone"));v.pushLoading();a.ajax(a.extend({},wb,b,{data:d,success:function(b){var b=b||[],d=N(g,this,arguments);a.isArray(d)&&(b=d);c(b)},error:function(){N(h,this,arguments);c()},complete:function(){N(i,this,arguments);v.popLoading()}}))}else c()},
k=function(b){var c=P.sourceNormalizers,d;a.isFunction(b)||a.isArray(b)?d={events:b}:"string"===typeof b?d={url:b}:"object"===typeof b&&(d=a.extend({},b));if(d){d.className?"string"===typeof d.className&&(d.className=d.className.split(/\s+/)):d.className=[];a.isArray(d.events)&&(d.origArray=d.events,d.events=a.map(d.events,function(a){return D(a,d)}));for(b=0;b<c.length;b++)c[b].call(v,d);return d}},n=function(b,c){var e;for(e=0;e<b.length;e++){var f=b[e],g="pending"===f._status;f._status="rejected";
g&&l()}c?(da=[],S=[]):(da=a.grep(da,function(a){for(e=0;e<b.length;e++)if(a===b[e])return!1;return!0}),S=t(S,b));d()},p=function(b){return a.grep(da,function(a){return a.id&&a.id===b})[0]},s=function(b){b?a.isArray(b)||(b=[b]):b=[];var c=[],d;for(d=0;d<b.length;d++)c.push.apply(c,q(b[d]));return c},q=function(b){var c,d;for(c=0;c<da.length;c++)if(d=da[c],d===b)return[d];return(d=p(b))?[d]:a.grep(da,function(a){return b&&a&&r(b)==r(a)})},r=function(a){return("object"===typeof a?a.origArray||a.googleCalendarId||
a.url||a.events:null)||a},t=function(b,c){return a.grep(b,function(a){for(var b=0;b<c.length;b++)if(a.source===c[b])return!1;return!0})},y=function(a){var b,c;for(b=0;b<a.length;b++)c=a[b],c.start=v.moment(c.start),c.end=c.end?v.moment(c.end):null,z(c,w(c));d()},w=function(b){var c={};a.each(b,function(b,d){!/^_|^(id|allDay|start|end)$/.test(b)&&void 0!==d&&/undefined|null|boolean|number|string/.test(a.type(d))&&(c[b]=d)});return c},x=function(a,b){var c=[],e,f,g,h;for(f=0;f<a.length;f++)if(e=D(a[f])){e=
I(e);for(g=0;g<e.length;g++)h=e[g],h.source||(b&&(F.events.push(h),h.source=F),S.push(h));c=c.concat(e)}c.length&&d();return c},A=function(b){return a.isFunction(b)?a.grep(S,b):null!=b?(b+="",a.grep(S,function(a){return a._id==b})):S},D=function(b,c){var d=v.opt("eventDataTransform"),e={},f,h;d&&(b=d(b));c&&c.eventDataTransform&&(b=c.eventDataTransform(b));a.extend(e,b);c&&(e.source=c);e._id=b._id||(void 0===b.id?"_fc"+xb++:b.id+"");e.className=b.className?"string"==typeof b.className?b.className.split(/\s+/):
b.className:[];d=b.start||b.date;f=b.end;E(d)&&(d=g.duration(d));E(f)&&(f=g.duration(f));if(b.dow||g.isDuration(d)||g.isDuration(f))e.start=d?g.duration(d):null,e.end=f?g.duration(f):null,e._recurring=!0;else{if(d&&(d=v.moment(d),!d.isValid()))return!1;f&&(f=v.moment(f),f.isValid()||(f=null));h=b.allDay;void 0===h&&(h=O(c?c.allDayDefault:void 0,v.opt("allDayDefault")));e.start=d;e.end=f;e.allDay=h;H(e);ga(e)}v.normalizeEvent(e);return e},H=function(a){K(a);a.end&&!a.end.isAfter(a.start)&&(a.end=null);
a.end||(a.end=v.opt("forceEventDuration")?v.getDefaultEventEnd(a.allDay,a.start):null)},K=function(a){null==a.allDay&&(a.allDay=!(a.start.hasTime()||a.end&&a.end.hasTime()));a.allDay?(a.start.stripTime(),a.end&&a.end.stripTime()):(a.start.hasTime()||(a.start=v.applyTimezone(a.start.time(0))),a.end&&!a.end.hasTime()&&(a.end=v.applyTimezone(a.end.time(0))))},I=function(b,c,d){var e=[],f,g,h,i,j,l,c=c||u,d=d||L;if(b)if(b._recurring){if(g=b.dow){f={};for(h=0;h<g.length;h++)f[g[h]]=!0}for(c=c.clone().stripTime();c.isBefore(d);){if(!f||
f[c.day()])i=b.start,j=b.end,g=c.clone(),l=null,i&&(g=g.time(i)),j&&(l=c.clone().time(j)),h=a.extend({},b),i=!i&&!j,j=h,j.start=g,j.end=l,j.allDay=i,H(j),ga(j),e.push(h);c.add(1,"days")}}else e.push(b);return e},z=function(b,c,d){var e={},f,h,i,c=c||{};c.start||(c.start=b.start.clone());void 0===c.end&&(c.end=b.end?b.end.clone():null);null==c.allDay&&(c.allDay=b.allDay);H(c);f={start:b._start.clone(),end:b._end?b._end.clone():v.getDefaultEventEnd(b._allDay,b._start),allDay:c.allDay};H(f);h=null!==
b._end&&null===c.end;i=d?g.duration(Math.round(c.start.diff(f.start,d,!0)),d):c.allDay?M(c.start,f.start):G(c.start,f.start);c.end?(d=d?g.duration(Math.round(c.end.diff(f.end,d,!0)),d):c.allDay?M(c.end,f.end):G(c.end,f.end),d=d.subtract(i)):d=null;a.each(c,function(a,b){!/^_|^(id|allDay|start|end)$/.test(a)&&void 0!==b&&(e[a]=b)});var b=A(b._id),j=c.allDay,l=i,m=d,k=v.getIsAmbigTimezone(),n=[];l&&!l.valueOf()&&(l=null);m&&!m.valueOf()&&(m=null);a.each(b,function(b,c){var d,f;d={start:c.start.clone(),
end:c.end?c.end.clone():null,allDay:c.allDay};a.each(e,function(a){d[a]=c[a]});f={start:c._start,end:c._end,allDay:j};H(f);h?f.end=null:m&&!f.end&&(f.end=v.getDefaultEventEnd(f.allDay,f.start));l&&(f.start.add(l),f.end&&f.end.add(l));m&&f.end.add(m);if(k&&!f.allDay&&(l||m))f.start.stripZone(),f.end&&f.end.stripZone();a.extend(c,e,f);ga(c);n.push(function(){a.extend(c,d);ga(c)})});return{dateDelta:i,durationDelta:d,undo:function(){for(var a=0;a<n.length;a++)n[a]()}}},v=this;v.requestEvents=function(a,
b){return!v.opt("lazyFetching")||e(a,b)?f(a,b):la.resolve(T)};v.reportEventChange=d;v.isFetchNeeded=e;v.fetchEvents=f;v.fetchEventSources=i;v.refetchEvents=h;v.refetchEventSources=function(a){return i(s(a))};v.getEventSources=function(){return da.slice(1)};v.getEventSourceById=p;v.addEventSource=function(a){if(a=k(a))da.push(a),i([a],"add")};v.removeEventSource=function(a){n(q(a))};v.removeEventSources=function(a){null==a?n(da,!0):n(s(a))};v.updateEvent=function(a){y([a])};v.updateEvents=y;v.renderEvent=
function(a,b){return x([a],b)};v.renderEvents=x;v.removeEvents=function(b){var c,e;null==b?b=function(){return!0}:a.isFunction(b)||(c=b+"",b=function(a){return a._id==c});S=a.grep(S,b,!0);for(e=0;e<da.length;e++)a.isArray(da[e].events)&&(da[e].events=a.grep(da[e].events,b,!0));d()};v.clientEvents=A;v.mutateEvent=z;v.normalizeEventDates=H;v.normalizeEventTimes=K;var F={events:[]},da=[F],u,L,B=0,S=[],T;a.each((v.opt("events")?[v.opt("events")]:[]).concat(v.opt("eventSources")||[]),function(a,b){var c=
k(b);c&&da.push(c)});v.getEventCache=function(){return S};v.rezoneArrayEventSources=function(){var b,c,d;for(b=0;b<da.length;b++)if(c=da[b].events,a.isArray(c))for(d=0;d<c.length;d++){var e=c[d];e.start=v.moment(e.start);e.end&&(e.end=v.moment(e.end));ga(e)}};v.buildEventFromInput=D;v.expandEvent=I;this.initialize()},initialize:function(){},getCalendar:function(){return this},getView:function(){return this.view},publiclyTrigger:function(a,b){var c=Array.prototype.slice.call(arguments,2),d=this.opt(a),
b=b||this.el[0];this.triggerWith(a,b,c);if(d)return d.apply(b,c)},instantiateView:function(a){a=this.getViewSpec(a);return new a["class"](this,a)},isValidViewType:function(a){return Boolean(this.getViewSpec(a))},changeView:function(a,b){b&&(b.start&&b.end?this.recordOptionOverrides({visibleRange:b}):this.currentDate=this.moment(b).stripZone());this.renderView(a)},zoomTo:function(a,b){var c,b=b||"day";c=this.getViewSpec(b)||this.getUnitViewSpec(b);this.currentDate=a.clone();this.renderView(c?c.type:
null)},initCurrentDate:function(){var a=this.opt("defaultDate");this.currentDate=null!=a?this.moment(a).stripZone():this.getNow()},prev:function(){var a=this.view.buildPrevDateProfile(this.currentDate);a.isValid&&(this.currentDate=a.date,this.renderView())},next:function(){var a=this.view.buildNextDateProfile(this.currentDate);a.isValid&&(this.currentDate=a.date,this.renderView())},prevYear:function(){this.currentDate.add(-1,"years");this.renderView()},nextYear:function(){this.currentDate.add(1,"years");
this.renderView()},today:function(){this.currentDate=this.getNow();this.renderView()},gotoDate:function(a){this.currentDate=this.moment(a).stripZone();this.renderView()},incrementDate:function(a){this.currentDate.add(g.duration(a));this.renderView()},getDate:function(){return this.applyTimezone(this.currentDate)},pushLoading:function(){this.loadingLevel++||this.publiclyTrigger("loading",null,!0,this.view)},popLoading:function(){--this.loadingLevel||this.publiclyTrigger("loading",null,!1,this.view)},
select:function(a,b){this.view.select(this.buildSelectSpan.apply(this,arguments))},unselect:function(){this.view&&this.view.unselect()},buildSelectSpan:function(a,b){var c=this.moment(a).stripZone(),d;d=b?this.moment(b).stripZone():c.hasTime()?c.clone().add(this.defaultTimedEventDuration):c.clone().add(this.defaultAllDayEventDuration);return{start:c,end:d}},parseRange:function(a){var b=null,c=null;a.start&&(b=this.moment(a.start).stripZone());a.end&&(c=this.moment(a.end).stripZone());return!b&&!c||
b&&c&&c.isBefore(b)?null:{start:b,end:c}},rerenderEvents:function(){this.elementVisible()&&this.reportEventChange()}});ca.mixin({dirDefaults:null,localeDefaults:null,overrides:null,dynamicOverrides:null,optionsModel:null,initOptionsInternals:function(b){this.overrides=a.extend({},b);this.dynamicOverrides={};this.optionsModel=new ra;this.populateOptionsHash()},option:function(a,b){var c;if("string"===typeof a){if(void 0===b)return this.optionsModel.get(a);c={};c[a]=b;this.setOptions(c)}else"object"===
typeof a&&this.setOptions(a)},opt:function(a){return this.optionsModel.get(a)},setOptions:function(a){var b=0,c;this.recordOptionOverrides(a);for(c in a)b++;if(1===b){if("height"===c||"contentHeight"===c||"aspectRatio"===c){this.updateSize(!0);return}if("defaultDate"===c)return;if("businessHours"===c){this.view&&(this.view.unrenderBusinessHours(),this.view.renderBusinessHours());return}if("timezone"===c){this.rezoneArrayEventSources();this.refetchEvents();return}}this.renderHeader();this.renderFooter();
this.viewsByType={};this.reinitView()},populateOptionsHash:function(){var a,b;a=O(this.dynamicOverrides.locale,this.overrides.locale);a=Oa[a];a||(a=ca.defaults.locale,a=Oa[a]||{});this.dirDefaults=b=O(this.dynamicOverrides.isRTL,this.overrides.isRTL,a.isRTL,ca.defaults.isRTL)?ca.rtlDefaults:{};this.localeDefaults=a;a=K([ca.defaults,b,a,this.overrides,this.dynamicOverrides],da);Pa(a);this.optionsModel.reset(a)},recordOptionOverrides:function(a){for(var b in a)this.dynamicOverrides[b]=a[b];this.viewSpecCache=
{};this.populateOptionsHash()}});ca.mixin({defaultAllDayEventDuration:null,defaultTimedEventDuration:null,localeData:null,initMomentInternals:function(){var a=this;this.defaultAllDayEventDuration=g.duration(this.opt("defaultAllDayEventDuration"));this.defaultTimedEventDuration=g.duration(this.opt("defaultTimedEventDuration"));this.optionsModel.watch("buildingMomentLocale","?locale ?monthNames ?monthNamesShort ?dayNames ?dayNamesShort ?firstDay ?weekNumberCalculation".split(" "),function(b){var c=
b.weekNumberCalculation,d=b.firstDay;"iso"===c&&(c="ISO");var e=L(g.localeData(b.locale)||g.localeData("en"));b.monthNames&&(e._months=b.monthNames);b.monthNamesShort&&(e._monthsShort=b.monthNamesShort);b.dayNames&&(e._weekdays=b.dayNames);b.dayNamesShort&&(e._weekdaysShort=b.dayNamesShort);null==d&&"ISO"===c&&(d=1);null!=d&&(b=L(e._week),b.dow=d,e._week=b);if("ISO"===c||"local"===c||"function"===typeof c)e._fullCalendar_weekCalc=c;a.localeData=e;a.currentDate&&a.localizeMoment(a.currentDate)})},
moment:function(){var a;"local"===this.opt("timezone")?(a=P.moment.apply(null,arguments),a.hasTime()&&a.local()):a="UTC"===this.opt("timezone")?P.moment.utc.apply(null,arguments):P.moment.parseZone.apply(null,arguments);this.localizeMoment(a);return a},localizeMoment:function(a){a._locale=this.localeData},getIsAmbigTimezone:function(){return"local"!==this.opt("timezone")&&"UTC"!==this.opt("timezone")},applyTimezone:function(a){if(!a.hasTime())return a.clone();var b=this.moment(a.toArray()),c=a.time()-
b.time();c&&(c=b.clone().add(c),0===a.time()-c.time()&&(b=c));return b},getNow:function(){var a=this.opt("now");"function"===typeof a&&(a=a());return this.moment(a).stripZone()},humanizeDuration:function(a){return a.locale(this.opt("locale")).humanize()},getEventEnd:function(a){return a.end?a.end.clone():this.getDefaultEventEnd(a.allDay,a.start)},getDefaultEventEnd:function(a,b){var c=b.clone();a?c.stripTime().add(this.defaultAllDayEventDuration):c.add(this.defaultTimedEventDuration);this.getIsAmbigTimezone()&&
c.stripZone();return c}});ca.mixin({viewSpecCache:null,getViewSpec:function(a){var b=this.viewSpecCache;return b[a]||(b[a]=this.buildViewSpec(a))},getUnitViewSpec:function(b){var c,d,e;if(-1!=a.inArray(b,za)){c=this.header.getViewsWithButtons();a.each(P.views,function(a){c.push(a)});for(d=0;d<c.length;d++)if((e=this.getViewSpec(c[d]))&&e.singleUnit==b)return e}},buildViewSpec:function(a){for(var b=this.overrides.views||{},c=[],d=[],e=[],f=a,h,i,j;f;)h=ja[f],i=b[f],f=null,"function"===typeof h&&(h=
{"class":h}),h&&(c.unshift(h),d.unshift(h.defaults||{}),j=j||h.duration,f=f||h.type),i&&(e.unshift(i),j=j||i.duration,f=f||i.type);h=K(c);h.type=a;if(!h["class"])return!1;if(j=j||this.dynamicOverrides.duration||this.overrides.duration)c=g.duration(j),c.valueOf()&&(j=J(c,j),h.duration=c,h.durationUnit=j,1===c.as(j)&&(h.singleUnit=j,e.unshift(b[j]||{})));h.defaults=K(d,da);h.overrides=K(e,da);this.buildViewSpecOptions(h);this.buildViewSpecButtonText(h,a);return h},buildViewSpecOptions:function(a){a.options=
K([ca.defaults,a.defaults,this.dirDefaults,this.localeDefaults,this.overrides,a.overrides,this.dynamicOverrides],da);Pa(a.options)},buildViewSpecButtonText:function(a,b){function c(d){d=d.buttonText||{};return d[b]||(a.buttonTextKey?d[a.buttonTextKey]:null)||(a.singleUnit?d[a.singleUnit]:null)}a.buttonTextOverride=c(this.dynamicOverrides)||c(this.overrides)||a.overrides.buttonText;a.buttonTextDefault=c(this.localeDefaults)||c(this.dirDefaults)||a.defaults.buttonText||c(ca.defaults)||(a.duration?this.humanizeDuration(a.duration):
null)||b}});ca.mixin({el:null,contentEl:null,suggestedViewHeight:null,windowResizeProxy:null,ignoreWindowResize:0,render:function(){this.contentEl?this.elementVisible()&&(this.calcSize(),this.renderView()):this.initialRender()},initialRender:function(){var b=this,c=this.el;c.addClass("fc");c.on("click.fc","a[data-goto]",function(c){var d=a(this).data("goto"),e=b.moment(d.date),d=d.type,f=b.view.opt("navLink"+S(d)+"Click");"function"===typeof f?f(e,c):("string"===typeof f&&(d=f),b.zoomTo(e,d))});this.optionsModel.watch("applyingThemeClasses",
["?theme"],function(a){c.toggleClass("ui-widget",a.theme);c.toggleClass("fc-unthemed",!a.theme)});this.optionsModel.watch("applyingDirClasses",["?isRTL","?locale"],function(a){c.toggleClass("fc-ltr",!a.isRTL);c.toggleClass("fc-rtl",a.isRTL)});this.contentEl=a("<div class='fc-view-container'/>").prependTo(c);this.initToolbars();this.renderHeader();this.renderFooter();this.renderView(this.opt("defaultView"));this.opt("handleWindowResize")&&a(window).resize(this.windowResizeProxy=Y(this.windowResize.bind(this),
this.opt("windowResizeDelay")))},destroy:function(){this.view&&this.view.removeElement();this.toolbarsManager.proxyCall("removeElement");this.contentEl.remove();this.el.removeClass("fc fc-ltr fc-rtl fc-unthemed ui-widget");this.el.off(".fc");this.windowResizeProxy&&(a(window).unbind("resize",this.windowResizeProxy),this.windowResizeProxy=null);qa.unneeded()},elementVisible:function(){return this.el.is(":visible")},renderView:function(b,c){this.ignoreWindowResize++;var d=this.view&&b&&this.view.type!==
b;d&&(this.freezeContentHeight(),this.clearView());!this.view&&b&&(this.view=this.viewsByType[b]||(this.viewsByType[b]=this.instantiateView(b)),this.view.setElement(a("<div class='fc-view fc-"+b+"-view' />").appendTo(this.contentEl)),this.toolbarsManager.proxyCall("activateButton",b));this.view&&(c&&this.view.addForcedScroll(c),this.elementVisible()&&(this.currentDate=this.view.setDate(this.currentDate)));d&&this.thawContentHeight();this.ignoreWindowResize--},clearView:function(){this.toolbarsManager.proxyCall("deactivateButton",
this.view.type);this.view.removeElement();this.view=null},reinitView:function(){this.ignoreWindowResize++;this.freezeContentHeight();var a=this.view.type,b=this.view.queryScroll();this.clearView();this.calcSize();this.renderView(a,b);this.thawContentHeight();this.ignoreWindowResize--},getSuggestedViewHeight:function(){null===this.suggestedViewHeight&&this.calcSize();return this.suggestedViewHeight},isHeightAuto:function(){return"auto"===this.opt("contentHeight")||"auto"===this.opt("height")},updateSize:function(a){if(this.elementVisible())return a&&
this._calcSize(),this.ignoreWindowResize++,this.view.updateSize(!0),this.ignoreWindowResize--,!0},calcSize:function(){this.elementVisible()&&this._calcSize()},_calcSize:function(){var a=this.opt("contentHeight"),b=this.opt("height");this.suggestedViewHeight="number"===typeof a?a:"function"===typeof a?a():"number"===typeof b?b-this.queryToolbarsHeight():"function"===typeof b?b()-this.queryToolbarsHeight():"parent"===b?this.el.parent().height()-this.queryToolbarsHeight():Math.round(this.contentEl.width()/
Math.max(this.opt("aspectRatio"),0.5))},windowResize:function(a){!this.ignoreWindowResize&&a.target===window&&this.view.renderRange&&this.updateSize(!0)&&this.view.publiclyTrigger("windowResize",this.el[0])},freezeContentHeight:function(){this.contentEl.css({width:"100%",height:this.contentEl.height(),overflow:"hidden"})},thawContentHeight:function(){this.contentEl.css({width:"",height:"",overflow:""})}});ca.mixin({header:null,footer:null,toolbarsManager:null,initToolbars:function(){this.header=new Ta(this,
this.computeHeaderOptions());this.footer=new Ta(this,this.computeFooterOptions());this.toolbarsManager=new Ja([this.header,this.footer])},computeHeaderOptions:function(){return{extraClasses:"fc-header-toolbar",layout:this.opt("header")}},computeFooterOptions:function(){return{extraClasses:"fc-footer-toolbar",layout:this.opt("footer")}},renderHeader:function(){var a=this.header;a.setToolbarOptions(this.computeHeaderOptions());a.render();a.el&&this.el.prepend(a.el)},renderFooter:function(){var a=this.footer;
a.setToolbarOptions(this.computeFooterOptions());a.render();a.el&&this.el.append(a.el)},setToolbarsTitle:function(a){this.toolbarsManager.proxyCall("updateTitle",a)},updateToolbarButtons:function(){var a=this.getNow(),b=this.view,c=b.buildDateProfile(a),d=b.buildPrevDateProfile(this.currentDate),e=b.buildNextDateProfile(this.currentDate);this.toolbarsManager.proxyCall(c.isValid&&!H(a,b.currentRange)?"enableButton":"disableButton","today");this.toolbarsManager.proxyCall(d.isValid?"enableButton":"disableButton",
"prev");this.toolbarsManager.proxyCall(e.isValid?"enableButton":"disableButton","next")},queryToolbarsHeight:function(){return this.toolbarsManager.items.reduce(function(a,b){var c=b.el?b.el.outerHeight(!0):0;return a+c},0)}});ca.defaults={titleRangeSeparator:" \u2013 ",monthYearFormat:"MMMM YYYY",defaultTimedEventDuration:"02:00:00",defaultAllDayEventDuration:{days:1},forceEventDuration:!1,nextDayThreshold:"09:00:00",defaultView:"month",aspectRatio:1.35,header:{left:"title",center:"",right:"today prev,next"},
weekends:!0,weekNumbers:!1,weekNumberTitle:"W",weekNumberCalculation:"local",scrollTime:"06:00:00",minTime:"00:00:00",maxTime:"24:00:00",showNonCurrentDates:!0,lazyFetching:!0,startParam:"start",endParam:"end",timezoneParam:"timezone",timezone:!1,isRTL:!1,buttonText:{prev:"prev",next:"next",prevYear:"prev year",nextYear:"next year",year:"year",today:"today",month:"month",week:"week",day:"day"},buttonIcons:{prev:"left-single-arrow",next:"right-single-arrow",prevYear:"left-double-arrow",nextYear:"right-double-arrow"},
allDayText:"all-day",theme:!1,themeButtonIcons:{prev:"circle-triangle-w",next:"circle-triangle-e",prevYear:"seek-prev",nextYear:"seek-next"},dragOpacity:0.75,dragRevertDuration:500,dragScroll:!0,unselectAuto:!0,dropAccept:"*",eventOrder:"title",eventLimit:!1,eventLimitText:"more",eventLimitClick:"popover",dayPopoverFormat:"LL",handleWindowResize:!0,windowResizeDelay:100,longPressDelay:1E3};ca.englishDefaults={dayPopoverFormat:"dddd, MMMM D"};ca.rtlDefaults={header:{left:"next,prev today",center:"",
right:"title"},buttonIcons:{prev:"right-single-arrow",next:"left-single-arrow",prevYear:"right-double-arrow",nextYear:"left-double-arrow"},themeButtonIcons:{prev:"circle-triangle-e",next:"circle-triangle-w",nextYear:"seek-prev",prevYear:"seek-next"}};var Oa=P.locales={};P.datepickerLocale=function(b,c,d){var e=Oa[b]||(Oa[b]={});e.isRTL=d.isRTL;e.weekNumberTitle=d.weekHeader;a.each(tb,function(a,b){e[a]=b(d)});a.datepicker&&(a.datepicker.regional[c]=a.datepicker.regional[b]=d,a.datepicker.regional.en=
a.datepicker.regional[""],a.datepicker.setDefaults(d))};P.locale=function(b,c){var d,e;d=Oa[b]||(Oa[b]={});c&&(d=Oa[b]=K([d,c],da));e=g.localeData(b)||g.localeData("en");a.each(vb,function(a,b){null==d[a]&&(d[a]=b(e,d))});ca.defaults.locale=b};var tb={buttonText:function(a){return{prev:a.prevText.replace(/&.*?;/g,""),next:a.nextText.replace(/&.*?;/g,""),today:a.currentText.replace(/&.*?;/g,"")}},monthYearFormat:function(a){return a.showMonthAfterYear?"YYYY["+a.yearSuffix+"] MMMM":"MMMM YYYY["+a.yearSuffix+
"]"}},vb={dayOfMonthFormat:function(a,b){var c=a.longDateFormat("l"),c=c.replace(/^Y+[^\w\s]*|[^\w\s]*Y+$/g,"");return c=b.isRTL?c+" ddd":"ddd "+c},mediumTimeFormat:function(a){return a.longDateFormat("LT").replace(/\s*a$/i,"a")},smallTimeFormat:function(a){return a.longDateFormat("LT").replace(":mm","(:mm)").replace(/(\Wmm)$/,"($1)").replace(/\s*a$/i,"a")},extraSmallTimeFormat:function(a){return a.longDateFormat("LT").replace(":mm","(:mm)").replace(/(\Wmm)$/,"($1)").replace(/\s*a$/i,"t")},hourFormat:function(a){return a.longDateFormat("LT").replace(":mm",
"").replace(/(\Wmm)$/,"").replace(/\s*a$/i,"a")},noMeridiemTimeFormat:function(a){return a.longDateFormat("LT").replace(/\s*a$/i,"")}},ub={smallDayDateFormat:function(a){return a.isRTL?"D dd":"dd D"},weekFormat:function(a){return a.isRTL?"w[ "+a.weekNumberTitle+"]":"["+a.weekNumberTitle+" ]w"},smallWeekFormat:function(a){return a.isRTL?"w["+a.weekNumberTitle+"]":"["+a.weekNumberTitle+"]w"}};P.locale("en",ca.englishDefaults);P.sourceNormalizers=[];P.sourceFetchers=[];var wb={dataType:"json",cache:!1},
xb=1;ca.prototype.mutateSeg=function(a,b){return this.mutateEvent(a.event,b)};ca.prototype.normalizeEvent=function(){};ca.prototype.spanContainsSpan=function(a,b){var c=a.start.clone().stripZone(),d=this.getEventEnd(a).stripZone();return b.start>=c&&b.end<=d};ca.prototype.getPeerEvents=function(a,b){var c=this.getEventCache(),d=[],e,f;for(e=0;e<c.length;e++)f=c[e],(!b||b._id!==f._id)&&d.push(f);return d};ca.prototype.isEventSpanAllowed=function(a,b){var c=b.source||{},d=this.opt("eventAllow"),e=O(b.constraint,
c.constraint,this.opt("eventConstraint")),c=O(b.overlap,c.overlap,this.opt("eventOverlap"));return this.isSpanAllowed(a,e,c,b)&&(!d||!1!==d(a,b))};ca.prototype.isExternalSpanAllowed=function(b,c,d){var e;d&&(c=a.extend({},d,c),e=this.expandEvent(this.buildEventFromInput(c))[0]);return e?this.isEventSpanAllowed(b,e):this.isSelectionSpanAllowed(b)};ca.prototype.isSelectionSpanAllowed=function(a){var b=this.opt("selectAllow");return this.isSpanAllowed(a,this.opt("selectConstraint"),this.opt("selectOverlap"))&&
(!b||!1!==b(a))};ca.prototype.isSpanAllowed=function(a,b,c,d){var e,f,g;if(null!=b&&(e=this.constraintToEvents(b))){f=!1;for(b=0;b<e.length;b++)if(this.spanContainsSpan(e[b],a)){f=!0;break}if(!f)return!1}e=this.getPeerEvents(a,d);for(b=0;b<e.length;b++)if(f=e[b],this.eventIntersectsRange(f,a)&&(!1===c||"function"===typeof c&&!c(f,d)||d&&(g=O(f.overlap,(f.source||{}).overlap),!1===g||"function"===typeof g&&!g(d,f))))return!1;return!0};ca.prototype.constraintToEvents=function(a){return"businessHours"===
a?this.getCurrentBusinessHourEvents():"object"===typeof a?null!=a.start?this.expandEvent(this.buildEventFromInput(a)):null:this.clientEvents(a)};ca.prototype.eventIntersectsRange=function(a,b){var c=a.start.clone().stripZone(),d=this.getEventEnd(a).stripZone();return b.start<d&&b.end>c};var pb={id:"_fcBusinessHours",start:"09:00",end:"17:00",dow:[1,2,3,4,5],rendering:"inverse-background"};ca.prototype.getCurrentBusinessHourEvents=function(a){return this.computeBusinessHourEvents(a,this.opt("businessHours"))};
ca.prototype.computeBusinessHourEvents=function(b,c){return!0===c?this.expandBusinessHourEvents(b,[{}]):a.isPlainObject(c)?this.expandBusinessHourEvents(b,[c]):a.isArray(c)?this.expandBusinessHourEvents(b,c,!0):[]};ca.prototype.expandBusinessHourEvents=function(b,c,d){var e=this.getView(),f=[],g,h;for(g=0;g<c.length;g++)if(h=c[g],!d||h.dow)h=a.extend({},pb,h),b&&(h.start=null,h.end=null),f.push.apply(f,this.expandEvent(this.buildEventFromInput(h),e.activeRange.start,e.activeRange.end));return f};
var kb=P.BasicView=Ea.extend({scroller:null,dayGridClass:eb,dayGrid:null,dayNumbersVisible:!1,colWeekNumbersVisible:!1,cellWeekNumbersVisible:!1,weekNumberWidth:null,headContainerEl:null,headRowEl:null,initialize:function(){this.dayGrid=this.instantiateDayGrid();this.scroller=new jb({overflowX:"hidden",overflowY:"auto"})},instantiateDayGrid:function(){return new (this.dayGridClass.extend(yb))(this)},buildRenderRange:function(a,b){var c=Ea.prototype.buildRenderRange.apply(this,arguments);/^(year|month)$/.test(b)&&
(c.start.startOf("week"),c.end.weekday()&&c.end.add(1,"week").startOf("week"));return this.trimHiddenDays(c)},renderDates:function(){this.dayGrid.breakOnWeeks=/year|month|week/.test(this.currentRangeUnit);this.dayGrid.setRange(this.renderRange);this.dayNumbersVisible=1<this.dayGrid.rowCnt;this.opt("weekNumbers")&&(this.opt("weekNumbersWithinDays")?(this.cellWeekNumbersVisible=!0,this.colWeekNumbersVisible=!1):(this.cellWeekNumbersVisible=!1,this.colWeekNumbersVisible=!0));this.dayGrid.numbersVisible=
this.dayNumbersVisible||this.cellWeekNumbersVisible||this.colWeekNumbersVisible;this.el.addClass("fc-basic-view").html(this.renderSkeletonHtml());this.renderHead();this.scroller.render();var b=this.scroller.el.addClass("fc-day-grid-container"),c=a('<div class="fc-day-grid" />').appendTo(b);this.el.find(".fc-body > tr > td").append(b);this.dayGrid.setElement(c);this.dayGrid.renderDates(this.hasRigidRows())},renderHead:function(){this.headContainerEl=this.el.find(".fc-head-container").html(this.dayGrid.renderHeadHtml());
this.headRowEl=this.headContainerEl.find(".fc-row")},unrenderDates:function(){this.dayGrid.unrenderDates();this.dayGrid.removeElement();this.scroller.destroy()},renderBusinessHours:function(){this.dayGrid.renderBusinessHours()},unrenderBusinessHours:function(){this.dayGrid.unrenderBusinessHours()},renderSkeletonHtml:function(){return'<table><thead class="fc-head"><tr><td class="fc-head-container '+this.widgetHeaderClass+'"></td></tr></thead><tbody class="fc-body"><tr><td class="'+this.widgetContentClass+
'"></td></tr></tbody></table>'},weekNumberStyleAttr:function(){return null!==this.weekNumberWidth?'style="width:'+this.weekNumberWidth+'px"':""},hasRigidRows:function(){var a=this.opt("eventLimit");return a&&"number"!==typeof a},updateWidth:function(){this.colWeekNumbersVisible&&(this.weekNumberWidth=c(this.el.find(".fc-week-number")))},setHeight:function(a,b){var c=this.opt("eventLimit"),e;this.scroller.clear();p(this.headRowEl);this.dayGrid.removeSegPopover();c&&"number"===typeof c&&this.dayGrid.limitRows(c);
e=this.computeScrollerHeight(a);this.setGridHeight(e,b);c&&"number"!==typeof c&&this.dayGrid.limitRows(c);if(!b){this.scroller.setHeight(e);c=this.scroller.getScrollbarWidths();if(c.left||c.right)d(this.headRowEl,c),e=this.computeScrollerHeight(a),this.scroller.setHeight(e);this.scroller.lockOverflow(c)}},computeScrollerHeight:function(a){return a-b(this.el,this.scroller.el)},setGridHeight:function(a,b){b?this.dayGrid.rowEls.height(""):i(this.dayGrid.rowEls,a,!0)},computeInitialDateScroll:function(){return{top:0}},
queryDateScroll:function(){return{top:this.scroller.getScrollTop()}},applyDateScroll:function(a){void 0!==a.top&&this.scroller.setScrollTop(a.top)},hitsNeeded:function(){this.dayGrid.hitsNeeded()},hitsNotNeeded:function(){this.dayGrid.hitsNotNeeded()},prepareHits:function(){this.dayGrid.prepareHits()},releaseHits:function(){this.dayGrid.releaseHits()},queryHit:function(a,b){return this.dayGrid.queryHit(a,b)},getHitSpan:function(a){return this.dayGrid.getHitSpan(a)},getHitEl:function(a){return this.dayGrid.getHitEl(a)},
renderEvents:function(a){this.dayGrid.renderEvents(a);this.updateHeight()},getEventSegs:function(){return this.dayGrid.getEventSegs()},unrenderEvents:function(){this.dayGrid.unrenderEvents()},renderDrag:function(a,b){return this.dayGrid.renderDrag(a,b)},unrenderDrag:function(){this.dayGrid.unrenderDrag()},renderSelection:function(a){this.dayGrid.renderSelection(a)},unrenderSelection:function(){this.dayGrid.unrenderSelection()}}),yb={renderHeadIntroHtml:function(){var a=this.view;return a.colWeekNumbersVisible?
'<th class="fc-week-number '+a.widgetHeaderClass+'" '+a.weekNumberStyleAttr()+"><span>"+I(a.opt("weekNumberTitle"))+"</span></th>":""},renderNumberIntroHtml:function(a){var b=this.view,a=this.getCellDate(a,0);return b.colWeekNumbersVisible?'<td class="fc-week-number" '+b.weekNumberStyleAttr()+">"+b.buildGotoAnchorHtml({date:a,type:"week",forceOff:1===this.colCnt},a.format("w"))+"</td>":""},renderBgIntroHtml:function(){var a=this.view;return a.colWeekNumbersVisible?'<td class="fc-week-number '+a.widgetContentClass+
'" '+a.weekNumberStyleAttr()+"></td>":""},renderIntroHtml:function(){var a=this.view;return a.colWeekNumbersVisible?'<td class="fc-week-number" '+a.weekNumberStyleAttr()+"></td>":""}},zb=P.MonthView=kb.extend({buildRenderRange:function(){var a=kb.prototype.buildRenderRange.apply(this,arguments),b;this.isFixedWeeks()&&(b=Math.ceil(a.end.diff(a.start,"weeks",!0)),a.end.add(6-b,"weeks"));return a},setGridHeight:function(a,b){b&&(a*=this.rowCnt/6);i(this.dayGrid.rowEls,a,!b)},isFixedWeeks:function(){return this.opt("fixedWeekCount")}});
ja.basic={"class":kb};ja.basicDay={type:"basic",duration:{days:1}};ja.basicWeek={type:"basic",duration:{weeks:1}};ja.month={"class":zb,duration:{months:1},defaults:{fixedWeekCount:!0}};var Db=P.AgendaView=Ea.extend({scroller:null,timeGridClass:ob,timeGrid:null,dayGridClass:eb,dayGrid:null,axisWidth:null,headContainerEl:null,noScrollRowEls:null,bottomRuleEl:null,usesMinMaxTime:!0,initialize:function(){this.timeGrid=this.instantiateTimeGrid();this.opt("allDaySlot")&&(this.dayGrid=this.instantiateDayGrid());
this.scroller=new jb({overflowX:"hidden",overflowY:"auto"})},instantiateTimeGrid:function(){return new (this.timeGridClass.extend(Ab))(this)},instantiateDayGrid:function(){return new (this.dayGridClass.extend(Bb))(this)},renderDates:function(){this.timeGrid.setRange(this.renderRange);this.dayGrid&&this.dayGrid.setRange(this.renderRange);this.el.addClass("fc-agenda-view").html(this.renderSkeletonHtml());this.renderHead();this.scroller.render();var b=this.scroller.el.addClass("fc-time-grid-container"),
c=a('<div class="fc-time-grid" />').appendTo(b);this.el.find(".fc-body > tr > td").append(b);this.timeGrid.setElement(c);this.timeGrid.renderDates();this.bottomRuleEl=a('<hr class="fc-divider '+this.widgetHeaderClass+'"/>').appendTo(this.timeGrid.el);this.dayGrid&&(this.dayGrid.setElement(this.el.find(".fc-day-grid")),this.dayGrid.renderDates(),this.dayGrid.bottomCoordPadding=this.dayGrid.el.next("hr").outerHeight());this.noScrollRowEls=this.el.find(".fc-row:not(.fc-scroller *)")},renderHead:function(){this.headContainerEl=
this.el.find(".fc-head-container").html(this.timeGrid.renderHeadHtml())},unrenderDates:function(){this.timeGrid.unrenderDates();this.timeGrid.removeElement();this.dayGrid&&(this.dayGrid.unrenderDates(),this.dayGrid.removeElement());this.scroller.destroy()},renderSkeletonHtml:function(){return'<table><thead class="fc-head"><tr><td class="fc-head-container '+this.widgetHeaderClass+'"></td></tr></thead><tbody class="fc-body"><tr><td class="'+this.widgetContentClass+'">'+(this.dayGrid?'<div class="fc-day-grid"/><hr class="fc-divider '+
this.widgetHeaderClass+'"/>':"")+"</td></tr></tbody></table>"},axisStyleAttr:function(){return null!==this.axisWidth?'style="width:'+this.axisWidth+'px"':""},renderBusinessHours:function(){this.timeGrid.renderBusinessHours();this.dayGrid&&this.dayGrid.renderBusinessHours()},unrenderBusinessHours:function(){this.timeGrid.unrenderBusinessHours();this.dayGrid&&this.dayGrid.unrenderBusinessHours()},getNowIndicatorUnit:function(){return this.timeGrid.getNowIndicatorUnit()},renderNowIndicator:function(a){this.timeGrid.renderNowIndicator(a)},
unrenderNowIndicator:function(){this.timeGrid.unrenderNowIndicator()},updateSize:function(a){this.timeGrid.updateSize(a);Ea.prototype.updateSize.call(this,a)},updateWidth:function(){this.axisWidth=c(this.el.find(".fc-axis"))},setHeight:function(a,b){var c,e;this.bottomRuleEl.hide();this.scroller.clear();p(this.noScrollRowEls);this.dayGrid&&(this.dayGrid.removeSegPopover(),(c=this.opt("eventLimit"))&&"number"!==typeof c&&(c=Cb),c&&this.dayGrid.limitRows(c));if(!b){c=this.computeScrollerHeight(a);this.scroller.setHeight(c);
e=this.scroller.getScrollbarWidths();if(e.left||e.right)d(this.noScrollRowEls,e),c=this.computeScrollerHeight(a),this.scroller.setHeight(c);this.scroller.lockOverflow(e);this.timeGrid.getTotalSlatHeight()<c&&this.bottomRuleEl.show()}},computeScrollerHeight:function(a){return a-b(this.el,this.scroller.el)},computeInitialDateScroll:function(){var a=g.duration(this.opt("scrollTime")),a=this.timeGrid.computeTimeTop(a);(a=Math.ceil(a))&&a++;return{top:a}},queryDateScroll:function(){return{top:this.scroller.getScrollTop()}},
applyDateScroll:function(a){void 0!==a.top&&this.scroller.setScrollTop(a.top)},hitsNeeded:function(){this.timeGrid.hitsNeeded();this.dayGrid&&this.dayGrid.hitsNeeded()},hitsNotNeeded:function(){this.timeGrid.hitsNotNeeded();this.dayGrid&&this.dayGrid.hitsNotNeeded()},prepareHits:function(){this.timeGrid.prepareHits();this.dayGrid&&this.dayGrid.prepareHits()},releaseHits:function(){this.timeGrid.releaseHits();this.dayGrid&&this.dayGrid.releaseHits()},queryHit:function(a,b){var c=this.timeGrid.queryHit(a,
b);!c&&this.dayGrid&&(c=this.dayGrid.queryHit(a,b));return c},getHitSpan:function(a){return a.component.getHitSpan(a)},getHitEl:function(a){return a.component.getHitEl(a)},renderEvents:function(a){var b=[],c=[],d;for(d=0;d<a.length;d++)a[d].allDay?b.push(a[d]):c.push(a[d]);this.timeGrid.renderEvents(c);this.dayGrid&&this.dayGrid.renderEvents(b);this.updateHeight()},getEventSegs:function(){return this.timeGrid.getEventSegs().concat(this.dayGrid?this.dayGrid.getEventSegs():[])},unrenderEvents:function(){this.timeGrid.unrenderEvents();
this.dayGrid&&this.dayGrid.unrenderEvents()},renderDrag:function(a,b){if(a.start.hasTime())return this.timeGrid.renderDrag(a,b);if(this.dayGrid)return this.dayGrid.renderDrag(a,b)},unrenderDrag:function(){this.timeGrid.unrenderDrag();this.dayGrid&&this.dayGrid.unrenderDrag()},renderSelection:function(a){a.start.hasTime()||a.end.hasTime()?this.timeGrid.renderSelection(a):this.dayGrid&&this.dayGrid.renderSelection(a)},unrenderSelection:function(){this.timeGrid.unrenderSelection();this.dayGrid&&this.dayGrid.unrenderSelection()}}),
Ab={renderHeadIntroHtml:function(){var a=this.view,b;return a.opt("weekNumbers")?(b=this.start.format(a.opt("smallWeekFormat")),'<th class="fc-axis fc-week-number '+a.widgetHeaderClass+'" '+a.axisStyleAttr()+">"+a.buildGotoAnchorHtml({date:this.start,type:"week",forceOff:1<this.colCnt},I(b))+"</th>"):'<th class="fc-axis '+a.widgetHeaderClass+'" '+a.axisStyleAttr()+"></th>"},renderBgIntroHtml:function(){var a=this.view;return'<td class="fc-axis '+a.widgetContentClass+'" '+a.axisStyleAttr()+"></td>"},
renderIntroHtml:function(){return'<td class="fc-axis" '+this.view.axisStyleAttr()+"></td>"}},Bb={renderBgIntroHtml:function(){var a=this.view;return'<td class="fc-axis '+a.widgetContentClass+'" '+a.axisStyleAttr()+"><span>"+a.getAllDayHtml()+"</span></td>"},renderIntroHtml:function(){return'<td class="fc-axis" '+this.view.axisStyleAttr()+"></td>"}},Cb=5,qb=[{hours:1},{minutes:30},{minutes:15},{seconds:30},{seconds:15}];ja.agenda={"class":Db,defaults:{allDaySlot:!0,slotDuration:"00:30:00",slotEventOverlap:!0}};
ja.agendaDay={type:"agenda",duration:{days:1}};ja.agendaWeek={type:"agenda",duration:{weeks:1}};ja.inspirockAgendaWeek={type:"agenda",duration:{days:4}};var Fb=Ea.extend({grid:null,scroller:null,initialize:function(){this.grid=new Eb(this);this.scroller=new jb({overflowX:"hidden",overflowY:"auto"})},renderSkeleton:function(){this.el.addClass("fc-list-view "+this.widgetContentClass);this.scroller.render();this.scroller.el.appendTo(this.el);this.grid.setElement(this.scroller.scrollEl)},unrenderSkeleton:function(){this.scroller.destroy()},
setHeight:function(a){this.scroller.setHeight(this.computeScrollerHeight(a))},computeScrollerHeight:function(a){return a-b(this.el,this.scroller.el)},renderDates:function(){this.grid.setRange(this.renderRange)},renderEvents:function(a){this.grid.renderEvents(a)},unrenderEvents:function(){this.grid.unrenderEvents()},isEventResizable:function(){return!1},isEventDraggable:function(){return!1}}),Eb=Ha.extend({segSelector:".fc-list-item",hasDayInteractions:!1,spanToSegs:function(a){for(var b=this.view,
c=b.renderRange.start.clone().time(0),d=0,e,f=[];c<b.renderRange.end;){if(e=C(a,{start:c,end:c.clone().add(1,"day")}))e.dayIndex=d,f.push(e);c.add(1,"day");d++;if(e&&!e.isEnd&&a.end.hasTime()&&a.end<c.clone().add(this.view.nextDayThreshold)){e.end=a.end.clone();e.isEnd=!0;break}}return f},computeEventTimeFormat:function(){return this.view.opt("mediumTimeFormat")},handleSegClick:function(b,c){var d;Ha.prototype.handleSegClick.apply(this,arguments);if(!a(c.target).closest("a[href]").length&&(d=b.event.url)&&
!c.isDefaultPrevented())window.location.href=d},renderFgSegs:function(a){a=this.renderFgSegEls(a);a.length?this.renderSegList(a):this.renderEmptyMessage();return a},renderEmptyMessage:function(){this.el.html('<div class="fc-list-empty-wrap2"><div class="fc-list-empty-wrap1"><div class="fc-list-empty">'+I(this.view.opt("noEventsMessage"))+"</div></div></div>")},renderSegList:function(b){var b=this.groupSegsByDay(b),c,d,e,f=a('<table class="fc-list-table"><tbody/></table>'),g=f.find("tbody");for(c=
0;c<b.length;c++)if(d=b[c]){g.append(this.dayHeaderHtml(this.view.renderRange.start.clone().add(c,"days")));this.sortEventSegs(d);for(e=0;e<d.length;e++)g.append(d[e].el)}this.el.empty().append(f)},groupSegsByDay:function(a){var b=[],c,d;for(c=0;c<a.length;c++)d=a[c],(b[d.dayIndex]||(b[d.dayIndex]=[])).push(d);return b},dayHeaderHtml:function(a){var b=this.view,c=b.opt("listDayFormat"),d=b.opt("listDayAltFormat");return'<tr class="fc-list-heading" data-date="'+a.format("YYYY-MM-DD")+'"><td class="'+
b.widgetHeaderClass+'" colspan="3">'+(c?b.buildGotoAnchorHtml(a,{"class":"fc-list-heading-main"},I(a.format(c))):"")+(d?b.buildGotoAnchorHtml(a,{"class":"fc-list-heading-alt"},I(a.format(d))):"")+"</td></tr>"},fgSegHtml:function(a){var b=this.view,c=["fc-list-item"].concat(this.getSegCustomClasses(a)),d=this.getSegBackgroundColor(a),e=a.event,f=e.url,e=e.allDay?b.getAllDayHtml():b.isMultiDayEvent(e)?a.isStart||a.isEnd?I(this.getEventTimeText(a)):b.getAllDayHtml():I(this.getEventTimeText(e));f&&c.push("fc-has-url");
return'<tr class="'+c.join(" ")+'">'+(this.displayEventTime?'<td class="fc-list-item-time '+b.widgetContentClass+'">'+(e||"")+"</td>":"")+'<td class="fc-list-item-marker '+b.widgetContentClass+'"><span class="fc-event-dot"'+(d?' style="background-color:'+d+'"':"")+'></span></td><td class="fc-list-item-title '+b.widgetContentClass+'"><a'+(f?' href="'+I(f)+'"':"")+">"+I(a.event.title||"")+"</a></td></tr>"}});ja.list={"class":Fb,buttonTextKey:"list",defaults:{buttonText:"list",listDayFormat:"LL",noEventsMessage:"No events to display"}};
ja.listDay={type:"list",duration:{days:1},defaults:{listDayFormat:"dddd"}};ja.listWeek={type:"list",duration:{weeks:1},defaults:{listDayFormat:"dddd",listDayAltFormat:"LL"}};ja.listMonth={type:"list",duration:{month:1},defaults:{listDayAltFormat:"dddd"}};ja.listYear={type:"list",duration:{year:1},defaults:{listDayAltFormat:"dddd"}};return P});
define("jQueryExtensions/linkToEndTimeSelect",["jquery","jqueryui"],function(){$.fn.linkToEndTimeSelect=function(a,g){var d=$(this),g=g||30;d.off("selectmenuchange.linkToEndTimeSelect").on("selectmenuchange.linkToEndTimeSelect",function(){var p=parseInt(d.val(),10),m=parseInt(a.val(),10);if(-1!==p&&(isNaN(m)||p>=m)&&1440>=p+g)a.val(p+g),a.selectmenu("refresh");return!0});a.off("selectmenuchange.linkToEndTimeSelect").on("selectmenuchange.linkToEndTimeSelect",function(){var p=parseInt(d.val(),10),m=
parseInt(a.val(),10);if(-1!==m&&(isNaN(p)||-1===p||p>=m)&&0<=m-g)d.val(m-g),d.selectmenu("refresh");return!0})}});
define("plan/calendar","modules/analytics modules/analyticsEventParams modules/utils modules/ajax modules/events modules/history plan/visits plan/reserveds plan/travelEdit plan/planUtils modules/copyright plan/reservation/reservation text!templates/reservedDropDown.html text!templates/visitDropDown.html moment explore/exploreWrapper text!templates/calendarDropDown.html plan/loading jquery jqueryui jQueryExtensions/inspirockAutocomplete jQueryExtensions/inspirockDatepicker qtip fullCalendar jQueryExtensions/linkToEndTimeSelect jQueryExtensions/inspirockSelectmenu".split(" "),function(a,
g,d,p,m,j,i,c,b,f,u,n,k,h,e,l,t,r){function q(a,b){b.isOverflow||V?(Y=a,D("Travel"===b.eventType||"Travel-Faux"===b.eventType?ba:b.stayId)):s.loadCalendarEvents(a)}function D(a){ba=a;for(var b=jQuery.extend(!0,{},Y),c=[],f=0;f<Y.events.length;f++){var g=Y.events[f];g.stayId===a&&("Visit"===g.eventType||"Reserved"===g.eventType||"Hop"===g.eventType)&&c.push(g)}for(var g=b.stayTravelItems,f=[],h=0,i,j,l=0;l<g.length;l++)if(g[l].id===a){f.push(g[l]);h=l;break}a=[];for(l=h-1;0<=l;l--)if(!g[l].eventType){i=
g[l];break}for(l=h+1;l<g.length;l++)if(!g[l].eventType){j=g[l];break}var l=c[0]?c[0].start:void 0,m=c[c.length-1]?c[c.length-1].end:void 0;f[0].leftOverflowItems&&f[0].leftOverflowItems.length&&(a=$.merge(a,f[0].leftOverflowItems),l=a[0].start);var k=g[h-1];k&&(a=$.merge(a,[k]),l=!l||k.start<l?k.start:l);a=$.merge(a,c);c=g[h+1];f[0].rightOverflowItems&&f[0].rightOverflowItems.length&&(a=$.merge(a,f[0].rightOverflowItems),m=f[0].rightOverflowItems[f[0].rightOverflowItems.length-1].end>m?f[0].rightOverflowItems[f[0].rightOverflowItems.length-
1].end:m);c&&(a=$.merge(a,[c]),m=!m||c.end>m?c.end:m);b.events=a;b.stays=f;b.start=e.utc(l).startOf("day").valueOf();b.end=e.utc(m).startOf("day").valueOf();b.previousStay=i;b.nextStay=j;if(V)s.loadCalendarEvents(b,void 0,!1,!0,$(".dlg-show-overflow-calendar").find(".calendar-container"),!0);else{var n=$("<div class='calendar-container'><div class='calendar-modal'><div id='calendar' class='itinerary-calendar-pane modal dock-top' style='opacity: 1;'/></div></div>");n.find("#calendar").append($("<div id='calendarStayBox' class='calendar-stay-box'/>")).append($("<div id='calendarBox' class='calendar-box'/>"));
n.dialog({resizable:!1,modal:!0,draggable:!1,width:"1083",dialogClass:"dlg-show-overflow-calendar mediumx",buttons:{Done:function(){n.dialog("close")}},open:function(){var a=n.parents(".dlg-show-overflow-calendar");s.loadCalendarEvents(b,void 0,!0,!0,n,!1);$(".resultspage").addClass("scroll-hide-todo");a.find("#calendar").is(":visible")&&(z(),a.find(".ui-dialog-content").scroll(function(){z()}));d.detectIE()&&($("body").off("mousewheel"),a.find(".ui-dialog-content").on("mousewheel",function(b){if(!$(".modal-box").length){b.preventDefault();
var b=b.originalEvent.wheelDelta,c=a.find(".ui-dialog-content").scrollTop();a.find(".ui-dialog-content").scrollTop(c-b)}}))},close:function(){n.dialog("destroy").remove();s.loadCalendarEvents(Y,void 0,void 0,void 0,void 0,!0);$(".resultspage").removeClass("scroll-hide-todo");d.detectIE()&&d.enableMouseWheel()}})}}function v(a){var b=[],c;for(c in A){var d=A[c];a.isSameOrAfter(d.arrivalTime,"day")&&a.isSameOrBefore(d.departureTime,"day")&&b.push(c)}1<b.length&&b.sort(function(a,b){return A[a].arrivalTime-
A[b].arrivalTime});return b}function B(a){return e(a.format(S),S)}function z(){var a=V?$(".dlg-show-overflow-calendar").find("#calendarBox"):$("#calendarBox");if(a.is(":visible")){var b=a.find(".fc-header-toolbar"),c=$(".itinerary-subnav-pane"),d=b.find(".fc-prev-button"),b=b.find(".fc-next-button"),e=a.offset().top,f=a.height(),g=$(window).scrollTop(),h=$(window).height(),a=Math.max(e,g),f=Math.min(e+f,g+h),a=(f-a)/2+52;c.hasClass("dock-top")&&(a=Math.max(e,c.offset().top+c.height()),a=(f-a)/2+Math.max(0,
c.offset().top+c.height()-e)+52);a=Math.max(a,0);d.css({top:a+"px"});b.css({top:a+"px"})}}function C(a,b,c){function d(a){var b=I[a].currentStayId;I[a].currentStayId=I[a].alternateStayId;I[a].alternateStayId=b}var f=e(a).format(T),g=e(a).add(1,"days"),a=e(a).subtract(1,"days"),h=!0,i=!0,j=I[f].currentStayId;for(O.hasOwnProperty(f)&&d(f);h||i;){var f=g.format(T),l=a.format(T);h&&O.hasOwnProperty(f)&&I[f].currentStayId===j?(d(f),g.add(1,"days")):h=!1;i&&O.hasOwnProperty(l)&&I[l].currentStayId===j?(d(l),
a.subtract(1,"days")):i=!1}g=F();x.fullCalendar("removeEvents");x.fullCalendar("addEventSource",g);ja(b,c)}function G(a){a.start>L?x.find(".fc-prev-button").show():x.find(".fc-prev-button").hide();a.end<=Q?x.find(".fc-next-button").show():x.find(".fc-next-button").hide()}function M(){m.addObserver("scroll","calendar",z)}function w(){m.removeObserver("scroll","calendar")}function J(){return V?g.CAT_PLAN_CALENDAR_OVERFLOW:g.CAT_PLAN_CALENDAR}function F(){var a=[],b;for(b in N){var c=N[b],d=c.start.format(T),
e=c.end.format(T);O[d]&&(c.stayId===I[d].currentStayId||-1===c.stayId&&c.nextStayId===I[d].currentStayId)?a.push(c):!O[d]&&O[e]&&c.nextStayId&&c.nextStayId===I[e].currentStayId?a.push(c):O[d]||a.push(c)}return a}function y(){$("#calendarItemContainer").css("display","none")}var s={},H,x,A,E,K,L,Q,N=[],O,I,T=d.ISO_DATE_FORMAT,S=d.ISO_DATE_TIME_FORMAT,U,aa,W,Y,V=!1,ba,ha,ia,pa,ka,na=!1,sa=!0,t=d.removeTagsFromString(t,".add-reservation",$("#plan").data("reservationsEnabled")),Na=function(b,c){if($("#plan").data("editEnabled")&&
!V&&!$(".qtip.calendar-add-tip").length){var d=b.utc(),e=d.format(T);if(!d.isBefore(E)&&!d.isAfter(K)&&!d.isSame(K)){var f=[],h;for(h in A)(d.isSame(A[h].arrivalTime)||d.isAfter(A[h].arrivalTime))&&d.isBefore(A[h].departureTime)&&f.push(A[h]);if(f.length&&(d=1===f.length?f[0]:A[I[e].currentStayId],!(O[e]&&I[e].currentStayId!==d.id))){var i={};i.dateForExplore=b.clone();i.destinationId=d.destinationId;i.stayId=d.id;i.stayArrivalTime=d.arrivalTime;i.stayDepartureTime=d.departureTime;i.date=b.utc().format(T);
i.startTime=b.utc().format("HH:mm");i.tip={corner:!0,width:20,height:10,mimic:"center bottom",offset:40};i.position={at:"center",my:"bottom left",target:[c.pageX,c.pageY],viewport:$(window),adjust:{x:-12,scroll:!1,resize:!1}};i.view="CalendarData";e=60*b.hours()+b.minutes();i.startTimeInMinutes=e;i.endTimeInMinutes=e+30;i.notes=null;i.url=window.contextPath+"/trip/"+$("#plan").data("planId")+"/reserved";i.successCB=function(b){s.loadCalendarEvents(b);m.triggerEvent("calendar","reserved-add",{uiSource:i.uiSource,
suppressRefresh:!0});a.trackEvent(J(),g.ACT_ADD_RESERVED);m.triggerEvent("route","mmt_track_link",{linkName:"Add Reserved"})};i.reserveEdit=!1;i.content=t;i.className=" cal-day-tip";i.timeRanges=[{start:d.arrivalTime.clone(),end:d.departureTime.clone()}];i.width="200";s.addItemClick(i,$(this))}}}},Qa=function(a,f,g){if(!$(f.target).hasClass("overflow-icon-container")&&($(f.target).parents(".fc-event").data("qtip")&&$(f.target).parents(".fc-event").data("qtip").destroy(!0),$("#plan").data("editEnabled")&&
"Hop"!==a.eventType)){var j=a.start.diff(g.start,"days"),g={},n={},p=A[a.stayId],s=$(this),r="right center",t="left center",y=s.offset().left+s.width();1<j&&(r="left center",t="right center",y=s.offset().left);g.tip={corner:!0,width:20,height:10};g.position={at:r,my:t,target:[y,f.pageY],viewport:$(window),adjust:{resize:!1,method:"shift"}};g.view="CalendarData";g.startTimeInMinutes=60*a.start.hours()+a.start.minutes();g.endTimeInMinutes=60*a.end.hours()+a.end.minutes();g.endTimeInMinutes=0===g.endTimeInMinutes?
1440:g.endTimeInMinutes;g.start=a.start;g.end=a.end;g.successCB=function(b){q(b,a);b={uiSource:"itinerary.calendar.replanDialog.replan"};"Visit"===a.eventType?m.triggerEvent("calendar","visit-update",b):"Reserved"===a.eventType&&m.triggerEvent("calendar","reserved-update",b)};g.isOverflow=a.isOverflow;n.isOverflow=a.isOverflow;n.successCB=function(b){q(b,a);b={uiSource:"itinerary.calendar.replanDialog.remove",suppressRefresh:!0};"Visit"===a.eventType?m.triggerEvent("calendar","visit-remove",b):"Reserved"===
a.eventType&&m.triggerEvent("calendar","reserved-remove",b)};n.view="CalendarData";g.deleteData=n;if("Visit"===a.eventType){g.date=a.start.format(T);g.visitId=a.id;g.name=a.title;g.content=h;g.visitEdit=!0;g.url=window.contextPath+"/trip/"+$("#plan").data("planId")+"/visit/"+a.id;g.detailsUrl=a.detailsUrl;g.attractionId=a.dataId;g.stayId=a.stayId;g.stayArrivalTime=p.arrivalTime;g.stayDepartureTime=p.departureTime;n.visitId=a.id;g.rating=a.rating;g.attractionTagInfo=a.attractionTagInfo;g.notes=a.notes?
$("<textarea/>").html(a.notes).text():a.notes;g.attachments=a.attachments;var f=A[a.stayId].destinationId,j=[],w;for(w in A)n=A[w],n.destinationId===f&&j.push({start:n.arrivalTime.clone(),end:n.departureTime.clone()});g.timeRanges=j;g.successDialogOpen=function(a){a&&(na=!1)};na||(na=!0,i.openVisitItemDialog(g,A,E,K,V,l))}else"Reserved"===a.eventType?(g.url=window.contextPath+"/trip/"+$("#plan").data("planId")+"/reserved/"+a.id,g.name=a.title?$("<textarea/>").html(a.title).text():a.title,g.date=a.start.format(T),
g.notes=a.notes?$("<textarea/>").html(a.notes).text():a.notes,g.attachments=a.attachments,g.reserveEdit=!0,g.location=a.location,g.content=k,g.stayArrivalTime=p.arrivalTime,g.stayDepartureTime=p.departureTime,g.timeRanges=[{start:p.arrivalTime.clone(),end:p.departureTime.clone()}],g.reservedId=a.id,g.stayId=a.stayId,n.reservedId=a.id,g.successDialogOpen=function(a){a&&(na=!1)},f=e($("#plan").data("planStartDate"),d.ISO_DATE_FORMAT),w=e($("#plan").data("planEndDate"),d.ISO_DATE_FORMAT),na||(na=!0,
c.openReservedItemDialog(g,f,w,V))):"Travel"===a.eventType&&(g={successCB:function(b){q(b,a);m.triggerEvent("calendar","travel-update",{suppressRefresh:!0})},successDialogOpen:function(a){a&&(na=!1)}},e(E.format(S),S),e(K.format(S),S),w=$.extend({},a),w.notes=w.notes?$("<textarea/>").html(w.notes).text():w.notes,p=A[w.stayId],n=A[w.nextStayId],j=w.isBoundary&&void 0===p||V?w.localStartDateTime.clone().startOf("day"):p.arrivalTime.clone(),n=w.isBoundary&&void 0===n||V?w.localEndDateTime.clone().add("h",
24).endOf("day"):n.departureTime.clone(),s=w.isBoundary&&void 0===p?j.clone().add(30,"m"):n.clone().subtract(30,"m"),p=j.clone().add(30,"m"),j=[e(j.format(S),S),e(s.format(S),S)],n=[e(p.format(S),S),e(n.format(S),S)],na||(na=!0,b.travelClick(w,f,j,n,g,V,"calendar")))}},Xa=function(b){var d=H.find("#event-"+b.id);d.qtip()&&d.qtip("destroy",!0);var e=$(document.createElement("div")),f=$('<div class="delete-confirm clickable"><input type="button" class="button cta-button small" value="Delete '+("Visit"===
b.eventType?"Attraction":"Blocked Time")+'?"></div>');f.find(".cta-button").attr("data-event-id",b.id).attr("data-event-type",b.eventType).attr("data-title",b.title).attr("data-has-notes",b.notes||b.attachments).attr("data-target","#event-"+b.id);e.append(f);d.qtip({content:e,position:{my:"top right",at:"top right",viewport:d,adjust:{method:"none none"}},show:{event:"click",delay:0,ready:!0},hide:{event:"unfocus",fixed:!0},events:{show:function(d,e){f.find(".cta-button").click(function(d){var f=$(d.currentTarget).data("eventId"),
h=$(d.currentTarget).data("eventType"),j=$(d.currentTarget).data("title"),l=$(d.currentTarget).data("hasNotes"),l={title:j,hasNotes:l,$target:$(H.find($(d.currentTarget).data("target"))),successCB:function(a){q(a,b);a={uiSource:"itinerary.calendar",suppressRefresh:!0};"Visit"===h?m.triggerEvent("calendar","visit-remove",a):"Reserved"===h?m.triggerEvent("calendar","reserved-remove",a):"Hop"===h&&m.triggerEvent("calendar","hop-remove",a)}};"Visit"===h?(l.visitId=f,l.view="CalendarData",l.isOverflow=
b.isOverflow,a.trackEvent(J(),g.ACT_DEL_VISIT,j.toLowerCase()),i.removeFromPlan(l)):"Reserved"===h&&(l.reservedId=f,l.view="CalendarData",l.isOverflow=b.isOverflow,a.trackEvent(J(),g.ACT_DEL_RESERVED),c.removeFromPlan(l));d.stopPropagation();e.destroy(!0)})},hide:function(a,b){b.destroy(!0)}},style:{classes:"noShadow noBorder deleteConfirm",width:"221",tip:{corner:!1}}})},Ba=function(a){H.find("#event-"+a.id).addClass("show-on-top");H.find("#event-"+a.id).addClass("event-drag-start")},ya=function(b,
c,f){H.find("#event-"+b.id).removeClass("show-on-top");H.find("#event-"+b.id).removeClass("event-drag-start");if(b.minTime&&b.maxTime&&(b.start.isBefore(b.minTime)||b.end.isAfter(b.maxTime)))"Visit"===b.eventType?d.showMessageDialog("Cannot reschedule visit to "+b.title+" outside your "+A[b.stayId].name+" stay.","OK"):"Reserved"===b.eventType&&d.showMessageDialog("Cannot reschedule this blocked time outside your "+A[b.stayId].name+" stay.","OK"),f();else{var c=60*b.start.hours()+b.start.minutes(),
h=e.duration(b.end-b.start).asMinutes();if("Visit"===b.eventType){a.trackEvent(J(),g.ACT_RESIZE_VISIT,b.title.toLowerCase());var i={date:b.start.format(T),startTime:c,duration:h,view:"CalendarData",isOverflow:b.isOverflow,move:!0};1440<c+h?(d.showMessageDialog("Cannot schedule visit to "+b.title+" past the end of the day.","OK"),f()):p.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/visit/"+b.id,type:"POST",data:i,synchronize:!0,success:function(a){q(a,b);m.triggerEvent("calendar",
"visit-update",{uiSource:"itinerary.calendar.resize"})},error:function(){window.console.log("error on server?");f()}})}else"Reserved"===b.eventType?(a.trackEvent(J(),g.ACT_RESIZE_RESERVED),i={date:b.start.format(T),fromTime:c,duration:h,view:"CalendarData",isOverflow:b.isOverflow,isMove:!0},p.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/reserved/"+b.id,type:"POST",data:i,synchronize:!0,success:function(a){q(a.calendarData?a.calendarData:a,b);m.triggerEvent("calendar",
"reserved-update",{uiSource:"itinerary.calendar.resize"})},error:function(){window.console.log("error on server?");f()}})):"Travel"===b.eventType&&(a.trackEvent(J(),g.ACT_RESIZE_TRAVEL),i={startDateTime:b.start.format(S),endDateTime:b.end.format(S),view:"CalendarData",move:!0},p.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/travel/"+b.id,type:"POST",data:i,synchronize:!0,success:function(a){q(a,b);m.triggerEvent("calendar","travel-update",{suppressRefresh:!0})},error:function(){window.console.log("error on server?");
f()},complete:function(){}}))}},Ja=function(a){H.find("#event-"+a.id).addClass("event-drag-start")},Ta=function(a){H.find("#event-"+a.id).removeClass("event-drag-start")},Pa=function(b,c,f){var c=60*b.start.hours()+b.start.minutes(),h=e.duration(b.end-b.start).asMinutes();if("Visit"===b.eventType){var i;var j=b.start,l=b.end,k=[];for(i in A){var n=A[i];!j.isBefore(n.arrivalTime)&&!l.isAfter(n.departureTime)&&k.push(i)}1===k.length?i=k[0]:1<k.length?(i=j.format(T),i=I[i].currentStayId):i=void 0;!V&&
void 0===i?(d.showMessageDialog("Cannot reschedule visit to "+b.title+" outside of your "+A[b.stayId].name+" stay.","OK"),f()):1440<c+h?(d.showMessageDialog("Cannot reschedule visit across days.","OK"),f()):(a.trackEvent(J(),g.ACT_MOVE_VISIT,b.title.toLowerCase()),c={date:b.start.format(T),startTime:c,duration:h,view:"CalendarData",isOverflow:b.isOverflow,isOverflowMode:V,move:!0},p.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/visit/"+b.id,type:"POST",data:c,synchronize:!0,
success:function(a){q(a,b);m.triggerEvent("calendar","visit-update",{uiSource:"itinerary.calendar.drop"})},error:function(){window.console.log("error on server?");f()}}))}else"Reserved"===b.eventType?!V&&b.minTime&&b.maxTime&&(b.start<b.minTime||b.end>b.maxTime)?(d.showMessageDialog("Cannot reschedule this blocked time outside your "+A[b.stayId].name+" stay.","OK"),f()):1440<c+h?(d.showMessageDialog("Cannot reschedule blocked time across days.","OK"),f()):(a.trackEvent(J(),g.ACT_MOVE_RESERVED),c=
{date:b.start.format(T),fromTime:c,duration:h,view:"CalendarData",isOverflow:b.isOverflow,isOverflowMode:V,isMove:!0},p.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/reserved/"+b.id,type:"POST",data:c,synchronize:!0,success:function(a){q(a.calendarData?a.calendarData:a,b);m.triggerEvent("calendar","reserved-update",{uiSource:"itinerary.calendar.drop"})},error:function(){window.console.log("error on server?");f()}})):"Travel"===b.eventType?(a.trackEvent(J(),g.ACT_MOVE_TRAVEL),
c={startDateTime:b.start.format(S),endDateTime:b.end.format(S),view:"CalendarData",move:!0,isOverflowMode:V},p.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/travel/"+b.id,type:"POST",data:c,synchronize:!0,success:function(a){q(a,b);m.triggerEvent("calendar","travel-update",{suppressRefresh:!0})},error:function(){window.console.log("error on server?");f()}})):"Travel-Faux"===b.eventType&&(-1!==b.className.indexOf("travel-faux-arrival")?(c=b.end.format(S),h=b.end.format(S)):
(c=b.start.format(S),h=b.start.format(S)),c={startDateTime:c,endDateTime:h,view:"CalendarData",move:!0,isOverflowMode:V,isFauxTravel:!0},p.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/travel/"+b.id,type:"POST",data:c,synchronize:!0,success:function(a){q(a,b);m.triggerEvent("calendar","travel-update",{suppressRefresh:!0})},error:function(){window.console.log("error on server?");f()}}))};s.getStartDay=function(){if(x.data("fullCalendar"))return e.duration(x.fullCalendar("getDate").utc()-
L).asDays()+1};var ga=function(b,c,d,e,h,i,j){if(!$(".calendar-tip").length&&!$(".deleteConfirm").length){if($("#plan").data("editEnabled")&&(h&&(c=$('<div><div class="title">Conflict:</div><div class="content">Travel time is longer than your schedule has allowed.</div></div>')),!e.isOverflow)){var l=$('<div class="tip-message"><span class="tip">Tip:</span> '+(h?"Set aside more time":"Drag activity to a new time")+' or <br/><span class="recalculate-link text-link">Recalculate '+A[e.stayId].name+"</span></div>");
l.find(".recalculate-link").attr("data-stay-id",b.data("stayId"));c.find(".content").append(l)}var k,n,p,l=[0,0];h?(d="bottom left",k="top left",j={corner:!0,width:20,height:10,offset:50,mimic:"center top"},n=-9,p=-11,l=i?i:""):(i=e.start.diff(d.start,"days"),1<i?(k="left center",d="right center"):(k="right center",d="left center"),l[0]=1<i?b.offset().left:b.offset().left+b.width(),l[1]=j.pageY,p=n=0,j={width:20,height:10});(h?b:b.find(".overflow-icon")).qtip({content:{text:c,button:!0},overwrite:!1,
show:{ready:"true"},hide:{delay:100,event:h?"mouseout":"unfocus",fixed:!0},position:{my:d,at:k,target:l,viewport:$(window),adjust:{x:n,y:p,method:"shift"}},events:{show:function(b,c){$(".calendar-tip").qtip("hide");c.elements.button.removeAttr("title");$(this).off("click.recalculate-link").on("click.recalculate-link",".recalculate-link",function(){c.hide();var b=$(this).data("stayId"),d=A[b].startDate.clone().format(T),b=$(this).data("stayId");a.trackEvent(g.CAT_PLAN_CALENDAR_ERRORTIP,g.ACT_RECALC);
var e=parseInt(b,10),b=A[e];f.recalcStay(e,function(){V&&H.dialog("close");m.triggerEvent("notifications","stay-update",{uiSource:"notifications.recalculate",suppressRefresh:!0});m.triggerEvent("notifications","mmt_track_link",{linkName:"Recalculate"});m.triggerEvent("notifications","show-tab-itinerary",{addToHistory:!0,tabData:{subnav:"calendar",stayId:e,slotIndex:0,date:d}})},void 0,void 0,b&&(b.leftOverflowItems&&b.leftOverflowItems.length||b.rightOverflowItems&&b.rightOverflowItems.length),b.name)});
0===c.elements.content.siblings(".qtip-fillerDiv").length&&$('<div class="qtip-fillerDiv"></div>').insertBefore(c.elements.content)},hide:function(a,b){b.destroy(!0)}},style:{classes:"error-qtip qtip-light qtip-shadow calendar-tip "+(V?"overflow-error-tip ":"")+(e.isOverflow?"overflow-event-tip":""),tip:j}})}};s.gotoDate=function(a,b,c){var d=function(){var d,f=!(null===b||void 0===b),g;g=!a&&c&&c.stayId?A[c.stayId].startDate||E:a||E;if((d=e(g))&&x.data("fullCalendar")){x.fullCalendar("gotoDate",
d);c&&c.showOverflow&&D(c.stayId);d=x.fullCalendar("getView");var h=!$("#plan").data("editEnabled");c.stayId&&(I&&I[g]&&I[g].currentStayId!==c.stayId)&&C(g,d,h);f?(g=b?$("#event-"+b):$(".visitEvent").first(),d=g.height()+10):(g=$(".fc-body").find(".fc-slats").find("[data-time='"+W+"']"),d=0);m.triggerEvent("calendar","scroll-first-visit",{element:g,additionalYOffset:d});if(f&&$("#plan").data("editEnabled")&&!c.visitNoOpen){var i=$("#event-"+b);i.length&&(i.trigger("mouseenter"),setTimeout(function(){H.is(":visible")&&
(i.trigger("mouseover").trigger("click"),c.edit&&setTimeout(function(){$(".edit-event,.edit-container").trigger("click")},100))},100))}f=$("#itinerarySubnavPane").find(".subnav-tabs").find("#calendarlink");d=f.attr("id");h=f.data("target");$(".modal-box").length||(g=j.getState(),delete c.visitId,d={targetId:h,subnavLinkId:d,historyData:c},(!g||"itinerary"!==g.id||"itinerary"!==g.tabId||g.url!==f.data("url")||!g.data||!g.data.historyData||JSON.stringify(g.data.historyData)!==JSON.stringify(d.historyData))&&
j.replace("itinerary","itinerary",f.data("url"),d))}};sa?(H.one("refreshed",d),s.refreshIfInvalid(!1)):d()};s.reloadTabWithDestinationInView=function(a,b){var c=H.find(".navigationLink.stay-list-title").filter(function(){return $(this).data("stayId")===b});c.hasClass("stay-list-title")&&(c=$(c.siblings(".day-list").find(".day-list-title")[0]));c=c.data("dayNumber");c=L.clone().add(c-1,"days");s.reloadTab(a,c)};s.loadCalendarEvents=function(b,c,f,h,i,j){var l=b.stays,k=b.events,n=b.dayStartTime,p=
0,s,q,r=!$("#plan").data("editEnabled"),t;h?(V=!0,ha=b.previousStay,ia=b.nextStay):(Y=b,V=!1);aa=n;N=[];h=Math.floor(n/60);n%=60;W=(9<h?h:"0"+h)+":"+(9<n?n:"0"+n)+":00";E=e.utc(b.start);K=e.utc(b.end).utc().add(1,"days");A={};for(p=0;p<l.length;p++)n=l[p],n.arrivalTime=e.utc(n.arrivalTime),n.startDate=n.arrivalTime.clone().startOf("day"),n.departureTime=e.utc(n.departureTime),n.endDate=n.departureTime.clone().startOf("day").add(1,"days"),n.firstSchedulableTime=e.utc(n.firstSchedulableTime),n.firstSchedulableDate=
n.firstSchedulableTime.clone().startOf("day"),n.lastSchedulableTime=e.utc(n.lastSchedulableTime),n.lastSchedulableDate=n.lastSchedulableTime.clone().startOf("day"),A[n.id]=n;j||(pa=I,ka=O);I={};O={};for(p=0;p<k.length;p++)k[p].hasOwnProperty("localStartDateTime")&&e(k[p].localStartDateTime);for(p=0;p<k.length;p++)if(j=A[k[p].stayId],j={id:k[p].id,title:k[p].title,start:e.utc(k[p].start),end:e.utc(k[p].end),duration:e.duration(k[p].duration,"minutes"),eventType:k[p].eventType,minTime:"Travel"!==k[p].eventType&&
j?j.arrivalTime:void 0,maxTime:"Travel"!==k[p].eventType&&j?j.departureTime:void 0,conflict:k[p].conflict,dataId:k[p].dataId,detailsUrl:k[p].detailsUrl,notes:k[p].notes,attachments:k[p].attachments,sideTrip:k[p].sideTrip,stayId:k[p].stayId,nextStayId:k[p].nextStayId,distance:k[p].distance,durationInHoursAndMinutes:k[p].durationInHoursAndMinutes,startDestination:k[p].startDestination,endDestination:k[p].endDestination,isBoundary:k[p].isBoundary,isTrainBookable:k[p].isTrainBookable,localStartDateTime:k[p].hasOwnProperty("localStartDateTime")?
e(k[p].localStartDateTime):void 0,localEndDateTime:k[p].hasOwnProperty("localEndDateTime")?e(k[p].localEndDateTime):void 0,openCloseTimeText:k[p].openCloseTimeText,modeName:k[p].modeName,customName:k[p].customName,rating:k[p].rating,attractionTagInfo:k[p].attractionTagInfo,firstMajorMode:k[p].firstMajorMode,isOverflow:k[p].isOverflow,location:k[p].location,overflowType:k[p].overflowType},!("Hop"===j.eventType&&0===j.end.diff(j.start)&&j.start.clone().startOf("day").isSame(j.start))){if(q&&(j.start.date()!==
q.start.date()&&j.end.isAfter(j.start)||j.stayId!==q.stayId))"Hop"===q.eventType&&(q.last=!0),s=q=void 0;if("Hop"===k[p].eventType){if(s&&j.end.isBefore(j.start)){s.nextHopError=!0;continue}q&&("Reserved"===q.eventType&&0===j.duration.asMinutes())&&(j.title="");j.className=["hopEvent"];q||(j.first=!0);j.editable=!1;j.requiredDuration=e.duration(30*Math.floor((j.duration.asMinutes()+29)/30),"minutes")}else"Visit"===k[p].eventType||"Reserved"===k[p].eventType?(s?(!0===s.nextHopError&&(j.prevHopError=
!0),j.start.isBefore(t)&&(s.overlapped=!0,j.overlapped=!0),t=j.end.isAfter(t)?j.end.clone():t):t=j.end.clone(),q&&("Hop"===q.eventType&&"Reserved"===j.eventType&&0===q.duration.asMinutes())&&(q.title=""),j.className="Visit"===j.eventType?["visitEvent"]:["reservedEvent"],j.editable=!r,s=j):"Travel"===k[p].eventType?(j.className="travelEvent",j.startEditable=!r,j.startEditable=!k[p].isGoingBackInTime,j.editable=!r,j.durationEditable=!k[p].isGoingBackInTime,j.formattedDuration=k[p].formattedDuration,
l=k[p].stayId,n=k[p].nextStayId,k[p].isGoingBackInTime&&(l=0<=p-1?"Travel"===k[p-1].eventType?k[p-1].nextStayId:k[p-1].stayId:void 0,n=p+1<=k.length-1?"Travel"===k[p+1].eventType?k[p+1].nextStayId:k[p+1].stayId:void 0),!V&&(l&&A[l]&&A[l].rightOverflowItems&&A[l].rightOverflowItems.length)&&(j.overflowBefore=!0,j.previousOverflowStayId=A[l].id),!V&&(n&&A[n]&&A[n].leftOverflowItems&&A[n].leftOverflowItems.length)&&(j.overflowAfter=!0,j.nextOverflowStayId=A[n].id),r&&(j.startEditable=!r,j.durationEditable=
!r),q&&"Hop"===q.eventType?(q.last=!0,q.end>j.start&&(j.overlapped=!0)):!q&&120>e.duration(j.end-j.start).asMinutes()&&(j.overlapped=!0)):"Travel-Faux"===k[p].eventType&&("Arrival"===k[p].title?(j.className=["travelFauxEvent","travel-faux-arrival"],n=b.stays[0].id,l=void 0):(j.className=["travelFauxEvent","travel-faux-departure"],l=b.stays[0].id,n=void 0),j.editable=!r,j.durationEditable=!1,!V&&(l&&A[l]&&A[l].rightOverflowItems&&A[l].rightOverflowItems.length)&&(j.overflowBefore=!0,j.previousOverflowStayId=
A[l].id),!V&&(n&&A[n]&&A[n].leftOverflowItems&&A[n].leftOverflowItems.length)&&(j.overflowAfter=!0,j.nextOverflowStayId=A[n].id));j.isOverflow&&(j.className.push("overflow-event"),"Hop"!==j.eventType&&j.className.push("conflict bg-stripe red"),j.durationEditable=!1);q&&(q.nextId=j.id,j.prevId=q.id);if(!V&&(-1!==j.stayId||j.hasOwnProperty("nextStayId")&&j.nextStayId)){l=j.start.clone().startOf("day").subtract(1,"d");for(n=l.format(T);l.isAfter(E)||l.isSame(E);){if(I.hasOwnProperty(n))if(I[n].currentStayId!==
j.stayId&&(l.isSame(A[j.stayId].firstSchedulableDate)||l.isAfter(A[j.stayId].firstSchedulableDate))){I[n].alternateStayId=j.stayId;var h=A[I[n].currentStayId],w=A[j.stayId];h.timezoneOffset!==w.timezoneOffset&&h.departureTime>=w.arrivalTime&&(O[n]=1)}else break;else I[n]={currentStayId:j.stayId};l=l.subtract(1,"d");n=l.format(T)}l=j.start.format(T);I.hasOwnProperty(l)?I[l].currentStayId!==j.stayId&&(I[l].alternateStayId=j.stayId,h=A[I[l].currentStayId],w=A[j.stayId],h.timezoneOffset!==w.timezoneOffset&&
h.departureTime>=w.arrivalTime&&(O[l]=1)):"Travel"===j.eventType?!q&&0<=j.stayId&&0<=j.nextStayId?(q=A[j.nextStayId],A[j.stayId].lastSchedulableTime.isAfter(j.start.clone().startOf("day"))?(I[l]={currentStayId:j.stayId},q.firstSchedulableTime.isBefore(j.start.clone().startOf("day").add(1,"d"))&&(I[l].alternateStayId=j.nextStayId)):I[l]={currentStayId:j.nextStayId}):!q&&0<=j.nextStayId?I[l]={currentStayId:j.nextStayId}:-1!==j.stayId?I[l]={currentStayId:j.stayId}:-1!==j.nextStayId&&(I[l]={currentStayId:j.nextStayId}):
I[l]={currentStayId:j.stayId}}q=j;N.push(j)}q&&"Hop"===q.eventType&&(q.last=!0);for(l=E.clone();!l.isSame(K);){k=l.format(T);if(!I.hasOwnProperty(k)&&(s=l.clone().subtract(1,"d").format(T),s=I[s]))n=s.hasOwnProperty("alternateStayId")?"alternateStayId":"currentStayId",I[k]={currentStayId:s[n]};l.add(1,"d")}if(pa&&ka)for(var y in ka)ka.hasOwnProperty(y)&&(ka[y]&&O[y]&&I[y].hasOwnProperty("alternateStayId")&&I[y].currentStayId!==pa[y].currentStayId)&&(k=I[y].currentStayId,I[y].currentStayId=I[y].alternateStayId,
I[y].alternateStayId=k);y=F();L=e.utc(b.start);Q=e.utc(b.end).add(3,"days");i?(H=i,x=i.find(".calendar-box")):(H=$("#calendar"),x=H.find("#calendarBox"));x.data("fullCalendar")?(x.find(".qtip").each(function(){$(this).qtip("api").destroy()}),x.fullCalendar("removeEvents"),x.fullCalendar("addEventSource",y),b=x.fullCalendar("getView"),G(b),z()):(x.fullCalendar({defaultView:"inspirockAgendaWeek",header:{left:"prev",center:"",right:"next"},dateIncrement:{days:1},height:"auto",events:y,allDayDefault:!1,
ignoreTimezone:!1,allDaySlot:!1,allDaySlotClick:!1,allDayText:"",numDaysDisplay:4,slotEventOverlap:!1,columnFormat:"ddd, MMM D",axisFormat:'[<span class="time">]ha[</span>]',eventClick:Qa,eventDragStart:Ja,eventDragStop:Ta,eventDrop:Pa,eventResizeStart:Ba,eventResize:ya,dayClick:Na,eventRender:function(b,c,d){if("Travel"===b.eventType&&(0===b.duration.asMinutes()||b.startDestination.destinationId===b.endDestination.destinationId))return!1;b.id&&c.attr("id","event-"+b.id);c.attr("id","event-"+b.id);
b.notes&&!r&&c.find(".fc-content .fc-title").addClass("has-notes");if("Reserved"===b.eventType||"Visit"===b.eventType){c.find(".fc-content .fc-title").html(b.title);b.conflict||b.overlapped||b.isOverflow?c.find(".fc-title").before('<div class="overflow-icon"><svg class="icon"><use xlink:href="#icon-error-circle"/></div>'):"Reserved"===b.eventType?c.find(".fc-title").before('<svg class="icon"><use xlink:href="#icon-flag"/>'):c.find(".fc-title").before('<svg class="icon"><use xlink:href="#icon-binocs"/>');
(b.attachments&&b.attachments.length||b.notes)&&!r&&c.find(".fc-content").after('<svg class="note-icon"><use xlink:href="#icon-note"/>');if(r)"Visit"===b.eventType&&c.addClass("attLink").data("eventSrc","calendar.visit").data("detailsUrl",b.detailsUrl);else{var e=$('<div data-event-id="'+b.id+'" data-event-type="'+b.eventType+'" data-title="'+b.title+'" data-has-notes="'+(b.notes?"true":"false")+'" class="deleteEvent fa fa-times"></input>');e.click(function(a){Xa.bind($(this))(b,{});a.stopPropagation()});
c.append(e)}(b.conflict||b.overlapped||b.isOverflow)&&c.addClass("conflict bg-stripe red");if(b.conflict||b.overlapped||b.isOverflow)c.find(".overflow-icon").off("click.visit-reserved-conflict").on("click.visit-reserved-conflict",function(a){c.addClass("conflict bg-stripe red");c.attr("data-stay-id",b.stayId);var e;b.isOverflow?(e="Left"===b.overflowType?ha:ia,e=$('<div><div class="title"><svg class="overflow-icon"><use xlink:href="#icon-error-circle"></use></svg><span class="title-text">Help us help you</span></div><div class="content">'+
("This activity in "+A[b.stayId].name+" cannot be part of "+(e?e.name:"plan"))+'</div><div class="content suggestion">Drag or delete this activity to fix your schedule</div></div>')):b.overlapped?e=$('<div><div class="title">Error</div><div class="content">You have 2 activities scheduled at this time.</div></div>'):b.conflict&&(e=$('<div><div class="title">Error</div><div class="content"><span class="event-title">'+b.title+"</span> "+b.openCloseTimeText+"</div>NaN"));e.length&&!H.find(".fc-event-container:not(.fc-helper-container)").find("#event-"+
b.id).hasClass("event-drag-start")&&ga(c,e,d,b,!1,void 0,a);a.stopPropagation()});b.nextHopError&&$(document.createElement("div")).addClass("next-hop-broken").appendTo(c);b.prevHopError&&$(document.createElement("div")).addClass("prev-hop-broken").appendTo(c)}else if("Hop"===b.eventType){var f=b.duration.asMilliseconds(),h=b.end&&b.start?b.end.diff(b.start):0,e=f>h,f=h>f;b.first?c.addClass("first endpoint"):b.last&&c.addClass("last endpoint");var i=$(document.createElement("div"));i.addClass("hop-line-top");
c.find(".fc-content").append(i);i=$(document.createElement("div"));i.addClass("hop-line-bottom");c.find(".fc-content").append(i);if(f)h=100*(b.requiredDuration.asMilliseconds()/b.end.diff(b.start)),c.find(".fc-content").append($(document.createElement("div")).addClass("fc-event-solid-time").css({height:h+"%"})),h=$(document.createElement("div")).addClass("fc-event-filler-time").css({top:h+"%"}),c.find(".fc-content").append(h);else if(e){c.addClass("under");c.attr("data-stay-id",b.stayId);c.find(".fc-content").append($(document.createElement("div")).addClass("fc-event-solid-time").css({height:"100%"}));
var j=0===h?c.find(".hop-line-top"):c.find(".fc-title");if(!b.isOverflow)c.off("mouseover.hoperror").on("mouseover.hoperror",function(){ga(c,void 0,d,b,!0,j)})}else c.find(".fc-content").append($(document.createElement("div")).addClass("fc-event-solid-time").css({height:"100%"}));h=b.end&&b.start?b.end.diff(b.start):0;0===h?c.addClass("dot-only"):18E5>=h&&c.addClass("short");b.title||c.find(".fc-title").remove();if((b.first||b.last)&&!b.sideTrip)e?c.find(".fc-title").css("opacity",0):c.find(".fc-title").remove();
b.detailsUrl&&c.find(".fc-title").click(function(){a.trackEvent(J(),g.ACT_DIR_CLICK);window.open(b.detailsUrl,"_blank")});b.notes&&!r&&c.find(".fc-title").append('<span class="cal-notes"> ('+b.notes.replace(/\n/g,"<br/>")+")</span>")}else"Travel"===b.eventType&&(b.formattedDuration&&(c.find(".fc-title").append('<div class="cal-notes"> ('+b.formattedDuration.replace(/\n/g,"<br/>")+")</div>"),c.find(".fc-title").before('<svg class="icon"><use xlink:href="#'+b.firstMajorMode+'" />')),(b.attachments&&
b.attachments.length||b.notes)&&!r&&c.find(".fc-content").after('<svg class="note-icon"><use xlink:href="#icon-note"/>'));if($("#plan").data("editEnabled")){b.overflowBefore&&$(document.createElement("div")).addClass("overflow-content overflow-before overflow").attr("data-stay-id",b.previousOverflowStayId).prependTo(c.first());b.overflowAfter&&$(document.createElement("div")).addClass("overflow-content overflow-after overflow").attr("data-stay-id",b.nextOverflowStayId).appendTo(c.last());if(b.overflowBefore||
b.overflowAfter)e=$('<div class="overflow-icon-container overflow"><svg class="overflow-icon"><use xlink:href="#icon-error-circle"></use></svg></div>'),c.find(".fc-content").append(e),c.addClass("overflow-marked");c.off("click.overflow-icon").on("click.overflow-icon",".overflow-icon-container",function(){c.data("qtip")&&$("#"+c.data("qtip")._id).hasClass("travel-edit-tip")&&c.data("qtip").hide();var a=$(this),b=function(a){for(var a=a.data("stayId"),b=A[a].name,c,d=A[a],e=c=0;e<d.rightOverflowItems.length;e++)"Hop"!==
d.rightOverflowItems[e].eventType&&c++;for(e=0;e<d.leftOverflowItems.length;e++)"Hop"!==d.leftOverflowItems[e].eventType&&c++;e=b+" has "+c+" conflict"+(1<c?"s":"");d=$('<div class="overflow-stay-container"></div>');d.append($('<div class="overflow-desc">'+e+"</div>"));b=$('<div class="overflow-mode" data-stay>Click here to see '+b+"'s conflict"+(1<c?"s":"")+"</div>");b.attr("data-stay-id",a);d.append(b);f.append(d)};if($(".overflow-tip").length)$(".overflow-tip").data("qtip").hide();else{var d=a.parents(".fc-event"),
e=d.find(".overflow-before"),d=d.find(".overflow-after");if(e.length||d.length){var f=$('<div class="overflow-container"></div>');e.length&&b(e);d.length&&b(d);a.qtip({content:{text:f,button:!0},position:{my:"bottom center",at:"top center",viewport:$("body"),adjust:{method:"shift none"}},overwrite:!0,show:{ready:!0},hide:{event:"unfocus",fixed:!0},style:{classes:"qtip-light qtip-shadow overflow-tip overflow-icon-tip",tip:{corner:!0,width:20,height:10,mimic:"center top"}},events:{show:function(a,b){var c=
$(this);0===b.elements.content.siblings(".qtip-fillerDiv").length&&$('<div class="qtip-fillerDiv"></div>').insertBefore(b.elements.content);c.off("click.overflow-mode").on("click.overflow-mode",".overflow-mode",function(){b.hide();D.bind($(this))($(this).data("stayId"))})},hide:function(a,b){b.destroy(!0)}}})}}})}},viewRender:function(a){ja(a,r)},eventAfterAllRender:function(a){window.clearTimeout(U);x.fullCalendar("clientEvents",function(a){if("Hop"===a.eventType){var b=x.find("#event-"+a.id),c=
x.find("#event-"+a.prevId),a=x.find("#event-"+a.nextId),d=0,e=0;0<c.length&&0<a.length?(d=Math.max(c.position().left,a.position().left),e=Math.min(c.position().left+c.width(),a.position().left+a.width())):0<c.length?(d=c.position().left,e=c.position().left+c.width()):0<a.length&&(d=a.position().left,e=a.position().left+a.width());e<=d?b.remove():b.css({left:d+"px",width:e-d+"px"});(0<c.length&&c.hasClass("conflict")||0<a.length&&a.hasClass("conflict"))&&b.find(".cal-notes").remove()}});x.find(".qtip").each(function(){$(this).qtip("destroy")});
U=window.setTimeout(function(){function a(){H.is(":visible")&&m.triggerEvent("calendar","show-help-tips",{tabName:"#calendar"})}if(sa)H.one("refreshed",a);else a()},100);var b=function(a,b){for(var c=0,d=a;d<a+b;d++)c+=h[d];return c},c=function(a){var b=[],c=null,e;for(e in a){var f=a[e];if(0<=f){var g=A[f];(null===c||g.destinationId!==c.destinationId)&&b.push(A[f].name);c=g}}return d.joinArray(b,", "," & ")},e=0,f=0,g=0,h=[],i=a.start,j=a.end,l=i.clone().utc(),k=H.find("#calendarStayBox");k.empty();
for(l=0;4>l;l++)h.push(x.find(".fc-head-container th").eq(l+1).outerWidth());for(var n=[],l=i.clone();l<j;){var i=v(l),s;if(!(s=l===j))if(!(s=n.length&&!i.length))if(s=n.length)if(s=i.length){a:if(n.length!==i.length)s=!1;else{for(s=0;s<n.length;++s)if(n[s]!==i[s]){s=!1;break a}s=!0}s=!s}s&&(g=$(document.createElement("div")).addClass("columnHeader").css({width:b(g,e)+"px"}).appendTo(k),n.length&&(n=c(n),g.append($("<div>").text(n).attr("title",n))),g=e,e=0);e++;f++;n=i;l.add(1,"d")}0<e&&(g=$(document.createElement("div")).addClass("columnHeader").appendTo(k),
n.length&&(n=c(n),g.append($("<div>").text(n).attr("title",n))));k.find(".columnHeader div").each(function(){for(var a=$(this),b=a.height(),c=a.get(0).scrollHeight,d=a.text();c>b+2;)d=d.substring(0,d.length-1),a.text(d+"..."),b=a.height(),c=a.get(0).scrollHeight});$(".fc-head-container thead th").each(function(){var b=$(this);if(!b.hasClass("fc-axis")&&b.data("date")){b.removeClass("tzoverlap").find(".error").remove();b.data("qtip")&&b.qtip("api").destroy();b.find("svg.icon").length||b.append('<div class="overflow-icon-container overflow hidden"><svg class="icon"><use xlink:href="#icon-error-circle"></use></svg></div>');
var c=b.data("date");if(O.hasOwnProperty(c)){c=A[I[c].alternateStayId];b.addClass("tzoverlap").find("span").after('<svg class="error"><use xlink:href="#icon-error"></use></svg>');var c='<div><div class="close">\u2715</div><div class="note">Note:</div><div class="msg">This itinerary overlaps because of timezones</div><div class="toggle text-link">View '+c.name+' itinerary <span style="white-space: nowrap;">for this day</span></div></div>',d=0;4===b.index()?d=15:1===b.index()&&(d=-55);b.find("span,svg.error").qtip({overwrite:!0,
content:c,position:{my:"top center",at:"bottom center",container:$("#calendarBox"),viewport:$("#calendarBox"),adjust:{method:"shift none"}},show:{event:"click",delay:0},hide:{event:"unfocus"},style:{classes:"qtip-light qtip-shadow toggle-tz-date calendar-tip",tip:{corner:!0,width:20,height:10,mimic:"center top",offset:d}},events:{show:function(c,d){d.elements.content.off("click.toggle").on("click.toggle",".toggle",function(){var c=b.data("date").trim();C(c,a,r)}).off("click.close").on("click.close",
".close",function(){d.hide()})}}})}}});var q=0<x.parents(".dlg-show-overflow-calendar").length,b=q?$(".dlg-show-overflow-calendar .ui-dialog-content"):$(window),c=H.find(".fc-day-header").outerHeight(),e=H.find(".columnHeader").outerHeight(),f=$(".itinerary-subnav-contents").outerHeight(),j=$(".plan-header-wrap").outerHeight(),t=c+e+f+j+10;q&&(t=c+c+10);var y=[];H.find(".travelEvent,.travelFauxEvent").each(function(a,b){var c=$(b),d=c.offset().top-t-($("#pageWrapper").hasClass("modal-open")?parseInt($("#pageWrapper").css("top")):
0);q&&(d=c.position().top);c.data("dockAt",d).data("dockStopAt",d+c.outerHeight()-c.find(".fc-title").outerHeight()-5);y.push(c)});b.off("scroll.calEvents").on("scroll.calEvents",function(a){var b=$(this).scrollTop(),c=[],e=[];for(p in y){var f=y[p].data("dockAt"),g=y[p].data("dockStopAt"),g=Math.min(Math.max(0,b-f),Math.max(0,g-f));y[p].find(".fc-content").css("top",g);!q&&(b-f>y[p].outerHeight()-10&&y[p].hasClass("overflow-marked"))&&(g=y[p].data("fc-seg").start.format(d.ISO_DATE_FORMAT),-1===c.indexOf(g)&&
(c.push(g),e.push(f-20)))}if(!q)for(p in $("#itinerary .fc-day-header .overflow-icon-container").addClass("hidden"),c)$('#itinerary .fc-day-header[data-date="'+c[p]+'"] .overflow-icon-container').removeClass("hidden").off("click").on("click",function(){$("html,body").animate({scrollTop:e[p]},"fast")});a.stopPropagation()});b.trigger("scroll")}}),H.find("#calendarBox,#calendarStayBox").off("click.closeMenu").on("click.closeMenu",function(){var a=$(".qtip.option-tip,.qtip.add-activity-child");a.length&&
a.qtip&&a.qtip("api").hide()}),c||x.fullCalendar("gotoDate",e.utc(b.start)));c&&x.fullCalendar("gotoDate",c);f&&(c=H.find(".fc-body").find(".fc-slats").find("[data-time='"+W+"']"),i&&(c=H.find(".fc-event").first()),m.triggerEvent("calendar","scroll-first-visit",{element:c,additionalYOffset:0,$dialog:i}));H.trigger("refreshed");sa=!1;$(".qtip.calendar-tip").each(function(){$(this).qtip("api").destroy()})};s.refreshIfInvalid=function(a){if(sa){var b;a&&x.data("fullCalendar")&&(b=x.fullCalendar("getDate"));
var c=b,d=$("#planRecalculating"),e=H;r.showLoading(d,e,"Loading Calendar...");p.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/calendarEvents",complete:function(){r.hideLoading(d,e)},success:function(a){s.loadCalendarEvents(a,c,!0)}})}};var P=function(){sa=!0;H.is(":visible")&&s.refreshIfInvalid()},ja=function(a){x.find(".fc-prev-button").empty().append('<span class="fa fa-angle-left" />');x.find(".fc-next-button").empty().append('<span class="fa fa-angle-right" />');G(a);
var a=a.start.format(T),b=I[a];b&&A[b.currentStayId]&&(b=$("#itinerary .itinerary-left-timeline-pane .active"),$("#itinerary .itinerary-left-timeline-pane .day-box:not(.alldays)").removeClass("active"),a=$("#itinerary .itinerary-left-timeline-pane .day-box").filter('[data-date="'+a+'"]'),a.length?a.first().addClass("active"):b.parents(".stay").next().length?b.parents(".stay").next().find(".day-box").first().addClass("active"):b.addClass("active"));a=$(".itinerary-left-timeline-pane").find(".active");
a.length&&m.triggerEvent("calendar","update-history",{$dayBox:a});x.find(".fc-content").find(".fc-agenda-days").find("thead").find(".fc-agenda-axis").html('<div class="day">&nbsp;</div>');x.find(".fc-content").find(".fc-agenda-days").find("thead").find(".fc-agenda-gutter").html('<div class="day">&nbsp;</div>')};s.isDirty=function(){return sa};s.addItemClick=function(a,b){if(b.data("qtip")){var f=b.data("qtip")._id,f=$("#"+f);b.qtip("destroy",!0);if(!f.hasClass("error-qtip")){b.data("requestInProgress",
!1);return}}if(void 0!==b){if(b.hasClass("claimPlanLink")||0<b.children(".claimPlanLink").length||b.data("requestInProgress"))return;b.data("requestInProgress",!0)}a.startTimeInMinutes||(a.startTimeInMinutes=aa,a.endTimeInMinutes=a.startTimeInMinutes+30);b.qtip({overwrite:!0,content:{text:a.content?a.content:t,button:!0},position:a.position,show:{event:"click",ready:!0},hide:{event:"unfocus",fixed:!0},events:{show:function(b,f){f.elements.button.removeAttr("title");var g=$(this);f.elements.content.off("click.close").on("click.close",
".close",function(){f.hide()});V&&(g.find(".edit-event").addClass("hidden"),g.find(".delete-event").addClass("full-width"));g.off("click.explore-page").on("click.explore-page",".explore-page",function(){f.hide();var b=void 0;a.dateForExplore&&a.stayId&&(b={},b.date=a.dateForExplore.toISOString(),b.stayId=a.stayId);l.gotoSelectedTagPlaces(null,null,null,a.destinationId,"itinerary",b,!0)});g.off("click.custom-event").on("click.custom-event",".custom-event",function(){var b=e($("#plan").data("planStartDate"),
d.ISO_DATE_FORMAT),g=e($("#plan").data("planEndDate"),d.ISO_DATE_FORMAT);a.successDialogOpen=function(a){a&&(na=!1)};c.openReservedItemDialog(a,b,g);f.hide()})},hide:function(a,c){b.data("requestInProgress",!1);c.destroy(!0);d.removeAllErrorToolTips()}},style:{classes:"calendar-add-tip qtip-light calendar-tip qtip-shadow "+(a.className?a.className:""),width:a.width?a.width:"320",tip:a.tip}})};s.initialize=function(){H=$("#calendar");x=H.find("#calendarBox");sa=!0;H.off("isVisible").on("isVisible",
M).off("isHidden").on("isHidden",w);m.addObservers("visit-add visit-remove visit-update reserved-add reserved-remove reserved-update hop-add hop-remove hop-update".split(" "),"calendar",P);m.addObserver("setup-time-selects","calendar",function(a,b){var c=b.date,f=b.starttime,g=b.endtime,h=b.startTimeInMinutes,i=b.endTimeInMinutes,j=b.showTimeSelectTitles,l=b.container,k=b.isOverflow,n,m,p,s,q=b.timeRanges,r=[],t;for(t in q){var y=B(q[t].start.clone().startOf("day")),w=B(q[t].end.clone().startOf("day"));
(y.isSame(c)||y.isBefore(c))&&(w.isSame(c)||w.isAfter(c))&&r.push(q[t])}1===r.length&&(q=r[0].start,r=r[0].end,c&&(q&&r)&&(c=e.utc(e(c).format(d.ISO_DATE_FORMAT)),t=e.utc(q.format(d.ISO_DATE_FORMAT)),y=e.utc(r.format(d.ISO_DATE_FORMAT)),k?(n=0,p=30,m=1410,s=1440):(t.isSame(c)&&(n=e.duration(q-t).as("m"),p=n+30),y.isSame(c)&&(s=e.duration(r-y).as("m"),m=s-30))));k=j?"End":null;d.createOptionForTime(f,j?"Start":null,h,n,m);d.createOptionForTime(g,k,i,p,s);f.data("selectmenu")&&f.selectmenu("destroy");
f.inspirockSelectmenu({appendTo:l||f.parents(".calendar-add-tip")});g.data("selectmenu")&&g.selectmenu("destroy");g.inspirockSelectmenu({appendTo:l||g.parents(".calendar-add-tip")});f.linkToEndTimeSelect(g)});m.addObserver("show-calendar-dialog","calendar",function(a,b){$("#calendarItemContainer").css("display","block");b.length&&$(".dlg-calendar-edit-item").find(".reservation").html(b)});m.addObserver("close-calendar-dialog","calendar",function(){$("#calendarItemContainer").length&&$("#calendarItemContainer").remove()});
m.addObserver("hide-calendar-dialog","calendar",y);H.is(":visible")&&(s.refreshIfInvalid("same"),M())};return s});
define("plan/itineraryMap","modules/utils modules/ajax modules/events modules/map moment modules/analytics modules/analyticsEventParams jquery".split(" "),function(a,g,d,p,m,j,i){var c=function(a){this.googleMap=void 0;this.googleMapLoaded=!1;this.points=[];this.overlays=[];this.polylines=[];this.mapBounds;this.$mapView=a;this.$mapCanvas;this.infoWindowCache={};this.mapMarkerCache={};this.prevOpenInfoWindow;this.prevInfoWindow;this.routeMode;this.$mapDayTitle;this.$mapStayTitle;this.$mapLegend;this.directionsCache=
{};this.latestDirectionsRequestId=0;this.unit;this.currentIdAttr;this.currentShowDirections;this.directionRenderers=[]};c.prototype.loadMapView=function(){if(this.googleMapLoaded)return!0;if(!a.isGoogleMapsApiAvailable())return!1;var b={center:new window.google.maps.LatLng(0,0),zoomControl:!0,mapTypeId:window.google.maps.MapTypeId.ROADMAP,scaleControl:!0,fullscreenControl:!1,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]};this.googleMap=new window.google.maps.Map(this.$mapCanvas[0],
b);n=new window.google.maps.DirectionsService;this.googleMapLoaded=!0;var c=this,d=window.google.maps.event.addListener(this.googleMap,"idle",function(){var b=c.$mapView.find(".gm-style-cc:not(.gmnoprint):contains(' m'),.gm-style-cc:not(.gmnoprint):contains(' km')").filter(function(){return"MILES"===c.unit&&(a.endsWith($(this).text()," km")||a.endsWith($(this).text()," m"))||"KILOMETERS"===c.unit&&!a.endsWith($(this).text()," km")&&!a.endsWith($(this).text()," m")});b.length&&b.click();window.google.maps.event.removeListener(d)});
window.google.maps.event.addListenerOnce(this.googleMap,"tilesloaded",function(){c.$mapCanvas.data("tracked")||(c.$mapCanvas.data("tracked",!0),j.trackNonInteractionEvent(i.CAT_PLAN_DBD_MAP,i.ACT_GMAP_LOAD))});return!0};c.prototype.initializeLegend=function(){this.$mapView.find(".map-legend").find(".legend-day-list").each(function(){var a=0;$(this).find(".legendOption").each(function(){$(this).find("li").each(function(){if($(this).data("isVisit")){var b;b="";var c=a;do{var d=c%26,c=Math.floor(c/26);
b=String.fromCharCode(d+65)+b;c-=1}while(0<=c);$(this).data("markerLabel",b);c=$(this).find(".map-marker-circle");c.css({"background-color":"#fa8c00"});c.text(b);a+=1}})})})};c.prototype.showLegend=function(a){this.$mapView.find(".legendOption").addClass("hidden");("-"===a.charAt(a.length-1)?this.$mapView.find("*[id^='"+a+"']"):this.$mapView.find("#"+a)).removeClass("hidden")};c.prototype.getPoints=function(a){var b=[],c;c="-"===a.charAt(a.length-1)?this.$mapView.find("*[id^='"+a+"']"):this.$mapView.find("#"+
a);c.each(function(a){c.eq(a).find("li").each(function(){if($(this).data("isVisit")){var d=$(this),f;f=d.parent().hasClass("legend-stay-list")?d.index()+1:d.data("markerLabel");b.push({lat:d.data("lat"),lng:d.data("lng"),label:f,color:5,routeColor:"#000000",legendOption:$(c[a]).attr("id"),title:d.find(".name").text(),link:d.data("link"),stayId:d.data("stayId")})}})});0===b.length&&(a=c.first().parent("ol.legend-day-list"),b.push({lat:a.data("lat"),lng:a.data("lng"),label:void 0,color:void 0,routeColor:void 0,
legendOption:void 0,title:void 0,link:a.data("link")}));return b};c.prototype.renderDirections=function(a,b,c){c=new window.google.maps.DirectionsRenderer({suppressMarkers:!0,polylineOptions:{strokeColor:c,strokeOpacity:0.57,strokeWeight:4},preserveViewport:!0});c.setMap(a);c.setDirections(b);this.directionRenderers.push(c)};c.prototype.routeAndDisplayDirections=function(a,b,c,d,f,g,i){if(1<b.length){var g={},j=b.length,k=[],n=0;g.origin=new window.google.maps.LatLng(b[0].lat,b[0].lng);g.destination=
new window.google.maps.LatLng(b[j-1].lat,b[j-1].lng);g.travelMode=window.google.maps.DirectionsTravelMode.DRIVING;for(n=1;n<j-1;n++)k.push({location:new window.google.maps.LatLng(b[n].lat,b[n].lng)});g.waypoints=k;if("DRIVING"===this.routeMode)if(this.directionsCache.hasOwnProperty(a))this.renderDirections(d,this.directionsCache[a],c);else{var m=this;f.route(g,function(b,e){e===window.google.maps.DirectionsStatus.OK?(m.directionsCache[a]=b,m.latestDirectionsRequestId===i&&m.renderDirections(d,b,c)):
console.log("Unable to get route")})}else if("LINES"===this.routeMode){f=[];for(g=0;g<b.length;g++)f.push(new window.google.maps.LatLng(b[g].lat,b[g].lng));b=new window.google.maps.Polyline({path:f,geodesic:!0,strokeColor:"#000000",strokeOpacity:0.57,strokeWeight:4});b.setMap(d);d===this.googleMap&&this.polylines.push(b)}}};c.prototype.addMapDirections=function(a){this.loadMapView();this.latestDirectionsRequestId+=1;if(1<this.points.length){var b;this.mapBounds=new window.google.maps.LatLngBounds;
for(var c=[],d=0,d=0;d<this.points.length;d++){var f=this.points[d],g=new window.google.maps.LatLng(f.lat,f.lng);this.mapBounds.extend(g);void 0!==b&&f.stayId!==b.stayId&&(0<c.length&&this.routeAndDisplayDirections(b.legendOption,c,b.routeColor,this.googleMap,n,a,this.latestDirectionsRequestId),c=[]);c.push(f);b=f}this.routeAndDisplayDirections(c[0].legendOption,c,c[0].routeColor,this.googleMap,n,a,this.latestDirectionsRequestId);this.googleMap.fitBounds(this.mapBounds)}};c.prototype.clearMapDirections=
function(){for(var a=0,a=0;a<this.directionRenderers.length;a++)this.directionRenderers[a].setMap(null);for(;0<this.polylines.length;)this.polylines.pop().setMap(null);this.directionRenderers=[]};c.prototype.clearMap=function(){for(;0<this.overlays.length;)this.overlays.pop().setMap(null);this.clearMapDirections();this.hideInfoWindow(void 0,!0);this.infoWindowCache={};this.mapMarkerCache={}};c.prototype.showMapMarkers=function(){this.loadMapView();this.clearMap();var a;if(1===this.points.length&&
void 0===this.points[0].title)this.mapBounds=new window.google.maps.LatLngBounds,a=new window.google.maps.LatLng(this.points[0].lat,this.points[0].lng),this.mapBounds.extend(a),this.googleMap.setCenter(this.mapBounds.getCenter()),this.googleMap.setZoom(10);else{this.mapBounds=new window.google.maps.LatLngBounds;for(var b=0,b=0;b<this.points.length;b++){var c=this.points[b];a=new window.google.maps.LatLng(c.lat,c.lng);var d='<div class="info-window-content attLink" data-details-url="'+c.link+'" data-event-src="map-infowindow">',
d=d+('<h5 class="clickable-text">'+c.title+"</h5>"),d=d+"</div>",d=new window.google.maps.InfoWindow({content:d,position:a,disableAutoPan:!1,pixelOffset:new window.google.maps.Size(0,-30,"px","px"),link:c.link});this.infoWindowCache[c.link]=d;d=new window.LabelMapMarker({label:c.label,markerIconIndex:c.color,markerChecked:!1,mapPosition:a,infoWindow:d,map:this.googleMap,controller:this,inPlan:!0});d.setMap(this.googleMap);this.overlays.push(d);this.mapMarkerCache[c.link]=d;this.mapBounds.extend(a)}1===
this.points.length?(this.googleMap.setCenter(this.mapBounds.getCenter()),this.googleMap.setZoom(10)):this.googleMap.fitBounds(this.mapBounds)}};c.prototype.showMapViewForId=function(a,b,c,d){d||(c?$("#maps").find(".slot-date").removeClass("hidden"):$("#maps").find(".slot-date").addClass("hidden"));c="param-"+a;this.currentIdAttr=a;this.currentShowDirections=b;this.routeMode="DRIVING";this.showLegend(c);this.points=this.getPoints(c);this.showMapMarkers();a=document.getElementById("show-directions");
b&&a.checked?this.addMapDirections(this.routeMode):this.clearMapDirections()};c.prototype.directionsEnabled_change=function(a){a=a.data.self;a.loadMapView()?(a.$mapCanvas.find("#noMapMessage").hide(),a.$mapView.find(".show-directions .cb")[0].checked?a.addMapDirections(a.routeMode):a.clearMapDirections()):a.$mapCanvas.find("#noMapMessage").show()};c.prototype.updateMapTitle=function(a,b,c){this.$mapDayTitle.length&&this.$mapStayTitle.length&&(a?(this.$mapDayTitle.removeClass("hidden").siblings().addClass("hidden"),
this.$mapDayTitle.find(".mon").text(a.split(" ")[0]),this.$mapDayTitle.find(".date").text(a.split(" ")[1]),this.$mapDayTitle.find(".dow").text(m(c,"dddd, MMM D").format("ddd")),this.$mapDayTitle.find(".stayName").text(b).attr("title",b)):(this.$mapStayTitle.removeClass("hidden").siblings().addClass("hidden"),this.$mapStayTitle.find(".stayName").text(b),this.$mapStayTitle.find(".date").text(c)))};c.prototype.showInfoWindow=function(a,b,c){c&&(this.prevOpenInfoWindow&&this.prevOpenInfoWindow!==a)&&
(this.mapMarkerCache[this.prevOpenInfoWindow.link]&&$(this.mapMarkerCache[this.prevOpenInfoWindow.link].getMarkerSpan()).css({"z-index":""}).removeClass("highlight"),this.prevOpenInfoWindow.close());this.prevInfoWindow&&this.prevInfoWindow!==a&&(this.mapMarkerCache[this.prevInfoWindow.link]&&$(this.mapMarkerCache[this.prevInfoWindow.link].getMarkerSpan()).css({"z-index":""}).removeClass("highlight"),this.prevInfoWindow.close());b?(this.prevOpenInfoWindow=a,this.prevInfoWindow=null):this.prevInfoWindow=
a;$(this.mapMarkerCache[a.link].getMarkerSpan()).css({"z-index":10}).addClass("highlight");a.open(this.googleMap)};c.prototype.hideInfoWindow=function(a,b){b&&void 0!==this.prevOpenInfoWindow&&(this.mapMarkerCache[this.prevOpenInfoWindow.link]&&$(this.mapMarkerCache[this.prevOpenInfoWindow.link].getMarkerSpan()).css({"z-index":""}).removeClass("highlight"),this.prevOpenInfoWindow.close(),this.prevOpenInfoWindow=void 0);void 0!==a&&a!==this.prevOpenInfoWindow&&($(this.mapMarkerCache[a.link].getMarkerSpan()).css({"z-index":""}).removeClass("highlight"),
a.close())};c.prototype.setup=function(){this.googleMap&&window.google.maps.event.clearInstanceListeners(this.googleMap);this.$mapCanvas=this.$mapView.find(".mapCanvas");this.$mapDayTitle=this.$mapView.find(".map-day-title");this.$mapStayTitle=this.$mapView.find(".map-stay-title");this.$mapLegend=this.$mapView.find(".map-legend");this.googleMapLoaded=!1;this.googleMap=void 0;this.points=[];this.overlays=[];this.polylines=[];this.mapBounds=void 0;this.directionsCache={};this.$mapView.find(".show-directions .cb").change({self:this},
this.directionsEnabled_change);this.unit=this.$mapCanvas.data("unit");this.initializeLegend();var b=this;this.$mapView.find(".legend-stay-list li, .legend-day-list > li > ul > li.visit-name").mouseover(function(){b.showInfoWindow(b.infoWindowCache[$(this).data("link")],!1,!1)});this.$mapView.find(".legend-stay-list li, .legend-day-list > li > ul > li.visit-name").mouseout(function(){b.hideInfoWindow(b.infoWindowCache[$(this).data("link")],!1)});this.$mapView.find(".legend-stay-list li, .legend-day-list > li > ul > li.visit-name").click(function(a){b.showInfoWindow(b.infoWindowCache[$(this).data("link")],
!0,!0);a.stopPropagation()});var d=function(){b.googleMap&&b.mapBounds&&(window.google.maps.event.trigger(b.googleMap,"resize"),1===b.points.length?(b.googleMap.setCenter(b.mapBounds.getCenter()),b.googleMap.setZoom(10)):b.googleMap.fitBounds(b.mapBounds))};this.$mapCanvas.off("resize").on("resize",d);this.$mapView.off("isVisible.init").on("isVisible.init",d);this.$mapView.off("refreshed").on("refreshed",d);this.$mapView.is("#maps")&&(this.loadMapView(),this.googleMap.addListener("click",function(){var d=
b.$mapView.find(".map-wrap").clone(),e;d.dialog({resizable:!1,modal:!0,draggable:!1,width:0.95*$(window).width(),height:0.95*$(window).height(),dialogClass:"itinerary-maps-pane mediumx",open:function(){var b=d.find(".mapCanvas"),g=d.find(".map-legend").is(":visible")?"26%":"0";b.css({width:"auto",height:"auto",position:"absolute",left:0,top:0,bottom:0,right:g,"float":"none"});b.addClass("large-map").data("singleColor",!0);b.empty();d.find(".map-legend").css({"float":"none",position:"absolute",right:0,
top:0,bottom:0,width:"25%","overflow-y":"auto"});d.find(".show-directions").css({"float":"none",margin:"10px 0",padding:0}).prependTo(d.find(".map-legend"));d.find(".show-directions").find(".cb").attr("id","modal-show-directions");d.find(".show-directions").find("label").attr("for","modal-show-directions");e=new c(d);e.setup();e.showMapViewForId(f.currentIdAttr,f.currentShowDirections,!1,!0);e.$mapCanvas.trigger("resize");a.setupDialogOverlay(d,!1,!1)},create:function(){}})}))};var b={},f,u=!1,n;
b.gotoMapAllDestinations=function(){if(f){var a=f.$mapLegend.find(".legendOption"),a=a.first().data("dateText")+" - "+a.last().data("dateText");f.updateMapTitle(void 0,"Full Plan Map",a);f.showMapViewForId("stay-",!0,!0)}};b.gotoMapStay=function(a){if(f){f.$mapLegend.hide();f.$mapView.find(".show-directions").hide();f.$mapCanvas.css("width","100%").trigger("resize");var b="stay-"+a+"-slot-",c=$("#param-stay-"+a),a=c.data("stayName"),c=c.children(),c=c.first().data("dateText")+" - "+c.last().data("dateText");
f.updateMapTitle(void 0,a,c);f.showMapViewForId(b,!1)}};b.gotoMapDate=function(a,c,d){if(f)if(f.$mapLegend.show(),f.$mapView.find(".show-directions").show(),f.$mapCanvas.css("width","").trigger("resize"),a){var g=$("#param-stay-"+d);if(g.length&&!f.$mapView.is(":empty")){var d=g.data("stayName"),i=g.children().filter('[data-date="'+c+'"]'),c=i.data("dateText"),g=c.split(", ")[1],i=i.data("slotIndex"),a="stay-"+a+"-slot-"+i;f.updateMapTitle(g,d,c);d=f.$mapView.find(".show-directions .cb")[0].checked;
f.showMapViewForId(a,d)}}else b.gotoMap()};b.gotoMap=function(){if(f){var a=f.$mapLegend.find(".legendOption").first(),c=a.parents("ol.legend-day-list");b.gotoMapDate(c.data("stayId"),a.data("date"),a.data("slotIndex"))}};b.refreshIfInvalid=function(a,c,d,i,j){u&&f&&(f.$mapView.empty(),g.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/map",type:"GET",success:function(g){f.$mapView.html(g);f.setup();void 0!==a&&void 0!==j?b.gotoMapDate(a,j,c):d?b.gotoMapStay(a):i?b.gotoMapAllDestinations():
b.gotoMap();f.$mapView.trigger("refreshed");u=!1}}));void 0!==a&&void 0!==j?b.gotoMapDate(a,j,c):d?b.gotoMapStay(a):i?b.gotoMapAllDestinations():b.gotoMap()};var k=function(){u=!0;if(f&&f.$mapView.is(":visible")){var a=$("#itineraryLeftTimelinePane").find(".active");if(a.hasClass("fullmap"))b.refreshIfInvalid(void 0,void 0,void 0,!0);else if(a.hasClass("alldays")){var c=a.parents(".stay").data("stayId");b.refreshIfInvalid(c,void 0,!0,void 0)}else{var c=a.data("stayId"),d=a.data("dayIndex"),a=a.data("date");
b.refreshIfInvalid(c,d,void 0,void 0,a)}}};b.isDirty=function(){return u};b.initialize=function(){f=new c($("#maps"));p.addToQueue(function(){f.setup()});if(f.$mapView.is(":visible")){var a=$("#itineraryLeftTimelinePane").find(".day-box").filter(".active"),e=a.data("date"),g=a.data("stayId"),i=a.data("dayIndex");p.addToQueue(function(){b.refreshIfInvalid(g,i,!1,!1,e)})}d.addObservers("visit-add visit-remove visit-update reserved-add reserved-remove reserved-update".split(" "),"map",k)};return b});
define("plan/itinerary","modules/analytics modules/analyticsEventParams modules/utils modules/ajax modules/events modules/copyright modules/history plan/daybyday plan/calendar plan/itineraryMap plan/details plan/loading modules/dock modules/view modules/modal modules/map text!templates/calendarDropDown.html explore/exploreWrapper moment plan/reserveds plan/reservation/reservation jquery jqueryui jQueryExtensions/inspirockAutocomplete jQueryExtensions/photoSlider qtip".split(" "),function(a,g,d,p,
m,j,i,c,b,f,u,n,k,h,e,l,t,r,q,D,v){function B(){var a=$("#pageHeader:visible"),b=$("#itinerary-carousel:visible"),c=$(".plan-heading:visible"),d=$(".itinerary-left-timeline-pane"),e=$(".dbd-right-rail"),b=a.outerHeight(!0)+c.outerHeight(!0)+b.outerHeight(!0)+0+0;k.dockView("itinerary-left-timeline-pane",d,{dockTopAt:b,contentHeight:$(window).height()-a.outerHeight(!0)-c.outerHeight(!0)-I.outerHeight(!0),canScroll:!0,subNav:I});k.dockView("itinerary-right-rail",e,{dockTopAt:b,contentHeight:$(window).height()-
a.outerHeight(!0)-c.outerHeight(!0)-I.outerHeight(!0),canScroll:!0,subNav:I});k.dockView("itinerary-subnav-pane",I,{dockTopAt:b});k.dockView("itinerary-calendar-pane",$(".itinerary-calendar-pane"),{dockTopAt:b});h.scrollAndUpdate()}function z(a,b){N.data("isDirty",!0);if(N.is(":visible")&&(!b||!b.suppressRefresh)&&!e.isOpen()){var b=b||{},c=$(".subnav-tabs").find(".active");b.subnav=c.data("target");b.onlyInvalidate||Q.refreshIfInvalid(b)}}function C(){u.initialize(W,"itinerary","itinerary",g.CAT_DETAILS_ATTR)}
function G(){i.pop()}function M(){m.triggerEvent("itinerary","clean-help-tips",{});var b=$(this),c=b.attr("id"),d=b.data("target"),e=I.find(".subnav-tabs .subnavlink.active").data("target"),f={},h;h=O.find(".active");"daybyday"===e&&"daybyday"===d?f.date=Y.first().data("date"):"calendar"===d||"daybyday"===d?(h.hasClass("fullmap")?h=O.find(".day-box").first():h.hasClass("alldays")?h=h.parents(".stay").find(".day-box").first():h.hasClass("before-plan")?h=O.find(".in-plan").first():h.hasClass("after-plan")&&
(h=O.find(".in-plan").last()),"calendar"!==e&&(f.stayId=h.data("stayId")),f.date=h.data("date")):"maps"===d&&(h.hasClass("fullmap")?f.fullMap=!0:h.hasClass("alldays")?(f.stayId=h.data("stayId"),f.allDays=!0,f.date=h.parents(".stay").children(".day-box").first().data("date")):(h.hasClass("before-plan")?h=O.find(".in-plan").first():h.hasClass("after-plan")?h=O.find(".in-plan").last():-1===h.data("stayId")&&(h=h.next().hasClass("fullmap")?h.prev():h.next()),f.stayId=h.data("stayId"),f.date=h.data("date"),
f.dayIndex=h.data("dayIndex")));a.trackEvent(g.CAT_PLAN_DBD_SUBNAV,"click-sub-view",d);i.push("itinerary","itinerary",b.data("url"),{targetId:d,subnavLinkId:c,historyData:f});Q.switchToSubnav(d,c,!0,f)}function w(){var b={},c=$("#calendarlink"),d=c.attr("id"),e=c.data("target"),f=$("#itineraryLeftPane").find(".active");b.date=f.data("date");a.trackEvent(g.CAT_PLAN_DBD_SUBNAV,"click-edit");i.push("itinerary","itinerary",c.data("url"),{targetId:e,subnavLinkId:d});Q.switchToSubnav(e,d,!0,b)}function J(){$(this).hasClass("claimPlanLink")||
$(this)}function F(){var b=$(this),c=b.find(".day");if(!b.hasClass("inactive")){c.data("qtip")&&c.qtip("destroy",!0);Y.removeClass("active");V.removeClass("active");b.addClass("active");a.trackEvent(g.CAT_PLAN_DBD_LEFTPANE,"click-day-box",b.hasClass("alldays")?"alldays":b.data("dayNumber"));W.is(":visible")&&(i.push("daybyday","itinerary",N.data("url"),{subnavLinkId:"daybydaylink"}),Q.switchToSubnav("daybyday","daybydaylink"));if(S.is(":visible")){var d=b.data("date"),c=b.data("stayId"),d=$('.day-block[data-date="'+
d+'"]');1<d.length&&(d=d.filter("[data-stay-id="+c+"]"));K(b);h.scrollDayByDayElementIntoView(d,!0)}else aa.is(":visible")&&(b.hasClass("alldays")?(K(b,!0),l.addToQueue(function(){f.gotoMapStay(b.data("stayId"))})):(K(b),l.addToQueue(function(){f.gotoMapDate(b.data("stayId"),b.data("date"),b.data("dayIndex"))})));setTimeout(function(){O.scrollTop($("#itineraryLeftTimelinePane").scrollTop()+b.position().top)},550)}}function y(){var b=$(this).parents(".stay"),c=b.find(".day-box").eq(0);Y.removeClass("active");
V.removeClass("active");c.addClass("active");a.trackEvent(g.CAT_PLAN_DBD_LEFTPANE,"click-stay-title");W.is(":visible")&&(i.push("daybyday","itinerary",N.data("url"),{subnavLinkId:"daybydaylink"}),Q.switchToSubnav("daybyday","daybydaylink"));if(S.is(":visible")){var d=c.data("date"),e=c.parents(".stay").data("stayId"),d=$('.day-block[data-date="'+d+'"]');1<d.length&&(d=d.filter("[data-stay-id="+e+"]"));h.scrollElementIntoView(d,-160)}else aa.is(":visible")&&(b=c.parents(".stay"),K(c,!0),l.addToQueue(function(){f.gotoMapStay(b.data("stayId"))}));
K(c);B()}function s(){Y.removeClass("active");V.addClass("active");a.trackEvent(g.CAT_PLAN_DBD_LEFTPANE,"click-full-map");l.addToQueue(function(){f.gotoMapAllDestinations()});K(void 0,!1,!0)}function H(){var c=$(this),e={};c.data("qtip")?c.qtip("destroy",!0):(e.view=$("#itineraryMainPane").children().filter(":not(.hidden)").attr("id"),e.successCB=function(c){"calendar"===e.view&&b.loadCalendarEvents(c);"daybyday"===e.view&&($("#itinerary").html(c),m.triggerEvent("daybyday","initialize-itinerary",
{}),$("#daybyday").trigger("refreshed"));"maps"===e.view&&T.find("#maps").html(c);m.triggerEvent(e.eventSource,"reserved-add",{uiSource:e.uiSource,suppressRefresh:!0});a.trackEvent(g.CAT_PLAN_DBD_SUBNAV,"add-reserved-confirm");m.triggerEvent("route","mmt_track_link",{linkName:"Add Reserved"})},e.url=window.contextPath+"/trip/"+$("#plan").data("planId")+"/reserved",e.eventSource=e.view,e.uiSource="itinerary."+e.eventSource,e.notes=null,c.qtip({overwrite:!0,content:{text:t,button:!1},position:{my:"top right",
at:"bottom right",target:c,effect:!1,viewport:$(window),adjust:{method:"shift none",y:10}},show:{ready:!0},hide:{event:"unfocus",fixed:!0},events:{show:function(a,b){var c=$(this);$("#plan").data("editEnabled")||c.find(".add-reservation, .custom-event").remove();c.off("click.explore-page").on("click.explore-page",".explore-page",function(){var a=c.find(".items").addClass("hidden").siblings(".explore-things-to-do").removeClass("hidden"),d=$(".destination-list"),e=d.data("nightstays"),d=d.data("countries"),
f="",g;for(g in e)f+="<div class='night-stay explore-item' data-destination-id=\""+e[g].destinationId+"\"><svg><use xmlns:xlink='http://www.w3.org/1999/xlink' xlink:href=\"#icon-binocs\"></use></svg><span class='stay-name'> in "+e[g].name+"</span></div>";f+='<div class="explore-more-destinations"><svg class="icon-search"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-search"></use></svg><span class=\'explore-header\'>Explore more destinations</span></div><div class="countries hidden">';
for(g in d)f+='<div class="country explore-item" data-destination-id="'+d[g].destinationId+'"><svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-map-marker"></use></svg><span class=\'country-name\'>'+d[g].name+"</span></div>";f+="</div>";a.find(".destination-list").html($(f));a.off("click.explore-more-destinations").on("click.explore-more-destinations",".explore-more-destinations",function(){$(this).siblings(".countries").removeClass("hidden")});a.off("click.explore-item").on("click.explore-item",
".explore-item",function(){b.hide();r.gotoSelectedTagPlaces(null,null,null,$(this).data("destinationId"),"itinerary",void 0,!0)});b.reposition()});c.off("click.custom-event").on("click.custom-event",".custom-event",function(){var a=q($("#plan").data("planStartDate"),d.ISO_DATE_FORMAT),c=q($("#plan").data("planEndDate"),d.ISO_DATE_FORMAT);e.successDialogOpen=function(a){a&&(isDialogOpen=!1)};D.openReservedItemDialog(e,a,c);b.hide()});v.registerEventsForReservation(c,b)},hide:function(a,b){b.destroy(!0);
d.removeAllErrorToolTips()}},style:{classes:"qtip-light calendar-tip qtip-shadow option-tip",width:200,tip:!1}}))}function x(){N.data("isDirty")||(B(),m.addObserver("scroll","itinerary",function(a,b){if(!e.isOpen()&&S.is(":visible")){if(!b.manualScrollEvent){var f=$("#itinerary .itinerary-left-timeline-pane:visible .day-box:visible"),g=$("#itinerary #daybyday:visible .day-block"),h=$("#itinerary .itinerary-left-timeline-pane:visible"),i=$(window).scrollTop(),j;g.each(function(){var a=$(this),b=$(this).offset().top+
0.75*$(this).outerHeight(!0);if(!a.data("destinationId"))return!0;if(b>i+d.getFloatingBarsHeight()+I.outerHeight()){b=f.filter(function(){return $(this).data("date")===a.data("date")});if(!b.length)return!0;1<b.length&&(b=b.filter(function(){return $(this).data("stayId")===a.data("stayId")?!0:!1}));b.hasClass("active")||(f.removeClass("active"),b.addClass("active"));0>b.position().top?(j=b.position().top+h.scrollTop()-100,h.scrollTop(j)):b.position().top+b.outerHeight(!0)+100>h.innerHeight()&&(j=
b.position().top+h.scrollTop()+b.outerHeight(!0)+100-h.innerHeight(),h.scrollTop(j));return!1}});g=O.find(".active");K(g)}c.updateRightRail()}}))}function A(){k.undockView("itinerary-left-timeline-pane");k.undockView("itinerary-subnav-pane");m.removeObserver("scroll","itinerary")}function E(a,b){h.scrollElementIntoView("itinerary-item-"+b.itemId,-160)}function K(a,b,c){var d={};b?(d.allDays=b,d.stayId=a.data("stayId")):c?d.fullMap=c:(d.stayId=a.data("stayId"),d.date=a.data("date"),d.dayIndex=a.data("dayIndex"));
var a=$(".subnavlink").filter(".active"),c=a.attr("id"),e=a.data("target"),b={};b.targetId=e;b.subnavLinkId=c;b.historyData=d;-1===location.pathname.indexOf("https://www.inspirock.com/modal/")&&(d=i.getState(),(!d||"itinerary"!==d.id||"itinerary"!==d.tabId||d.url!==a.data("url")||!d.data||!d.data.historyData||JSON.stringify(d.data.historyData)!==JSON.stringify(b.historyData))&&i.replace("itinerary","itinerary",a.data("url"),b))}function L(){var a=$(this),b=a.data("title");b&&a.qtip({overwrite:!0,content:{text:b,button:!1},
position:{my:"left center",at:"right center",effect:!1,adjust:{scroll:!0,resize:!1,method:"shift"}},show:{delay:0,ready:!0},hide:{event:"mouseout",fixed:!0},events:{hide:function(a,b){b.destroy(!0)}},style:{classes:"timeline-tip qtip-light qtip-shadow",tip:{width:5,height:3}}})}var Q={},N,O,I,T,S,U,aa,W,Y,V,ba,t=d.removeTagsFromString(t,".add-reservation",$("#plan").data("reservationsEnabled"));Q.refreshIfInvalid=function(a){if(N.data("isDirty"))n.showLoading($("#planRecalculating"),$("#resultpageContent"),
"Loading..."),N.css("visibility","hidden"),p.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/itinerary",type:"GET",success:function(b){N.html(b).css("visibility","");N.data("isDirty",!1);Q.initialize();a&&a.subnav&&("daybyday"===a.subnav?Q.showDayByDay(a.historyData?a.historyData:a):"calendar"===a.subnav?Q.showCalendar(a.historyData?a.historyData:a):"maps"===a.subnav&&Q.switchToSubnav("maps","mapslink",void 0,a.historyData?a.historyData:a));B();N.trigger("refreshed");a&&
a.scrollTo&&$(window).scrollTop(a.scrollTo)},complete:function(){n.hideLoading($("#planRecalculating"),$("#resultpageContent"))},error:function(){N.data("isDirty",!0)}});else if(a&&a.subnav&&"daybyday"===a.subnav)Q.showDayByDay(a.historyData?a.historyData:a);else if(a&&a.subnav&&"calendar"===a.subnav)Q.showCalendar(a.historyData?a.historyData:a);else if(a&&a.subnav&&"maps"===a.subnav)Q.switchToSubnav(a.subnav,a.subnavLinkId,void 0,a.historyData?a.historyData:a);else{var b=I.find(".subnavlink.active"),
c=b.data("target"),b=b.attr("id");Q.switchToSubnav(c,b,void 0)}};Q.isDirty=function(){return N.data("isDirty")};Q.switchToSubnav=function(d,e,g,h,i){i=i||I.find(".subnav-tabs .subnavlink.active").data("target");if(Q.isDirty())N.one("refreshed",function(){Q.switchToSubnav(d,e,g,h,i)}),Q.refreshIfInvalid();else{var j=$(".dbd-right-rail"),l=$("#"+d);"minidetails"===d?I.find(".subnav-tabs").addClass("hidden"):I.find(".subnav-tabs").removeClass("hidden");e&&$("#"+e).addClass("active").siblings().removeClass("active");
a.setPageType($("#plan").data("isAnonymous")?"Anonymous In-Plan Page":"In-Plan Page");a.trackPageView("/plan/itinerary/"+d);I.find(".back").addClass("hidden");var k=N.find(".subnav-actions");"daybyday"===d?(k.find(".optimize").parents("li").addClass("hidden"),k.find(".customize-btn").parents("li").removeClass("hidden"),k.find(".back-to-itinerary").addClass("hidden"),O.find(".day-box").filter('[data-stay-id="-1"]').removeClass("inactive")):"calendar"===d?(k.find(".optimize").parents("li").addClass("hidden"),
k.find(".customize-btn").parents("li").addClass("hidden"),k.find(".back-to-itinerary").addClass("hidden")):"maps"===d?(k.find(".optimize").parents("li").addClass("hidden"),k.find(".customize-btn").parents("li").removeClass("hidden"),k.find(".back-to-itinerary").addClass("hidden"),O.find(".day-box").filter('[data-stay-id="-1"]').addClass("inactive")):"minidetails"===d&&(k.find(".optimize").parents("li").addClass("hidden"),k.find(".customize-btn").parents("li").addClass("hidden"),k.find(".back-to-itinerary").removeClass("hidden"));
"daybyday"===d?j.removeClass("hidden"):j.addClass("hidden");"daybyday"===d||"maps"===d||"minidetails"===d?(O.removeClass("hidden"),T.removeClass("col-12").addClass("col-9")):"calendar"===d&&(O.addClass("hidden"),T.removeClass("col-9").addClass("col-12"));O.removeClass("daybyday maps minidetails calendar").addClass(d);l.removeClass("hidden").siblings().addClass("hidden");V.removeClass("active");Y.filter(".alldays").removeClass("active");var n,m,p,s;if(h)Y.removeClass("active"),O.find(".day-box").removeClass("active"),
O.find(".day-box").filter('[data-date="'+h.date+'"]').addClass("active"),"calendar"===d||"daybyday"===d?"daybyday"===d?c.refreshIfInvalid(h.stayId,h.date):"calendar"===d&&b.gotoDate(h.date,h.visitId,h):"maps"===d&&(h.allDays?O.find(".stay").filter('[data-stay-id="'+h.stayId+'"]').find(".alldays").addClass("active"):h.fullMap&&O.find(".fullmap").addClass("active"),f.refreshIfInvalid(h.stayId,h.dayIndex,h.allDays,h.fullMap,h.date));else{if(g||"maps"===d)j=Y.filter(".active"),m=j.data("dayNumber"),p=
j.data("date"),n=j.data("stayId"),0>m&&(m=j.parents(".stay").find(".day-box").first().data("dayNumber")),j.hasClass("alldays")&&"maps"===d&&(s=!0,m=void 0);"daybyday"===d?c.refreshIfInvalid(n,p):"maps"===d?f.refreshIfInvalid(n,m,s):"calendar"===d&&b.refreshIfInvalid(!0)}i!==d&&$(window).scrollTop()>T.offset().top-120&&"maps"===d&&$(window).scrollTop(T.offset().top-120);n=ba.find(".plan-header-wrap").hasClass("dock-top");B();l.trigger("isVisible");!h&&!n&&$(window).scrollTop(0)}};Q.showItineraryDetails=
function(a,b){p.makeAJAXcall({type:"GET",url:a,data:{view:"partial"},complete:function(){n.hideLoading($("#itineraryLoadingPane"),$("#itineraryMainPane"))},success:function(a){Q.switchToSubnav("minidetails",void 0);W.html(a);n.hideLoading($("#itineraryLoadingPane"),$("#itineraryMainPane"));C();a=W.find(".in-plan").first();a.length&&(a=a.data("dayNumber"),Y.removeClass("active"),V.removeClass("active"),Y.filter("[data-day-number="+a+"]").addClass("active"));"overview.stay-highlights"===b&&I.find(".back-to-itinerary .title").text("back");
"itinerary.visit-row"!==b&&(I.find(".back-to-itinerary").addClass("hidden"),I.find(".back").removeClass("hidden"));B();$(window).scrollTop()>W.offset().top-120&&$(window).scrollTop(W.offset().top-120)}})};Q.showDayByDay=function(a){Q.switchToSubnav("daybyday","daybydaylink",void 0,a)};Q.showCalendar=function(a){var b=I.find(".subnav-tabs").find("#calendarlink"),c=b.attr("id"),d=b.data("target");a&&!a.noPush&&i.push("itinerary","itinerary",b.data("url"),{targetId:d,subnavLinkId:c,historyData:a},a.pageYOffset);
delete a.noPush;Q.switchToSubnav("calendar","calendarlink",void 0,a)};Q.showDayByDayDay=function(a,b){a&&b?Q.switchToSubnav("daybyday","daybydaylink",!1,{date:a,stayId:b}):Q.switchToSubnav("daybyday","daybydaylink")};Q.initialize=function(){N=$("#itinerary");var d=$("#itinerary-carousel");d.find(".photos").preparePhotoSlider(2);O=N.find("#itineraryLeftTimelinePane");I=N.find("#itinerarySubnavPane");T=N.find("#itineraryMainPane");S=T.find("#daybyday");U=T.find("#calendar");aa=T.find("#maps");W=T.find("#minidetails");
Y=O.find(".day-box");V=O.find(".fullmap");O.find(".day-box[data-stay-id=-1]");$("footer");$(".page-content");ba=$("#planHeader");m.addObservers("plan-update stay-add stay-remove stay-update travel-update visit-add visit-remove reserved-add reserved-remove".split(" "),"itinerary",z);m.addObserver("refresh-itinerary","itinerary",function(a,b){Q.refreshIfInvalid(b)});m.addObserver("goto-calendar","itinerary",function(a,b){Q.showCalendar(b)});m.addObserver("itinerary-subnav","itinerary",function(a,b){Q.switchToSubnav(b.targetId,
b.subnavLinkId,b.gotoSameDay,b.data)});m.addObserver("update-history","itinerary",function(a,b){K(b.$dayBox)});m.addObserver("scroll-to-item","itinerary",E);m.addObserver("modal-close","itinerary",function(a,b){if(!b.simulateClose&&N.is(":visible")){b={};b.subnav=N.find(".subnav-tabs").find(".active").data("target");b.date=O.find(".active").data("date");b.onModalClose=!0;b.historyData=eventData.historyData||{};b.historyData.noPush=!0;if("maps"===b.subnav){var c=O.find(".active").data("dayNumber");
b.allDays=c;b.stayId=O.find(".active").data("stayId");b.fullMap=O.find(".active").hasClass("fullmap")}Q.refreshIfInvalid(b)}});O.off("click.day-box").on("click.day-box",".day-box",F);O.off("click.stayTitle").on("click.stayTitle",".stay > .title",y);O.off("click.fullmap").on("click.fullmap",".fullmap",s);I.find(".customize-btn").off("click").on("click",w);I.find(".explore-btn").off("click").on("click",J);I.find(".subnavlink").off("click").on("click",M);I.find(".add-item").off("click").on("click",H);
I.find(".back-to-itinerary").off("click").on("click",G);I.find(".back").off("click").on("click",G);O.off("mouseenter.day").on("mouseenter.day",".day",L);N.off("isVisible").on("isVisible",x);S.off("refreshed.dock").on("refreshed.dock",B);U.off("refreshed.dock").on("refreshed.dock",B);aa.off("refreshed.dock").on("refreshed.dock",B);N.is(":visible")&&B();W.is(":visible")&&C();l.addToQueue(f.initialize);b.initialize();c.initialize();j.initialize();N.off("isHidden").on("isHidden",A);d.off("click.startTrip").on("click.startTrip",
".start-planning-now",function(){var b=$(this).siblings(".bold").text();a.trackEvent(g.CAT_PLAN_DBD_CAROUSEL,"start-plan-click",b,function(){window.location.href=window.contextPath+"/trip-planner"})})};return Q});
define("plan/travelAgent","modules/ajax modules/utils modules/analytics modules/analyticsEventParams modules/events modules/modal jquery jQueryExtensions/inspirockSelectmenu".split(" "),function(a,g,d,p,m,j){function i(){var b=$(this);"link"===b.data("type")?(d.trackEvent(p.CAT_PLAN_AGENT,"open-link"),window.open(b.data("link"),"_blank"),m.triggerEvent("travelagent","australia_track_find_agent",{})):b.attr("disabled")||(b.attr("disabled","disabled"),a.makeAJAXcall({url:window.contextPath+"/trip/"+
$("#plan").data("planId")+"/requestAgent",type:"GET",complete:function(){b.removeAttr("disabled")},success:function(b){var c=$(b);c.dialog({resizable:!1,draggable:!1,modal:!0,autoOpen:!1,dialogClass:"dlg-requestAgent mediumx",open:function(){var b=$("#countries"),e=c.find("#number"),f=c.find("#email-input"),i=c.find("#additionalInfo"),j=c.find("#user-name"),k=c.find("input[name=contactmethod]");b.inspirockSelectmenu({appendTo:c});var D=b.selectmenu("widget").filter("span").children(".ui-selectmenu");
g.detectIE()&&j.blur();var v=function(a){window.setTimeout(function(){g.hideErrorTooltip(j);g.hideErrorTooltip(f);g.hideErrorTooltip(e);g.hideErrorTooltip(D)},a)},u=function(){g.hideErrorTooltip(j);g.hideErrorTooltip(f);g.hideErrorTooltip(e);g.hideErrorTooltip(D);var a=j.val().trim(),c=f.val().trim(),d=e.val().trim(),i=b.val();return!a.length?(g.showErrorTooltip(j,"Name must be provided."),v(3E3),!1):"-1"===i?(g.showErrorTooltip($("#countries"),"Country must be provided.",null,{}),v(3E3),!1):!d.length?
(g.showErrorTooltip(e,"Phone number must be provided."),v(3E3),!1):!g.isPhoneNumber(d)?(g.showErrorTooltip(e,"Unrecognized phone number format."),v(3E3),!1):!c.length||!g.validateEmail(c)?(g.showErrorTooltip(f,"Provide a valid E-mail Address."),v(3E3),!1):!0};c.find(".cta-button.show-agent-form").click(function(){c.find(".value-prop").addClass("hidden");c.find(".agent-form").removeClass("hidden");d.trackEvent(p.CAT_PLAN_AGENT,p.ACT_DLG_OPEN)});c.find(".cta-button.submit-request").click(function(){if(g.validateEmailField(f)){c.find(".cta-button").prop("disabled",
!0);var v={};v.selectedCountry=b.val();v.accessedFromCountry=c.find(".cta-button.submit-request").data("defaultCountry").trim();v.email=f.val().trim();v.name=j.val().trim();v.contactMethod=k.filter(":checked").val();v.additionalInfo=i.val().trim();v.phoneNumber=e.val().trim();if(u()){var D=c.find(".cta-button.submit-request").data("provider"),G=!1;c.find(".spinner").show();c.find(".dialog-form").css("visibility","hidden");a.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/requestAgent",
type:"POST",data:v,success:function(a){var b=$(a);b.dialog({resizable:!1,draggable:!1,modal:!0,dialogClass:"dlg-message mediumx",width:"560px",open:function(){g.setupDialogOverlay(b);b.find(".cta-button").click(function(){b.dialog("close")});d.trackEvent(p.CAT_REQUEST_AGENT,p.ACT_REQUEST_AGENT);d.trackEvent(p.CAT_PLAN_AGENT,"send-request-"+D,b.find(".ok-button").data("agentRequestId"));m.triggerEvent("route","mmt_track_link",{linkName:"Contact an Agent"})},close:function(){b.dialog("destroy").remove()}});
G=!0},error:function(a){var b=$(a);b.dialog({resizable:!1,draggable:!1,modal:!0,dialogClass:"dlg-message mediumx",width:"560px",open:function(){b.find(".cta-button").click(function(){b.dialog("close");c.dialog("close")})},close:function(){b.dialog("destroy").remove()}});G=!1},complete:function(){c.find(".spinner").hide();c.find(".dialog-form").css("visibility","visible");c.find(".cta-button").prop("disabled",!1);G&&c.dialog("close")}})}else c.find(".cta-button").prop("disabled",!1)}});c.find(".dlg-footer img, .dlg-footer .question").click(function(){var a=
$("<div>").append($("<img>").attr("src",$(c).find(".dlg-footer img").attr("src"))).append($(c).find(".dlg-footer img").data("dialogHtml"));a.dialog({resizable:!1,draggable:!1,modal:!0,dialogClass:"dlg-travel-agent-footer mediumx",width:"490px",open:function(){d.trackEvent(p.CAT_PLAN_AGENT,p.ACT_DLG_OPEN,"info");a.parents(".ui-dialog").css("z-index",2002);g.setupDialogOverlay(a);a.find(".cta-button").click(function(){a.dialog("close")})},close:function(){a.dialog("destroy").remove()}})});c.find(".agent-form").hasClass("hidden")?
d.trackEvent(p.CAT_PLAN_AGENT,p.ACT_DLG_OPEN,"value-prop"):d.trackEvent(p.CAT_PLAN_AGENT,p.ACT_DLG_OPEN)},close:function(){g.hideErrorTooltip($(this).find("#email-input"));g.hideErrorTooltip($(this).find("#number"));g.hideErrorTooltip($(this).find("#user-name"));c.dialog("destroy").remove();$(".resultspage").removeClass("scroll-hide");f.remove();g.removeAllErrorToolTips()}});$(".resultspage").addClass("scroll-hide");var f=$("<div>").css({position:"fixed",left:0,top:0,right:0,bottom:0,overflow:"auto",
"z-index":2E3}).attr("id","travelAgentContainer");f.appendTo($("body"));c.parents(".ui-dialog").appendTo(f);c.dialog("open");f.off("click").on("click",function(a){"travelAgentContainer"===$(a.target).attr("id")&&c.dialog("close")})}}))}var c={},b;c.initialize=function(){b=$("#request-agent");m.addObserver("open-travel-agent-dlg","travelagent",function(){i.apply(b)});m.addObserver("post-route-change","travelagent",function(a,c){"open-travel-agent-dlg"===c.action&&i.apply(b)});m.addObserver("plan-form-submitted",
"travelAgent",function(){b.addClass("hidden")});b.off("click").on("click",function(){m.triggerEvent("travelagent","page-change",{action:"open-travel-agent-dlg"})});if(!window.localStorage.getItem("agent-shown-"+$("#plan").data("planId"))){var a=0,c=setInterval(function(){a+=0.5;5<=a&&(!j.isOpen()&&!$(".ui-dialog:visible").length)&&(b.addClass("focus"),$(document).one("click",function(){b.removeClass("focus")}),window.localStorage.setItem("agent-shown-"+$("#plan").data("planId"),1),window.clearInterval(c))},
500);$(document).mousemove(function(){a=0});$(document).keypress(function(){a=0});$(document).scroll(function(){a=0})}m.addObservers("stay-add stay-remove stay-update plan-delete plan-update travel-update visit-add visit-remove".split(" "),"travelagent",function(){var a=$("#plan").data("travelAgentButtonText");a?b.removeClass("hidden").find(".msg").text(a):b.addClass("hidden")})};return c});
define("plan/hotels","modules/analyticsEventParams modules/ajax plan/travelAgent modules/events modules/hotelbooking modules/dock modules/view modules/copyright plan/loading modules/dateRange jquery jqueryui qtip jQueryExtensions/readMore".split(" "),function(a,g,d,p,m,j,i,c,b){function f(){h.data("isDirty",!0);h.is(":visible")&&k.refreshIfInvalid()}function u(){if(!h.data("isDirty")){var a=$("#pageHeader:visible"),b=$("#pageWrapper");j.dockView("hotels-right-pane",l,{dockTopAt:function(){return a.outerHeight(!0)+
12},dockBottomAt:function(){return e.offset().top-b.offset().top+e.outerHeight()+12},contentHeight:e.outerHeight(),shouldDockBottom:!0});i.scrollAndUpdate()}}function n(){j.undockView("hotels-right-pane")}var k={},h,e,l;k.refreshIfInvalid=function(){h.data("isDirty")&&(b.showLoading($("#planRecalculating"),$("#resultpageContent"),"Loading..."),h.empty(),g.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/hotels",type:"GET",complete:function(){b.hideLoading($("#planRecalculating"),
$("#resultpageContent"))},success:function(a){h.html(a);h.data("isDirty",!1);k.initialize();h.trigger("refreshed")}}))};k.isDirty=function(){return h.data("isDirty")};k.enableTravelAgents=function(){e.removeClass("no-travel-agents");l.removeClass("hidden")};k.initialize=function(){c.initialize();h=$("#hotels");h.length&&(e=h.find("#hotelsMainPane"),l=h.find("#requestAgentPane"),e.find(".hotel-search"),e.find(".destination-where-to-stay").each(function(){var b=$(this);m.initializeWhereToStay(b,b.find(".hotel-booking-module"),
{container:$("body")},a.CAT_PLAN_HOTELS)}),p.addObservers(["plan-update","stay-add","stay-remove","stay-update"],"hotels",f),p.addObserver("refresh-hotels","hotels",k.refreshIfInvalid),l.off("click.request-agent").on("click.request-agent",".request-agent-button",function(){p.triggerEvent("hotels","open-travel-agent-dlg",{})}),l.off("click.aus").on("click.aus",".aussie-specialist",function(){p.triggerEvent("hotels","australia_track_find_agent",{})}),h.off("isVisible").on("isVisible",u).off("isHidden").on("isHidden",
n),h.is(":visible")&&u())};return k});
define("plan/todolist","modules/ajax modules/utils modules/events moment modules/analytics modules/analyticsEventParams modules/hotelbooking jquery jqueryui".split(" "),function(a,g,d,p,m,j,i){function c(){if(!t){var c=$("#todolist").find(".todo-text");t=!0;$(".resultspage").addClass("scroll-hide-todo");$("#sendFeedback").addClass("hidden");var d=$('<div><img class="progress-indicator" src="'+window.ajaxLoaderPath+'" alt="loading"></div>');d.dialog({resizable:!1,modal:!0,draggable:!1,width:"660px",
dialogClass:"dlg-show-todolist",open:function(){m.trackEvent(j.CAT_PLAN_TODO,"open");d.parents(".ui-dialog").css("z-index",$("#todolist").css("z-index")-1);$("body").append($("#todolist").addClass("outer"));d.parents(".ui-dialog").animate({right:0},250);d.off("click.is-planned-travel").on("click.is-planned-travel",".is-planned-travel",k);d.off("click.is-planned-hotel").on("click.is-planned-hotel",".is-planned-hotel",h);d.off("click.search-travel").on("click.search-travel",".search-travel",f);d.off("click.search-hotel").on("click.search-hotel",
".search-hotel",u);g.setupDialogOverlay(d,!1,!1,function(a){b(a)});var a=$("#todolist").position().top-$(window).scrollTop(),a=Math.max(a,0);$(".dlg-show-todolist").css("top",a)},close:function(){c.removeClass("transform-click");d.dialog("destroy").remove();$(".resultspage").removeClass("scroll-hide-todo");$("#sendFeedback").removeClass("hidden");r=!1;$(".plan-header-wrap").append($("#todolist").removeClass("outer"));$(".ui-widget-overlay").remove()}});a.makeAJAXcall({url:window.contextPath+"/trip/"+
$("#plan").data("planId")+"/todoList",type:"GET",success:function(a){d.html(a);d.find(".travel-rows").last().addClass("noborder");n(d)},complete:function(){t=!1}})}}function b(a){r=!0;$(".dlg-show-todolist").animate({right:"-660px"},250,"swing",function(){a.dialog("close")})}function f(){var a=$(this).parents(".travel-row"),b="";if(a.length){if(window.flightsEnabled&&"plane"===a.data("mode")){if(!a.data("available")){window.open("https://www.skyscanner.com/","_blank");return}var c,e,f;window.sessionStorage.hasOwnProperty("cabin-selector-"+
$("#plan").data("planId"))?(f=JSON.parse(window.sessionStorage.getItem("cabin-selector-"+$("#plan").data("planId"))),b=Math.min(parseInt(f.adult),8),c=Math.min(parseInt(f.children),8),e=Math.min(parseInt(f.infant),b),f=f.cabin):(b=Math.min($("#plan").data("numAdults")+$("#plan").data("numTeens"),8),c=Math.min($("#plan").data("numKids"),8),e=0,f="Economy");a={origin:{placeId:a.data("fromId"),schema:a.data("fromSchema")},destination:{placeId:a.data("toId"),schema:a.data("toSchema")},outbounddate:a.data("outboundDate"),
inbounddate:a.data("inboundDate"),adults:b,children:c,infants:e,cabinclass:f,tripType:a.data("tripType")};d.triggerEvent("plan","flight-search",a);b="flights"}else window.carsEnabled&&"car"===a.data("mode")&&a.data("available")?(a={mode:a.data("mode"),travelId:a.data("travelId"),segmentIndex:a.data("segmentIndex")},d.triggerEvent("plan","show-transport-modal",{searchData:a}),b="cars"):window.trainsEnabled&&"train"===a.data("mode")&&a.data("available")?(a={mode:a.data("mode"),travelId:a.data("travelId"),
segmentIndex:a.data("segmentIndex")},d.triggerEvent("plan","show-transport-modal",{searchData:a}),b="trains"):(b=a.data("startDestinationName"),c=a.data("endDestinationName"),e=a.data("startDestinationCountry"),f=a.data("endDestinationCountry"),window.open("https://www.rome2rio.com?"+(b+", "+e+"/"+c+", "+f),"_blank"),b=a.data("mode"));b&&m.trackEvent(j.CAT_PLAN_TODO,"search-"+b)}}function u(){var a=$(this),b=a.parents(".hotel-row"),c=p.utc(b.data("checkInDate"),g.ISO_DATE_FORMAT),d=p.utc(b.data("checkOutDate"),
g.IS);if(!c||!d)g.showExclamationDialog("Uh oh!","Please select a valid start and end date.","Close");else{var e=a.siblings(".booking-options").children(".booking-option");i.findHotel(e,j.CAT_PLAN_TODO,b.data("name"),b.data("countryCode"),c,d,a,a.parents(".ui-dialog"));return!1}}function n(a){for(var b=!0,c=a.find(".todolist-row").find(".is-planned"),d=0;d<c.length;d++)if(!$(c[d]).hasClass("yes")){b=!1;break}b?a.find(".todo-header").addClass("hidden"):a.find(".todo-header").removeClass("hidden")}
function k(){var b=$(this),c=b.parents(".travel-row"),d={};b.hasClass("disabled")||(d.flag=!0,b.hasClass("yes")&&(d.flag=!1),e(b,c),b.parents(".todolist-container").find(".is-planned").addClass("disabled"),d.travelId=c.data("travelId"),d.segmentIndex=c.data("segmentIndex"),a.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/checkorUncheckSegment",type:"POST",data:d,error:function(){e(b,c)},complete:function(){b.parents(".todolist-container").find(".is-planned").removeClass("disabled");
n($(".dlg-show-todolist").find(".todolist-container"))}}),m.trackEvent(j.CAT_PLAN_TODO,"check-travel",c.data("mode")))}function h(){var b=$(this),c=b.parents(".hotel-row"),d={};b.hasClass("disabled")||(d.flag=!0,b.hasClass("yes")&&(d.flag=!1),e(b,c),b.parents(".todolist-container").find(".is-planned").addClass("disabled"),d.stayId=c.data("stayId"),a.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/checkorUncheckHotelSegment",type:"POST",data:d,error:function(){e(b,c)},complete:function(){b.parents(".todolist-container").find(".is-planned").removeClass("disabled");
n($(".dlg-show-todolist").find(".todolist-container"))}}),m.trackEvent(j.CAT_PLAN_TODO,"check-hotel"))}function e(a,b){a.hasClass("yes")?(a.removeClass("yes"),b.find(".todolist-search").removeClass("hidden")):(a.addClass("yes"),b.find(".todolist-search").addClass("hidden"))}var l={},t=!1,r=!1;l.initialize=function(){d.addObserver("post-route-change","todolist",function(a,d){if("to-do-list"===d.action&&!t&&!r){var e=$("#todolist").find(".todo-text");e.toggleClass("transform-click");e.hasClass("transform-click")?
(e=$("#todolist").offset().top,$("html, body").animate({scrollTop:e},0<e?250:0,c)):b($(".todolist-container").parent())}});$("body").off("click.open-close").on("click.open-close","#todolist",function(){d.triggerEvent("todolist","page-change",{action:"to-do-list"})})};return l});
define("modules/pagination","modules/analytics modules/analyticsEventParams modules/utils modules/ajax plan/loading moment jquery jqueryui jQueryExtensions/inspirockAutocomplete qtip jQueryExtensions/readMore".split(" "),function(a,g,d,p,m){var j=300,i=20;return{initialize:function(c){function b(a){$(".modal-box .ui-dialog-content").scrollTop(0);a.addClass("hidden");m.showLoading($("#flightSearchLoadingPane"),a,"Loading...")}function d(a,b,c){for(var e=0;e<a.length;e++)if(a[e][b]===c)return e;return-1}
function p(a,b){var c=a.getValue(b);Array.isArray(c)||(c=[c]);var e=null;a.getGroup&&(e=a.getGroup(b),Array.isArray(e)||(e=[e]));for(var g=0;g<c.length;g++)if(c[g]){var h=d(a.values,"value",c[g]),i=b.prices[0].price;if(e)for(var j=0;j<e.length;j++)-1===a.groups.indexOf(e[j])&&a.groups.push(e[j]);-1===h?(i={value:c[g],max:i,min:i,enabled:!0},e&&(i.group=e[g]),a.values.push(i)):(h=a.values[h],h.max<i&&(h.max=i),h.min>i&&(h.min=i))}}function n(a,b){var c=a.getValue(b);c&&-1===a.values.indexOf(c)&&a.values.push(c)}
function k(a,b){for(var c=0;c<a.subFilters.length;c++)switch(a.subFilters[c].type){case "checkBox":p(a.subFilters[c],b);break;case "rangeSlider":n(a.subFilters[c],b);break;case "expandable":k(a.subFilters[c],b)}for(c=0;c<a.subFilters.length;c++)if(a.subFilters[c].values.length){a.values.push("enabled");break}}function h(a){return a.replace("%origin_name%",w.originName).replace("%destination_name%",w.destinationName).replace("%origin_code%",w.originIataCode).replace("%destination_code%",w.destinationIataCode)}
function e(a,b){var d='<div class="ckbox '+a.col+'" data-type="'+a.col+'"><label class="heading">'+a.heading+"</label>",e=a.values;a.order&&(e=a.order());for(var f,g=0;g<e.length;g++){10===g&&(d+='<div class="view-more secondary-text-link">View more <i class="fa fa-angle-down"></i></div>');if(e[g].group&&(!f||f!==e[g].group))d+='<div class="ckbox-group">'+e[g].group+"</div>",f=e[g].group;var h=10<=g?"hidden":"",i="ckbox-"+a.col+"-"+e[g].value.replace(/[\W_]+/g,""),j=-1!==a.selectedValues.indexOf(e[g].value)?
"checked":"",l=c.formatPrice?c.formatPrice(e[g].min):e[g].min,d=d+('<input type="checkbox" class="flat '+h+'" id="'+i+'" data-filter-id="'+b+'" data-value="'+e[g].value+'" '+j+'><label for="'+i+'" class="clearfix '+h+'"><span class="min-price">'+l+'</span><span class="label-txt">'+e[g].value+"</span></label>")}return d+"</div>"}function l(a,b){for(var c=null,d=null,e=0;e<a.values.length;e++){if(null===c||a.compare&&0<a.compare(c,a.values[e])||c>a.values[e])c=a.values[e];if(null===d||a.compare&&0>
a.compare(d,a.values[e])||d<a.values[e])d=a.values[e]}if(a.compare&&0<a.compare(d,a.values[e])||d>a.max)a.max=d;e='<div class="range-slider-wrapper" data-type="'+a.col+'">';a.heading&&(e+='<label class="heading">'+h(a.heading)+"</label>");a.subHeading&&(e+='<label class="sub-heading">'+h(a.subHeading)+"</label>");return e+='<label class="range-slider-label"></label><div class="range-slider '+a.col+'" data-min="'+c+'" data-max="'+d+'" data-filter-id="'+b+'"\n                      data-start="'+a.range.start+
'" data-end="'+a.range.end+'"></div></div>'}function t(a,b){for(var c='<div class="expandable" data-filter-id="'+b+'"><div class="expandable-text secondary-text-link">'+a.collapsedText+'<i class="fa fa-angle-down"></i></div>',d=0;d<a.subFilters.length;d++)if(0!==a.subFilters[d].values.length){0<d&&a.subFilters[d].heading&&(c+='<div class="line"></div>');var f=b+"-"+d;G[f]=a.subFilters[d];switch(a.subFilters[d].type){case "checkBox":c+=e(a.subFilters[d],f);break;case "rangeSlider":c+=l(a.subFilters[d],
f);break;case "expandable":c+=t(a.subFilters[d],f)}}return c+"</div>"}function r(){var a="";0<z.currentPage-1&&(a+='<a href="javascript:void(0);" class="page-count prev" data-page-no="'+(z.currentPage-1)+'">Previous</a>',2<z.currentPage&&(a+=q(1),a+=4>=z.pageTotal?4>z.pageTotal||3===z.currentPage?"":q(2):'<span class="ellipsis">...</span>'),a+=q(z.currentPage-1));a+=q(z.currentPage,!0);z.currentPage<z.pageTotal&&(a+=q(z.currentPage+1),z.currentPage<z.pageTotal-1&&(a+=4>=z.pageTotal?4>z.pageTotal||
1<z.currentPage?"":q(3):'<span class="ellipsis">...</span>',a+=q(z.pageTotal)),a+='<a href="javascript:void(0);" class="page-count next" data-page-no="'+(z.currentPage+1)+'">Next</a>');return a}function q(a,b){return'<a href="javascript:void(0);" class="page-count '+(b?"selected":"")+'" data-page-no="'+a+'">'+a+"</a>"}function D(a,b){for(var c=0;c<a.length;c++)a[c].enabled=!0,a[c].min>b&&(a[c].min=b)}function v(a,b){for(var c=0;c<b.length;c++){var d=b[c];switch(d.type){case "checkBox":var e;a:{e=
a;for(var d=[d],f=0;f<d.length;f++){var g=d[f],h=g.getValue(e);if("checkBox"===g.type){Array.isArray(h)||(h=[h]);for(var i=0;i<h.length;i++){var j=!1;if(0===g.selectedValues.length||-1!==g.selectedValues.indexOf(h[i])){j=!0;break}}if(!j){e=!1;break a}}}e=!0}if(!e)return!1;break;case "rangeSlider":if((e=d.getValue(a))&&(e<d.range.start||e>d.range.end))return!1;break;case "expandable":for(e=0;e<d.subFilters.length;e++)if(!v(a,d.subFilters))return!1}}return!0}function B(){for(var e=$(c.selector).find(".rows"),
h=0,l=0;l<C.length;l++)if("checkBox"===C[l].type)for(var k=0;k<C[l].values.length;k++){C[l].values[k].enabled=!1;C[l].values[k].min=Number.MAX_VALUE;var n="ckbox-"+C[l].col+"-"+C[l].values[k].value.replace(/[\W_]+/g,"");$("#"+n).addClass("disabled").siblings('label[for="'+n+'"]').find(".min-price").html("")}l=(z.currentPage-1)*i;k=$('<div class="page pageno-'+z.currentPage+'"></div>');for(n=0;n<z.rows.length;n++){for(var p=z.rows[n],y=p,q=0;q<C.length;q++)if("checkBox"===C[q].type){var w=y.prices[0].price;
if(C[q].filterDependecy&&C[q].filterDependecy.length){var t=[],I=C[q].getValue(y);Array.isArray(I)||(I=[I]);for(var F=0;F<C.length;F++)-1!==C[q].filterDependecy.indexOf(C[F].col)&&t.push(C[F]);if(v(y,t))for(F=0;F<I.length;F++)t=d(C[q].values,"value",I[F]),D([C[q].values[t]],w)}else{I=C[q].getValue(y);for(F=0;F<I.length;F++)t=d(C[q].values,"value",I[F]),D([C[q].values[t]],w)}}v(p,C)&&(h>=l&&h<l+i&&(y=$(c.render(p,M)),y.data("rowData",p),k.append(y)),h++)}z.pageTotal=Math.ceil(h/i);e.removeClass("hidden");
m.hideLoading($("#flightSearchLoadingPane"),e);0===h?e.html(c.emptyResultText(c)):e.empty().append(k).append('<div class="pager">'+r()+"</div>");0<h&&$(c.selector+" .booking-data").find(".search-results-count .count-available").removeClass("hidden").siblings(".count-unavailable").addClass("hidden");$(c.selector+" .booking-data").find(".search-results-count .num").text(h);$(c.selector+" .booking-data").find(".search-results-count .total").text(z.rows.length);var u=$(c.selector).find(".rows");c.registerHandlers&&
c.registerHandlers(u,c);u.find(".pager .page-count").off("click.pager").on("click.pager",function(){$(this).hasClass("selected")||(b(u),z.currentPage=$(this).data("pageNo"),$(this).parents(".pager").html(r()),a.trackEvent(g.CAT_PLAN_FLIGHT_RESULTS_DIALOG,"change-page"),setTimeout(function(){B()},j),$(".modal-box .ui-dialog-content").animate({scrollTop:0},"fast"))});for(e=0;e<C.length;e++)if("checkBox"===C[e].type)for(h=0;h<C[e].values.length;h++)C[e].values[h].enabled&&(l="ckbox-"+C[e].col+"-"+C[e].values[h].value.replace(/[\W_]+/g,
""),k=c.formatPrice?c.formatPrice(C[e].values[h].min):C[e].values[h].min,$("#"+l).removeClass("disabled").siblings('label[for="'+l+'"]').find(".min-price").html(k))}var z={},C=c.filters,G={},M={},w={},J=50;z.rows=[];z.currentPage=1;for(var F in C)M[C[F].col]=C[F];z.loadingComplete=function(){J=100;$(c.selector+" .loading .progress").css("width",J+"%");$(c.selector+" .loading").hide();var a=$(c.selector).find(".no-flights"),b=$(c.selector).find(".flight-list");z.rows.length?a.addClass("hidden"):(a.removeClass("hidden"),
b.addClass("hidden"));$(c.selector+" .booking-data").find(".search-results-count .count-available").removeClass("hidden").siblings(".count-unavailable").addClass("hidden")};z.loading=function(){J=50;$(c.selector+" .loading .progress").css("width",J+"%");$(c.selector+" .loading").show();$(c.selector+" .booking-data").find(".search-results-count .count-available").addClass("hidden").siblings(".count-unavailable").removeClass("hidden")};z.loadingTick=function(){J=Math.min(90,J+15);$(c.selector+" .loading .progress").css("width",
J+"%")};z.loadingHideMessage=function(){$(c.selector+" .loading .msg").hide();$(c.selector+" .flight-list-wrapper").removeClass("hidden")};z.push=function(a){for(var b=0;b<C.length;b++)switch(C[b].type){case "checkBox":p(C[b],a);break;case "rangeSlider":n(C[b],a);break;case "expandable":k(C[b],a)}z.rows.push(a)};z.clear=function(){z.rows=[];$(c.selector).parents(".modal-box").find(".qtip").each(function(){$(this).qtip("api").hide()})};z.setSearchParams=function(a,b,c,d){w.originName=a;w.originIataCode=
b;w.destinationName=c;w.destinationIataCode=d};z.display=function(){for(var h=$(c.selector).find(".flight-list"),i=$(c.selector).find(".filters"),k="",m=0;m<C.length;m++)if(0!==C[m].values.length)switch(0<m&&C[m].heading&&(k+='<div class="line"></div>'),G[""+m]=C[m],C[m].type){case "checkBox":k+=e(C[m],m);break;case "rangeSlider":k+=l(C[m],m);break;case "expandable":k+=t(C[m],m)}i.html(k);i=$(c.selector).find(".filters");i.find(".only").off("click.only").on("click.only",function(a){var e=$(this).parents("label"),
g=$("#"+e.attr("for")),h=$(c.selector).find(".rows"),i=G[g.data("filterId")],l=d(i.values,"value",g.data("value")),l=i.values[l];b(h);if(l.group){e=i.selectedValues;for(h=0;h<i.values.length;h++){var k=e.indexOf(i.values[h].value);i.values[h].group===l.group&&i.values[h].value!==g.data("value")?-1!==k&&($("#ckbox-airports-"+e[k].replace(/[\W_]+/g,"")).attr("checked",!1),e.splice(k,1)):i.values[h].value===g.data("value")&&-1===k&&e.push(g.data("value"))}}else e.siblings('input[type="checkbox"]').each(function(){$(this).attr("checked",
!1)}),i.selectedValues=[g.data("value")];g.attr("checked",!0);z.currentPage=1;setTimeout(function(){B()},j);a.stopPropagation();return!1});i.find('input[type="checkbox"]').off("click.filter-checkbox").on("click.filter-checkbox",function(){var d=$(this),e=d.parents(".ckbox"),f=$(c.selector).find(".rows"),h=G[d.data("filterId")];b(f);d.is(":checked")?h.selectedValues.push(d.data("value")):(d=h.selectedValues.indexOf(d.data("value")),0<=d&&h.selectedValues.splice(d,1));a.trackEvent(g.CAT_PLAN_FLIGHT_RESULTS_DIALOG,
"filter",e.data("type"));z.currentPage=1;setTimeout(function(){B()},j)});i.find(".view-more").off("click.ckbox-filters-view-more").on("click.ckbox-filters-view-more",function(){$(this).addClass("hidden").siblings('input[type="checkbox"].hidden').removeClass("hidden").siblings("label.hidden").removeClass("hidden")});i.find(".range-slider").each(function(){var d=$(this),e=G[d.data("filterId")],f=d.parents(".range-slider-wrapper"),h=d.prev(".range-slider-label");e.getDisplayValue&&h.html(e.getDisplayValue(d.data("min"),
d.data("max")));e.range.start=d.data("min");e.range.end=d.data("max");d.slider({range:!0,min:d.data("min"),max:d.data("max"),values:[d.data("min"),d.data("max")],slide:function(a,b){e.getDisplayValue&&h.html(e.getDisplayValue(b.values[0],b.values[1]))},stop:function(d,i){if(!(e.range.start===i.values[0]&&e.range.end===i.values[1])){var l=$(c.selector).find(".rows");b(l);e.range.start=i.values[0];e.range.end=i.values[1];e.getDisplayValue&&h.html(e.getDisplayValue(i.values[0],i.values[1]));a.trackEvent(g.CAT_PLAN_FLIGHT_RESULTS_DIALOG,
"filter",f.data("type"));z.currentPage=1;setTimeout(function(){B()},j)}}})});i.find(".expandable").each(function(){var a=$(this),b=G[a.data("filterId")];$(this).find(".expandable-text").off("click").on("click",function(){var c=$(this);a.toggleClass("expanded");a.hasClass("expanded")?b.expandedText?(c.html(b.expandedText),c.append($("<i>").addClass("fa").addClass("fa-angle-up"))):c.hide():(c.html(b.collapsedText),c.append($("<i>").addClass("fa").addClass("fa-angle-down")))})});B();z.rows.length&&h.removeClass("hidden")};
for(F=0;F<C.length;F++)if(C[F].values=[],C[F].groups=[],C[F].selectedValues=[],C[F].range={},"expandable"===C[F].type)for(var y=0;y<C[F].subFilters.length;y++)C[F].subFilters[y].values=[],C[F].subFilters[y].groups=[],C[F].subFilters[y].selectedValues=[],C[F].subFilters[y].range={};return z}}});define("text%21templates/bookFlightModal.html",[],function(){return'<div>\n    <div class="flight-summary">\n        <div class="clearfix">\n            <svg class="flight-icon notranslate"><use xlink:href="#icon-travel-flight"></use></svg>\n            <div class="flight-origin notranslate"></div>\n            <svg class="right-arrow notranslate"><use xlink:href="#icon-left-arrow"></use></svg>\n            <div class="flight-destination notranslate"></div>\n            <div class="flight-date notranslate"></div>\n            <div class="show-details text-link">Show details <i class="fa fa-angle-down"></i></div>\n        </div>\n        <table class="flight-details clearfix" style="display: none;">\n        </table>\n    </div>\n    <div class="booking-options">\n        <div class="title">Book your ticket</div>\n        <div class="booking-type"></div>\n        <table>\n            <tr class="headers">\n                <th>Booking site</th>\n                <th>Price per seat</th>\n                <th></th>\n            </tr>\n        </table>\n    </div>\n</div>'});
define("plan/transportation/searchFlightsModal","modules/analytics modules/analyticsEventParams modules/ajax moment modules/utils modules/modal modules/pagination text!templates/bookFlightModal.html modules/sojern jquery jqueryui".split(" "),function(a,g,d,p,m,j,i,c,b){function f(a,b){var c=p.utc(a.departureTime,C),d=p.utc(a.arrivalTime,C),e="",f=1<b.airlines.getValue(a).length,e=e+('<div class="new-row"><div class="content clearfix"><div class="image">'+(f?"Multiple Airlines":'<img src="'+a.carrierImageUrl+
'" onerror="this.parentElement.textContent=\''+a.carrierName+"'\"/>")+'</div><div class="total-price">Total: '+a.prices[0].formattedTotalPriceDisplay+'</div><div class="right-col"><div class="default-price">'+a.prices[0].formattedPriceDisplay+'<sup>per seat</sup></div><div class="default-agent">'+a.prices[0].agentName+'</div><a class="dropdown-wrapper cta-button small"  href="javascript:void(0);"><div class="dropdown"></div></a><a class="price dropdown-grp cta-button small" href="javascript:void(0);">Book</a></div><div class="summary"><div class="name">'+
(f?"Multiple Airlines":a.carrierName)+'</div><div class="flight clearfix"><div class="origin-time">'+c.format(M)+'</div><div class="origin-name">'+a.originStation+'</div><svg class="right-arrow"><use xlink:href="#icon-left-arrow"></use></svg><div class="destination-time">'+d.format(M)+'</div><div class="origin-name">'+a.destinationStation+'</div><div class="duration">('+m.formatDuration(a.duration)+')</div><div class="stops">'+u(a)+"</div></div>");if(a.inBoundFlight)var f=p.utc(a.inBoundFlight.departureTime,
C),g=p.utc(a.inBoundFlight.arrivalTime,C),e=e+('<div class="flight clearfix return-flight"><div class="origin-time">'+f.format(M)+'</div><div class="origin-name">'+a.inBoundFlight.originStation+'</div><svg class="right-arrow"><use xlink:href="#icon-left-arrow"></use></svg><div class="destination-time">'+g.format(M)+'</div><div class="origin-name">'+a.inBoundFlight.destinationStation+'</div><div class="duration">('+m.formatDuration(a.inBoundFlight.duration)+')</div><div class="stops">'+u(a.inBoundFlight)+
"</div></div>");e+='<div class="details-text text-link">Show details <i class="fa fa-angle-down"></i></div></div></div><div class="details hidden"><div class="departDate">Depart &mdash; '+c.format(G)+'<span class="right">'+m.formatDuration(a.duration)+'</span></div><div class="line"></div>';c.clone().startOf("day").isSame(d.clone().startOf("day"))||(e+='<div class="diff-day">This flight leaves on <b>'+c.format("dddd (D MMM)")+"</b> and arrives on <b>"+d.format("dddd (D MMM)")+"</b>.</div>");e+=k(a);
a.inBoundFlight&&(f=p.utc(a.inBoundFlight.departureTime,C),g=p.utc(a.inBoundFlight.arrivalTime,C),e+='<div class="departDate">Return &mdash; '+f.format(G)+'<span class="right">'+m.formatDuration(a.inBoundFlight.duration)+"</span></div>",e+='<div class="line"></div>',f.clone().startOf("day").isSame(g.clone().startOf("day"))||(e+='<div class="diff-day">This flight leaves on <b>'+f.format("dddd (D MMM)")+"</b> and arrives on <b>"+g.format("dddd (D MMM)")+"</b>.</div>"),e+=k(a.inBoundFlight));c=4<a.prices.length;
d='<table><tr class="headers"><th>Booking site</th><th>Price per seat</th><th></th>';for(f=0;f<a.prices.length;f++)d=2<f&&c?d+('<tr class="prices greater hidden" data-agent-name="'+a.prices[f].agentName+'" \n                                data-deep-link-url="'+a.prices[f].deepLinkUrl+'" data-price="'+a.prices[f].formattedPriceDisplay+'"><td><div class="image"><img src="'+a.prices[f].imageUrl+'"></div></td><td>'+a.prices[f].formattedPriceDisplay+'</td><td><a class="price cta-button small go" target="_blank" href="'+
a.prices[f].deepLinkUrl+'">Book</a></td></tr>'):d+('<tr class="prices '+(!c&&f===a.prices.length-1?"last-row":"")+'" data-agent-name="'+a.prices[f].agentName+'" \n                                data-deep-link-url="'+a.prices[f].deepLinkUrl+'" data-price="'+a.prices[f].formattedPriceDisplay+'"><td><div class="image"><img src="'+a.prices[f].imageUrl+'"></div></td><td>'+a.prices[f].formattedPriceDisplay+'</td><td><a class="price cta-button small go" target="_blank" href="'+a.prices[f].deepLinkUrl+'">Book</a></td></tr>');
d+="</table>";c&&(d+='<div class="show-text">View '+(a.prices.length-3)+' more...</div><div class="hide-text hidden">View less</div>');e+=d;return e+"</div></div>"}function u(a){if(a.legs){var b=[],c=a.legs.length-1;if(0===c)return"";for(var d=0;d<c;d++){if(2===d){b.pop();b.push("...");break}b.push(a.legs[d].destinationStation)}return c+" "+(1===c?"stop":"stops")+" ("+b.join(", ")+")"}return""}function n(a,b){var c=p.utc(a.departureTime,C),d=p.utc(a.arrivalTime,C),c='<div class="leg clearfix"><div class="left">'+
a.carrierName+" "+a.flightNo+(a.operatingCarrierName?'<br/><span class="operator">Operated by '+a.operatingCarrierName+"</span>":"")+'</div><div class="center"><div class="flight-time">'+c.format(M)+" - "+d.format(M)+'</div><div class="location">'+a.originLocation+" ("+a.originStation+") &mdash; "+a.destinationLocation+" ("+a.destinationStation+")</div>",c=c+('</div><div class="right">'+m.formatDuration(a.duration)+"</div></div>");b&&(d=p.utc(b.departureTime,C).diff(d,"minutes"),c+='<div class="layover leg clearfix"><div class="left">&nbsp;</div>',
c+='<div class="center"><div class="layover-text">Change Planes in '+a.destinationLocation+" ("+a.destinationStation+")</div></div>",c+='<div class="right">'+m.formatDuration(d)+"</div>",c+="</div>");return c}function k(a){var b='<div class="legs">';if(a.legs&&1<a.legs.length)for(var c=0;c<a.legs.length;c++)b+=n(a.legs[c],c<a.legs.length-1?a.legs[c+1]:null);else b+=n(a);return b+"</div>"}function h(a){return B.formattedPrices.hasOwnProperty(a)?B.formattedPrices[a]:a}function e(b){a.trackEvent(g.CAT_PLAN_FLIGHT_RESULTS_DIALOG,
"book-link-click");var c=a.getClientId();d.makeAJAXcall({type:"GET",url:window.contextPath+"/trackFlightTransporationPartnerClick",data:{gaClientId:c,planId:$("#plan").data("planId"),targetUrl:b}})}function l(b){var c=$(this).parents(".new-row").find("tr.prices"),d='<div class="agents">';c.each(function(a,b){d+='<a class="agent '+(5<c.length&&4<=a?"hidden":"")+'" href="'+$(b).data("deepLinkUrl")+'" target="_blank" rel="nofollow">\n                        <span class="price">'+$(b).data("price")+'</span><span class="agents-name">'+
$(b).data("agentName")+"</span></a>"});d+="</div>";5<c.length&&(d+='<div class="see-more">'+(c.length-4)+' more sites<i class="fa fa-angle-down"></i></div>');$(this).qtip({overwrite:!0,content:{text:d},position:{my:"top right",at:"bottom right",effect:!1,container:$(this).parents(".modal-box .ui-dialog-content"),target:$(this)},show:{event:!1,ready:!0},hide:{event:"unfocus",fixed:!0},events:{hide:function(a,c){c.destroy();$(b.selector+" .flight-list").css("margin-bottom","")},show:function(c,d){a.trackEvent(g.CAT_PLAN_FLIGHT_RESULTS_DIALOG,
"show-more-agents");d.elements.content.find(".see-more").off("click.see-more").on("click.see-more",function(){$(this).addClass("hidden").siblings(".agents").find(".agent").removeClass("hidden");d.reposition(null,!1);$(b.selector+" .flight-list").css("margin-bottom",d.elements.tooltip.height())});d.elements.content.find(".agent").off("click.agent").on("click.agent",function(){e($(this).attr("href"))});d.reposition(null,!1)}},style:{classes:"agents-qtip notranslate",tip:{corner:!1}}})}function t(){var a=
parseInt(B.searchParams.adults)+parseInt(B.searchParams.children)+parseInt(B.searchParams.infants);return 1===parseInt(B.searchParams.adults)&&1===a?"1 adult":a+" travelers"}function r(){var a=B.searchParams.cabinclass;return"PremiumEconomy"===a?"Premium Economy":"First"===a?"Fist Class":a}function q(){function b(a){var c=$("<tr>").append($('<td><div class="airline">'+a.carrierName+" "+a.flightNo+"</div></td>"));$("<td>").append('<div class="depart-arrive">Depart:</div>').append('<div class="date">'+
p.utc(a.departureTime).format("ddd, MMM D")+"</div>").append('<div class="time">'+p.utc(a.departureTime).format("h:mm a")+"</div>").append('<div class="airport">'+a.originCity+" ("+a.originStation+")</div>").appendTo(c);$("<td>").append('<div class="depart-arrive">Arrive:</div>').append('<div class="date">'+p.utc(a.arrivalTime).format("ddd, MMM D")+"</div>").append('<div class="time">'+p.utc(a.arrivalTime).format("h:mm a")+' <span class="duration">('+m.formatDuration(a.duration)+")</span></div>").append('<div class="airport">'+
a.destinationCity+" ("+a.destinationStation+")</div>").appendTo(c);k.append(c)}function d(a){if(a.legs)for(var c=0;c<a.legs.length;c++){if(0<c){var e=p.utc(a.legs[c].departureTime,C).diff(p.utc(a.legs[c-1].arrivalTime,C),"minutes");k.append('<tr class="layover"><td colspan="3"><span class="layover-text">CHANGE PLANES IN '+a.legs[c].originCity+" "+m.formatDuration(e)+"</span></td></tr>")}b(a.legs[c])}else b(a)}var f=$(this).parents(".new-row"),h=f.data("rowData"),i=$(c);i.find(".booking-type").text(r()+
", "+t());var j=p.utc(h.departureTime).format("ddd, MMM D");h.inBoundFlight&&(j+=" &mdash; "+p.utc(h.inBoundFlight.departureTime).format("ddd, MMM D"));i.find(".flight-date").html(j);i.find(".flight-origin").text(B.searchParams.originIataCode);i.find(".flight-destination").text(B.searchParams.destinationIataCode);h.inBoundFlight&&i.find("svg.right-arrow").attr("class","right-arrow round-trip").html('<use xlink:href="#icon-return-arrow"></use>');for(var j=i.find(".booking-options table"),l=0;l<h.prices.length;l++)f=
h.prices[l],f=$("<tr>").append($('<td><img src="'+f.imageUrl+'" /></td>')).append($("<td>"+f.formattedPriceDisplay+"</td>")).append($('<td><a class="cta-button small book-btn" target="_blank" href="'+f.deepLinkUrl+'">Book</a></td>')),j.append(f);var k=i.find(".flight-details");d(h);h.inBoundFlight&&(k.append('<tr class="return"><td colspan="3">RETURN</td></tr>'),d(h.inBoundFlight));i.find(".show-details").on("click",function(){k.toggle();k.is(":visible")?$(this).html('Hide details <i class="fa fa-angle-up"></i>'):
$(this).html('Show details <i class="fa fa-angle-down"></i>')});i.find(".book-btn").on("click",function(a){e($(this).attr("href"));a.stopPropagation()});i.dialog({resizable:!1,modal:!0,draggable:!1,autoOpen:!1,dialogClass:"dlg-book-flight mediumx",open:function(){$(".modal-box").addClass("scroll-hide");a.trackEvent(g.CAT_PLAN_FLIGHT_RESULTS_DIALOG,"book-dialog-open");i.parents(".ui-dialog").find(".ui-dialog-titlebar-close").empty();m.setupDialogOverlay(i,!1)},close:function(){$(".modal-box").removeClass("scroll-hide");
i.dialog("destroy").remove();n.remove()}});var n=$("<div>").css({position:"fixed",left:0,top:0,right:0,bottom:0,overflow:"auto","z-index":2E3}).attr("id","bookDetailsContainer");n.appendTo($("body"));i.parents(".ui-dialog").appendTo(n);i.dialog("open");n.off("click").on("click",function(a){"bookDetailsContainer"===$(a.target).attr("id")&&i.dialog("close")})}function D(b,c){b.find("a.price.dropdown-grp").off("click.a.price.dropdown-grp").on("click.a.price.dropdown-grp",function(a){q.apply(this);a.stopPropagation()});
b.find(".content").off("click.content").on("click.content",function(){var b=$(this).siblings(".details");b.is(":visible")?(a.trackEvent(g.CAT_PLAN_FLIGHT_RESULTS_DIALOG,"hide-flight-details"),$(this).find(".details-text").html('Show details <i class="fa fa-angle-down"></i>'),b.addClass("hidden"),b.find(".prices.greater").addClass("hidden")):(a.trackEvent(g.CAT_PLAN_FLIGHT_RESULTS_DIALOG,"show-flight-details"),$(this).find(".details-text").html('Hide details <i class="fa fa-angle-up"></i>'),b.removeClass("hidden"),
b.find(".show-text").removeClass("hidden"),b.find(".hide-text").addClass("hidden"))});b.find("a.dropdown-wrapper").off("click.price-dropdown").on("click.price-dropdown",function(a){a.preventDefault();a.stopPropagation();l.bind($(this))(c)});b.find(".show-text").off("click.show-text").on("click.show-text",function(){var a=$(this).parent(".details");$(this).siblings("table").find(".prices.greater").removeClass("hidden");$(this).addClass("hidden");a.find(".hide-text").removeClass("hidden");$(this).parents(".content").find(".total-price").removeClass("hidden")});
b.find(".hide-text").off("click.hide-text").on("click.hide-text",function(){var a=$(this).parent(".details");$(this).siblings("table").find(".prices.greater").addClass("hidden");$(this).addClass("hidden");a.find(".show-text").removeClass("hidden");$(this).parents(".content").find(".total-price").addClass("hidden")})}function v(a){a=$(a.selector+" > .no-flights").clone().removeClass("hidden");a.find(".msg").html("No matching flights found.<br/>Try adjusting some filters to see more results.");return $("<div>").append(a).html()}
var B={},z="",C="YYYY-MM-DDTHH:mm:ss+0000",G="ddd, MMM D",M="h:mmA";B.doSearchFlights=function(a,c){clearTimeout(z);B.searchParams=a;B.formattedPrices={};var e=i.initialize({filters:[{type:"checkBox",col:"stops",heading:"Stops",getValue:function(a){return(!a.legs||1===a.legs.length)&&(!a.inBoundFlight||!a.inBoundFlight.legs||1===a.inBoundFlight.legs.length)?"Non-stop":(!a.legs||2>=a.legs.length)&&(!a.inBoundFlight||!a.inBoundFlight.legs||2>=a.inBoundFlight.legs.length)?"1 stop":"2+ stops"},order:function(){return this.values.sort(function(a,
b){return a.value===b.value?0:"Non-stop"===a.value?-1:"Non-stop"===b.value?1:"1 stop"===a.value?-1:1})},filterDependecy:["airports","airlines","inbound","outbound"]},{type:"rangeSlider",col:"outbound",heading:"Times",subHeading:"Take off %origin_name% (%origin_code%)",combo:!0,min:0,max:1440,getValue:function(a){return p(a.departureTime,C)},getDisplayValue:function(a,b){var c=p(a),d=p(b),e=c.format("ddd hh:mm A")+" &mdash; ";c.date()!==d.date()&&(e+=d.format("ddd "));return e+=d.format("hh:mm A")},
compare:function(a,b){return a.isBefore(b)?-1:a.isAfter(b)?1:0}},{type:"rangeSlider",col:"inbound",subHeading:"Take off %destination_name% (%destination_code%)",min:0,max:1440,getValue:function(a){return!a.inBoundFlight?null:p(a.inBoundFlight.departureTime,C)},getDisplayValue:function(a,b){var c=p(a),d=p(b),e=c.format("ddd hh:mm A")+" &mdash; ";c.date()!==d.date()&&(e+=d.format("ddd "));return e+=d.format("hh:mm A")},compare:function(a,b){return a.isBefore(b)?-1:a.isAfter(b)?1:0}},{type:"expandable",
col:"",collapsedText:"Show landing times",subFilters:[{type:"rangeSlider",col:"outbound",subHeading:"Landing %destination_name% (%destination_code%)",combo:!0,min:0,max:1440,getValue:function(a){return p(a.arrivalTime,C)},getDisplayValue:function(a,b){var c=p(a),d=p(b),e=c.format("ddd hh:mm A")+" &mdash; ";c.date()!==d.date()&&(e+=d.format("ddd "));return e+=d.format("hh:mm A")},compare:function(a,b){return a.isBefore(b)?-1:a.isAfter(b)?1:0}},{type:"rangeSlider",col:"inbound",subHeading:"Landing %origin_name% (%origin_code%)",
min:0,max:1440,getValue:function(a){return!a.inBoundFlight?null:p(a.inBoundFlight.arrivalTime,C)},getDisplayValue:function(a,b){var c=p(a),d=p(b),e=c.format("ddd hh:mm A")+" &mdash; ";c.date()!==d.date()&&(e+=d.format("ddd "));return e+=d.format("hh:mm A")},compare:function(a,b){return a.isBefore(b)?-1:a.isAfter(b)?1:0}}],getValue:function(){return 1},getDisplayValue:function(){return 1}},{type:"checkBox",col:"airports",heading:"Airports",getGroup:function(a){return[a.originCity,a.destinationCity]},
getValue:function(a){return[a.originStation+": "+a.originLocation,a.destinationStation+": "+a.destinationLocation]},order:function(){var a=this.groups;return this.values.sort(function(b,c){return a.indexOf(b.group)<a.indexOf(c.group)?-1:a.indexOf(b.group)>a.indexOf(c.group)?1:b.value<c.value?-1:b.value>c.value?1:0})}},{type:"checkBox",col:"airlines",heading:"Airlines",getValue:function(a){function b(a){if(a.legs)for(var d=0;d<a.legs.length;d++){var e=a.legs[d].carrierName;-1===c.indexOf(e)&&c.push(e)}else e=
a.carrierName,-1===c.indexOf(e)&&c.push(e)}var c=[];b(a);a.inBoundFlight&&b(a.inBoundFlight);return c},order:function(){return this.values.sort(function(a,b){return a.value<b.value?-1:a.value>b.value?1:0})},filterDependecy:["airports","stops","inbound","outbound"]}],selector:".search-flights-dlg",render:f,emptyResultText:v,registerHandlers:D,formatPrice:h});j.open({dialogClass:"full display-flight-info-dlg",data:{history:{}},ajaxParams:{url:"/trip/"+$("#plan").data("planId")+"/search-flights",type:"GET",
data:a},onLoad:function(f){function g(){k++>m?e.loadingComplete():(e.loadingTick(),d.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/poll-flights",type:"POST",data:{searchId:i},success:function(c){var d=jQuery.parseJSON(c);l=3E3;if(!d||j===c||!d.status)z=window.setTimeout(g,l);else{n||(n=!0,b.trackPixel("fs",{fa1:d.originIataCode,fa2:d.destinationIataCode,fc:a.cabinclass,fd1:a.outbounddate,fd2:"oneway"===a.tripType?"":a.inbounddate}));j=c;e.clear();B.searchParams.originName=
d.originName;B.searchParams.originIataCode=d.originIataCode;B.searchParams.destinationName=d.destinationName;B.searchParams.destinationIataCode=d.destinationIataCode;e.setSearchParams(d.originName,d.originIataCode,d.destinationName,d.destinationIataCode);if(d.flights&&d.flights.length){for(c=0;c<d.flights.length;c++)B.formattedPrices[d.flights[c].prices[0].price]=d.flights[c].prices[0].formattedPriceDisplay,e.push(d.flights[c]);e.loadingHideMessage();e.display()}"UpdatesPending"===d.status?z=window.setTimeout(g,
l):e.loadingComplete()}},error:function(){e.loadingComplete()}}))}if(c.onModalLoad)c.onModalLoad(f);var h=f.find(".fa-question-circle");h.qtip({content:{text:f.find(".non-editable").find(".nearest-airport-alert").text()},position:{my:"center left",at:"center right",container:h.parents(".ui-dialog"),viewport:h.parents(".ui-dialog"),adjust:{x:5}},show:{event:"mouseover"},hide:{event:"mouseleave"},style:{classes:"help-text-qtip",tip:{width:20,height:10,corner:!0,mimic:"center"}}});e.loading();var i=
f.find(".search-flights-dlg").data("searchId"),j="",l=1E3,k=0,m=20,n=!1;i?z=window.setTimeout(g,l):e.loadingComplete()},onClose:function(){if(c.onModalClose)c.onModalClose();clearTimeout(z)}})};return B});define("text%21templates/transportCabinDropdown.html",[],function(){return'<div class="num-passenger">\n    <div class="adult agegroup">\n        <label>Adult<span> (12 +)</span></label>\n        <div class="input-number-box">\n            <span class="minus disabled"></span>\n            <input type="text" name="num-adult-passenger" class="adult-passenger" readonly>\n            <span class="plus"></span>\n        </div>\n    </div>\n    <div class="children agegroup">\n        <label>Children<span> (2-11)</span></label>\n        <div class="input-number-box">\n            <span class="minus disabled"></span>\n            <input type="text" name="num-children-passenger" class="children-passenger" readonly>\n            <span class="plus"></span>\n        </div>\n    </div>\n    <div class="infant agegroup">\n        <label>Infant<span> (Under 2)</span></label>\n        <div class="input-number-box">\n            <span class="minus disabled"></span>\n            <input type="text" name="num-infant-passenger" class="infant-passenger" readonly>\n            <span class="plus"></span>\n        </div>\n    </div>\n    <select name="cabin-type" class="cabin-type" id="transport-cabin-type">\n        <option value="Economy">Economy</option>\n        <option value="PremiumEconomy">Premium Economy</option>\n        <option value="Business">Business</option>\n        <option value="First">First Class</option>\n    </select>\n    <button class="cta-button large btn-save" disabled>Save</button>\n</div>'});
define("plan/transportation/flightTransportation","modules/events modules/analytics modules/analyticsEventParams moment modules/utils modules/modal plan/transportation/searchFlightsModal modules/flightquotes modules/intentmedia modules/eyeota text!templates/transportCabinDropdown.html jquery jqueryui jQueryExtensions/inspirockSelectmenu jQueryExtensions/inspirockDatepicker".split(" "),function(a,g,d,p,m,j,i,c,b,f,u){function n(a,b,c){b.find(".adult input").val()==a.data("adult")&&b.find(".infant input").val()==
a.data("infant")&&b.find(".children input").val()==a.data("children")&&b.find(".cabin-type").val()==a.data("cabin")?c.attr("disabled","disabled"):c.removeAttr("disabled")}function k(){var a=$(this).find(".cabin");if(a.qtip("api"))a.qtip("api").hide();else{a.select();var b=$(this).parents(".ui-dialog").length?$(this).parents(".ui-dialog"):$(this).parents(".booking-data.flight");a.qtip({overwrite:!0,content:u,position:{my:"top right",at:"bottom right",container:b},show:{event:"click",delay:0,ready:!0},
hide:{event:"unfocus",fixed:!0},events:{hide:function(a,b){b.destroy()},show:function(b,c){var d=c.elements.content,e=d.find(".btn-save"),f=d.find(".adult input"),g=d.find(".children input"),i=d.find(".infant input"),j=d.find("select");d.off("click.minus").on("click.minus",".minus",function(){var b=$(this);if(!b.hasClass("disabled")){var f=b.siblings("input"),g=parseInt(f.val()),i=f.attr("name");f.val(--g);h(f,g);b.parent().find("span.plus").removeClass("disabled");"num-adult-passenger"===i?(1>=g&&
b.addClass("disabled"),g<=c.elements.content.find(".infant input").val()&&(c.elements.content.find(".infant input").val(g),c.elements.content.find(".infant span.plus").addClass("disabled"))):"num-children-passenger"===i?0>=g&&b.addClass("disabled"):"num-infant-passenger"===i&&0>=g&&b.addClass("disabled");n(a,d,e)}});d.off("click.plus").on("click.plus",".plus",function(){var b=$(this);if(!b.hasClass("disabled")){var f=b.siblings("input"),g=parseInt(f.val()),i=f.attr("name");f.val(++g);g>=Q&&b.addClass("disabled");
h(f,g);b.parent().find("span.minus").removeClass("disabled");"num-adult-passenger"===i?c.elements.content.find(".infant span.plus").removeClass("disabled"):"num-children-passenger"!==i&&"num-infant-passenger"===i&&g>=c.elements.content.find(".adult input").val()&&b.addClass("disabled");n(a,d,e)}});d.off("selectmenuchange.cabin").on("selectmenuchange.cabin",".cabin-type",function(){n(a,d,e)});d.off("click.save").on("click.save",".btn-save",function(){a.data("adult",f.val());a.data("children",g.val());
a.data("infant",i.val());a.data("cabin",j.val());a.data("cabin-text",d.find("select option:selected").text());var b={};b.adult=f.val();b.children=g.val();b.infant=i.val();b.cabin=j.val();b["cabin-text"]=d.find("select option:selected").text();window.sessionStorage.setItem("cabin-selector-"+E,JSON.stringify(b));b=$(".transportation-pane").find(".booking-info").find(".cabin");r(a);a.parents(".search-flights-dlg").length&&r(b);c.hide()});if(window.sessionStorage.hasOwnProperty("cabin-selector-"+E)){var l=
JSON.parse(window.sessionStorage.getItem("cabin-selector-"+E)),k=B(l.adult,l.children,l.infant),m=k.children,p=k.infant;f.val(k.adult);g.val(m);i.val(p);j.val(l.cabin)}else f.val(a.data("adult")),g.val(a.data("children")),i.val(a.data("infant")),j.val(a.data("cabin"));j.inspirockSelectmenu({appendTo:d});h(d.find(".adult input"),a.data("adult"));h(d.find(".children input"),a.data("children"));h(d.find(".infant input"),a.data("infant"));r(a);n(a,d,e);l=d.find(".adult input");k=d.find(".children input");
m=d.find(".infant input");l.prev(".minus").toggleClass("disabled",1>=l.val());l.next(".plus").toggleClass("disabled",l.val()>=Q);k.prev(".minus").toggleClass("disabled",0>=k.val());k.next(".plus").toggleClass("disabled",k.val()>=Q);m.prev(".minus").toggleClass("disabled",0>=m.val());m.next(".plus").toggleClass("disabled",m.val()>=Math.min(parseInt(l.val()),Q))}},style:{classes:"traveler-tip qtip-light qtip-shadow",tip:{corner:!1}}})}}function h(a){a.toggleClass("zero",0===parseInt(a.val()))}function e(a,
b,c,d,e,f,g){return g?'<li><span class="destinations" title="'+a+" &mdash; "+b+'"><span class="destination-name">'+a+'</span><svg class="default-arrow"><use xlink:href="#icon-return-arrow" /></svg> <span class="destination-name">'+b+'</span></span><span class="short-date">'+e+" - "+f+'</span><span class="'+c+'">'+d+"</span></li>":'<li><span class="destinations" title="'+a+" &mdash; "+b+'"><span class="destination-name">'+a+'</span><svg class="default-arrow"><use xlink:href="#icon-left-arrow" /></svg><span class="destination-name">'+
b+'</span></span><span class="short-date">'+e+'</span> <span class="'+c+'">'+d+"</span></li>"}function l(a,b){var c=a.datepicker("getDate");null!==c?b.datepicker("option","minDate",c):b.datepicker("option","minDate","+0d")}function t(a,b){(b.startDestId||b.endDestId)&&w.find(".nearby-text").html("");void 0!==b.roundTrip&&(b.roundTrip?w.find(".round-trip-travel").click():w.find(".oneway-travel").click());b.startDestId&&(J.data("inspirockAutocomplete").setItem({id:b.startDestId,value:b.startDestination,
schema:b.startSchema,nearbyText:b.fromNearbyText,iata:b.startIata}),y.datepicker("setDate",p(b.departDate,x).toDate()),l(y,s));b.endDestId&&(F.data("inspirockAutocomplete").setItem({id:b.endDestId,value:b.endDestination,schema:b.endSchema,nearbyText:b.toNearbyText,iata:b.endIata}),b.returnDate?s.datepicker("setDate",p(b.returnDate,x).toDate()):s.datepicker("setDate",p(b.departDate,x).add(7,"d").toDate()))}function r(a){var b=[],c,d,e,f;window.sessionStorage.hasOwnProperty("cabin-selector-"+E)?(f=
JSON.parse(window.sessionStorage.getItem("cabin-selector-"+E)),e=B(f.adult,f.children,f.infant),c=e.adult,d=e.children,e=e.infant,f=f["cabin-text"]):(c=parseInt(a.data("adult")),d=parseInt(a.data("children")),e=parseInt(a.data("infant")),f=a.data("cabin-text"));1<c+d+e?b.push(c+d+e+" travelers"):0<c?b.push(c+" adult"):0<d?b.push(d+" children"):0<e&&b.push(e+" infant");b.push(f?f:q(a.data("cabin")));a.text(b.join(", "))}function q(a){var b=$("<div />").append(u);b.find("select").val(a);return b.find("select option:selected").text()}
function D(){$(this).addClass("selected").siblings("li").removeClass("selected");if("oneway"===$(this).data("tripType"))s.parents(".calendar-input").addClass("hidden"),y.parents(".calendar-input").removeClass("small");else if("roundtrip"===$(this).data("tripType")){s.parents(".calendar-input").removeClass("hidden");y.parents(".calendar-input").addClass("small");l(y,s);var a=J.data("inspirockAutocomplete").getSelectedItem(),b=F.data("inspirockAutocomplete").getSelectedItem(),c=y.datepicker("getDate");
a:{var a=a&&a.id,b=b&&b.id,d;for(d in L[0]){var e=L[0][d];if(a&&a===e.startDestId&&b&&b===e.endDestId&&e.returnDate&&p(c).isSame(p(e.departDate,x))){c=e.returnDate;break a}}c=p(c).add(7,"d").toDate()}s.datepicker("setDate",c)}m.removeAllErrorToolTips()}function v(a){a.off("click.tripType").on("click.tripType",".tripType",D);a.off("click.close").on("click.close",".close-btn",function(){j.close()});a.off("click.cabindropdown").on("click.cabindropdown",".cabin-input",k);a.find(".search-flights-btn").off("click.search-flights-btn").on("click.search-flights-btn",
function(){if("kiwi-demo.inspirock.com"===window.partnerDomain)window.open("https://www.kiwi.com/us/","_blank");else{var c=J.data("inspirockAutocomplete").getSelectedItem(),e=F.data("inspirockAutocomplete").getSelectedItem(),h=a.find(".tripType.selected").data("tripType"),j=p(y.datepicker("getDate")),l=p(s.datepicker("getDate")),k={position:{my:"left center",at:"right center",container:a,viewport:$(window),effect:!1}};if(!c||!c.id)m.showErrorTooltip(a.find(".start-destination"),"Enter a valid destination",
null,k);else if(!e||!e.id)m.showErrorTooltip(a.find(".end-destination"),"Enter a valid destination",null,k);else if(c&&e&&c.id===e.id)m.showErrorTooltip(a.find(".end-destination"),"End destination should be different from start destination",null,k);else if(j.isValid())if("roundtrip"===h&&!l.isValid())m.showErrorTooltip(s.siblings(".return-date"),"Select the date of return",null,k);else{var n,q,r;window.sessionStorage.hasOwnProperty("cabin-selector-"+E)?(r=JSON.parse(window.sessionStorage.getItem("cabin-selector-"+
E)),q=B(r.adult,r.children,r.infant),k=q.adult||1,n=q.children||0,q=q.infant||0,r=r.cabin):(k=H.data("adult")||1,n=H.data("children")||0,q=H.data("infant")||0,r=H.data("cabin"));var t=A.data("skyScannerKey");t?(h="http://partners.api.skyscanner.net/apiservices/referral/v1.0/"+(A.data("countryCode")+"/"+A.data("currency")+"/"+A.data("locale")),h+="/"+c.id+"/"+e.id+"/"+j.format("YYYY-MM-DD"),l&&l.isValid&&(h+="/"+l.format("YYYY-MM-DD")),window.open(h+("/?apiKey="+t+"&adult="+k+"&children=0&adultsv2="+
k+"&childrenv2=&infants="+q+"&cabinclass="+r),"_blank")):(i.doSearchFlights({origin:{placeId:c.id,schema:c.schema},destination:{placeId:e.id,schema:e.schema},outbounddate:!j||!j.isValid()?null:j.format(x),inbounddate:!l||!l.isValid()?null:l.format(x),adults:k,children:n,infants:q,cabinclass:r,tripType:h},{onModalLoad:function(a){G.prepareBookingInfo(a.find(".booking-info"));v(w)},onModalClose:function(){G.prepareBookingInfo(M)}}),r=d.CAT_PLAN_TRANS,a.parents(".search-flights-dlg").length?r=d.CAT_PLAN_FLIGHT_RESULTS_DIALOG:
a.parents(".ui-dialog").length&&(r=d.CAT_PLAN_FLIGHT_SEARCH_DIALOG),g.trackEvent(r,d.ACT_SEARCH_FLIGHTS),f.trackPixel({transport:"flight","from-iata-code":c.iata,"to-iata-code":e.iata,"travel-date":j.format("YYYY-MM")}),window.IntentMedia&&window.IntentMediaProperties?a.find(".im_cb").length&&(t=a.find(".im_cb input[type=checkbox]"),t.length?(t=t.is(":checked"),g.trackNonInteractionEvent(r,d.ACT_FLIGHT_COMPARISON,"im-checkbox-"+(t?"checked":"unchecked")),b.triggerFlightSearch(t,h,c.iata,e.iata,j,
"roundtrip"===h?l:j,k+n+q)):g.trackNonInteractionEvent(r,d.ACT_FLIGHT_COMPARISON,"im-available-no-checkbox")):g.trackNonInteractionEvent(r,d.ACT_FLIGHT_COMPARISON,"im-notavailable"))}else m.showErrorTooltip(y.siblings(".depart-date"),"Select the date of departure",null,k)}});var c=[],h=[];$("#transport-options").find("option").each(function(){var a=$(this),b=p(a.data("departDate"),x).format(window.dateFormatMomentDisplayPattern),d=a.data("returnDate")?p(a.data("returnDate"),x).format(window.dateFormatMomentDisplayPattern):
"",f=a.data("start"),g=a.data("end"),i=a.data("startId"),j=a.data("endId"),l=a.data("nearestAirportMessage"),k=a.data("isRoundTrip"),m="nearest-airport-message ",n=a.data("startSchema"),r=a.data("endSchema");if(null===l||""===l)m+="hidden";if("plane"!==a.data("mode"))return!0;c.push({id:i+j+a.data("departDate"),label:f,value:f,selectable:!0,li:e(f,g,m,l,b,d,k),className:"indent1",departDate:a.data("departDate"),returnDate:a.data("returnDate"),startDestination:f,endDestination:g,startDestId:i,endDestId:j,
startSchema:n,endSchema:r,roundTrip:k,startIata:a.data("startAirportIata"),endIata:a.data("endAirportIata")});h.push({id:i+j+a.data("departDate"),label:g,value:g,selectable:!0,li:e(f,g,m,l,b,d,k),className:"indent1",departDate:a.data("departDate"),returnDate:a.data("returnDate"),startDestination:f,endDestination:g,startDestId:i,endDestId:j,startSchema:n,endSchema:r,roundTrip:k,startIata:a.data("startAirportIata"),endIata:a.data("endAirportIata")})});L=[c,h];var n=L[0],q=L[1];if(n.length){var u={id:void 0,
label:"Search Flights",value:void 0,selectable:!1,li:"<li>Search Flights based on your route</li>",className:"section-title"};n.unshift(u);q.unshift(u)}else n.length||(q=n=void 0);u=window.contextPath+"/airportAutocomplete";J.inspirockAutocomplete({url:u,defaultDropdown:n,appendTo:J.parents(".input-grp"),classes:"flight",appendAirports:!0,onSelect:t,onFocusItem:t,onFocus:function(){m.hideErrorTooltip(J);m.hideErrorTooltip(F);$(this).select()}});F.inspirockAutocomplete({url:u,defaultDropdown:q,appendTo:F.parents(".input-grp"),
classes:"flight",appendAirports:!0,onSelect:t,onFocusItem:t,onFocus:function(){m.hideErrorTooltip(J);m.hideErrorTooltip(F);$(this).select()}});y.inspirockDatepicker({minDate:"+0d",maxDate:"+3y",dateFormat:"yy-mm-dd",altFormat:window.dateFormatDisplayPattern,altField:y.siblings(".depart-date"),onSelect:function(){l(y,s)},beforeShow:function(){y.parents(".booking-data").append($("#ui-datepicker-div").addClass("search-flight-datepicker-depart"));$("#ui-datepicker-div").hide()},onClose:function(){$("body").append($("#ui-datepicker-div").removeClass("search-flight-datepicker-depart"))}});
y.siblings(".depart-date").off("click").on("click",function(){m.hideErrorTooltip($(this));var a=$(this).siblings(".container-datepicker");a.datepicker(a.datepicker("widget").is(":visible")?"hide":"show")});s.inspirockDatepicker({dateFormat:"yy-mm-dd",maxDate:"+3y",altFormat:window.dateFormatDisplayPattern,altField:s.siblings(".return-date"),beforeShow:function(){s.parents(".booking-data").append($("#ui-datepicker-div").addClass("search-flight-datepicker-return"));$("#ui-datepicker-div").hide()},onClose:function(){$("body").append($("#ui-datepicker-div").removeClass("search-flight-datepicker-return"))}});
s.siblings(".return-date").off("click").on("click",function(){m.hideErrorTooltip($(this));var a=$(this).siblings(".container-datepicker");a.datepicker(a.datepicker("widget").is(":visible")?"hide":"show")});l(y,s);var n=a.find(".start-destination, .end-destination"),q=p(y.val(),x),u=p(s.val(),x),z=p().startOf("day");y.datepicker("setDate",q.toDate());s.datepicker("setDate",u.toDate());z.isAfter(q)&&(q=z.clone(),u=q.clone().add(7,"days"),y.datepicker("setDate",q.toDate()),s.datepicker("setDate",u.toDate()));
l(y,s);n.each(function(){var a=$(this).data("id"),b=a?$(this).data("value"):"";a&&$(this).data("inspirockAutocomplete").setItem({id:a,value:b,schema:$(this).data("schema"),iata:$(this).data("iata")})});r(a.find(".cabin"))}function B(a,b,c){var d={};d.adult=Math.min(parseInt(a),Q);d.children=Math.min(parseInt(b),Q);d.infant=Math.min(parseInt(c),d.adult);return d}function z(a,b){if("kiwi-demo.inspirock.com"===window.partnerDomain)window.open("https://www.kiwi.com/us/","_blank");else{if(window.sessionStorage.hasOwnProperty("cabin-selector-"+
E)){var c=JSON.parse(window.sessionStorage.getItem("cabin-selector-"+E)),d=B(c.adult,c.children,c.infant);b.adults=d.adult;b.children=d.children;b.infants=d.infant;b.cabinclass=c.cabin}else b.cabinclass="Economy",b.adults=$("#plan").data("numAdults")+$("#plan").data("numTeens"),b.children=$("#plan").data("numKids"),b.infants=0;(c=A.data("skyScannerKey"))?(d="http://partners.api.skyscanner.net/apiservices/referral/v1.0/"+(A.data("countryCode")+"/"+A.data("currency")+"/"+A.data("locale")),d+="/"+b.origin.placeId+
"/"+b.destination.placeId+"/"+b.outbounddate,b.inbounddate&&(d+="/"+b.inbounddate),d+="/?apiKey="+c+"&adult="+b.adults+"&children=0&adultsv2="+b.adults+"&childrenv2=&infants="+b.infants+"&cabinclass="+b.cabinclass,window.open(d,"_blank")):i.doSearchFlights(b,{onModalLoad:function(a){G.prepareBookingInfo(a.find(".booking-info"));v(w)},onModalClose:function(){G.prepareBookingInfo(M)}})}}function C(b,c){var e,f;c.startIataCode?c.endIataCode||(e="Please select destination airport",f="end"):(e="Please select origin airport",
f="start");var h=$('<div><input type="text" name="search" class="airport-search flat"/></div>');h.dialog({resizable:!1,modal:!0,title:e,draggable:!1,width:"490px",dialogClass:"dlg-route-edit dlg-modify-boundary mediumx",buttons:{Search:function(){var b=h.find(".airport-search").data("inspirockAutocomplete").getSelectedItem();void 0===b||null===b?m.showErrorTooltip(h.find(".airport-search"),"Specify an airport"):("start"===f?(c.startIataCode=b.id,c.startSchema="sky",c.searchData.startIata=b.id,c.searchData.startDestinationId=
null):"end"===f&&(c.endIataCode=b.id,c.endSchema="sky",c.searchData.endIata=b.id,c.searchData.endDestinationId=null),g.trackEvent(c.event,d.ACT_SEARCH_FLIGHTS),a.triggerEvent("flight-search","show-transport-modal",{searchData:c.searchData}),h.dialog("close"))}},open:function(){m.setupDialogOverlay(h);var a=h.find(".airport-search");a.inspirockAutocomplete({url:window.contextPath+"/airportAutocomplete",appendTo:h.parents(".ui-dialog"),onFocus:function(){m.hideErrorTooltip(a)}})},close:function(){h.dialog("destroy").remove();
m.removeAllErrorToolTips()}})}var G={},M,w,J,F,y,s,H,x=m.ISO_DATE_FORMAT,A=$("#plan"),E=A.data("planId"),K=m.ISO_DATE_FORMAT,L=[],Q=m.MAX_TRAVELERS_FLIGHT;G.isAvailable=function(a){return a&&"plane"!==a&&"flight"!==a.toLowerCase()?!1:J.data("value")||F.data("value")||a};G.prepareBookingInfo=function(a){w=a.find(".booking-data.flight");J=w.find(".start-destination");F=w.find(".end-destination");y=w.find(".depart-date-copy");s=w.find(".return-date-copy");H=w.find(".cabin");var c=w,d=c.find(".start-date"),
e=c.find(".end-date"),f=p(d.text()),g=p(e.text());d.append('<div class="day text">'+f.format("dddd")+"</div>").find(".value").html(f.format("MMM D"));e.append('<div class="day text">'+g.format("dddd")+"</div>").find(".value").html(g.format("MMM D"));c.find(".non-editable").off("click.change-flights-btn").on("click.change-flights-btn",function(){$(this).addClass("hidden").siblings(".editable").removeClass("hidden");$(this).parents(".search-flights-dlg").find(".flight-search-dlg-heading").removeClass("hidden");
$(this).parents(".search-flights-dlg").find(".booking-info").addClass("flight-search-heading");$(this).siblings(".search-results-count").addClass("hidden")});window.IntentMediaProperties&&w.find(".im_cb").length&&(a=!a.parents(".ui-dialog").length?"flight.frontdoor":"flight.frontdoor.modal",IntentMediaProperties.page_id=a);b.triggerRefresh()};G.initialize=function(b){M=b?b:$("#transportation");G.prepareBookingInfo(M);v(w);w.parents(".booking-info").find(".rentals-tiles.flight .flight").each(function(){$(this).off("click").on("click",
function(){var b=$(this),b={origin:{placeId:b.data("startId"),schema:b.data("startSchema")},destination:{placeId:b.data("endId"),schema:b.data("endSchema")},outbounddate:b.data("departDate"),inbounddate:b.data("returnDate"),adults:b.data("adults"),children:b.data("children"),infants:b.data("infants"),cabinclass:H.data("cabin"),tripType:b.data("isRoundTrip")?"roundtrip":"oneway"};a.triggerEvent("route","flight-search",b)})});M.off("click.powered-by-module.flight").on("click.powered-by-module.flight",
".powered-by-module.flight .search-flights-btn",function(){a.triggerEvent("flight","show-transport-modal",{searchData:{mode:"plane",showEmpty:"true"}})});w.parents(".booking-info").find(".rentals-tiles.flight .flight").each(function(){var a=$(this),b=a.find(".price, .overview-route-price"),d=a.data("startCityIataCode"),e=a.data("endCityIataCode"),f=a.data("startDestinationId"),g=a.data("endDestinationId"),h=a.data("departDate"),i=a.data("returnDate");a.data("planId");var j=p.utc(h,K),l;i&&(l=p.utc(i,
K),l.isBefore(j)&&(j=h,h=i,i=j,j=d,d=e,e=j,j=f,f=g,g=j));if(b.hasClass("overview-route-price")&&"plane"===a.data("mode")){if(!b.length||!d||!e||d===e)return!0;c.getQuote({startDestinationId:f,endDestinationId:g,outboundDateStr:h,inboundDateStr:i},function(c){b.html(c.formattedAmount);a.find(".price-module").removeClass("hidden")})}});0===M.find(".rentals-tiles.flight .flight").length&&M.find(".powered-by-module.flight").addClass("no-flight-tiles");1400>$("body").width()?$(".page-content").find(".flight-background").css("background-position",
"center -10px"):1400<$("body").width()&&1550>$("body").width()?$(".page-content").find(".flight-background").css("background-position","center -70px"):$(".page-content").find(".flight-background").css("background-position","center bottom")};G.registerEventHandlers=function(){a.addObserver("flight-search","transportation",z);a.addObserver("prompt-flight-search","transportation",C)};return G});define("text%21templates/editDriverAge.html",[],function(){return'<div>\n    <input type="checkbox" name="driver-age-ckbox" id="driver-age-ckbox" class="flat" checked/>\n    <label for="driver-age-ckbox">\n        Driver\'s age is between 25 and 65 \n    </label>\n    <sup class="fa fa-question-circle" aria-hidden="true" data-hasqtip="19" aria-describedby="qtip-19"></sup>\n        <span class="help-text hidden">Price may vary by age of driver at the time of rental.</span>\n    <input type="text" placeholder="Enter age" name="search" class="custom-driver-age flat hidden" oninput="value=value.replace(/[^0-9]/g, \'\');"/>\n</div>'});
define("plan/transportation/carTransportation","modules/events modules/analytics modules/analyticsEventParams modules/ajax moment modules/utils modules/modal modules/map text!templates/editDriverAge.html modules/intentmedia modules/eyeota jquery jqueryui jQueryExtensions/inspirockSelectmenu jQueryExtensions/inspirockDatepicker".split(" "),function(a,g,d,p,m,j,i,c,b,f,u){function n(){var a=H.data("inspirockAutocomplete").getSelectedItem(),b=s.find(".end-destination:not(.hidden)").length?x.data("inspirockAutocomplete").getSelectedItem():
a,c=parseInt(E.val()),e=parseInt(L.val()),h=m(A.datepicker("getDate")),i=m(K.datepicker("getDate")),l=window.sessionStorage.getItem("driver-age"),k=h.clone().add(c,"m"),n=i.clone().add(e,"m"),p=k.format("YYYY-MM-DDTHH:mm:ss"),r=n.format("YYYY-MM-DDTHH:mm:ss");j.removeAllErrorToolTips();!a||!a.id?j.showErrorTooltip(H,"Enter a valid destination",null,{}):!b||!b.id?j.showErrorTooltip(x,"Enter a valid destination",null,{}):h.clone().add(c,"m").isAfter(i.clone().add(e,"m"))?j.showErrorTooltip(K.parent(".calendar-input"),
"Drop-off time cannot be before pick-up time",null,{}):(c=d.CAT_PLAN_TRANS,s.parents(".ui-dialog").length&&(c=d.CAT_PLAN_CAR_SEARCH_DIALOG),l?(window.open("/trip/"+Q+"/car-redirect?from="+a.id+"&to="+b.id+"&pickupDateTime="+p+"&dropoffDateTime="+r+"&driversAge="+("default"===l?35:l),"_blank"),g.trackEvent(c,d.ACT_SEARCH_CARS),u.trackPixel({transport:"car","from-iata-code":a.id,"to-iata-code":b.id,"travel-date":k.format("YYYY-MM")})):(window.IntentMedia&&window.IntentMediaProperties?s.find(".im_cb").length&&
(l=s.find(".im_cb input[type=checkbox]"),l.length?(l=l.is(":checked"),g.trackNonInteractionEvent(c,d.ACT_CARS_COMPARISON,"im-checkbox-"+(l?"checked":"unchecked")),f.triggerCarSearch(l,a===b?"roundtrip":"oneway",a.id,b.id,h,k.format("HHmm"),i,n.format("HHmm"))):g.trackNonInteractionEvent(c,d.ACT_CARS_COMPARISON,"im-available-no-checkbox")):g.trackNonInteractionEvent(c,d.ACT_CARS_COMPARISON,"im-notavailable"),z("view_cars")))}function k(a,b){var c=a.datepicker("getDate");null!==c?b.datepicker("option",
"minDate",c):b.datepicker("option","minDate","+0d")}function h(a){return'<li><span class="destinations" title="'+a+'">'+a+"</span></li>"}function e(){var a=s.find(".stay-data").length,b=[],c=[],d,e,f,g,i,j,l,k,m,n,p=!0,r;s.find(".stay-data").each(function(q,t){var s=$(t),v=s.data("id"),y=s.data("destinationId"),u=s.data("value"),w=s.data("nearbyText");v&&(r&&r.data("countryId")!==s.data("countryId")&&(p=!1),0===q&&(d=v,e=u,f=y,l=s.data("arriveDate"),m=w),q===a-1&&(g=v,i=u,j=y,k=s.data("departDate"),
n=w),b.push({id:s,label:u,value:u,selectable:!0,li:h(u),className:"indent1",departDate:s.data("arriveDate"),returnDate:s.data("departDate"),startDestination:w?u+" * ":u,startDestId:v,startDestinationId:f,fromNearbyText:w?"* Pickup in "+w:""}),c.push({id:s,label:u,value:u,selectable:!0,li:h(u),className:"indent1",departDate:s.data("arriveDate"),returnDate:s.data("departDate"),endDestination:w?u+" * ":u,endDestId:v,endDestinationId:j,toNearbyText:w?"* Dropoff in "+w:""}),r=s)});if(b.length){var q={id:void 0,
nightstay:!1,value:void 0,selectable:!1,className:"section-title",li:"<li>Search cars based on your route</li>"};b.unshift(q);c.unshift(q)}p&&(d&&g)&&(q={id:d+g+l,label:e,value:e,selectable:!0,className:"indent1",departDate:l,returnDate:k,startDestination:m?e+" * ":e,endDestination:n?i+" * ":i,startDestId:d,endDestId:g,startDestinationId:f,endDestinationId:j,fromNearbyText:m?"* Pickup in "+m:"",toNearbyText:n?"* Dropoff in "+n:""},b.unshift(q),c.unshift(q));return[b,c]}function l(){var a=H.data("inspirockAutocomplete").getSelectedItem(),
b=x.data("inspirockAutocomplete").getSelectedItem(),c=a?a.nearbyText:"",d=b&&!s.find(".end-destination").hasClass("hidden")?b.nearbyText:"";a&&(a.nearbyText&&a&&-1===a.nearbyText.indexOf("Pickup"))&&(c="* Pickup in "+a.nearbyText);!x.hasClass("hidden")&&(b&&b.nearbyText&&-1===b.nearbyText.indexOf("Dropoff"))&&(d="* Dropoff in "+b.nearbyText);s.find(".nearby-text").html(c+" "+d)}function t(){var a=m(A.datepicker("getDate")),b=m(K.datepicker("getDate")),c=parseInt(E.val()),d=parseInt(L.val());!b.isAfter(a)&&
c>d&&(L.val(c),L.selectmenu("refresh"))}function r(a,b){var c=b.startDestId?b:H.data("inspirockAutocomplete").getSelectedItem(),d=b.endDestId?b:x.data("inspirockAutocomplete").getSelectedItem();(b.startDestId||b.endDestId)&&s.find(".nearby-text").html("");if(s.find("#same-dropoff").is(":checked")){var e=m(b.departDate,O),f=m(b.returnDate,O),g=m(new Date).startOf("date");g.isSameOrAfter(e)&&(e=g.clone().add(1,"days"),f=g.clone().add(1,"days"));A.datepicker("setDate",e.toDate());k(A,K);K.datepicker("setDate",
f.toDate());e.isSame(f)?(E.val(600),L.val(1080)):(E.val(600),L.val(600))}else b.startDestId&&(e=m(b.departDate,O),g=m(new Date).startOf("date"),g.isSameOrAfter(e)&&(e=g.clone().add(1,"days")),A.datepicker("setDate",e.toDate()),E.val(600),k(A,K)),b.endDestId&&(e=m(b.departDate,O),f=m(b.returnDate,O),g=m(new Date).startOf("date"),g.isSameOrAfter(e)&&(f=g.clone().add(1,"days")),K.datepicker("setDate",f.toDate()),L.val(600),s.find("#same-dropoff").prop("checked",!1).change());b&&(b.startDestinationId&&
b.startDestinationId===b.endDestinationId)&&s.find("#same-dropoff").prop("checked",!0).change();c&&$(a.target).hasClass("start-destination")&&((e=c.nearbyText?c.nearbyText:c.fromNearbyText)&&-1===e.indexOf("Pickup")&&(e="* Pickup in "+e),c.value+=e&&-1===c.value.indexOf("*")?" *":"",H.data("inspirockAutocomplete").setItem({id:c.startDestId?c.startDestId:c.id,value:c.startDestination?c.startDestination:c.value?c.value:"",nearbyText:e?e:""}));d&&$(a.target).hasClass("end-destination")&&((c=d.nearbyText?
d.nearbyText:d.toNearbyText)&&-1===c.indexOf("Dropoff")&&(c="* Dropoff in "+c),d.value+=c&&-1===d.value.indexOf("*")?" *":"",x.data("inspirockAutocomplete").setItem({id:d.endDestId?d.endDestId:d.id,value:d.endDestination?d.endDestination:d.value?d.value:"",nearbyText:c?c:""}));l();j.hideErrorTooltip(H);j.hideErrorTooltip(x)}function q(a,b){var c=window.contextPath+"/trip/"+$("#plan").data("planId")+"/carsAutocomplete";a.inspirockAutocomplete({url:c,defaultDropdown:b,appendTo:a.parents(".input-grp"),
classes:"flight",appendAirports:!0,onSelect:r,onEmpty:l,onFocus:function(){j.hideErrorTooltip(H);j.hideErrorTooltip(x);$(this).select()},sanitize:function(a){return a.replace(" *","")}})}function D(a,b,c){a.inspirockDatepicker({minDate:"+0d",maxDate:"+3y",dateFormat:"yy-mm-dd",altFormat:window.dateFormatDisplayPattern,altField:a.siblings("."+b+"-date"),onSelect:function(a,b){if(c&&c.onSelect)c.onSelect(a,b);k(A,K)},beforeShow:function(){i.isOpen()&&(a.parents(".booking-data").append($("#ui-datepicker-div").addClass("search-flight-datepicker-"+
b).addClass("transportation-datepicker-car-"+b)),$("#ui-datepicker-div").hide())},onClose:function(){$("body").append($("#ui-datepicker-div").removeClass("search-flight-datepicker-"+b).removeClass("transportation-datepicker-car-"+b))}});a.siblings("."+b+"-date").off("click").on("click",function(){j.hideErrorTooltip($(this));var a=$(this).siblings(".container-datepicker");a.datepicker(a.datepicker("widget").is(":visible")?"hide":"show")})}function v(){var a=s.find(".driver-age-txt"),b=window.sessionStorage.getItem("driver-age");
a.toggleClass("hidden",!b);b&&(s.find(".im_cb").remove(),a.find(".age").text("default"===b?"between 25 and 65":b));s.off("click.edit_driverAge").on("click.edit_driverAge",".edit-driver-age",z)}function B(a){var b="default";a.find("#driver-age-ckbox").is(":checked")||(b=a.find(".custom-driver-age").val());if(!b)return j.showErrorTooltip(a.find(".custom-driver-age"),"Enter age"),!1;if(999<parseInt(b))return j.showErrorTooltip(a.find(".custom-driver-age"),"Age cannot be greater than 999"),!1;window.sessionStorage.setItem("driver-age",
b);v();a.dialog("close");return!0}function z(a,c){var d=$(b),e=window.sessionStorage.getItem("driver-age"),f={Save:function(){B(d)}};a&&"view_cars"===a?f={"View Cars":function(){B(d)&&n()}}:a&&"tile_cars"===a&&(f={"View Cars":function(){B(d)&&w(c)}});d.dialog({resizable:!1,modal:!0,title:"Confirm driver's age",draggable:!1,width:"490px",dialogClass:"dlg-route-edit dlg-modify-driver-age mediumx",buttons:f,open:function(){j.setupDialogOverlay(d,!1);d.find("#driver-age-ckbox").off("change.driver-age").on("change.driver-age",
function(){d.find(".custom-driver-age").toggleClass("hidden",$(this).is(":checked"));j.removeAllErrorToolTips()});e&&"default"!==e&&(d.find(".custom-driver-age").val(e),d.find("#driver-age-ckbox").click());var a=d.find(".fa-question-circle");a.qtip({content:{text:d.find(".help-text").text()},position:{my:"center left",at:"center right",container:a.parents("body"),viewport:a.parents("body"),effect:!1,adjust:{x:5}},show:{event:"mouseover"},hide:{event:"mouseleave"},style:{classes:"help-text-qtip",tip:{width:20,
height:10,corner:!0,mimic:"center"}}})},close:function(){j.removeAllErrorToolTips();d.dialog("destroy").remove()}})}function C(){H.toggleClass("large",!0===$(this).prop("checked"));x.toggleClass("hidden",!0===$(this).prop("checked"));l();j.removeAllErrorToolTips()}function G(a,b,c){a.data("inspirockAutocomplete").setItem({id:c.id,value:c.value,nearbyText:c.nearbyText});b.datepicker("setDate",c.date.toDate())}function M(a,b,c){var d={};c?(d.id=a.data("id"),d.destinationId=a.data("destinationId"),c=
a.data("value"),c+=a.data("nearbyText")&&-1===a.data("value").indexOf("*")?" *":"",d.value=c,d.nearbyText=a.data("nearbyText"),d.date=m(a.data(b+"Date"))):(d.date=m(a.data(b+"Date")),d.value="",d.nearbyText="");return d}function w(a){var b=$(a).data("from"),c=$(a).data("to"),e=window.sessionStorage.getItem("driver-age"),f=$(a).data("pickupDateTime"),h=$(a).data("dropoffDateTime");e?(window.open("/trip/"+Q+"/car-redirect?from="+b+"&to="+c+"&pickupDateTime="+f+"&dropoffDateTime="+h+"&driversAge="+("default"===
e?35:e),"_blank"),g.trackEvent(d.CAT_PLAN_TRANS,d.ACT_SEARCH_CARS)):z("tile_cars",a)}function J(){var a=$(this),b=a.find(".mini-map");if(b.is(":visible")){var c=[];a.find(".tile-map-row").each(function(){c.push($(this).data("destinationId"))});var e=!0;if(e=N.length===c.length)for(var f=0;f<N.length;f++)e&=N[f]===c[f];if(!e||b.is(":empty"))N=c,b.empty(),a.prepareMiniMap({$rootView:a,$mapMarkerDataHolders:a.find(".tile-map-row"),showMarkerLabel:!0,nonInteractive:!0,showDirections:!0,analyticsCategory:d.CAT_PLAN_TRANS_CARTILE})}}
var F={},y,s,H,x,A,E,K,L,Q=$("#plan").data("planId"),N=[],O=j.ISO_DATE_FORMAT;F.isAvailable=function(a){return a&&"car"!==a.toLowerCase()?!1:s.length&&e()[0].length};F.prepareBookingInfo=function(a){a.find(".drivers-age-car").removeClass("hidden");s=a.find(".booking-data.car");H=s.find(".start-destination");x=s.find(".end-destination");A=s.find(".depart-date-copy");E=s.find(".depart-hrs");K=s.find(".return-date-copy");L=s.find(".return-hrs");y.find(".transportation-options .mini-map").each(function(){c.addToQueue(J.bind($(this).parent(".rental-car-tile")))});
window.sessionStorage.getItem("driver-age")?s.find(".im_cb").remove():(window.IntentMediaProperties&&s.find(".im_cb").length&&(a=!a.parents(".ui-dialog").length?"car.frontdoor":"car.frontdoor.modal",IntentMediaProperties.page_id=a),f.triggerRefresh())};F.populateFields=function(){var a,b,c=!0;s.find(".stay-data").each(function(a,d){b&&b!==$(d).data("countryId")&&(c=!1);b=$(d).data("countryId")});a=c;var d=M(s.find(".stay-data:first"),"arrive",a);a=M(s.find(".stay-data:last"),"depart",a);G(H,A,d);
G(x,K,a);"same"===(d.destinationId&&d.destinationId===a.destinationId?"same":"different")?s.find("#same-dropoff").prop("checked",!0).change():s.find("#same-dropoff").prop("checked",!1).change();l()};F.initialize=function(b){y=b?b:$("#transportation");F.prepareBookingInfo(y);s.off("click.search-cars-btn").on("click.search-cars-btn",".search-cars-btn",n);s.off("change.tripType").on("change.tripType",".tripType",C);y.off("click.rental-car-tile").on("click.rental-car-tile",".rental-car-tile",function(){w($(this))});
y.find(".booking-data.car .depart-hrs").inspirockSelectmenu({appendTo:E.parents(".booking-data.car"),change:t});y.find(".booking-data.car .return-hrs").inspirockSelectmenu({appendTo:E.parents(".booking-data.car"),change:t});y.off("click.powered-by-module.car").on("click.powered-by-module.car",".powered-by-module.car .search-cars-btn",function(){a.triggerEvent("car","show-transport-modal",{searchData:{mode:"car",showEmpty:"true"}})});1400<$("body").width()?$(".page-content").find(".car-background").css("background-position",
"center"):$(".page-content").find(".car-background").css("background-position","center -20px");var b=s,c=e(b),d=c[0],c=c[1];d.length||(c=d=void 0);q(H,d);q(x,c);D(A,"depart",{onSelect:function(){k(A.siblings(".container-datepicker"),K.siblings(".container-datepicker"))}});D(K,"return");k(A,K);var b=b.find(".start-destination, .end-destination"),d=m(A.val(),O),c=m(K.val(),O),f=m().startOf("day");A.datepicker("setDate",d.toDate());K.datepicker("setDate",c.toDate());f.isAfter(d)&&(d=f.clone(),c=f.clone().add(1,
"days"),A.datepicker("setDate",d.toDate()),K.datepicker("setDate",c.toDate()),k(A,K));b.each(function(){var a=$(this).data("id"),b=a?$(this).data("value"):"",c=a?$(this).data("nearbyText"):"";a&&$(this).data("inspirockAutocomplete").setItem({id:a,value:b,nearbyText:c})});v()};return F});
define("plan/transportation/trainTransportation","modules/events modules/analytics modules/analyticsEventParams modules/ajax jquery jqueryui jQueryExtensions/inspirockSelectmenu".split(" "),function(a,g,d,p){function m(a,b){var c=g.getClientId();p.makeAJAXcall({url:window.contextPath+"/trackTrainSearchClick",data:{gaClientId:c,providerId:a,planId:$("#plan").data("planId"),targetUrl:b},type:"GET"});g.trackEvent(d.CAT_PLAN_TRANS,d.ACT_SEARCH_TRAINS,a)}function j(){var a=$(this).parents(".train-logo").data("url"),
b=$(this).parents(".booking-data.train").data("providerId");window.open(a,"_blank");m(b,a)}function i(){var a=$(this).parents(".booking-data.train").data("providerId");m(a,$(this).attr("href"))}function c(){var a=$("option:selected",this),c=a.data("pageLink"),d=a.data("logoUrl");a.data("blurb");var a=a.data("pageLinkText"),g=b.find(".train-provider-details");g.find(".train-logo").data("url",c);g.find(".train-logo").find("img").hide().attr("src",d).on("load",function(){$(this).show()});g.find(".train-link").html(a);
g.find(".train-link").prop("href",c)}var a={},b;a.prepareBookingInfo=function(){};a.isAvailable=function(){return!b.find(".no-trains").length};a.initialize=function(a){b=a?a:$("#transportation");b.find(".train-logo-image").off("click.train-logo-image").on("click.train-logo-image",j);b.find(".train-link").off("click.train-link").on("click.train-link",i);a=b.find(".train-provider-choices");b.find("#train-provider-list").inspirockSelectmenu({$appendTo:a});b.off("selectmenuchange").on("selectmenuchange",
"#train-provider-list",c)};return a});
define("plan/transportation/addReservationModal","modules/events modules/ajax modules/analytics moment modules/utils modules/modal jquery jqueryui jQueryExtensions/inspirockDatepicker".split(" "),function(a,g,d,p,m,j){function i(a){if(!a.is(":visible"))return{};var b=a.find(".depart-date").siblings(".container-datepicker").datepicker("getDate"),d=c(a.find("select.depart-time-hrs")),g=a.find(".arrival-date").siblings(".container-datepicker").datepicker("getDate"),h=c(a.find("select.arrival-time-hrs"));
if(!b)return m.showErrorTooltip(a.find(".depart-date"),"Enter departure date",null,{}),null;if(!g)return m.showErrorTooltip(a.find(".arrival-date"),"Enter arrival date",null,{}),null;if(!d||!h)return null;b.setHours(d.hrs);b.setMinutes(d.mins);g.setHours(h.hrs);g.setMinutes(h.mins);return g<b?(m.showErrorTooltip(a.find("#arrival-time-departure .ui-selectmenu-status"),"Arrival Time Cannot be before departure time",null,{}),null):{departure:f(b),arrival:f(g)}}function c(a){var b=a.val();if(!b)return m.showErrorTooltip(a,
"Enter time",null,{}),null;b=parseInt(b);a=b%60;return{hrs:(b-a)/60,mins:a}}function b(a){if(!a.is(":visible"))return{};var b=a.find(".depart-date").siblings(".container-datepicker").datepicker("getDate"),c=u(a.find(".depart-time-hrs"),a.find(".depart-time-mins"),a.find(".depart-time-ampm")),d=a.find(".arrival-date").siblings(".container-datepicker").datepicker("getDate"),g=u(a.find(".arrival-time-hrs"),a.find(".arrival-time-mins"),a.find(".arrival-time-ampm"));if(!b)return m.showErrorTooltip(a.find(".depart-date"),
"Enter departure date",null,{}),null;if(!d)return m.showErrorTooltip(a.find(".arrival-date"),"Enter arrival date",null,{}),null;if(!c||!g)return null;b.setHours(c.hrs);b.setMinutes(c.mins);d.setHours(g.hrs);d.setMinutes(g.mins);return d<b?(m.showErrorTooltip(a.find(".arrival-time-ampm"),"Arrival Time Cannot be before departure time",null,{}),null):{departure:f(b),arrival:f(d)}}function f(a){return a.getFullYear()+"-"+n(a.getMonth()+1)+"-"+n(a.getDate())+"T"+n(a.getHours())+":"+n(a.getMinutes())+":"+
n(a.getSeconds())}function u(a,b,c){var d=a.val(),f=b.val(),c=c.val();if(!d)return m.showErrorTooltip(a,"Enter time",null,{}),null;if(!f)return m.showErrorTooltip(b,"Enter time",null,{}),null;d=parseInt(d);f=parseInt(f);"am"===c?12===d&&(d=0):12!==d&&(d+=12);return{hrs:d,mins:f}}function n(a){return 10>a?"0"+a:a}function k(){var a=$(this).parents(".time-grp"),b=a.find(".time-input-hrs"),c=a.find(".time-input-mins"),a=a.find("toggle-ampm").val(),d=parseInt(b.val());(!d||!$.isNumeric(d))&&b.val("");
10>d&&b.val("0"+d);(12<d||1>d&&"am"===a)&&b.val("12");b=parseInt(c.val());(!b||!$.isNumeric(b))&&c.val("");10>b&&c.val("0"+b);59<b&&c.val("59")}function h(c,f,h){function n(){var a=c.find('input[name="tripType"]:checked').val();z.removeClass("hidden large");C.removeClass("hidden large");"car"===f?"roundtrip"===a?(z.addClass("large"),z.attr("placeholder","Pick up & Drop off location"),C.addClass("hidden")):(z.attr("placeholder","Pick up location"),C.attr("placeholder","Drop off location")):(z.attr("placeholder",
"From"),C.attr("placeholder","To"));"roundtrip"===a&&"car"!==f?(c.find(".details .line").removeClass("hidden"),c.find(".return.datetime-grp").removeClass("hidden")):(c.find(".details .line").addClass("hidden"),c.find(".return.datetime-grp").addClass("hidden"))}var q=c.find(".depart-date"),u=c.find(".arrival-date"),v=q.siblings(".depart-time"),B=u.siblings(".arrival-time"),z=c.find(".from"),C=c.find(".to"),G=c.find(".from, .to"),M="icon-"+f,w={car:"car rental","other-travel":"other transportation"}[f]||
f,J=c.find(".reservation-detail"),F=J.find(".heading");"car"===f?(J.find(".time-grp").addClass("hidden"),J.find(".time-grp-car").removeClass("hidden"),J.find(".time-grp-car select").inspirockSelectmenu({appendTo:".reservation-detail"})):(J.find(".time-grp").removeClass("hidden"),J.find(".time-grp-car").addClass("hidden"));F.find(".icons").remove();F.prepend("<svg class='icons "+f+"'><use xlink:href='#"+M+"' /></svg>");F.find(".txt").text(("add"===h?"Add ":"Edit ")+w+" details");J.find(".round-trip").text("car"===
f?"Same dropoff":"Round trip");J.find(".oneway").text("car"===f?"Different dropoff":"One way");J.find(".travel-mode").toggleClass("hidden","other"!==f);$(".toggle-ampm").each(function(a,b){k.bind($(b))()});J.find(".toggle-ampm").off("click.toggle-ampm").on("click.toggle-ampm",function(){var a=$(this).data("toggle");$(this).data("toggle",$(this).val());$(this).val(a)});J.find(".time-input-hrs").off("change.time-input-hrs").on("change.time-input-hrs",k);J.find(".time-input-mins").off("change.time-input-mins").on("change.time-input-mins",
k);J.find(".toggle-ampm").off("change.toggle-ampm").on("change.toggle-ampm",k);n();c.find('input[name="tripType"]').off("change.tripType").on("change.tripType",function(){n();m.removeAllErrorToolTips()});q.each(function(){var a=new Date($(this).siblings(".container-datepicker").val()),b=$(this);b.siblings(".container-datepicker").inspirockDatepicker({minDate:"+1d",maxDate:"+3y",dateFormat:"dd-mm-yyyy",altFormat:"D m/d",altField:$(this),defaultDate:a,onSelect:function(){var a=$(this),b=$(this).parents(".datetime-grp").find(".arrival-date-copy.container-datepicker"),
a=a.datepicker("getDate");null!==a?b.datepicker("option","minDate",a):b.datepicker("option","minDate","+1d")},beforeShow:function(){j.isOpen()&&(b.parents(".calendar-input").append($("#ui-datepicker-div").addClass("add-reservation-datepicker")),$("#ui-datepicker-div").hide())},onClose:function(){$("#ui-datepicker-div").hide();$("body").append($("#ui-datepicker-div").removeClass("add-reservation-datepicker"))}});$(this).off("click").on("click",function(){var a=$(this).siblings(".container-datepicker");
a.datepicker(a.datepicker("widget").is(":visible")?"hide":"show")})});u.each(function(){var a=new Date($(this).siblings(".container-datepicker").val()),b=$(this);b.siblings(".container-datepicker").inspirockDatepicker({minDate:"+1d",maxDate:"+3y",dateFormat:"dd-mm-yyyy",altFormat:"D m/d",altField:$(this),defaultDate:a,beforeShow:function(){j.isOpen()&&(b.parents(".calendar-input").append($("#ui-datepicker-div").addClass("add-reservation-datepicker")),$("#ui-datepicker-div").hide())},onClose:function(){$("#ui-datepicker-div").hide();
$("body").append($("#ui-datepicker-div").removeClass("add-reservation-datepicker"))}});$(this).off("click").on("click",function(){var a=$(this).siblings(".container-datepicker");a.datepicker(a.datepicker("widget").is(":visible")?"hide":"show")})});v.inspirockSelectmenu();B.inspirockSelectmenu();v.off("change").on("change",function(){var a=$(this),b=$(this).parents(".datetime-grp").find(".arrival-time");if(a.val()){var a=parseInt(a.val()),c=parseInt(b.val());a>c&&b.val(a)}});"flight"===f?G.inspirockAutocomplete({url:window.contextPath+
"/airportAutocomplete",appendTo:G.parents(".ui-dialog"),data:{hideCity:!0}}):G.inspirockAutocomplete({url:window.contextPath+"/nightStayAutocomplete",customName:"true",appendTo:G.parents(".ui-dialog")});c.find(".save-reservation").off("click.save-reservation").on("click.save-reservation",function(){if(!$(this).hasClass("disabled")){m.removeAllErrorToolTips();var h=c.find(".details"),k=h.find(".from").data("inspirockAutocomplete").getSelectedItem(),n=h.find(".to").data("inspirockAutocomplete").getSelectedItem(),
q=c.find('input[name="tripType"]:checked').val(),r=J.data("reservationId");if(!k||!k.id&&!k.value)m.showErrorTooltip(h.find(".from"),"Enter a valid destination");else if(!h.find(".to").hasClass("hidden")&&(!n||!n.id&&!n.value))m.showErrorTooltip(h.find(".to"),"Enter a valid destination");else if(k.id&&k.id===n.id)m.showErrorTooltip(h.find(".to"),"Departure and arrival destinations must be different.");else{var t={mode:f,travelMode:h.find(".travel-mode").val(),onwardDate:"car"===f?i(h.find(".departure.datetime-grp")):
b(h.find(".departure.datetime-grp")),returnDate:"car"===f?i(h.find(".return.datetime-grp")):b(h.find(".return.datetime-grp")),onwardNotes:h.find(".departure.datetime-grp .notes").val(),returnNotes:h.find(".return.datetime-grp .notes").val(),tripType:q,reservationId:r};if(t.onwardDate&&("roundtrip"!==t.tripType||t.returnDate))if("car"===f&&"roundtrip"===t.tripType&&p.utc(t.onwardDate.departure)>=p.utc(t.onwardDate.arrival))m.showErrorTooltip(h.find(".departure.datetime-grp").find(".depart-date"),"Departure must be before arrival.");
else if("car"!==f&&"roundtrip"===t.tripType&&t.returnDate&&p.utc(t.onwardDate.arrival)>p.utc(t.returnDate.departure))m.showErrorTooltip(h.find(".return.datetime-grp").find(".depart-date"),"Return journey must be after onward journey.");else{if("flight"===f)t.fromCode=k.id,t.fromSchema=k.schema,t.toCode=n.id,t.toSchema=n.schema;else if(t.fromDestination={id:k.id,name:k.value},"car"!==f||"roundtrip"!==q)t.toDestination={id:n.id,name:n.value};$(this).addClass("disabled");g.makeAJAXcall({url:window.contextPath+
"/trip/"+$("#plan").data("planId")+"/"+(r?"update":"save")+"-reservation",data:t,type:"POST",success:function(){m.removeAllErrorToolTips();j.close();a.triggerEvent("add-reservation-modal",r?"reservation-edit":"reservation-add",{});d.trackEvent("reservation-dlg","save",f)}})}}}});G.each(function(){$(this).data("inspirockAutocomplete").setItem({id:$(this).data("id"),value:$(this).data("value"),schema:$(this).data("schema")})})}return{showAddReservationDialog:function(a){var b={};a&&a.addToHistory&&
(b={id:"addReservation",tabId:"transportation",url:m.getPlanUrl()+"/transportation/modal/add-reservation",data:{detailsUrl:m.getPlanUrl()+"/transportation/modal/add-reservation",backText:"",eventSource:"transportation",modal:"transportation",tab:"transportation"}});j.open({dialogClass:"full add-reservation",data:{history:b},ajaxParams:{url:"/trip/"+$("#plan").data("planId")+"/add-reservation",type:"GET"},onLoad:function(a){a.find(".tile").off("click.tile").on("click.tile",function(){var b=$(this).data("mode");
a.find(".from, .to, .depart-date, .arrival-date, .notes").val("");h(a,b,"add");a.find(".choose-transport-type").removeClass("active");a.find(".reservation-detail").addClass("active")});a.find(".back").click(function(){a.find(".choose-transport-type").addClass("active");a.find(".reservation-detail").removeClass("active");m.removeAllErrorToolTips()})}})},showEditReservationDialog:function(a){var b={},c=a.reservationId,d=c?"update":"add";a&&a.addToHistory&&(b={id:"addDestination",tabId:"transportation",
url:m.getPlanUrl()+"/transportation/modal/"+d+"-reservation-detail",data:{detailsUrl:m.getPlanUrl()+"/transportation/modal/"+d+"-reservation-detail",backText:"",eventSource:"transportation",modal:"transportation",tab:"transportation"}});j.open({dialogClass:"full add-reservation",data:{history:b},ajaxParams:{url:"/trip/"+$("#plan").data("planId")+"/"+d+"-reservation-detail",type:"GET",data:{reservationId:c}},onLoad:function(a){var b=a.find(".reservation-detail").data("mode");h(a,b,d)}})}}});
define("text%21templates/transportReservationDropDown.html",[],function(){return'<!DOCTYPE html>\n<\!--\n Copyright (c) 2012-2016, Inspirock Corporation.\n All rights reserved.\n--\>\n<ul class="reservation-dropdown-contents">\n    <li class="remove-reservation">Remove from my plan</li>\n    <li class="edit-reservation">Edit reservation details</li>\n</ul>'});
define("plan/transportation/reservation","modules/events modules/analytics modules/analyticsEventParams modules/ajax plan/transportation/addReservationModal text!templates/transportReservationDropDown.html jquery jqueryui".split(" "),function(a,g,d,p,m,j){function i(a){m.showAddReservationDialog(a);g.trackEvent(d.CAT_PLAN_TRANS,d.ACT_DLG_OPEN,"add-reservation")}function c(a){a.reservationId=$(this).data("reservationId");m.showEditReservationDialog(a);g.trackEvent(d.CAT_PLAN_TRANS,d.ACT_DLG_OPEN,"edit-reservation")}
function b(){var a=$(this);a.qtip({overwrite:!0,content:j,position:{my:"top center",at:"bottom left",container:u,adjust:{x:-40}},show:{event:"click",delay:0,ready:!0},hide:{event:"unfocus",fixed:!0},events:{hide:function(a,b){b.destroy()},show:function(b,d){d.elements.content.find("li").data("reservationId",a.data("reservationId"));d.elements.content.find("li.remove-reservation").off("click.remove-reservation").on("click.remove-reservation",function(){p.makeAJAXcall({url:window.contextPath+"/trip/"+
$("#plan").data("planId")+"/remove-reservation",data:{reservationId:$(this).data("reservationId")},type:"POST",success:function(){d.hide();a.parents(".reservation").remove();0===a.parents(".reservation-list").find(".reservation").length&&invalidate()}})});d.elements.content.find("li.edit-reservation").off("click.edit-reservation").on("click.edit-reservation",function(a){a.addToHistory=!0;c.bind(this)(a)})}},style:{classes:"reservation-tip qtip-light qtip-shadow",tip:{corner:!1}}})}var f={},u;f.initialize=
function(){u=$("#transportation");u.off("click.add-reservations").on("click.add-reservations",".add-reservation-btn",function(a){a.addToHistory=!0;i.bind(this)(a)});u.find(".view-reservations .reservation-drop-down").off("click.reservation-drop-down").on("click.reservation-drop-down",b);u.find(".view-reservations .hide-details").off("click.hide-details").on("click.hide-details",function(){$(this).siblings(".more-details").addClass("hidden");$(this).addClass("hidden");$(this).siblings(".show-details").removeClass("hidden")});
u.find(".view-reservations .show-details").off("click.show-details").on("click.show-details",function(){$(this).siblings(".more-details").removeClass("hidden");$(this).addClass("hidden");$(this).siblings(".hide-details").removeClass("hidden")});a.addObserver("show-add-reservation","transportation",i)};return f});
define("plan/transportation","modules/events modules/analytics modules/analyticsEventParams modules/ajax modules/utils plan/loading plan/transportation/flightTransportation plan/transportation/carTransportation plan/transportation/trainTransportation plan/transportation/reservation jquery jqueryui".split(" "),function(a,g,d,p,m,j,i,c,b,f){function u(a){var b=$(".page-content").find(".transportation-background");"FLIGHT"===a?(b.find(".flight-background").removeClass("hidden"),b.find(".flight-background").siblings().addClass("hidden")):
"CAR"===a?(b.find(".car-background").removeClass("hidden"),b.find(".car-background").siblings().addClass("hidden")):"TRAIN"===a?(b.find(".train-background").removeClass("hidden"),b.find(".train-background").siblings().addClass("hidden")):b.addClass("hidden")}function n(){$("#transportation").data("isDirty",!0);$("#transportation").is(":visible")&&q.refreshIfInvalid()}function k(){D.data("isDirty")}function h(){}function e(a){B=a.find(".booking-data."+z.toLowerCase());var b=a.find(".powered-by-module."+
z.toLowerCase()),c=a.find(".rentals-tiles."+z.toLowerCase());B.removeClass("hidden").siblings(".booking-data").addClass("hidden");b.removeClass("hidden").siblings(".powered-by-module").addClass("hidden");c.removeClass("hidden").siblings(".rentals-tiles").addClass("hidden");0<c.find(".transportation-options").length&&b.css("border-bottom","1px solid #dedede");a.find(".drivers-age-car").addClass("hidden");C[z][0].prepareBookingInfo(a)}function l(a){D.find(".transport-modes li."+a.toLowerCase()).addClass("selected").siblings("li").removeClass("selected");
g.trackEvent(d.CAT_PLAN_TRANS,d.ACT_SHOW_MODE,a.toLowerCase());m.removeAllErrorToolTips();z=a;e(D);u(z)}function t(a){D.off("isVisible").on("isVisible",k).off("isHidden").on("isHidden",h);D.is(":visible")&&k();C={TRAIN:[b,".booking-data.train"],CAR:[c,".booking-data.car"],FLIGHT:[i,".booking-data.flight"]};if(!a)for(var f in C)D.find(C[f][1]).length&&(C[f][0].initialize(D),C[f][0].isAvailable(a)&&(z=f));e(D);D.find("ul.transport-modes").off("click.transport-modes").on("click.transport-modes","li",
function(){var a=$(this).data("target");g.trackEvent(d.CAT_PLAN_TRANS,d.ACT_CLICK_MODE,a.toLowerCase());l(a)})}function r(a,b){D=v;t(b.sourceMode)}var q={},D,v,B,z="FLIGHT",C={};q.isDirty=function(){return D.data("isDirty")};q.refreshIfInvalid=function(b,c){D.data("isDirty")?(D.empty(),j.showLoading($("#planRecalculating"),$("#resultpageContent"),"Loading..."),p.makeAJAXcall({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/transportation",type:"GET",complete:function(){j.hideLoading($("#planRecalculating"),
$("#resultpageContent"))},success:function(a){D.html(a);D.data("isDirty",!1);q.initialize();z=c&&c.tab?c.tab:z;l(z);c&&((c.from||c.to)&&C[z][0].populateFields)&&C[z][0].populateFields(c);D.trigger("refreshed")}})):(z=c&&c.tab?c.tab:z,e(D),u(z),D.find(".transport-modes li."+z.toLowerCase()).addClass("selected").siblings("li").removeClass("selected"),c&&((c.from||c.to)&&C[z][0].populateFields)&&C[z][0].populateFields(c),D.is(":visible")&&a.triggerEvent("transport","show-help-tips",{tabName:"#transportation"}),
t(z))};q.initialize=function(){D=v=$("#transportation");a.addObserver("refresh-transportation","transportation",q.refreshIfInvalid);a.addObservers("reservation-add reservation-edit reservation-remove plan-update stay-add stay-remove stay-update travel-update".split(" "),"transportation",n);a.addObserver("initialize-transport-modal","transportation",function(a,b){D=b.transportationView;t()});a.addObserver("show-transport-modal","transportation",function(b,c){var d=c.searchData,e=$("#transportation").is(":visible")?
$("#transportation ul.transport-modes li.selected").data("target"):"FLIGHT";p.makeAJAXcall({type:"POST",url:"/trip/"+$("#plan").data("planId")+"/showTransportation",data:d,success:function(b){if(b){var c=$(b);c.dialog({resizable:!1,modal:!0,draggable:!1,width:"1189px",dialogClass:"dlg-show-transport mediumx",open:function(){$("body").off("click.dlg-show-transport").on("click.dlg-show-transport",".dlg-show-transport",function(a){$(a.target).hasClass("dlg-show-transport")&&c.dialog("close")});c.parents(".ui-dialog").find(".ui-dialog-titlebar").prependTo(".dlg-show-transport .ui-dialog-content");
m.setupDialogOverlay(c,!1);a.triggerEvent("transport","initialize-transport-modal",{transportationView:c.find(".show-transport")});$(".resultspage").addClass("scroll-hide");c.find(".booking-data").find(".start-destination").blur()},close:function(){m.removeAllErrorToolTips();z=e;a.triggerEvent("transport","reset-transport-modal",{transportationView:c.find(".show-transport"),sourceMode:d.mode});$(".resultspage").removeClass("scroll-hide");c.dialog("destroy").remove()}})}}})});a.addObserver("reset-transport-modal",
"transportation",r);i.registerEventHandlers();D.is(":visible")&&(t(),f.initialize(),a.triggerEvent("transport","show-help-tips",{tabName:"#transportation"}))};return q});
define("plan/tabs","modules/events modules/analytics modules/analyticsEventParams modules/ajax modules/dock modules/history modules/view plan/itinerary plan/overview plan/route modules/intentmedia moment jquery".split(" "),function(a,g,d,p,m,j,i,c,b,f,u,n){var k={},h,e=!1,l=function(b,c,f,k,l,B){a.triggerEvent("tabs","clean-help-tips",{});var z=$("#"+b);"overview"===b?($(".plan-heading").find(".plan-text").addClass("hidden"),$(".plan-heading").find(".plan-hero").removeClass("hidden"),$(".plan-heading").removeClass("hidden"),
$(".page-content").removeClass("plan-header-hidden"),$(".page-header").addClass("transparent"),$(".plan-header-wrap .back-to-overview").addClass("hidden"),$(".page-header #australiaFlashNotification").removeClass("moveUp")):($(".plan-heading").find(".plan-text").removeClass("hidden"),$(".plan-heading").find(".plan-hero").addClass("hidden"),$(".plan-heading").addClass("hidden"),$(".page-content").addClass("plan-header-hidden"),$(".page-header").removeClass("transparent"),$(".plan-header-wrap .back-to-overview").removeClass("hidden"),
$(".page-header #australiaFlashNotification").addClass("moveUp"));$("#planHeader").find("#action-alerts").qtip("hide");"transportation"!==b?$(".page-content").find(".transportation-background").addClass("hidden"):$(".page-content").find(".transportation-background").removeClass("hidden");f&&(f=z.data("url"),j.push(b,b,f,void 0),g.trackEvent(d.CAT_PLAN_NAV,d.ACT_TAB,b.toLowerCase()));k=k||b;g.setPageType($("#plan").data("isAnonymous")?"Anonymous In-Plan Page":"In-Plan Page");f=$("#analytics-metadata");
g.setEntityType(f.data("entityType"));g.setEntity(f.data("entity"));g.setPageTypeNew(f.data("pageTypeNew")+" : "+k);g.setProperty("page","/plan/"+k);g.trackPageView("/plan/"+k);a.triggerEvent("home","mmt_track_planpage",{channel:"inspirock funnel",page:"plan"+b});h.find("li").removeClass("active");h.find(".tab-"+b).addClass("active");"notifications"===b?$("#action-alerts").addClass("highlighted"):$("#action-alerts").removeClass("highlighted");k=z.siblings().filter(".active");z.siblings().removeClass("active").addClass("hidden");
z.addClass("active").removeClass("hidden");k.trigger("isHidden");z.trigger("isVisible");z={dockTopAt:$("#planHeader").offset().top-$("#pageWrapper").offset().top};m.changeDockAttr("tabdock",z);l||(k=$("#planHeader"),z=$(window).scrollTop(),k=k.offset().top,z>k&&window.scrollTo(0,k+1));"overview"===b?a.triggerEvent("view","refresh-overview",{}):"route"===b?a.triggerEvent("view","refresh-route",{}):"itinerary"===b?(b=B||{},c&&(b.subnav="daybyday"),l||a.triggerEvent("view","refresh-itinerary",b)):"hotels"===
b?a.triggerEvent("view","refresh-hotels",{}):"explore"===b?(b={},c&&(b.showLanding=!0),a.triggerEvent("view","refresh-explore",b)):"notifications"===b?a.triggerEvent("view","refresh-notifications",{}):"transportation"===b&&a.triggerEvent("view","refresh-transportation",B);try{$(".qtip-default.error").qtip("destroy")}catch(C){}p.keepSessionAlive();i.scrollAndUpdate();c&&!e&&(z=$(".route-row.stay-row").eq(0),z.length&&(c=z.data("name"),l=z.data("stateCode"),b=z.data("countryCode"),B=n.utc(z.data("checkInDate")),
z=n.utc(z.data("checkOutDate")),k=$("#plan").data("numAdults")+$("#plan").data("numTeens")+$("#plan").data("numKids"),B.isAfter(n.utc())&&(u.triggerOpenExitUnit(c,l,b,B.format("YYYYMMDD"),z.format("YYYYMMDD"),k),e=!0)))};k.gotoOverviewTab=function(a,b){$("#overview").is(":visible")||l("overview",b,a,void 0)};k.gotoRouteTab=function(a,c){$("#overview").is(":visible")?f.expand():b.isDirty()?($("#overview").one("refreshed",function(){f.expand()}),l("overview",c,a,void 0)):(l("overview",c,a,void 0),f.expand())};
k.gotoExploreTab=function(a,b){$("#explore").is(":visible")||l("explore",b,a,void 0)};k.gotoItineraryTab=function(b,d,e){!$("#itinerary").is(":visible")||c.isDirty()?l("itinerary",d,b,void 0,void 0,e):a.triggerEvent("view","refresh-itinerary",e)};k.gotoHotelsTab=function(a,b){$("#hotels").is(":visible")||l("hotels",b,a,void 0)};k.gotoNotificationsTab=function(a){$("#notifications").is(":visible")||l("notifications",!1,a,void 0)};k.gotoTransportationTab=function(a,b){$("#transportation").is(":visible")||
l("transportation",!1,a,void 0,void 0,b)};k.initialize=function(){var b=$("#resultpageContent .tab-content:visible"),c=b.attr("id"),d=$("#planHeader .plan-header-wrap");h=$("#plan-nav").find(".tabs");m.dockView("tabdock",d,{dockTopAt:$("#pageHeader").height()});var e,f,g,i={};"itinerary"===c?(e=$("#itinerary").find(".itinerary-subnav-pane").find(".subnavlink").filter(".active"),d=e.attr("id"),f=e.data("target"),e=e.data("url"),g={},i=$(".itinerary-left-timeline-pane").find(".day-boxes").find(".active"),
g.dayNumber=i.data("dayNumber"),g.stayId=i.parents(".stay").data("stayId"),g.date=i.data("date"),-1===location.pathname.indexOf("https://www.inspirock.com/modal/")&&j.replace(c,c,e,{targetId:f,subnavLinkId:d,historyData:g})):"explore"===c?(e=$("#explore").find(".explore-subnav-pane").find(".subnavlink").filter(".active"),d=e.attr("id"),f=e.data("target"),g=c,e=e.data("url"),i.targetId=f,i.subnavLinkId=d,"destinationslink"===d&&$("#"+f).find(".explore-destination-details-pane").is(":visible")?(g="exploreDestinationDetails",
e=$("#"+f).find(".explore-destination-details-pane").find(".destination-details").data("url"),i.detailsUrl=e):"attractionslink"===d&&$("#"+f).find(".explore-attraction-details-pane").is(":visible")&&(g="exploreAttractionDetails",e=$("#"+f).find(".explore-attraction-details-pane").find(".attraction-details").data("url"),i.detailsUrl=e),-1===location.pathname.indexOf("https://www.inspirock.com/modal/")&&j.replace(g,c,e,i)):-1===location.pathname.indexOf("https://www.inspirock.com/modal/")&&j.replace(c,c,b.data("url"),void 0);$("#plan-nav ul.tabs > li,.back-to-overview").click(function(b,
c,d){var c=b.hasOwnProperty("originalEvent")||c?!0:!1,b=b.hasOwnProperty("originalEvent")?!0:!1,e=$(this).data("target");a.triggerEvent("tabs","page-change",{tabId:e,userClick:c,addToHistory:b,forcePage:d,action:"switch-tab"})});b.trigger("isVisible");l(c,!1,!1,void 0,!0);a.addObserver("post-route-change","tabs",function(a,b){"switch-tab"===b.action&&l(b.tabId,b.userClick,b.addToHistory,b.forcePage)});a.addObserver("show-tab-route","tabs",function(a,b){k.gotoRouteTab(b.addToHistory,b.tabClick)});
a.addObserver("show-tab-explore","tabs",function(a,b){k.gotoExploreTab(b.addToHistory,b.tabClick)});a.addObserver("show-tab-itinerary","tabs",function(a,b){k.gotoItineraryTab(b.addToHistory,b.tabClick,b.tabData)});a.addObserver("show-tab-hotels","tabs",function(a,b){k.gotoHotelsTab(b.addToHistory,b.tabClick)});a.addObserver("show-tab-overview","tabs",function(a,b){k.gotoOverviewTab(b.addToHistory,b.tabClick)});a.addObserver("show-tab-notifications","tabs",function(a,b){k.gotoNotificationsTab(b.addToHistory)});
a.addObserver("show-tab-transportation","tabs",function(a,b){k.gotoTransportationTab(b.addToHistory,b)});a.addObserver("show-batch-save-bar","tabs",function(){});a.addObserver("hide-batch-save-bar","tabs",function(){m.enableDock("tabdock")})};return k});define("text%21templates/shareEmail.html",[],function(){return'<div class="share-email">\n    <div class="plan-info">\n        <div class="share-url-label">\n            <svg><use xlink:href="#icon-ic-link"></use></svg>\n            Or share this plan via a \n            <span class="plan-url" data-clipboard-text="">public share link </span>\n            <span class="tip"><span class="fa fa-question"></span></span> \n            <span class="copy-text hidden">Link copied <svg><use xlink:href="#icon-tick"></use></svg></span>\n        </div><br />\n    </div>\n    \n    <div class="user-info">\n    </div>\n</div>'});
define("text%21templates/shareCollaborator.html",[],function(){return'<div class="collaborator">\n<input  type="text" class="shaded email" placeholder="Your friend\'s email *">\n</div>'});define("text%21templates/planShare.html",[],function(){return'<div>\n    <div class="title-icon"><span class="fa"></span></div>\n    <h2>Share your plan</h2>\n    <div class="tagline"></div>\n    <div class="share" data-share-url="${targetedReadOnlyLink}" data-share-title="${planTitle}">\n        <div id="getlink-view">\n            <div class="copylink-text">Anybody with access to the link can see the plan.</div>\n            <button class="cta-button small share-button">\n                <i class="fa"></i>Share\n            </button>\n        </div>\n    </div>\n</div>'});
define("modules/clipboard",["clipboard"],function(a){return{copyToClipboard:function(g,d,p,m){g=void 0!==m?new a(g,{container:m.container}):new a(g);g.on("success",function(a){d&&d(a)});g.on("error",function(a){p&&p(a)});return g}}});
define("plan/planHeader","modules/analytics modules/ajax modules/events modules/utils plan/collaboration text!templates/shareEmail.html text!templates/shareCollaborator.html text!templates/planShare.html moment modules/clipboard jquery jqueryui jQueryExtensions/inspirockSelectmenu".split(" "),function(a,g,d,p,m,j,i,c,b,f){function u(){d.triggerEvent("plan-header","show-tab-overview",{addToHistory:!0})}function n(a){var b=a.find("#startTime").val(),c=a.find("#endTime").val(),d=a.find("input:radio[name=pace]:checked").val(),
e=a.find("input:radio[name=distanceUnits]:checked").val(),f=a.find("#publicPlan").is(":checked"),g=a.find("#startTime"),h=a.find("#endTime"),i=a.find("input:radio[name=pace]"),j=a.find("input:radio[name=distanceUnits]"),k=a.find("#publicPlan"),l=function(){var l;if(!(l=b!==g.val()))if(!(l=c!==h.val()))if(l=i.filter(":checked"),!(l=d!==l.val()))l=j.filter(":checked"),l=e!==l.val()||k.length&&f!==k.is(":checked");l?a.data("hasChanged",!0):a.data("hasChanged",!1)};g.off("selectmenuchange.check").on("selectmenuchange.check",
l);h.off("selectmenuchange.check").on("selectmenuchange.check",l);i.off("change.check").on("change.check",l);j.off("change.check").on("change.check",l);k.off("change.check").on("change.check",l)}function k(){a.trackEvent("share-dialog","download-calendar")}function h(b,c){if("qtip-share-btn"===c.action){var e=c.$shareBtn;if(e.hasClass("active"))e.qtip("api").hide();else{var h=c.editClass,i=r.find(".plan-header-center").outerWidth(!1)-(e.offset().left-r.find(".plan-header-center").offset().left)-e.outerWidth(!0)/
2;e.qtip({overwrite:!0,content:{text:function(b,c){$.ajax({url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/download",cache:!1}).then(function(b){c.set("content.text",b);f.copyToClipboard(".share-dropdown .copy-link",function(){e.qtip("api").hide();p.showFlash("Link Copied.",!0,3E3);a.trackEvent("share-dialog","copy-link")},function(){c.elements.content.find(".copy-link").off("click").on("click",function(){e.qtip("api").hide();var a=$(this).data("clipboard-text");p.modal({title:"Copy Link",
width:"500px",dialogClass:"dlg-collab copy-link",open:function(b){$(b.target).html('<input type="text" class="shaded" value="'+a+'" />')}})})});c.elements.content.find(".share-options .outer-svg").each(function(){$(this).click(function(){e.qtip("api").hide();q.apply(this)})})},function(){});return'<div style="width:530px;"><img class="progress-indicator" src="'+window.ajaxLoaderPath+'" alt="loading"></div>'}},position:{container:r.find(".plan-nav"),my:"top right",at:"bottom center",adjust:{y:-12,
x:13,scroll:!1},effect:!1},show:{event:!1,ready:!0},hide:{event:"unfocus"},events:{show:function(b,c){e.addClass("active");a.trackEvent("plan-header","share-dialog");0===c.elements.content.siblings(".qtip-fillerDiv").length&&$('<div class="qtip-fillerDiv"></div>').insertBefore(c.elements.content);c.elements.content.off("click.link").on("click.link",".read-only-link",function(){$(this).select()});c.elements.content.off("click.social").on("click.social",".social-media-icons",function(){e.qtip("api").hide();
q.apply(this)});c.elements.content.off("click.cotrav").on("click.cotrav",".see-all.co-travelers",function(){e.qtip("api").hide();m.showManageCotravelerDialog()});c.elements.content.off("click.calendar").on("click.calendar",".calendar-container",k).off("click.add-cotraveler").on("click.add-cotraveler",".add-cotraveler",function(){e.qtip("api").hide();var a=$(this).parents(".cotravelers-pane").find(".num-people"),a=a.is(":visible")?a.val():1;m.showAddCotravelerDialog(10>=a?a:10)});c.elements.content.off("click.close-button").on("click.close-button",
".close-button",function(){c.hide()})},hide:function(){e.removeClass("active")}},style:{classes:"share-dropdown qtip-light qtip-shadow "+h,tip:{corner:!0,width:20,height:10,offset:i-10,mimic:"top center"}}})}}else if("qtip-settings-btn"===c.action){var j=c.$settingsBtn;j.hasClass("active")?j.qtip("api").hide():(h=r.find(".plan-header-center").outerWidth(!1)-(j.offset().left-r.find(".plan-header-center").offset().left)-j.outerWidth(!0)/2,j.qtip({overwrite:!0,content:{text:function(a,b){$.ajax({url:window.contextPath+
"/trip/"+$("#plan").data("planId")+"/settings",cache:!1}).then(function(a){b.set("content.text",a);var a=b.elements.content,c=a.find("#startTime"),d=a.find("#endTime");c.inspirockSelectmenu({appendTo:a,classes:{"ui-selectmenu-menu":"settings-time"}});d.inspirockSelectmenu({appendTo:a,classes:{"ui-selectmenu-menu":"settings-time"}});c.linkToEndTimeSelect(d);n(b.elements.content);b.elements.content.data("hasChanged",!1)},function(){});return'<img class="progress-indicator" src="'+window.ajaxLoaderPath+
'" alt="loading">'}},position:{container:r.find(".plan-nav"),my:"top right",at:"bottom center",adjust:{y:-12,x:0,scroll:!1},effect:!1},show:{event:!1,ready:!0},hide:{event:!1},events:{show:function(b,c){j.addClass("active");a.trackEvent("plan-header","settings-dialog");0===c.elements.content.siblings(".qtip-fillerDiv").length&&$('<div class="qtip-fillerDiv"></div>').insertBefore(c.elements.content);n(c.elements.content);c.elements.content.data("hasChanged",!1);c.elements.content.off("click.close-button").on("click.close-button",
".close-button",function(){c.hide()});$("#pageWrapper").off("click.settings-tip").on("click.settings-tip",function(a){var a=$(a.target),b=a.attr("class");b&&(-1!==b.indexOf("selectmenu")||-1!==b.indexOf("ui-menu-item"))||a.parents(".qtip").length||($("#pageWrapper").off("click.settings-tip"),c.hide())})},hide:function(b,c){if(c.elements.content.data("hasChanged")){var e={dayStartTime:parseInt(c.elements.content.find("#startTime").val(),10),dayEndTime:parseInt(c.elements.content.find("#endTime").val(),
10),pace:c.elements.content.find("input:radio[name=pace]:checked").val(),distanceUnits:c.elements.content.find("input:radio[name=distanceUnits]:checked").val(),publicPlan:c.elements.content.find("#publicPlan").is(":checked")};if(e.dayStartTime>=e.dayEndTime)return;var f=function(b,c,h,i){e.forceMerge=b;e.userDIY=c;h&&(e.replanStayIds=h);i&&(e.adjustStayIds=i);g.makeAJAXcall({type:"POST",url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/settings",data:e,synchronize:!0,success:function(b,
e,g){g.getResponseHeader("Modified-Visits")?($("#pageWrapper").append($(b)),d.triggerEvent("planUtils","show-removed-visits-dlg",{cb:f})):a.trackEvent("settings-dialog","save-plan-settings",void 0,function(){var a=p.planTabUrl().split("https://www.inspirock.com/"),b;1<a.length&&"itinerary"===a[a.length-2]&&("calendar"===a[a.length-1]?b="calendar":"maps"===a[a.length-1]&&(b="maps"));r.find("#action-settings").qtip("toggle",!1);d.triggerEvent("plan-header","plan-update",{subnav:b});c&&d.triggerEvent("explore","show-tab-itinerary",
{addToHistory:!1,tabData:{subnav:"calendar"}})})}})};f(!1,!1)}j.removeClass("active")}},style:{classes:"settings-dropdown qtip-light qtip-shadow",tip:{corner:!0,width:10,height:10,offset:h-10}}}))}else if("qtip-print-btn"===c.action){var l=c.$printBtn;l.hasClass("active")?l.qtip("api").hide():(h=$(l).data("link"),i=r.find(".plan-header-center").outerWidth(!1)-(l.offset().left-r.find(".plan-header-center").offset().left)-l.outerWidth(!0)/2,l.qtip({overwrite:!0,content:{text:'<div class="print-options clearfix"><div class="close-button-container"><div class="close-button"></div></div><div class="title">Print plan</div><div class="clearfix"><div class="content-div"><div><div class="option"><input type="radio" class="flat" id="printALL" name="print" value="all" checked /><label for="printALL">Print with maps & images</label></div><div class="option"><input type="radio" class="flat" id="printText" name="print" value="text" /><label for="printText">Print text only</label></div><div class="clear"></div></div><a href="" target="_blank" rel="noreferrer nofollow" id="submitLink"><button id="submit-button" class="cta-button large" data-link="'+
h+'">Print</button></a></div></div></div>'},position:{container:r.find(".plan-nav"),my:"top right",at:"bottom center",adjust:{y:-12,x:13,scroll:!1},effect:!1},show:{event:!1,ready:!0},hide:{event:"unfocus"},events:{show:function(b,c){localStorage&&localStorage.getItem("printPreference")&&$("#"+localStorage.getItem("printPreference")).prop("checked",!0);l.addClass("active");a.trackEvent("plan-header","print-dialog");0===c.elements.content.siblings(".qtip-fillerDiv").length&&$('<div class="qtip-fillerDiv"></div>').insertBefore(c.elements.content);
c.elements.content.off("change.printPreference").on("change.printPreference","input[type=radio][name=print]",function(){localStorage&&localStorage.setItem("printPreference",$(this).attr("id"))});c.elements.content.off("click.print_button").on("click.print_button",".print-options .cta-button",function(){var b=$(this).data("link"),d;d=$(".print-options").find("input[name=print]").filter(":checked");d=0<d.length?d.val():"";a.trackEvent("share-dialog","print");a.trackEvent("print-plan","print-plan");
window.uetq=window.uetq||[];window.uetq.push({ec:"Goal 4",ev:"0.10"});b=window.contextPath+b+"?type="+d;$("#submitLink").attr("href",b);b=$("#action-share");d=$("#plan").data("destinationNamesAbridged");b.qtip({content:{text:$("<div>Tell your friends you're going to "+d+"</div>"),button:!0},overwrite:!0,show:{ready:!0},hide:{event:"unfocus",fixed:!0},position:{my:"bottom center",at:"top center",viewport:$(window),adjust:{y:14,method:"flip"}},events:{show:function(a,b){b.elements.button.removeAttr("title");
0===b.elements.content.siblings(".qtip-fillerDiv").length&&$('<div class="qtip-fillerDiv"></div>').insertBefore(b.elements.content)},hide:function(a,b){b.destroy(!0)}},style:{classes:"qtip-light qtip-shadow social-tip",width:264,tip:{corner:!0,width:20,height:10,mimic:"center bottom",offset:70}}});c.hide()});c.elements.content.off("click.close-button").on("click.close-button",".close-button",function(){c.hide()})},hide:function(){l.removeClass("active")}},style:{classes:"print-dropdown qtip-light qtip-shadow",
tip:{corner:!0,width:20,height:10,offset:i-10,mimic:"top center"}}}))}}function e(){var a=r.find("#action-share");a.off("click.share-btn").on("click.share-btn",function(){d.triggerEvent("alerts","page-change",{action:"qtip-share-btn",$shareBtn:a,editClass:a.data("editMode")?"editMode":"notEditMode"})})}function l(){r.find("#action-share").data("qtip")&&(r.find("#action-share").data("qtip").destroy(),e())}var t={},r;t.showShareDialog=function(b,d){var e;if("email"===b)var h=p.modal({title:"<span class='bold'>Email this plan</span>",
message:j,dialogClass:"dlg-share-email bigx",width:"660px",buttons:{Send:function(){var b=!1,c=h.find(".collaborator"),d=[],e=h.find(".yourName");0===e.val().trim().length?(p.showErrorTooltip(e,"You must enter your name"),b=!0):p.hideErrorTooltip(e);var f=h.find(".yourEmail");""!==f.val().trim()&&!p.validateEmail(f.val().trim())?(p.showErrorTooltip(f,"Email address is invalid"),b=!0):p.hideErrorTooltip(f);for(f=0;f<c.length;f++){var i=$(c[f]).find(".email");p.validateEmailField(i)||(b=!0);d.push({email:i.val()})}b||
g.makeAJAXcall({type:"POST",url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/share",data:{userInfo:JSON.stringify(d),fromName:e.val()},success:function(){h.close();a.trackEvent("share-dialog","share","email");p.showOkDialog("Email sent","","OK")}})}},open:function(a){var b=$(a.target);b.find(".user-info").append('<div class="self-info clearfix">');b.find(".user-info .self-info").append('<div class="title">Your Information</div>');b.find(".user-info .self-info").append('<input  type="text" class="shaded yourName" placeholder="Your first name *">');
b.find(".user-info .self-info").append('<input  type="text" class="shaded yourEmail" placeholder="Your email">');b.find(".user-info").append("</div>");b.find(".user-info").append('<div class="friends-info">');b.find(".user-info .friends-info").append('<div class="title">Your Friends Email</div>');b.find(".user-info .friends-info").append(i);b.find(".user-info").append("</div>");b.on("scroll",function(){b.find(".error-qtip").each(function(){$(this).qtip("reposition")})});void 0!==d&&b.find(".user-info .yourName").val(d);
a=p.getAbsolutePlanUrl()+"?utm_source=plan-share-link&utm_medium=link&utm_content=shareplanlink&utm_campaign=plan-share-link";b.append($("<a>").append($("<i>").addClass("fa fa-plus")).append("Add friend").addClass("add-more text-link"));$(".dlg-share-email .add-more").off("click").on("click",function(){b.find(".user-info .friends-info").append(i);b.dialog({position:{my:"center",at:"center",of:window}});b.find(".error-qtip").each(function(){$(this).qtip("reposition")})});$(".dlg-share-email").find(".plan-url").attr("data-clipboard-text",
a);e=f.copyToClipboard(".plan-url",function(){$(".dlg-share-email").find(".copy-text").removeClass("hidden")},function(){},{container:document.getElementsByClassName("dlg-share-email")[0]})},create:function(){$(".dlg-request-access-sent").append('<div class="footer"><a href="javascript:void(0);" class="close">No thanks, I want to keep browsing this plan ></a></div>');$(".dlg-share-email").find(".plan-info").appendTo(".dlg-share-email");var a=$(".dlg-share-email .plan-info .tip");a.qtip({overwrite:!0,
content:"Anyone who you share the link with can see it",position:{my:"left center",at:"right center",container:a.parents(".share-url-label"),effect:!1},show:{event:"mouseenter",delay:0},hide:{event:"mouseleave",fixed:!0,delay:100},events:{show:function(b,c){a.addClass("active");0===c.elements.content.siblings(".qtip-fillerDiv").length&&$('<div class="qtip-fillerDiv"></div>').insertBefore(c.elements.content)},hide:function(){}},style:{classes:"plan-share-helpTip clearfix qtip-light qtip-shadow",tip:{corner:!0,
width:20,height:10,offset:12}}})},close:function(){$(".qtip.error").each(function(){e.destroy();$(this).data("qtip").destroy()})}});else{var k=$(c);k.find(".title-icon .fa").addClass("fa-"+b);k.find(".share-button .fa").addClass("fa-"+b);k.find(".share-button").addClass(b);k.dialog({resizable:!1,modal:!0,draggable:!1,width:"560px",dialogClass:"dlg-share-new mediumx",open:function(){p.setupDialogOverlay(k,!1);var c=k.find(".share").find(".share-button"),d=$("#plan"),e=p.getAbsolutePlanUrl()+"?utm_source=plan-share-link&utm_medium="+
b+"&utm_content=shareplanlink&utm_campaign=plan-share-link",f=window.encodeURIComponent(e),h=window.encodeURIComponent($("meta[property='og:image']").attr("content")),i=window.encodeURIComponent($("<div>").html(d.data("planName")).text());a.trackEvent("plan-header","share-dialog",b);"facebook"===b&&g.makeAJAXcall({type:"POST",url:"https://graph.facebook.com",suppressErrorDialog:!0,data:{id:e,scrape:!0}});c.click(function(){a.trackEvent("share-dialog","share",b);var c=window.screen.height/2-218,d=
window.screen.width/2-313;"facebook"===b?window.open("http://www.facebook.com/sharer.php?u="+f,"sharer","toolbar=0,status=0,width=626,height=256,resizable=1,top="+c+",left="+d):"twitter"===b?window.open("http://twitter.com/share?url="+f,"sharer","toolbar=0,status=0,width=626,height=256,resizable=1,top="+c+",left="+d):"google-plus"===b?window.open("http://plus.google.com/share?url="+f,"sharer","toolbar=0,status=0,width=626,height=500,resizable=1,top="+c+",left="+d):"pinterest"===b&&window.open("http://pinterest.com/pin/create/button/?url="+
f+"&media="+h+"&description="+i,"sharer","toolbar=0,status=0,width=626,height=256,resizable=1,top="+c+",left="+d);k.dialog("close");g.makeAJAXcall({type:"POST",url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/trackShare",suppressErrorDialog:!0,data:{mode:b}});return!1})},close:function(){k.dialog("destroy").remove()}})}};var q=function(){var a=$(this),b=a.data("target"),a=a.data("yourName");t.showShareDialog(b,a)};t.initialize=function(){$("#plan");r=$("#planHeader");$("#resultpageContent");
r.find("#viewMode").off("click.close").on("click.close",".close",function(){p.hideFlash()});d.addObservers(["collaborator-add","collaborator-remove"],"plan-header",l);d.addObserver("post-route-change","alerts",h);var a=r.find("#action-settings");a.off("click").on("click",function(){d.triggerEvent("alerts","page-change",{action:"qtip-settings-btn",$settingsBtn:a})});e();var b=r.find("#action-print");b.off("click.print-btn").on("click.print-btn",function(){d.triggerEvent("alerts","page-change",{action:"qtip-print-btn",
$printBtn:b})});r.off("click.titleGotoOverview").on("click.titleGotoOverview",".non-overview-header .plan-title > *",u).off("click.share").on("click.share",".action.share",q)};return t});
define("plan/customize",["modules/analytics","modules/analyticsEventParams","modules/events","modules/utils","jquery"],function(a,g,d,p){var m={},j,i=!1,c=function(b,c){var d={action:b};0===b.indexOf("stay-")?d.objectType="destination":0===b.indexOf("visit-")?d.objectType="attraction":0===b.indexOf("reserved-")?d.objectType="reserved":0===b.indexOf("hop-")?d.objectType="hop":0===b.indexOf("plan-")&&(d.objectType="plan");$.extend(d,c);i||(i=!0,a.trackNonInteractionEvent(g.CAT_CUST_PLAN,g.ACT_CUST_PLAN));
d=(d=window.localStorage.getItem("customizationCount"))?parseInt(d,10):0;d+=1;window.localStorage.setItem("customizationCount",d);if(5===d&&j.data("loginPrompt")&&!j.data("registrationRequired")&&!window.registeredUserLoggedIn){var m=c.signupCancelCallback,k=$("<div><div class='title'>Want to Save your Plan?</div><div class='title2'>Sign up.</div><div class='content'>Looks like you're off to a good start!<br/><br/>Sign up now to ensure your plan is saved and accessible on all your devices.</div></div>").dialog({resizable:!1,
modal:!0,draggable:!1,width:"300px",dialogClass:"dlg-signup-save mediumx",buttons:{Cancel:function(){k.dialog("close")},"Sign Up":function(){p.login("registration")}},open:function(){p.setupDialogOverlay($(this),!1)},close:function(){k.dialog("destroy").remove();m&&m()}});c.signupDisplayed=!0}};m.initialize=function(){j=$("#plan");d.addObservers("plan-update stay-add stay-remove stay-update travel-update visit-add visit-remove visit-update reserved-add reserved-remove reserved-update hop-add hop-remove hop-update".split(" "),
"customize",c)};return m});define("text%21templates/notification.html",[],function(){return'<div class="notification">\n    <div class="sheet notification-icon"></div>\n    <div class="content">\n        <div class="timestamp"></div>\n        <div class="title"></div>\n        <span class="action"></span>\n    </div>\n</div>'});
define("plan/notifications","modules/events modules/ajax plan/collaboration modules/analytics plan/loading moment modules/utils plan/planUtils text!templates/notification.html".split(" "),function(a,g,d,p,m,j,i,c,b){function f(a,b){return a.extra&&a.extra.hasOwnProperty(b)?a.extra[b]:""}function u(a,b){if(a.extra)for(var c=0;c<b.length;c++){var d=a.extra[b[c]];if(d)return d}return""}function n(a){return w.hasOwnProperty(a)?w[a]:""}function k(a){if(f(a,"causedByUser")===window.userId)return"you";a=
f(a,"causedByUserName");return null===a?"you":a}function h(a){var b=f(a,"causedByItem");return"PLAN"===f(a,"causedByItemType")?"route"===b?"the plan route":"dates"===b?"the plan dates":"the plan":b}function e(a){var b=f(a,"property");return"PLAN"===a.itemType?"route"===b?"the plan route":"dates"===b?"the plan dates":"the plan":""}function l(a){var b=f(a,"commentParentId");return a.itemId===b?"question":"comment"}function t(b,d,e){var f=$("<div><h2>"+b+'</h2><div class="contents">'+d+"</div>");f.dialog({resizable:!1,
modal:!0,draggable:!1,width:"560px",dialogClass:"dlg-helper mediumx",open:function(){i.setupDialogOverlay(f,!1);f.off("click.gotodestination").on("click.gotodestination",".gotodestination",function(){p.trackEvent(e+".helpdialog","gotodestination");a.triggerEvent("notifications","show-tab-route",{addToHistory:!0});f.dialog("close")});f.off("click.editdates").on("click.editdates",".editdates",function(){p.trackEvent(e+".helpdialog","editdates");a.triggerEvent("notifications","show-tab-route",{addToHistory:!0});
c.showEditDatesDialog("alerts");f.dialog("close")});f.off("click.gotocalendar").on("click.gotocalendar",".gotocalendar",function(){p.trackEvent(e+".helpdialog","gotocalendar");var b=parseInt($(this).data("stayId"),10),c=$(this).data("date");a.triggerEvent("notifications","show-tab-itinerary",{addToHistory:!0,tabData:{subnav:"calendar",stayId:b,date:c}});f.dialog("close")});f.off("click.recalculate").on("click.recalculate",".recalculate",function(){p.trackEvent(e+".helpdialog","recalculate");var b=
parseInt($(this).data("stayId"),10),d=$(this).data("destinationName"),g=$(this).data("date"),h=$(this).data("hasOverflow");c.recalcStay(b,function(){a.triggerEvent("notifications","stay-update",{uiSource:"notifications.recalculate",suppressRefresh:!0});p.trackEvent("notifications","recalculate",d.toLowerCase());a.triggerEvent("notifications","mmt_track_link",{linkName:"Recalculate"});a.triggerEvent("notifications","show-tab-itinerary",{addToHistory:!0,tabData:{subnav:"calendar",stayId:b,date:g}})},
void 0,void 0,h,d);f.dialog("close")})},close:function(){$(this).dialog("destroy").remove()}})}function r(){F.find("#action-alerts").qtip("hide")}function q(b){r();var c=b.data.notification;$("#itinerary-item-"+c.itemId).length?(a.triggerEvent(b.data.source,"show-tab-itinerary",{addToHistory:!0}),a.triggerEvent(b.data.source,"scroll-to-item",{itemId:c.itemId})):(b=u(c,["attractionName","title"]),i.showErrorModal(b+" was deleted/rescheduled from this plan.",{OK:function(){$(this).dialog("close")}}))}
function D(b){r();var c=b.data.notification;$("#overview-stay-"+c.itemId).length?a.triggerEvent(b.data.source,"show-tab-route",{addToHistory:!0}):(b=f(c,"destinationName"),i.showErrorModal(b+" was deleted/rescheduled from this plan.",{OK:function(){$(this).dialog("close")}}))}function v(b){r();a.triggerEvent(b.data.source,"show-tab-overview",{addToHistory:!0})}function B(b){r();var c=b.data.notification;if($("#comments-list-"+c.extra.commentId).length)if("STAY"===c.itemType||"PLAN"===c.itemType)a.triggerEvent(b.data.source,
"show-tab-overview",{addToHistory:!0}),a.triggerEvent(b.data.source,"scroll-to-comment",{commentId:c.extra.commentId});else{if("VISIT"===c.itemType||"RESERVED"===c.itemType)a.triggerEvent(b.data.source,"show-tab-itinerary",{addToHistory:!0}),a.triggerEvent(b.data.source,"scroll-to-comment",{commentId:c.extra.commentId})}else $("#comments-list-"+c.itemId).length?i.showErrorModal("The comment was deleted from this plan.",{OK:function(){$(this).dialog("close")}}):(b=f(c,"destinationName"),i.showErrorModal(b+
" was deleted/rescheduled from this plan.",{OK:function(){$(this).dialog("close")}}))}function z(){y.find(".progress").removeClass("hidden");$("#notifications-list").addClass("hidden");y.find(".friends,.cotravelers").addClass("hidden");g.makeAJAXcall({type:"GET",url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/userNotifications",success:function(a){var c=a.notifications,d=a.alerts,c=c.filter(function(a){return!("COLLABORATOR"===a.itemType&&"friend"===f(a,"collaboratorRole").toLowerCase())});
$("#notifications-list").empty();if(!c.length&&!d.length)c=$(b),c.find(".title").html("You have no plan notifications."),c.find(".notification-icon").addClass("info"),$("#notifications-list").append(c);else{d=d?d.concat(c):c;d.sort(function(a,b){return b.timestamp-a.timestamp});for(var e=0;e<d.length;e++)c=G.generateNotificationDisplay(d[e],"notifications"),$("#notifications-list").append(c)}c=a.friends;a=a.cotravelers;e=y.find(".collaborators-right");d=e.find(".friends");e=e.find(".cotravelers");
d.removeClass("hidden").find(".count").text(c);d.find(".type").text(1===c?"friend":"friends");e.removeClass("hidden").find(".count").text(a);e.find(".type").text(1===a?"co-traveler":"co-travelers");y.find(".progress").addClass("hidden");$("#notifications-list").removeClass("hidden");y.find(".friends,.cotravelers").removeClass("hidden")}})}function C(){d.showManageCotravelerDialog();r()}var G={},M={VISIT:{ADD:["update","<b>%user%</b> added <b>Day %day%: %attr%</b>","See the change","gotoItinerary"],
REMOVE:["update","<b>%user%</b> removed <b>Day %day%: %attr%</b>","",""],UPDATE:["update","<b>%user%</b> udpated <b>Day %day%: %attr%</b>","See the change","gotoItinerary"],COMMENT:["comment",'<b>%user%</b> commented on <b>Day %day%: %attr%</b> "%comment%"',"Go to comment","gotoComment"]},STAY:{ADD:["update","<b>%user%</b> added <b>%dest%</b>","See the change","gotoDestination"],REMOVE:["update","<b>%user%</b> removed <b>%dest%</b>","",""],UPDATE:["update","<b>%user%</b> updated <b>%dest%</b>","See the change",
"gotoDestination"],COMMENT:["comment",'<b>%user%</b> commented on <b>%dest%</b> "%comment%"',"Go to comment","gotoComment"],DELETE_COMMENT:["comment","<b>%user%</b> has deleted a %comment_type%","",""],INSPIROCK_UPDATE:["update","<b>%user%</b> updated <b>%dest%</b> since %caused_by_user% %caused_by_action% %caused_by_item%","",""]},RESERVED:{ADD:["update","<b>%user%</b> added <b>%reserved%</b>","See the change","gotoItinerary"],REMOVE:["update","<b>%user%</b> removed <b>%reserved%</b>","",""],UPDATE:["update",
"<b>%user%</b> updated <b>%reserved%</b>","See the change","gotoItinerary"],COMMENT:["comment",'<b>%user%</b> commented on <b>%dest%</b> "%comment%"',"Go to comment","gotoComment"]},PLAN:{ADD:["update","<b>%user%</b> added the plan","See the change","gotoOverview"],REMOVE:["update","<b>%user%</b> removed the plan","",""],UPDATE:["update","<b>%user%</b> updated %property%","See the change","gotoOverview"],COMMENT:["comment",'<b>%user%</b> commented on the plan "%comment%"',"Go to comment","gotoComment"]},
COLLABORATOR:{ADD:["collaborator","<b>%user%</b> added <b>%collaborator_name%</b> as a %collaborator_role%","Manage co-travelers","manageCotraveler"],REMOVE:["collaborator","<b>%user%</b> removed <b>%collaborator_name%</b> from this plan","",""],JOIN:["collaborator","<b>%collaborator_name%</b> has joined this plan as a %collaborator_role%","",""],LEAVE:["collaborator","<b>%collaborator_name%</b> has left this plan","",""],REQUEST:["collaborator","<b>%collaborator_name%</b> has requested %collaborator_role% access",
"",""],GRANT_ACCESS:["collaborator","<b>%collaborator_name%</b> has granted %collaborator_role% access","",""]}},w={ADD:"added",REMOVE:"removed",UPDATE:"updated"},J={login:{icon:"info",title:"Your plan is auto-saved. To save permanently, or to access it from other devices, log in now.",action:{type:"login",title:"Log In"}},freetime:{icon:"exclamation",title:"You have free time in your plan for %dest%.",action:{type:"fixgaps",title:"Help me fix this"}},conflicts:{icon:"exclamation",title:"You have conflicts in your plan for %dest%.",
action:{type:"fixconflicts",title:"Help me fix this"}},betterroute:{icon:"mapmarker",title:"You can visit destinations in a different order to save travel time.",action:{type:"fixroute",title:"Recalculate my destination route"}},dayover:{icon:"exclamation",title:"Your plan is going <b>1 day past</b> your end date.",action:{type:"fixdays",title:"Help me fix this"}},daysover:{icon:"exclamation",title:"Your plan is going <b>%numdays% days past</b> your end date.",action:{type:"fixdays",title:"Help me fix this"}},
opendays:{icon:"exclamation",title:"You have <b>%numdays% open days</b> in your plan.",action:{type:"fixdays",title:"Help me fix this"}},openday:{icon:"exclamation",title:"You have <b>1 open day</b> in your plan.",action:{type:"fixdays",title:"Help me fix this"}},overflow:{icon:"exclamation",title:"You have conflicts in <b>%stay%</b>",action:{type:"fixOverflows",title:"Help me fix this"}}},F,y;G.getNotificationDisplayData=function(a){var b={},c=M[a.itemType][a.action],d=c[1].replace("%user%",a.fromUserId===
window.userId?"You":a.fromUserName||"Anonymous").replace("%dest%",u(a,["destinationName","destinationNames"])).replace("%attr%",f(a,"attractionName")).replace("%day%",f(a,"dayNumber")).replace("%reserved%",f(a,"title")).replace("%comment%",f(a,"comment")).replace("%comment_type%",l(a)).replace("%property%",e(a)).replace("%collaborator_name%",f(a,"collaboratorName")).replace("%collaborator_role%",f(a,"collaboratorRole").toLowerCase()).replace("%caused_by_item%",h(a)).replace("%caused_by_action%",n(f(a,
"causedByAction"))).replace("%caused_by_user%",k(a));b.title=d;d="inspirock"===a.fromUserId?"inspirock "+c[0]:c[0];b.icon=d;b.action=c[2];b.actionClass=c[3];b.timestamp=j.utc(a.timestamp).fromNow();return b};G.getAlertDisplayData=function(a){var b={},c=J[a.type],d=c.title.replace("%dest%",u(a,["destinationName","destinationNames"])).replace("%numdays%",f(a,"numDays")).replace("%stay%",f(a,"destinationName"));b.title=d;b.icon=c.icon;b.action=c.action.title;b.actionClass=c.action.type;b.timestamp=j.utc(a.timestamp).fromNow();
return b};var s=function(a){var b=$(this).parents(".notification").data("notification"),c=f(b,"destinationId"),d=f(b,"destinationName"),e=f(b,"stayId"),b="true"===f(b,"hasOverflow");p.trackEvent(a.data.source,"fixgaps");r();t("Fix plan",'<div class="tagline">You have free time in your plan for '+d+'</div><div class="clickable-text gotocalendar" data-stay-id="'+e+'"><div class="fa fa-calendar"></div><div class="resolve-text"><div>Use the calendar<br/>to make adjustments.</div></div></div><div class="or-row"><div class="or-line"></div><span class="or-txt">or</span></div><div class="clickable-text recalculate" data-stay-id="'+
e+'" data-destination-id="'+c+'" data-destination-name="'+d+'" data-has-overflow="'+b+'"><div class="fa fa-gears"></div><div class="resolve-text"><div>Recalculate my plan<br/>and fix it for me.</div></div></div><div class="clear"></div>',a.data.source)},H=function(a){var b=$(this).parents(".notification").data("notification"),c=f(b,"planDuration"),d=j.utc(f(b,"userStartDate"),"MMM DD, YYYY"),b=j.utc(f(b,"userEndDate"),"MMM DD, YYYY"),d=j.duration(b-d).add(1,"day").asDays()-c;p.trackEvent(a.data.source,
"fixdays");r();var e=1===d||-1===d?" day":" days",c="You have "+c+(1===c?" day":" days")+" in your plan which ",c=0<d?c+("leaves "+Math.abs(d)+e+" open before your end date of "+b.format("D MMM")+"."):c+("is "+Math.abs(d)+e+" past your end date of "+b.format("D MMM")+".");t("Fix Plan Days",'<div class="tagline">'+c+'</div><div class="clickable-text gotodestination"><div class="fa fa-map-marker"></div><div class="resolve-text"><div>Edit the amount of days<br/>for a destination in Route.</div></div></div><div class="or-row"><div class="or-line"></div><span class="or-txt">or</span></div><div class="clickable-text editdates"><div class="fa fa-calendar"></div><div class="resolve-text"><div>Edit your dates.</div></div></div><div class="clear"></div>',
a.data.source)},x=function(b){a.triggerEvent("notifications","show-tab-route",{addToHistory:!0});p.trackEvent(b.data.source,"fixroute");r();var c={view:""};g.makeAJAXcall({type:"GET",url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/optimizePathNotification",success:function(d){var e=$(d);e.dialog({resizable:!1,modal:!0,draggable:!1,width:"560px",position:{my:"top center",at:"bottom center"},dialogClass:"dlg-optimizepath-notification mediumx",buttons:[{html:"Cancel",click:function(){e.dialog("close")}},
{html:"Use this Route",click:function(){function d(e,i,j,k,l){m.showLoading($("#planRecalculating"),$("#resultpageContent"),"Updating Your Plan...");e=$.extend({stayOrder:h,forceMerge:e,userDIY:i},c);j&&(e.replanStayIds=j);k&&(e.adjustStayIds=k);l&&(e.isAllAdjusted=l);g.makeAJAXcall({type:"POST",url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/adjustRoute",data:e,synchronize:!0,success:function(c,e,f){f.getResponseHeader("Modified-Visits")?($("#pageWrapper").append($(c)),a.triggerEvent(b.data.eventSource,
"show-removed-visits-dlg",{cb:d})):(c={signupCancelCallback:function(){window.location.reload()}},a.triggerEvent("notifications","plan-update",c),c.signupDisplayed||window.location.reload())},complete:function(){f.prop("disabled",!1);m.hideLoading($("#planRecalculating"),$("#resultpageContent"));i&&a.triggerEvent("explore","show-tab-itinerary",{addToHistory:!1,tabData:{subnav:"calendar"}})}})}var f=e.parents(".ui-dialog").children(".ui-dialog-buttonpane").children(".ui-dialog-buttonset").find("button:contains('Use this Route')");
f.prop("disabled",!0);var h="";e.find(".stay-row").map(function(){0!==$(this).index()&&(h+=",");h+=$(this).data("stayId")});e.dialog("close");d(!1,!1)}}],open:function(){i.setupDialogOverlay(e,!1)},close:function(){$(this).dialog("destroy").remove()}})}})},A=function(){var b=$(this).parents(".notification").data("notification"),c=f(b,"stayId"),b=f(b,"date");a.triggerEvent("notifications","show-tab-itinerary",{addToHistory:!0,tabData:{subnav:"calendar",stayId:parseInt(c),date:b,showOverflow:!0}})},
E=function(a){var b=$(this).parents(".notification").data("notification"),c=f(b,"destinationId"),d=f(b,"destinationName"),e=f(b,"stayId"),g=f(b,"date"),b="true"===f(b,"hasOverflow");p.trackEvent(a.data.source,"fixconflicts");r();t("Fix plan",'<div class="tagline">You have conflicts in your plan for '+d+'. You can...</div><div class="clickable-text gotocalendar" data-stay-id="'+e+'" data-date="'+g+'"><div class="fa fa-calendar"></div><div class="resolve-text"><div>Use the calendar<br/>to make adjustments.</div></div></div><div class="or-row"><div class="or-line"></div><span class="or-txt">or</span></div><div class="clickable-text recalculate" data-stay-id="'+
e+'" data-date="'+g+'" data-destination-id="'+c+'" data-destination-name="'+d+'" data-has-overflow="'+b+'"><div class="fa fa-gears"></div><div class="resolve-text"><div>Recalculate my plan<br/>and fix it for me.</div></div></div><div class="clear"></div>',a.data.source)};G.generateNotificationDisplay=function(a,c){var d;d=a.userId?G.getNotificationDisplayData(a):G.getAlertDisplayData(a);var e=$(b);e.find(".title").html(d.title);e.find(".notification-icon").addClass(d.icon);e.find(".action").html(d.action);
e.find(".action").addClass(d.actionClass);e.find(".timestamp").html(d.timestamp);e.data("notification",a);d={source:c,notification:e.data("notification")};e.off("click.fixconflicts").on("click.fixconflicts",".fixconflicts",d,E).off("click.fixgaps").on("click.fixgaps",".fixgaps",d,s).off("click.fixdays").on("click.fixdays",".fixdays",d,H).off("click.fixroute").on("click.fixroute",".fixroute",d,x).off("click.gotoItinerary").on("click.gotoItinerary",".gotoItinerary",d,q).off("click.gotoDestination").on("click.gotoDestination",
".gotoDestination",d,D).off("click.gotoOverview").on("click.gotoOverview",".gotoOverview",d,v).off("click.gotoComment").on("click.gotoComment",".gotoComment",d,B).off("click.manageCotraveler").on("click.manageCotraveler",".manageCotraveler",d,C).off("click.fixOverflows").on("click.fixOverflows",".fixOverflows",d,A);return e};G.initialize=function(){y=$("#notifications");F=$("#planHeader");a.addObserver("refresh-notifications","notifications",z);a.addObserver("showHelpDialog","notifications",function(a,
b){t(b.name,b.dialogContent,b.source)});y.off("click.manageCotravelers").on("click.manageCotravelers",".manage-cotravelers",C)};return G});
define("plan/alerts","modules/analytics modules/ajax modules/events modules/utils moment plan/notifications jquery jqueryui qtip".split(" "),function(a,g,d,p,m,j){function i(){k.find("#action-alerts").removeClass("has-alerts");$(".num-notifications").text("0")}function c(b,c){if("qtip-notifications"===c.action){var e=c.$alertsButton;if(e.hasClass("active"))e.qtip("api").hide();else{var f=k.find(".plan-header-center").outerWidth(!1)-(e.offset().left-k.find(".plan-header-center").offset().left)-e.outerWidth(!0)/
2;e.qtip({content:c.$alertsHtml,show:{event:!1,ready:!0},hide:{event:"unfocus",fixed:!0},position:{container:k.find(".plan-nav"),my:"top center",at:"bottom center",adjust:{y:-12,scroll:!1},effect:!1},events:{show:function(b,f){e.addClass("active");if(e.hasClass("has-alerts")){i();var j=m.utc().valueOf();g.makeAJAXcall({type:"POST",url:window.contextPath+"/notifications/see",data:{planId:h.data("planId"),timestamp:j},success:function(){h.data("notificationSeenTimestamp",j)}})}c.numNotifications&&(f.elements.content.off("click.all").on("click.all",
"#showAll",function(){e.qtip("hide");d.triggerEvent("alerts","show-tab-notifications",{addToHistory:!0})}),a.trackEvent("alerts.dropdown","show"));$("#qtipBack").data("view","alerts").fadeIn("fast")},hide:function(){e.removeClass("active")}},style:{classes:"alerts-qtip qtip-light qtip-shadow",tip:{mimic:"top center",width:18,height:10,offset:f-9}}})}}}function b(){e=$("html").qtip({content:'<img class="progress-indicator" src="'+window.ajaxLoaderPath+'" alt="loading">Updating Your Plan...',show:{ready:!0},
hide:{event:!1},position:{at:"bottom left",my:"bottom left"},style:{classes:"qtip-light qtip-popup"}})}function f(){e&&e.length&&(e.qtip("destroy"),e=void 0)}function u(a,b){var c=b.notifications||[],e=b.alerts||[],c=c.filter(function(a){return a.timestamp>t});l=c.concat(l);var f=e.concat(l),e=f;f.sort(function(a,b){return b.timestamp-a.timestamp});f.length&&(t=f[0].timestamp);var g=!1;f.length>q&&(f=f.slice(0,q),g=!0);D.empty();for(var m=0;m<f.length;m++){var n=f[m],u=j.generateNotificationDisplay(n,
"alerts.dropdown");D.append(u)}g&&D.append(v);if(t>h.data("notificationSeenTimestamp")){if(k.find("#action-alerts").addClass("has-alerts"),f=document.createElement("div"),c.length&&!r&&n.fromUserId!==h.data("userId")){1<c.length?$("<div>You have "+c.length+" new notifications</div>").appendTo(f):(n=c[0],c=j.getNotificationDisplayData(n),$("<div>"+c.title+"</div>").appendTo(f));var s=$(f);$("html").qtip({content:s,events:{show:function(a,b){var c=window.setTimeout(function(){b.elements&&b.elements.target.qtip("destroy")},
5E3);s.find(".fa-times").click(function(){window.clearTimeout(c);b.elements&&b.elements.target.qtip("destroy")})}},show:{ready:!0},hide:{event:!1},position:{at:"bottom left",my:"bottom left"},style:{classes:"qtip-light qtip-popup"}})}}else i();var H=0;e&&$.each(e,function(a,b){b.timestamp>h.data("notificationSeenTimestamp")&&H++});$(".num-notifications").text(H);var x=D.clone(!0,!0),A=$("#action-alerts");(c=A.qtip("api"))&&c.destroy();var E=x.find(".notification").length;E||(x=$('<div class="empty">You have no plan notifications.</div>'));
A.off("click.alert-btn").on("click.alert-btn",function(){d.triggerEvent("alerts","page-change",{action:"qtip-notifications",$alertsButton:A,$alertsHtml:x.clone(!0),numNotifications:E})});"notifications"===p.params.get("trigger")&&k.find("#action-alerts").click();r=!1}var n={},k,h,e,l=[],t=0,r=!0,q=6,D=$("<div class='notifications'></div>"),v=$("<div class='show-all'><a id='showAll'>all notifications</a></div>");n.initialize=function(){k=$("#planHeader");h=$("#plan");d.addObservers(["synchronized-ajax-begin"],
"alerts",b);d.addObservers(["synchronized-ajax-complete"],"alerts",f);d.addObserver("poll","alerts",u);d.addObserver("post-route-change","qtip-notifications",c)};return n});
define("plan/poll",["modules/ajax","modules/events"],function(a,g){function d(){c&&c.abort();b&&(c=a.makeAJAXcall({url:window.contextPath+"/poll",type:"GET",suppressErrorDialog:!0,abortIfSynchronizedCallInProgress:!0,data:{planId:k.data("planId"),fromTimestamp:i},success:function(a){a.error?m.setEnabled(!1):(i=a.timestamp,g.triggerEvent("poll","poll",a))},complete:function(){c=null;var a=k.data("collaborationEnabled")&&"VIEWER"!==k.data("planUserRole")?f:u;j=setTimeout(d,a)},abort:function(){c=null;
j=setTimeout(d,n)}}))}function p(){j&&(window.clearTimeout(j),j=null);j=setTimeout(d,0)}var m={},j,i,c,b=!0,f=2E4,u=18E4,n=2E3,k;m.setEnabled=function(a){b=a};m.initialize=function(){k=$("#plan");g.addObservers("plan-update stay-add stay-remove stay-update travel-update visit-add visit-remove visit-update reserved-add reserved-remove reserved-update hop-add hop-remove hop-update collaborator-add".split(" "),"alerts",function(){p()});g.addObservers(["stop-poll"],"ajax",function(){m.setEnabled(!1)});
p()};return m});
define("plan/attachments","modules/ajax plan/planUtils modules/analytics modules/analyticsEventParams jquery jqueryui jQueryExtensions/inspirockAutocomplete jQueryExtensions/photoSlider qtip".split(" "),function(a,g,d,p){function m(a,b){var d=b.find(".attachment-list"),i=[],m=$("#plan").data("allowedFileTypes"),k=$("#plan").data("allowedFileExtension"),h=$("#plan").data("maxFileUploadSize");b.siblings(".error").html("");for(var e=!1,l=0;l<a.length;l++){var p=a[l];if(p.size>h)e=p.name+" could not be uploaded. File size cannot be more than "+
h/1E6+" MB.<br /><br />",b.siblings(".error").append(e),e=!0;else if(!p.type||-1===m.indexOf(p.type))e=p.name+" could not be uploaded. Please upload from one of the following file types: "+k+".<br /><br />",b.siblings(".error").append(e),e=!0;else{var r=$(g.getFormattedAttachmentLink(p));d.append(r);r.find(".attachment-link").removeClass("text-link").siblings(".attachment-cross").addClass("hidden");i.push({file:p,element:r})}}b.siblings(".error").toggleClass("hidden",!e);var q=b.parents(".ui-dialog-content");
q.length&&(q.dialog({position:{my:"center",at:"center",of:window}}),$(window).height()>q.outerHeight()?q.parents(".ui-dialog").removeClass("fixedTop"):q.parents(".ui-dialog").addClass("fixedTop"),q.siblings(".ui-dialog-buttonpane").find("button").addClass("uploading").attr("disabled",!0));b.siblings(".save-event, .save-custom-event").addClass("uploading").attr("disabled",!0);j(i,0,function(){b.siblings(".save-event, .save-custom-event").removeClass("uploading").removeAttr("disabled");q.length&&q.siblings(".ui-dialog-buttonpane").find("button").removeClass("uploading").removeAttr("disabled")});
d=b.parents(".qtip");d.length&&d.qtip("api").reposition(null,!1)}function j(c,b,f){if(b>=c.length)f();else if(c[b].element.is(":visible")){var g=c[b].element.find(".progress"),i=c[b].element.parents(".attachment-container"),k=a.fileUpload({files:[c[b].file],url:window.contextPath+"/trip/"+$("#plan").data("planId")+"/attachment",success:function(a){a[0].error?(a=a[0].fileName+" could not be uploaded. "+a[0].message+".<br /><br />",i.siblings(".error").removeClass("hidden").append(a),c[b].element.remove()):
(c[b].element.find(".attachment-link").addClass("text-link").data("attachmentId",a[0].id).siblings(".attachment-cross").removeClass("hidden"),g.css("visibility","hidden"),a=$(".tab-content:visible").attr("id"),d.trackEvent(a+"."+i.data("type"),p.ACT_ADD_ATTACHMENT));c[b].element.off("remove");j(c,++b,f)},error:function(a){"abort"!==a.statusText&&i.siblings(".error").removeClass("hidden").append("Unexpected error occured. Please upload your attachment after some time.");c[b].element.off("remove");
c[b].element.remove();j(c,++b,f)},progress:function(a){g.css("width",100*a.loaded/a.total+"%")}});c[b].element.off("remove").on("remove",function(){k&&k.abort()})}else j(c,++b,f)}function i(a){a.stopPropagation();a.preventDefault()}return{initialize:function(){var a=$(document),b=$("body");b.off("click.attachment-link").on("click.attachment-link",".attachment-link",function(){$(this).data("attachmentId")&&window.open(window.contextPath+"/trip/"+$("#plan").data("planId")+"/attachment/"+$(this).data("attachmentId"),
"_blank")});a.off("dragenter.document").on("dragenter.document",i).off("dragover.document").on("dragover.document",i).off("drop.document").on("drop.document",i);b.off("click.delete-attachment").on("click.delete-attachment",".notes-attachment-wrapper .attachment-cross-wrapper",function(){$(this).parents(".attachment").remove()}).off("click.attach-icon").on("click.attach-icon",".attach-icon-wrapper",function(){$(this).siblings("#multi-attach-file").click()}).off("change.multi-attach-file").on("change.multi-attach-file",
"#multi-attach-file",function(a){a=a.target.files;a.length&&(m(a,$(this).parents(".attachment-container")),$("#multi-attach-file").val(""))}).off("drop.notes-attachment-wrapper").on("drop.notes-attachment-wrapper",".notes-attachment-wrapper",function(a){a.preventDefault();m(a.originalEvent.dataTransfer.files,$(this))})}}});
define("modules/introtips",["modules/utils","modules/events","modules/view","jquery","qtip"],function(a,g,d){function p(){$(".qtip.prod-intro-tip").qtip("destroy",!0)}function m(){for(var a in n)window.localStorage.setItem(a,!1);window.localStorage.setItem("showStartTip",!1)}function j(a,b){var c=window.localStorage.getItem("showHelpTip");if(!(c&&"false"===c)){$("html, body").animate({scrollTop:0},100);var c=$("#help-container").find(".help-tips"),d={text:$('<div class="content nohide"><div class="title empty"></div><div class="message help">You can always find <br/>helpful tips here</div></div><div class="navigation-buttons tips separate"><div class="done">Done</div></div>'),
button:!0};a&&d.text.find(".help").html(a);c.qtip({content:d,position:{my:"top right",at:"bottom center",adjust:{x:13,y:10},viewport:$(window)},show:{ready:!0},hide:{event:"unfocus",fixed:!0},style:{classes:"prod-intro-tip qtip-light qtip-shadow overview-tip",tip:{corner:!0,width:20,height:10,mimic:"top center",offset:10}},events:{show:function(a,b){b.elements.button.removeAttr("title");$(this).off("click.done").on("click.done",".done",function(){b.destroy()})},hide:function(a,c){0===$(window).scrollTop()&&
b&&$("html, body").animate({scrollTop:b},100);c.destroy()}}});window.localStorage.setItem("showHelpTip",!1)}}function i(d,f){0===$(".qtip.prod-intro-tip").find(".nohide").length&&$(".qtip.prod-intro-tip").qtip("destroy",!0);var g=$("#plan").data("planUserRole").toLowerCase();if(!(0<window.location.pathname.search("https://www.inspirock.com/modal/")||a.params.get("token"))&&!("owner"!==g&&"cotraveler"!==g)){var h=f.tabName||b();f.force&&(window.localStorage.setItem(h,!0),window.localStorage.setItem("showStartTip",!1));if(n.hasOwnProperty(h)){if("false"!==
window.localStorage.getItem(h)){var g={text:$('<div class="content"><div class="message start">Welcome! <br/>  Here is a short intro</div></div><div class="navigation-buttons separate"><div class="start next">Start intro</div></div>'),button:!0},i=!1;if("true"===window.localStorage.getItem("showStartTip")){var p=k.position.target;p instanceof jQuery||(p=$(p));p.qtip({overwrite:!0,content:g,position:k.position,show:{ready:!0},hide:{event:"unfocus",fixed:!0},style:k.style,events:{show:function(a,b){b.elements.button.removeAttr("title");
window.localStorage.setItem("showStartTip",!1);$(this).off("click.start").on("click.start",".start",function(){i=!0;b.destroy();c(n[h].start,n[h].start-1,n[h],h)})},hide:function(a,b){i||(a.originalEvent.currentTarget.classList.contains("qtip-close")&&j(null,$(window).scrollTop()),m());b.destroy()}}})}else c(n[h].start,n[h].start-1,n[h],h)}}else window.localStorage.setItem("showHelpTip",!0),j("Sorry, we don\u2019t have any <br/> tips for you right now"),window.localStorage.removeItem(h)}}function c(a,
b,f,g){if(!(a>f.end||a<f.start)){var i=h[a].position.target;i instanceof jQuery||(i=$(i).first());h[a].targetcheck&&(i=h[a].targetcheck(i));if(0>=i.length){a=b>a?a-1:a+1;if(a>f.end||a<f.start)return;i=h[a].position.target;i instanceof jQuery||(i=$(i).first())}var b=h[a],k="#overviewRoutePane"===b.subnav?$(b.subnav):i;"#calendar"!==b.subnav?d.scrollElementIntoView(k,-$(".tab-overview").height()):b.isScrollRequired&&d.scrollCalendarElementIntoView(k,k.height());var k={ready:!0},p={event:"unfocus",fixed:!0},
u={text:$('<div class="content"><div class="title"></div><div class="message guide"></div></div>'+(b.contentButtons?b.contentButtons:'<div class="navigation-buttons tips"><div class="back">Back</div><div class="next">Next</div></div>')),button:!0},z={corner:!0,width:20,height:10};b.hasOwnProperty("mimic")&&(z.mimic=b.mimic);b.hasOwnProperty("offset")&&(z.offset=b.offset);b.hasOwnProperty("message")&&u.text.find(".message").html(b.message);var C,G;"#calendar"!==b.subnav?(C=b.title+" of "+n[b.nav].count,
G=n[b.nav].count):(C=b.title+" of "+n[b.subnav].count,G=n[b.subnav].count);1===b.title&&u.text.find(".back").addClass("disabled");1<G&&b.hasOwnProperty("title")&&u.text.find(".title").html(C);1===G&&b.hasOwnProperty("title")&&u.text.find(".title").addClass("empty");b.position.viewport=$(window);b.style.tip=z;var M=!0;i.qtip({content:b.content?b.content:u,position:b.position,show:b.show?b.show:k,hide:b.hide?b.hide:p,style:b.style,events:{show:function(b,d){d.elements.button.removeAttr("title");var h=
$(this);h.off("click.start").on("click.start",".start",function(){M=!1;d.destroy();c(a+1,a,f)});h.off("click.skip").on("click.skip",".skip",function(){j(null,$(window).scrollTop());d.destroy()});h.off("click.finish").on("click.finish",".finish",function(){M=!1;window.localStorage.setItem(g,!1);d.destroy();j(null,$(window).scrollTop())});h.off("click.next").on("click.next",".next",function(){M=!1;d.destroy();c(a+1,a,f,g)});h.off("click.back").on("click.back",".back",function(){$(this).hasClass("disabled")||
(M=!1,d.destroy(),c(a-1,a,f,g))})},hide:function(a,b){M&&(a.originalEvent&&a.originalEvent.currentTarget.classList.contains("qtip-close")&&j(null,$(window).scrollTop()),m());b.destroy()}}})}}function b(){var a="#"+$(".tab-content.active").attr("id"),b=a;"#itinerary"===a?$("#calendar").is(":visible")?b="#calendar":$("#maps").is(":visible")&&(b="#maps"):"#overview"===a?$("#overviewRoutePane").hasClass("one-destination")&&(b="#overviewOneStay"):"#transportation"===a&&($(a).find(".train").hasClass("hidden")||
(b="#train"));return b}function f(a,c){var d=b();n.hasOwnProperty(d)&&$("#plan").data("editEnabled")&&c.$showTips.removeClass("hidden")}var u={},n={},k={position:{my:"bottom center",at:"top center",adjust:{x:40,y:-10,screen:!0},target:".tab-itinerary",viewport:$(window)},style:{classes:"prod-intro-tip qtip-light qtip-shadow start-tip",width:"338",tip:{corner:!0,width:20,height:10}},nav:"#overview",subnav:"#overview",mimic:"bottom center"},h=[{message:"Update your Route <br/> and Dates",position:{my:"right center",
at:"left center",adjust:{x:-10},target:"button.edit:visible, button.add-destination:visible"},style:{classes:"prod-intro-tip qtip-light qtip-shadow overview-tip"},nav:"#overviewOneStay",subnav:"#overview",mimic:"right center",targetcheck:function(a){return!a.is(":visible")?$(".add-destination"):a}},{message:"View & edit your <br/> day-by-day schedule",contentButtons:'<div class="navigation-buttons tips last"><div class="back">Back</div><div class="finish">Finish</div></div>',position:{my:"bottom center",
at:"top center",adjust:{y:-10},target:".tab-itinerary"},style:{classes:"prod-intro-tip qtip-light qtip-shadow overview-tip"},nav:"#overviewOneStay",subnav:"#overview"},{message:"View & edit your plan's<br/> high level route",contentButtons:'<div class="navigation-buttons tips"><div class="back disabled">Back</div><div class="next">Next</div></div>',position:{my:"bottom center",at:"top left",adjust:{x:24,y:-10},target:$(".tab-overview")},style:{classes:"prod-intro-tip qtip-light qtip-shadow overview-tip"},
nav:"#overview",subnav:"#overview",offset:-64},{message:"View & edit your <br/> day-by-day schedule",position:{my:"bottom center",at:"top center",adjust:{y:-10},target:$(".tab-itinerary")},style:{classes:"prod-intro-tip qtip-light qtip-shadow overview-tip"},nav:"#overview",subnav:"#overview"},{message:"Edit dates and reorder<br/> your route",position:{my:"left center",at:"right center",adjust:{x:10.4},target:".durationText"},style:{classes:"prod-intro-tip qtip-light qtip-shadow overview-tip"},nav:"#overview",
subnav:"#overviewRoutePane"},{message:"Change transportation <br/> options",position:{my:"left center",at:"right center",adjust:{y:1},target:".options"},style:{classes:"prod-intro-tip qtip-light qtip-shadow overview-tip"},nav:"#overview",subnav:"#overviewRoutePane"},{message:"Add more destinations <br/> to your plan",position:{my:"right center",at:"left center",adjust:{x:-10},target:".add-destination"},style:{classes:"prod-intro-tip qtip-light qtip-shadow overview-tip"},nav:"#overview",subnav:"#overviewRoutePane"},
{message:"Update your trip dates",contentButtons:'<div class="navigation-buttons tips last"><div class="back">Back</div><div class="finish">Finish</div></div>',position:{my:"bottom center",at:"top center",adjust:{x:5,y:-5},target:".change-dates-link"},style:{classes:"prod-intro-tip qtip-light qtip-shadow overview-tip"},nav:"#overview",subnav:"#overviewRoutePane",offset:90},{message:"Edit your day-by-day <br/> schedule in Calendar view",position:{my:"top center",at:"bottom center",target:"#calendarlink"},
style:{classes:"prod-intro-tip qtip-light qtip-shadow overview-tip"},nav:"#itinerary",subnav:"#tab-itinerary"},{message:"Explore more daily activities <br/> and add them to your plan",contentButtons:'<div class="navigation-buttons tips last"><div class="back">Back</div><div class="finish">Finish</div></div>',position:{my:"right center",at:"left center",adjust:{x:-5},target:".subnav-actions"},style:{classes:"prod-intro-tip qtip-light qtip-shadow overview-tip"},nav:"#itinerary",subnav:"#tab-itinerary"},
{message:"Drag or resize boxes <br/> to update your schedule",contentButtons:'<div class="navigation-buttons tips"><div class="skip">Skip</div><div class="next">Next</div></div>',position:{my:"bottom center",at:"top center",adjust:{y:10},target:".visitEvent"},style:{classes:"prod-intro-tip qtip-light qtip-shadow overview-tip"},nav:"#itinerary",subnav:"#calendar",isScrollRequired:!0},{message:"Explore more daily activities<br/>and add them to your plan",contentButtons:'<div class="navigation-buttons tips last"><div class="back">Back</div><div class="finish">Finish</div></div>',
position:{my:"right center",at:"left center",adjust:{x:0},target:".subnav-actions"},style:{classes:"prod-intro-tip qtip-light qtip-shadow overview-tip"},nav:"#itinerary",subnav:"#calendar"},{message:"Search activities by name",contentButtons:'<div class="navigation-buttons tips last"><div class="back disabled">Back</div><div class="finish">Finish</div></div>',position:{my:"top center",at:"bottom center",adjust:{x:-25},target:"#explore-search"},style:{classes:"prod-intro-tip qtip-light qtip-shadow overview-tip"},
nav:"#explore",subnav:"#explore"},{message:"Add or delete activities <br/> from your plan",contentButtons:'<div class="navigation-buttons tips last"><div class="back disabled">Back</div><div class="finish">finish</div></div>',position:{my:"bottom center",at:"top center",adjust:{y:-5},target:"button.delete-button"},style:{classes:"prod-intro-tip qtip-light qtip-shadow overview-tip"},nav:"#exploreHide",subnav:"#explore"},{message:"search for travel <br/>based on your plan",contentButtons:'<div class="navigation-buttons tips separate"><div class="finish">Finish</div></div>',
position:{my:"top center",at:"bottom center",adjust:{y:5},target:".start-destination:visible"},style:{classes:"prod-intro-tip qtip-light qtip-shadow overview-tip"},nav:"#transportation",subnav:"#transportation"}];u.hasHelpTips=function(a){return n.hasOwnProperty(a)};u.initialize=function(){for(var a=0;a<h.length;a++)"#calendar"!==h[a].subnav?(n.hasOwnProperty(h[a].nav)?n[h[a].nav].count+=1:n[h[a].nav]={count:1,start:a},h[a].title=n[h[a].nav].count):(n.hasOwnProperty(h[a].subnav)?n[h[a].subnav].count+=
1:n[h[a].subnav]={count:1,start:a},h[a].title=n[h[a].subnav].count);for(var b in n)window.localStorage.hasOwnProperty(b)||window.localStorage.setItem(b,!0),a=n[b],a.end=a.start+a.count-1;window.localStorage.hasOwnProperty("showStartTip")||window.localStorage.setItem("showStartTip",!0);window.localStorage.hasOwnProperty("showHelpTip")||window.localStorage.setItem("showHelpTip",!0);g.addObserver("show-help-tips","introtips",i);g.addObserver("clean-help-tips","introtips",p);g.addObserver("enable-help-tips",
"introtips",f)};return u});define("text%21templates/refreshPlanCotraveler.html",[],function(){return'<div class="refresh-plan">\n    <i class="fa fa-refresh"></i>\n    <span class="text">This plan has been updated by one of your co-travelers.</span>\n    <a href="javascript:void(0);" class="reload">Refresh Plan</a>\n</div>'});define("text%21templates/refreshPlanFriend.html",[],function(){return'<div class="refresh-plan">\n    <i class="fa fa-refresh"></i>\n    <span class="text">This plan has been updated.</span>\n    <a href="javascript:void(0);" class="reload">Refresh Plan</a>\n</div>'});
define("text%21templates/collabCotravelerWelcome.html",[],function(){return'<div class="clearfix">\n    <div>\n        <div class="sheet ticket"></div>\n        <div class="line1">Plan your trip to <span class="plan-name"></span><br/>with <span class="owner-name"></span>...</div>\n        <div class="line2">Welcome to Inspirock. Here we help you get the most out of your vacation. <span class="owner-name"></span> has already started a plan for your trip. As a co-traveler, you can edit and customize this plan along with them.</div>\n    </div>\n</div>'});
require("preprocess modules/analytics modules/analyticsEventParams modules/header modules/ajax modules/utils modules/events plan/overview plan/itinerary plan/hotels plan/todolist explore/explore explore/exploreWrapper plan/transportation plan/comments plan/travelAgent plan/tabs plan/planHeader modules/modal plan/customize plan/alerts modules/history modules/view modules/dock modules/viator plan/poll plan/notifications plan/collaboration plan/attachments modules/introtips modules/map moment text!templates/refreshPlanCotraveler.html text!templates/refreshPlanFriend.html text!templates/collabCotravelerWelcome.html jquery jqueryui jqueryuioverrides jQueryExtensions/inspirockDatepicker".split(" "),
function(a,g,d,p,m,j,i,c,b,f,u,n,k,h,e,l,t,r,q,D,v,B,z,C,G,M,w,J,F,y,s,H,x,A,E){function K(){if(!window.registeredUserLoggedIn&&!$(this).hasClass("create-similar")&&!U.data("isAnonymous")){if(!W){$(".dlg-large-map .ui-dialog-content").dialog("close");W=!0;var a=$("<div />");a.dialog({resizable:!1,modal:!0,title:"You must login to edit",draggable:!1,width:"460px",dialogClass:"dlg-login-create-similar inverted mediumx",buttons:{Login:function(){j.login()}},create:function(){$(".dlg-login-create-similar").append('<div class="close-button-container"></div><div class="footer"><div class="or-txt"><span>or</span></div><div>Do you want to add a similar plan to your account?</div><a class="create-similar-link" href="javascript:void(0);">Click here to create a similar plan.</a></div>');
$(".dlg-login-create-similar .create-similar-link").off("click").on("click",function(){a.dialog("close");L()})},open:function(){j.setupDialogOverlay(a,!1)},close:function(){W=!1}})}}else L()}function L(){Y||(Y=!0,m.makeAJAXcall({type:"GET",data:{inPlan:!0},url:window.contextPath+"/trip/"+U.data("planId")+"/claim",success:function(a){var b=$(a),c=b.find("#startDate"),d=b.find("#endDate"),e=b.find(".claim-button");b.dialog({resizable:!1,modal:!0,draggable:!1,width:"460px",dialogClass:"dlg-claimPlan mediumx",
open:function(){j.setupDialogOverlay(b,!1);c.inspirockDatepicker({dateFormat:"M dd, yy",minDate:"+0d"}).off("focus").on("click",function(){c.datepicker($(this).datepicker("widget").is(":visible")?"hide":"show")});e.click(function(){var a=e.siblings(".error-message");if(c.val().length){a.addClass("hidden");e.attr("disabled","disabled");var f={startDate:c.val(),endDate:d.val(),planID:U.data("planId")};m.makeAJAXcall({url:window.contextPath+"/planClaim",type:"POST",data:f,success:function(a){e.prop("disabled",
!1);window.location=window.contextPath+a},complete:function(){e.removeAttr("disabled");b.dialog("close")},error:function(){a.text("Please provide future date").removeClass("hidden")}})}else a.text("Please provide start date").removeClass("hidden")})},close:function(){Y=!1;b.dialog("destroy").remove()}})},error:function(){Y=!1}}))}function Q(a,b){if(!(b.version<=U.data("version"))){M.setEnabled(!1);var c=U.data("planUserRole"),c=-1<["FRIEND","VIEWER"].indexOf(c),d=U.data("collaborationEnabled");j.showFlash(c||
!d?A:x).find(".refresh-plan a").on("click",function(){window.location.href=document.location.pathname+j.addUrlParam(document.location.search,"force_reload","")})}}function N(){var a=$(".plan-title"),b=a[0];j.ellipsizeNames(a);b.scrollWidth>b.offsetWidth?(a.css("overflow","hidden"),a.removeClass("afterLoad")):(a.css("overflow","visible"),a.addClass("afterLoad"))}function O(){var a=$(".plan-title");a.html(U.data("planName"));a.data("fullTitle",a.text().trim());a=H(U.data("planEndDate"),ba).diff(H(U.data("planStartDate"),
ba),"days")+1;$(".plan-title-wrapper .num-days").text(a);$(".plan-title-wrapper .units").text(1===a?"day":"days");$(".plan-title-wrapper .subtitle").text(U.data("displayDate"));N();U.data("planImgUrl")&&($(".overview-header").css("background-image",'url("'+U.data("planImgUrl")+'")').data("sourceUrl",U.data("planImgSourceUrl")).data("artist",U.data("planImgAuthor")).data("name",U.data("planImgTitle")),a=$(".overview-header").siblings(".copyright"),U.data("planImgAuthor")?(a.length||(a=$("<a></a>").addClass("copyright copyright-fancy-box-div").html("&copy").appendTo($(".overview-header").parent())),
a.data("fancyboxTitle",U.data("planImgTitle")).attr("href",U.data("planImgUrl"))):a.remove());"true"===U.data("travelWarning")?($("#pageWrapper").addClass("hasTravelWarning"),0===$(".travel-warning").length?(a='<a target="_blank" rel="nofollow" href="https://travel.state.gov/content/passports/en/alertswarnings.html"><span class="travel-warning">Travel Warning: Security Concerns &emsp; More Info',a+="</span></a>",$(a).insertAfter(".plan-title-wrapper")):$(".travel-warning").removeClass("hidden")):
($("#pageWrapper").removeClass("hasTravelWarning"),$(".travel-warning").addClass("hidden"))}function I(){var a=$(".similar-plans-list");a.toggleClass("expanded");a.hasClass("expanded")&&($(this).addClass("hidden"),$(".see-all-plans").removeClass("hidden"),$("html,body").animate({scrollTop:$(".similar-plans").offset().top-80},"fast"))}function T(a){var b=$(this);13===a.keyCode?(a.stopPropagation(),b.trigger("blur")):($("#pageContent").find(".hidden-title").text(b.val()),a=$("#pageContent").find(".hidden-title").width(),
a=Math.max(450,Math.min(910,a)),b.css("width",a+20))}var S={},U,aa,W=!1,Y=!1,V,ba=j.ISO_DATE_FORMAT,ha=function(a,b){var c=0;a&&(c=$("#"+a).offset().top-j.getFloatingBarsHeight());b?$("html, body").animate({scrollTop:65<c-50?c-50:$("#pageHeader").outerHeight()},500):window.scrollTo(0,65<c-50?c-50:$("#pageHeader").outerHeight())},ia=function(a,b,c,d,e){var f=$("#"+a),g=$("#plan-nav .tab-"+a),h=function(){c&&ha(c,!1);e&&e()};if(b=b.isDirty())f.one("refreshed",h);d&&B.push(a,a,f.data("url"),void 0);
g.trigger("click");b||h();return!1};$.fn.setCursorPosition=function(a){return 0===this.length?this:$(this).setSelection(a,a)};$.fn.setSelection=function(a,b){if(0===this.length)return this;input=this[0];if(input.createTextRange){var c=input.createTextRange();c.collapse(!0);c.moveEnd("character",b);c.moveStart("character",a);c.select()}else input.setSelectionRange&&(input.focus(),input.setSelectionRange(a,b));return this};$.fn.focusEnd=function(){this.setCursorPosition(this.val().length);return this};
S.initialize=function(){aa=$("#resultpageContent");U=$("#plan");$("#planRecalculating");V=$("#pageContent").find(".similar-plans");var x=$("#resultpageContent .tab-content:visible").attr("id");g.setProperty("page","/plan/"+x);(x=j.getParameterByName("flash"))&&j.showFlash(x,!0);var A=function(a,b,c){var d=a.parents(".tab-content"),e="";0<d.length&&(e+=d.attr("id"));e+="."+a.data("eventSrc");g.trackEvent(e,b,c)};$("body").off("click.calendarLink").on("click.calendarLink",".calendarLink",function(a){a.preventDefault();
a=q.isOpen()?$(".modal-box .ui-dialog-content").scrollTop():window.pageYOffset;q.close();A($(this),"calendar-link","calendar");var c={date:$(this).data("date"),visitId:$(this).data("visitId"),pageYOffset:a};$(this).hasClass("leftpane-calendar-link")&&(c.date=$("#itineraryLeftPane").find(".active").data("date"));return ia("itinerary",b,void 0,!1,function(){c.subnav="calendar";b.showCalendar(c)})});aa.off("click.dayByDayLink").on("click.dayByDayLink",".dayByDayLink",function(){A($(this),"itinerary-list-link");
return ia("itinerary",b,void 0,!0,function(){b.showDayByDayDay()})});aa.off("click.dayByDayStayLink").on("click.dayByDayStayLink",".dayByDayStayLink",function(){var a=$(this).data("date"),c=$(this).data("stayId"),d=$(this).data("name");A($(this),"itinerary-list-link",d.toLowerCase());return ia("itinerary",b,void 0,!0,function(){b.showDayByDayDay(a,c)})});aa.off("click.hotelLink").on("click.hotelLink",".hotelLink",function(){A($(this),"hotel-link");return ia("hotels",f,void 0,!0,void 0)});aa.off("click.hotelStayLink").on("click.hotelStayLink",
".hotelStayLink",function(){var a=$(this).data("stayId"),b=$(this).data("name"),a="hotels-stay-"+a;A($(this),"hotel-stay-link",b.toLowerCase());return ia("hotels",f,a,!0,void 0)});aa.off("click.exploreLink").on("click.exploreLink",".exploreLink",function(){A($(this),"explore-link","explore");return ia("explore",n,void 0,!0,void 0)});aa.off("click.transportLink").on("click.transportLink",".transportLink",function(){A($(this),"transport-link");return ia("transportation",h,void 0,!0,void 0)});aa.off("click.routeLink").on("click.routeLink",
".routeLink",function(){A($(this),"route-link");ha("route",!0);return!1});x=$("body");x.off("click.attrDetailPageLink").on("click.attrDetailPageLink",".attractionDetailsLink,.attLink",k.attractionDetailsPageLinks);x.off("click.destDetailPageLink").on("click.destDetailPageLink",".destinationDetailsLink,.destLink",k.destinationDetailsPageLinks);if($("body").hasClass("edit-enabled")){$("#pageContent").find(".plan-title").addClass("editable");var L=$("#pageContent").find(".plan-title");L.data("fullTitle",
L.text().trim());var S=$("#pageContent").find(".hidden-title");L.after("<input class='editable-plan-title' type='text' maxlength='140' style='display:none' />");var W=L.next();L.click(function(){if(!$(".bottom-pane").hasClass("visible")){var a=S.width(),a=Math.max(450,Math.min(910,a));L.hide();W.val(L.data("fullTitle"));W.css({display:"block",width:a+20});W.focusEnd();W.off("keyup").on("keyup",T);$(W).off("blur").on("blur",function(a){a.stopPropagation();var a=U.data("planId"),b=L.data("fullTitle"),
c=W.val().trim();b===c?(W.hide(),L.show()):m.makeAJAXcall({url:window.contextPath+"/trip/"+a+"/editname",type:"POST",data:{name:c},success:function(){var a=U.data("planName").trim();a&&(W.hide(),L.html(a),L.data("fullTitle",L.text().trim()),$("#pageContent").find(".hidden-title").html(a),L.show(),document.title=L.text().trim(),N(),g.trackEvent(d.CAT_PLAN,d.ACT_PLAN_RENAME))}})})}})}$("body").off("click.claimPlan").on("click.claimPlan",".claimPlanLink",K);y.initialize();p.initialize();B.initialize();
b.initialize();c.initialize();f.initialize();h.initialize();k.initialize($("#explore"));w.initialize();D.initialize();v.initialize();r.initialize();C.initialize();z.initialize();t.initialize();e.initialize();M.initialize();l.initialize();N();s.initializeOnLoad();i.addObserver("poll","plan",Q);i.addObservers("stay-add stay-remove stay-update plan-delete plan-update travel-update visit-add visit-remove".split(" "),"plantitle",O);i.addObserver("claimPlan","plantitle",function(){K()});i.addObserver("initialize-itinerary",
"plan",b.initialize);i.addObserver("dayTime-click","plan",function(a,c){c.pageYOffset=q.isOpen()?$(".modal-box .ui-dialog-content").scrollTop():window.pageYOffset;q.close();return ia("itinerary",b,void 0,!1,function(){b.showCalendar(c)})});if("COTRAVELER"===U.data("planUserRole")&&j.params.get("token")){var Y=$("<div>");Y.html(E);Y.find(".plan-name").text(U.data("planName"));Y.find(".owner-name").html(J.formatCollaboratorNames(U.data("cotraveler-names")));Y.find(".show-others").off("click").on("click",
function(){var a=$("#plan").data("cotravelerNames").split(","),b=[];$.each(a,function(a,c){b.push({name:c})});J.showReadonlyCollaborationDialog(b,"COTRAVELER")});Y.dialog({resizable:!1,modal:!0,draggable:!1,title:'Welcome <span class="bold">co-traveler!</span>',width:"650px",dialogClass:"dlg-collab inverted cotraveler-welcome mediumx",buttons:{"LET'S GO!":function(){Y.dialog("close")}},open:function(){j.setupDialogOverlay(Y,!1)},close:function(){Y.dialog("destroy").remove()}})}$("img.stay-img, img.visit-img, img.attr-img").on("error",
function(){$(this).unbind("error").attr("src",window.contextPath+"/res/images/assets/no-image-graphic.jpg")});a.initialize();G.initialize();u.initialize();V.length&&V.find(".toggle-more-plans").click(I);F.initialize();if((x=U.data("editEnabled"))&&!U.data("isCreateLogged")){U.data("isCreateLogged",!0);g.trackNonInteractionEvent(d.CAT_CREATE_PLAN,d.ACT_CREATE_PLAN);var ba=U.data("planParams"),Ba=H(U.data("creationDate"),"ddd MMM D hh:mm:ss z YYYY").hours(0).minutes(0).seconds(0).milliseconds(0),ya=
H(ba.startDate,"ddd MMM D hh:mm:ss z YYYY").hours(0).minutes(0).seconds(0).milliseconds(0);ba.daysAhead=H.duration(ya-Ba).asDays();m.makeAJAXcall({type:"POST",url:window.contextPath+"/trip/"+U.data("planId")+"/analyticsRecorded",data:{event:"create"}});if(window.fbGoal1Count)for(ba=0;ba<fbGoal1Count;ba++)fbq("track","ViewContent",{content_name:"Goal 1"})}ba=H.utc(U.data("planStartDate"),j.ISO_DATE_FORMAT);Ba=H.utc(U.data("planEndDate"),j.ISO_DATE_FORMAT);ya=H.utc();x&&(ya.isAfter(ba)&&ya.isBefore(Ba))&&
g.trackNonInteractionEvent(d.CAT_PLAN,d.ACT_LOAD_IN_TRAVEL)};S.initialize();return S});define("plan",function(){});